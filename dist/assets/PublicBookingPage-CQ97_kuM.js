import{ak as $,al as oe,af as ne,e as ie,r as c,s as k,j as e,l as T,p as le,m as J,o as ce,a7 as Q,M as X,am as q,B as x,J as d,ab as C,A as de,I as z,h as W,a as G,ae as me,an as xe,a6 as ue,aa as pe}from"./index-qkwE8oul.js";import{C as he}from"./copy-CZoSjBXq.js";import{I as fe}from"./instagram-DSz6wspD.js";import{G as ge}from"./globe-BdEbVOQS.js";import{s as be,a as je}from"./subMonths-B0FMKiyg.js";import{p as B}from"./pt-BR-CiBMbAYM.js";import{s as ve}from"./startOfMonth-Da06yCVW.js";import{e as ye}from"./endOfMonth-B8pSvEs7.js";import{e as Ne,g as we}from"./getDay-CZLeoS75.js";function Se(i,o){const a=$(i),u=$(o);return+a<+u}function _e(){return oe(Date.now())}const N=({icon:i,label:o,...a})=>e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"block text-sm font-medium text-muted-foreground mb-1",children:o}),e.jsxs("div",{className:"relative",children:[e.jsx(i,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(z,{className:"pl-10",...a})]})]}),ke=({currentMonth:i,onMonthChange:o,onDateSelect:a,availability:u,selectedDate:t})=>{const f=ve(i),w=ye(i),M=Ne({start:f,end:w}),O=we(f),E=_e(),P=new Set(u.map(l=>d(C(l.start_time),"yyyy-MM-dd")));return e.jsxs("div",{className:"bg-card p-4 rounded-lg shadow-inner",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx(x,{onClick:()=>o("prev"),children:"Anterior"}),e.jsx("h3",{className:"font-semibold text-lg capitalize",children:d(i,"MMMM yyyy",{locale:B})}),e.jsx(x,{onClick:()=>o("next"),children:"Próximo"})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 text-center text-xs text-muted-foreground",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(l=>e.jsx("div",{children:l},l))}),e.jsxs("div",{className:"grid grid-cols-7 gap-1 mt-2",children:[Array.from({length:O}).map((l,m)=>e.jsx("div",{},`empty-${m}`)),M.map(l=>{const m=d(l,"yyyy-MM-dd"),S=P.has(m),_=Se(l,E),D=t&&d(l,"yyyy-MM-dd")===d(t,"yyyy-MM-dd");return e.jsxs("button",{disabled:!S||_,onClick:()=>a(l),className:ue("p-2 rounded-full text-sm transition-colors relative","disabled:opacity-50 disabled:cursor-not-allowed",D&&"bg-primary text-primary-foreground",S&&!D&&"hover:bg-accent"),children:[d(l,"d"),S&&!_&&e.jsx("span",{className:"absolute bottom-1 left-1/2 -translate-x-1/2 w-1.5 h-1.5 bg-green-500 rounded-full"})]},m)})]})]})},Ce=({selectedDate:i,availability:o,onSlotSelect:a})=>{if(!i)return e.jsx("p",{className:"text-center text-muted-foreground mt-4",children:"Selecione uma data para ver os horários."});const u=o.filter(t=>d(C(t.start_time),"yyyy-MM-dd")===d(i,"yyyy-MM-dd")).sort((t,f)=>new Date(t.start_time)-new Date(f.start_time));return u.length===0?e.jsx("p",{className:"text-center text-muted-foreground mt-4",children:"Nenhum horário disponível para esta data."}):e.jsxs("div",{className:"mt-4",children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Horários para ",d(i,"dd/MM/yyyy"),":"]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 gap-2",children:u.map(t=>e.jsx(x,{variant:"outline",onClick:()=>a(t),children:d(C(t.start_time),"HH:mm")},t.id))})]})},qe=()=>{const{bookingLinkId:i}=ne(),{toast:o}=ie(),[a,u]=c.useState(null),[t,f]=c.useState(null),[w,M]=c.useState([]),[O,E]=c.useState(!0),[P,l]=c.useState(null),[m,S]=c.useState(new Date),[_,D]=c.useState(null),[p,V]=c.useState(null),[g,b]=c.useState(1),[r,j]=c.useState({name:"",email:"",phone:""}),[I,A]=c.useState(!1),[v,Y]=c.useState(null),H=c.useCallback(async(s,h)=>{E(!0),l(null);try{const{data:n,error:y}=await k.functions.invoke("get-public-booking-data",{body:JSON.stringify({bookingLinkId:i,month:s+1,year:h})});if(y)throw new Error(`Erro ao buscar dados: ${y.message}`);if(n.error)throw new Error(n.error);u(n.photographer),f(n.bookingSettings),M(n.availability||[])}catch(n){console.error(n),l(n.message),o({title:"Erro",description:n.message,variant:"destructive"})}finally{E(!1)}},[i,o]);c.useEffect(()=>{H(m.getMonth(),m.getFullYear())},[H,m]);const K=s=>{D(s),V(null)},Z=s=>{V(s),b(2)},ee=s=>{if(s.preventDefault(),!r.name||!r.email||!r.phone){o({title:"Campos obrigatórios",description:"Por favor, preencha todos os seus dados.",variant:"destructive"});return}t.require_payment?b(3):L()},L=async()=>{if(!p||!r.name){o({title:"Erro",description:"Dados do agendamento ou cliente incompletos.",variant:"destructive"});return}A(!0);try{let s=null;if(v){const y=v.name.split(".").pop(),F=`booking-proof-${pe()}.${y}`,R=`public/${t.user_id}/booking_proofs/${F}`,{error:U}=await k.storage.from("user_assets").upload(R,v);if(U)throw U;const{data:re}=k.storage.from("user_assets").getPublicUrl(R);s=re.publicUrl}const{data:h,error:n}=await k.functions.invoke("finalize-booking",{body:JSON.stringify({photographerUserId:t.user_id,slotId:p.id,clientInfo:r,paymentProofUrl:s})});if(n)throw n;if(h.error)throw new Error(h.error);o({title:"Agendamento realizado!",description:"Você receberá uma confirmação em breve."}),b(4),M(y=>y.filter(F=>F.id!==p.id))}catch(s){o({title:"Erro ao agendar",description:s.message,variant:"destructive"})}finally{A(!1)}},se=async s=>{s.preventDefault(),A(!0);try{const{data:h,error:n}=await k.functions.invoke("submit-client-form",{body:JSON.stringify({formId:null,answers:r,userId:a?.user_id,source:"PublicBookingPageLead"})});if(n)throw n;o({title:"Obrigado!",description:"Seus dados foram enviados. Entraremos em contato em breve!"}),b(4)}catch(h){o({title:"Erro ao enviar",description:h.message,variant:"destructive"})}finally{A(!1)}},ae=s=>{navigator.clipboard.writeText(s),o({title:"Copiado!",description:"Chave PIX copiada para a área de transferência."})};if(O&&!a)return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-background",children:e.jsx(T,{className:"w-8 h-8 animate-spin"})});if(P)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-background p-4 text-center",children:[e.jsx(le,{className:"w-12 h-12 text-destructive mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Ops! Algo deu errado."}),e.jsx("p",{className:"text-muted-foreground max-w-md",children:P})]});const te=w.length>0;return e.jsxs("div",{className:"min-h-screen bg-background text-foreground flex flex-col items-center p-4 sm:p-8",children:[e.jsxs("main",{className:"w-full flex-grow",children:[e.jsxs(J.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-center mb-8",children:[a?.logo&&e.jsx("img",{src:a.logo,alt:a.business_name,className:"h-16 w-auto mx-auto mb-4 object-contain"}),e.jsx("h1",{className:"text-3xl font-bold",children:a?.business_name||a?.user_name}),e.jsx("p",{className:"text-muted-foreground",children:"Agende seu horário"})]}),e.jsx("div",{className:"w-full max-w-4xl mx-auto",children:e.jsx(ce,{mode:"wait",children:e.jsx(J.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:!te&&g!==4?e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Nenhuma vaga no momento"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Agradecemos seu interesse! No momento, não há vagas abertas. Deixe seus dados abaixo para entrar em nossa lista de espera."}),e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsx(N,{icon:Q,label:"Nome Completo",value:r.name,onChange:s=>j({...r,name:s.target.value}),required:!0}),e.jsx(N,{icon:X,label:"E-mail",type:"email",value:r.email,onChange:s=>j({...r,email:s.target.value}),required:!0}),e.jsx(N,{icon:q,label:"Telefone (WhatsApp)",value:r.phone,onChange:s=>j({...r,phone:s.target.value}),required:!0}),e.jsxs(x,{type:"submit",disabled:I,className:"w-full mt-4",children:[I?e.jsx(T,{className:"w-4 h-4 mr-2 animate-spin"}):null,"Entrar na Lista de Espera"]})]})]}):g===1?e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-center",children:"1. Escolha a data e horário"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-8",children:[e.jsx(ke,{currentMonth:m,onMonthChange:s=>S(s==="prev"?be(m,1):je(m,1)),onDateSelect:K,availability:w,selectedDate:_}),e.jsx(Ce,{selectedDate:_,availability:w,onSlotSelect:Z})]})]}):g===2?e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-center",children:"2. Seus Dados"}),e.jsxs("div",{className:"bg-card p-4 rounded-lg mb-4 text-center",children:[e.jsx("p",{children:"Você selecionou:"}),e.jsx("p",{className:"font-bold text-lg text-primary",children:d(C(p.start_time),"EEEE, dd 'de' MMMM 'às' HH:mm",{locale:B})})]}),e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[e.jsx(N,{icon:Q,label:"Nome Completo",value:r.name,onChange:s=>j({...r,name:s.target.value}),required:!0}),e.jsx(N,{icon:X,label:"E-mail",type:"email",value:r.email,onChange:s=>j({...r,email:s.target.value}),required:!0}),e.jsx(N,{icon:q,label:"Telefone (WhatsApp)",value:r.phone,onChange:s=>j({...r,phone:s.target.value}),required:!0}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsx(x,{type:"button",variant:"ghost",onClick:()=>b(1),children:"Voltar"}),e.jsxs(x,{type:"submit",children:["Continuar ",e.jsx(de,{className:"w-4 h-4 ml-2"})]})]})]})]}):g===3?e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"3. Pagamento da Reserva"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Para confirmar seu horário, é necessário um pagamento de reserva. Após pagar, anexe o comprovante."}),e.jsxs("div",{className:"space-y-6 bg-card p-6 rounded-lg",children:[t.pix_qr_code_url&&e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Pagar com PIX"}),e.jsx("img",{src:t.pix_qr_code_url,alt:"QR Code PIX",className:"w-48 h-48 rounded-lg border p-1"})]}),t.pix_key&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{value:t.pix_key,readOnly:!0}),e.jsx(x,{variant:"outline",size:"icon",onClick:()=>ae(t.pix_key),children:e.jsx(he,{className:"w-4 h-4"})})]}),t.credit_card_link&&e.jsx(x,{asChild:!0,className:"w-full",children:e.jsx("a",{href:t.credit_card_link,target:"_blank",rel:"noopener noreferrer",children:"Pagar com Cartão de Crédito"})}),e.jsxs("div",{className:"mt-6",children:[e.jsx(W,{htmlFor:"payment-proof",className:"font-semibold",children:"Anexar Comprovante"}),e.jsx(z,{id:"payment-proof",type:"file",onChange:s=>Y(s.target.files[0]),accept:"image/png, image/jpeg, image/jpg, application/pdf",className:"mt-2"}),v&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Arquivo selecionado: ",v.name]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-6",children:[e.jsx(x,{type:"button",variant:"ghost",onClick:()=>b(2),children:"Voltar"}),e.jsxs(x,{onClick:L,disabled:I||!v,children:[I?e.jsx(T,{className:"w-4 h-4 animate-spin mr-2"}):e.jsx(G,{className:"w-4 h-4 mr-2"}),"Finalizar Agendamento"]})]})]}):g===4?e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsx(G,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-green-500 mb-4",children:p?"Agendamento Confirmado!":"Obrigado pelo Interesse!"}),e.jsxs("p",{children:["Obrigado, ",r.name,"!"]}),p?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Seu horário para"}),e.jsxs("p",{className:"font-bold text-lg text-primary mb-4",children:[d(C(p.start_time),"EEEE, dd 'de' MMMM 'às' HH:mm",{locale:B})," está confirmado."]}),e.jsx("p",{children:"Você receberá um e-mail com os detalhes em breve."})]}):e.jsx("p",{children:"Seus dados foram recebidos e você está na nossa lista de espera. Entraremos em contato assim que novas vagas estiverem disponíveis!"}),e.jsx(x,{onClick:()=>window.location.reload(),className:"mt-6",children:"Voltar ao Início"})]}):null},g)})})]}),t?.show_footer_info&&e.jsxs("footer",{className:"w-full max-w-4xl mx-auto mt-12 pt-8 border-t border-border text-center text-muted-foreground text-sm",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start",children:[a.logo&&e.jsx("img",{src:a.logo,alt:a.business_name,className:"h-12 w-auto mb-2 object-contain"}),e.jsx("p",{className:"font-semibold",children:a.business_name}),a.cnpj&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(me,{size:14})," ",a.cnpj]})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Contato"}),a.address&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:14})," ",a.address]}),a.phones?.[0]?.number&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(q,{size:14})," ",a.phones[0].number]})]}),e.jsxs("div",{className:"flex flex-col items-center md:items-end",children:[e.jsx("p",{className:"font-semibold mb-2",children:"Redes Sociais"}),e.jsxs("div",{className:"flex gap-4",children:[a.website_social?.find(s=>s.type==="instagram")?.url&&e.jsx("a",{href:a.website_social.find(s=>s.type==="instagram").url,target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary",children:e.jsx(fe,{size:20})}),a.website_social?.find(s=>s.type==="website")?.url&&e.jsx("a",{href:a.website_social.find(s=>s.type==="website").url,target:"_blank",rel:"noopener noreferrer",className:"hover:text-primary",children:e.jsx(ge,{size:20})})]})]})]}),e.jsxs("p",{className:"mt-8 text-xs",children:["© ",new Date().getFullYear()," ",a.business_name,". Todos os direitos reservados."]})]})]})};export{qe as default};
