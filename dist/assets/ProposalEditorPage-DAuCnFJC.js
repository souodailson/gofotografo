import{r as N,a7 as Z,f as ee,u as te,j as e,ak as oe,p as z,B as I,aa as se,az as ae,ae as ie,s as L}from"./index-DHBNVHsv.js";import{u as ne,a as re,b as le,c as ce,D as de,H as pe,L as me,E as ue,d as fe,e as xe,P as he,f as ge,S as ve,R as Se,C as be}from"./EditorRulers-PhrZ-cjV.js";import{E as je}from"./EditorCanvas-B2ikFyBv.js";import"./dnd.esm-a4hrAlJG.js";import"./defineProperty-f6N_0mpf.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";import"./useDebounce-BdiKl5Pp.js";import"./html2canvas.esm-BfxBtG_O.js";import"./tabs-DSqzsg_3.js";import"./alert-dialog-CA3sahhm.js";import"./plus-circle-BRMk-46g.js";import"./upload-CTfbRBgM.js";import"./switch-C0tIeEyV.js";import"./instagram-DpjIItDL.js";import"./message-square-ZkAFTajl.js";import"./image-szymQnai.js";import"./link-CdWJa35W.js";import"./popover-pf7Mxtst.js";import"./ban-CkJLM38L.js";import"./tooltip-DrghJOUq.js";import"./chevron-up-Dga819J-.js";import"./grip-vertical-Cr0groAW.js";import"./eye-off-uuC8jvjx.js";import"./type-BY7q3g_6.js";import"./settings-BihSyCWF.js";import"./copy-Ydl0eOtw.js";import"./underline-Bh5oxSa3.js";import"./video-BsfnlMqo.js";import"./star-hcmGvLZa.js";import"./share-2-YgEUnj0u.js";import"./square-B1RtmOTp.js";import"./palette-BFstn63C.js";import"./align-justify-0pQYBYZw.js";import"./list-ZAa2agdS.js";import"./index-CBcTJ0gs.js";import"./index-Chjiymov.js";const it=({isAdmin:x=!1})=>{const A=ne({isAdmin:x}),{proposal:o,setProposal:l,proposalId:c,isNew:G,activeSection:d,setActiveSection:O,loading:F,saving:$,saveStatus:q,uploads:D,loadingUploads:H,handleSave:v,handlePublish:U,fetchUploads:h,navigateBackPath:_}=A,p=re(),{selectedBlock:n,handleSetSelectedBlock:m,viewMode:i,setViewMode:S,canvasWidth:V,isLeftSidebarOpen:b,setIsLeftSidebarOpen:j,isRightSidebarOpen:w,setIsRightSidebarOpen:k,snapLines:W,setSnapLines:J,toolbarPosition:K}=p,{addBlock:g,updateBlock:r}=le(l,m,i),C=N.useRef(null),s=ce({selectedBlock:n,updateBlock:r,addBlock:g,activeSection:d,canvasRef:C,viewMode:i,setViewMode:S,proposalName:o?.nome_da_proposta}),{fileInputRef:Q,handleFileInputClick:y}=s,{user:B}=Z(),{toast:u}=ee(),P=N.useRef(null),T=te(),X=async(t,a)=>{const f=t.target.files?.[0];if(!f||!B||!a)return;if(f.size>10*1024*1024){u({title:"Arquivo muito grande",description:"O arquivo excede o limite de 10MB.",variant:"destructive"});return}u({title:"Enviando arquivo...",description:"Aguarde um momento."});const Y=ae(f.name),E=`${B.id}/${c||"new"}/${ie()}-${Y}`,{error:M}=await L.storage.from("propostas").upload(E,f);if(M){u({title:"Erro no upload",description:M.message,variant:"destructive"});return}const{data:{publicUrl:R}}=L.storage.from("propostas").getPublicUrl(E);a.type==="image"?r(a.id,{content:{...a.content,src:R}}):a.type==="pdf"&&r(a.id,{content:{src:R}}),h(c),u({title:"Arquivo atualizado!",variant:"success"}),t.target.value=""};return F||!o?e.jsx(oe,{}):e.jsx(de,{backend:pe,children:e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 w-full fixed inset-0 overflow-hidden",onClick:s.closeContextMenu,children:[e.jsx("input",{type:"file",ref:Q,className:"hidden",onChange:t=>X(t,n),accept:n?.type==="pdf"?"application/pdf":"image/*"}),e.jsx(z,{children:b&&e.jsx(me,{onAddBlock:g,activeSection:d,uploads:D,loadingUploads:H,proposalId:c,onUploadComplete:()=>h(c),isNew:G,handleSave:()=>v(),onToggle:()=>j(!1)})}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden transition-all duration-300 ease-in-out",children:[e.jsx(ue,{navigateBack:()=>T(_),viewMode:i,setViewMode:S,handleExportPdf:s.handleExportPdf,handleSave:()=>v(),handlePublish:U,saving:$,saveStatus:q,isAdmin:x,proposal:o}),e.jsx(fe,{selectedBlock:n,updateBlock:r,toolbarPosition:K,onReplaceImage:()=>y()}),e.jsxs("div",{ref:P,className:"flex-1 overflow-auto bg-muted/40 p-4 sm:p-8 relative flex justify-center",onClick:()=>m(null),children:[e.jsx(xe,{scrollContainerRef:P}),!b&&e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 z-30",onClick:()=>j(!0),children:e.jsx(he,{})}),!w&&n&&e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-30",onClick:()=>k(!0),children:e.jsx(ge,{})}),e.jsxs("div",{className:se("mx-auto transition-all duration-300 relative",i==="desktop"&&"w-full max-w-4xl",i==="tablet"&&"w-full max-w-md",i==="mobile"&&"w-full max-w-xs"),style:{width:`${V}px`},onClick:t=>t.stopPropagation(),children:[e.jsx(je,{ref:C,sections:o.sections,blocksBySection:o.blocksBySection,addBlock:g,setSelectedBlock:m,selectedBlockId:n?.id,updateBlock:r,showGrid:p.showGrid,globalStyles:o.theme,activeSection:d,viewMode:i,setProposal:l,onContextMenu:s.handleContextMenu,setSnapLines:J}),W.map((t,a)=>e.jsx("div",{className:"absolute bg-orange-300",style:{...t.type==="vertical"?{left:t.position,top:0,width:"1px",height:"100%"}:{top:t.position,left:0,height:"1px",width:"100%"},zIndex:99998}},a))]})]}),e.jsx(ve,{sections:o.sections,activeSection:d,setActiveSection:O,setProposal:l,proposal:o})]}),e.jsx(z,{children:w&&e.jsx(Se,{selectedBlock:n,updateBlock:r,setSelectedBlock:m,globalStyles:o.theme,setGlobalStyles:t=>l(a=>({...a,theme:t})),showGrid:p.showGrid,setShowGrid:p.setShowGrid,proposal:o,setProposal:l,isAdmin:x,onToggle:()=>k(!1),onUploadComplete:()=>h(c),viewMode:i})}),s.contextMenu&&e.jsx(be,{x:s.contextMenu.x,y:s.contextMenu.y,block:s.contextMenu.block,onClose:s.closeContextMenu,onAction:s.handleContextMenuAction,onFileInputClick:y})]})})};export{it as default};
