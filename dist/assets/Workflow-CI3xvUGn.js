import{c as rt,f as Qe,u as Xe,j as e,m as G,B as g,aC as be,ag as nt,a7 as ee,D as fe,U as lt,ai as Je,aF as ot,r as v,I as xe,R as Le,a1 as ne,a2 as le,a3 as oe,a4 as ie,a5 as q,aV as ye,aD as it,d as Ye,aW as dt,af as de,aX as pe,ab as Ce,Q as Be,T as qe,V as Me,W as Z,aY as We,X as ce,C as Ze,P as Oe,q as ct,k as mt,z as xt,F as ut,G as ht,o as gt,aS as pt,aZ as ft}from"./index-B959_7_o.js";import{P as Ue,C as et,D as bt}from"./dnd.esm-CNSIsYfb.js";import{M as jt}from"./message-square-DK6t4m6u.js";import{M as kt}from"./map-pin-DE1Z08iO.js";import{R as vt}from"./route-DgUpNPMr.js";import{L as Nt}from"./list-BWAYK6lC.js";import{A as Ct}from"./align-justify-pHCYe3KW.js";import{C as wt}from"./chevron-up-ckAvg4TR.js";import{T as yt}from"./trending-up-CJXHKgjy.js";import{A as me}from"./archive-DxXold_A.js";import{S as St}from"./search-DecR3P-8.js";import{A as Se,b as Te,c as Pe,d as Ae,e as De,f as ze,g as Ee,h as _e,a as Tt}from"./alert-dialog-CMWSZjMP.js";import{u as Pt}from"./useCardHoverEffect-OZDMdtp8.js";import{T as At,a as Dt,b as zt,d as Et,c as _t}from"./tooltip-Cwgo7U0h.js";import{M as Ve}from"./more-vertical-_AfS99pC.js";import{P as we}from"./pen-square-CcxMKlNU.js";import{L as $t}from"./link-BuAO9sRO.js";import{M as Ge}from"./message-circle-1RwEbKRh.js";import{P as It}from"./palette-DYpEW6qD.js";import{E as Ft}from"./eye-off-CVDThO4Q.js";import{C as Rt}from"./calendar-days-Ch_ciOqy.js";import{L as Lt}from"./list-checks-Cw-iCUHK.js";import"./defineProperty-C-ST8_Gu.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";const Bt=rt("ArchiveRestore",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]]),qt=({isMobile:t,onAddNewCard:l,showArchived:a,isSummaryExpandedDesktop:i,setIsSummaryExpandedDesktop:o,cardViewMode:m,onToggleCardViewMode:s})=>{Qe();const h=Xe();return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs(G.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-left flex-grow",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl titulo-gradiente",children:"Fluxo de Trabalho"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1 text-sm sm:text-base",children:"Gerencie seus projetos e acompanhe o progresso"})]}),e.jsx("div",{className:`flex ${t?"hidden":"items-center space-x-2 flex-shrink-0"}`,children:!t&&!a&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(g,{variant:"outline",onClick:()=>h("/respostas-rapidas"),className:"bg-gradient-to-r from-green-50 to-blue-50 border-green-200 hover:bg-gradient-to-r hover:from-green-100 hover:to-blue-100 dark:from-green-900/20 dark:to-blue-900/20 dark:border-green-700 h-9",children:[e.jsx(jt,{className:"w-4 h-4 mr-2 text-green-600"}),"RESPOSTAS"]}),e.jsxs(g,{variant:"outline",onClick:()=>h("/spot"),className:"bg-gradient-to-r from-red-50 to-pink-50 border-red-200 hover:bg-gradient-to-r hover:from-red-100 hover:to-pink-100 dark:from-red-900/20 dark:to-pink-900/20 dark:border-red-700 h-9",children:[e.jsx(kt,{className:"w-4 h-4 mr-2 text-red-600"}),"SPOT"]}),e.jsxs(g,{variant:"outline",onClick:()=>h("/gomov"),className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200 hover:bg-gradient-to-r hover:from-blue-100 hover:to-indigo-100 dark:from-blue-900/20 dark:to-indigo-900/20 dark:border-blue-700 h-9",children:[e.jsx(vt,{className:"w-4 h-4 mr-2 text-blue-600"}),"GO.MOV"]}),e.jsxs(g,{onClick:l,size:"default",className:"btn-custom-gradient text-white shadow-lg h-9",children:[e.jsx(be,{className:"w-4 h-4 mr-2"})," Novo Trabalho"]}),e.jsxs("div",{className:"flex items-center rounded-md bg-muted p-0.5",children:[e.jsxs(g,{variant:m==="summarized"?"secondary":"ghost",size:"sm",className:"h-8 px-2",onClick:()=>s("summarized"),children:[e.jsx(Nt,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Resumido"})]}),e.jsxs(g,{variant:m==="detailed"?"secondary":"ghost",size:"sm",className:"h-8 px-2",onClick:()=>s("detailed"),children:[e.jsx(Ct,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Detalhado"})]})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>o(!i),className:"text-muted-foreground hover:bg-accent h-9",title:i?"Ocultar Resumo":"Mostrar Resumo",children:[i?e.jsx(wt,{className:"w-4 h-4 mr-1 sm:mr-2"}):e.jsx(nt,{className:"w-4 h-4 mr-1 sm:mr-2"}),e.jsxs("span",{className:"hidden sm:inline",children:[i?"Ocultar":"Mostrar"," Resumo"]}),e.jsx("span",{className:"sm:hidden",children:i?"Ocultar":"Mostrar"})]})]})})]})},He=({title:t,value:l,icon:a,color:i,isMobile:o,activeViewSummary:m,isFeatured:s=!1,isInsideModal:h=!1})=>{const w="bg-card p-4 rounded-xl shadow-lg border flex items-center space-x-3 transition-all duration-200 ease-in-out",y="border-border",N=s&&(h||m==="cards")?"border-customGreen ring-2 ring-customGreen":"border-border";let n="";o?n=N:n=y;const x="flex flex-col items-center justify-center p-3 h-24";return o&&m==="icons"&&!h?e.jsxs(G.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:200,damping:20},className:`${w} ${x} ${n}`,children:[e.jsx("div",{className:`p-2 rounded-full ${i} mb-1`,children:e.jsx(a,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-[10px] text-muted-foreground text-center leading-tight",children:t}),e.jsx("p",{className:`text-sm font-semibold ${s?"text-lg text-customGreen dark:text-customGreen":"text-foreground"}`,children:l})]}):e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:100,damping:15},className:`${w} ${n} card-hover`,children:[e.jsx("div",{className:`p-3 rounded-lg ${i}`,children:e.jsx(a,{className:"text-white w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t}),e.jsx("p",{className:`font-semibold text-lg ${s&&!o?"text-customGreen dark:text-customGreen":"text-foreground"}`,children:l})]})]})},Mt=({cards:t,isMobile:l,activeViewSummary:a,isInsideModal:i=!1})=>{const{settings:o}=ee();if(!t)return null;const m=o?.workflow_columns?.[0]?.id||"novo-lead",s=["agendado","em-andamento","concluido"],h=t.filter(u=>u.status===m).length,w=t.filter(u=>u.status!==m&&s.includes(u.status)&&!u.archived).length,y=h>0?(w/h*100).toFixed(1):0,N=t.filter(u=>u.status==="proposta-enviada").length,n=t.filter(u=>u.status==="em-andamento").length,x=t.reduce((u,W)=>W.status!=="concluido"&&W.value&&!W.archived?u+Number(W.value):u,0),j=t.filter(u=>u.archived).length,V=[{title:"Previsto",value:`R$ ${x.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:fe,color:"bg-emerald-500",isFeatured:!0},{title:"Leads",value:t.filter(u=>u.status===m&&!u.archived).length,icon:lt,color:"bg-sky-500"},{title:"Propostas",value:N,icon:Je,color:"bg-amber-500"},{title:"Em Andamento",value:n,icon:ot,color:"bg-violet-500"},{title:"Conversão",value:`${y}%`,icon:yt,color:"bg-rose-500"},...l&&a==="icons"&&!i?[{title:"Arquivados",value:j,icon:me,color:"bg-slate-500"}]:[]];if(l&&a==="icons"&&!i)return e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-6",children:V.map(u=>e.jsx(He,{...u,isMobile:l,activeViewSummary:a,isInsideModal:i},u.title))});const M=i?"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6":"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6";return e.jsx("div",{className:M,children:V.filter(u=>!(l&&a==="icons"&&u.title==="Arquivados")).map(u=>e.jsx("div",{className:`${i?"":"lg:col-span-1"} ${u.isFeatured&&i?"sm:col-span-2":""}`,children:e.jsx(He,{...u,isMobile:l,activeViewSummary:a,isInsideModal:i})},u.title))})},tt=v.memo(({onDebouncedChange:t,debounceMs:l=300,...a})=>{const i=v.useCallback(m=>{t&&t(m)},[t]),o=m=>{const s=m.target.value;a.onChange&&a.onChange(m),i(s)};return e.jsx(xe,{...a,onChange:o})});tt.displayName="OptimizedInput";const Wt=({activeFilters:t,setActiveFilters:l,searchTerm:a,setSearchTerm:i})=>{const{servicePackagesData:o,workflowCards:m}=ee(),s=Le.useMemo(()=>{const n=new Set;return Array.isArray(o)&&o.forEach(x=>{x.niche&&n.add(x.niche)}),Array.from(n)},[o]),h=Le.useMemo(()=>{const n=new Set;return Array.isArray(m)&&m.forEach(x=>{x.tags&&Array.isArray(x.tags)&&x.tags.forEach(j=>n.add(j))}),Array.from(n).sort()},[m]),w=(n,x)=>{l(j=>({...j,[n]:x==="all-items"?"":x}))},y=()=>{l({eventType:"",period:"",packageId:"",financialStatus:"",tag:""}),i("")},N=Object.values(t).some(n=>n!=="")||a!=="";return e.jsxs("div",{className:"p-4 bg-card rounded-xl shadow-lg border border-border mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Busca Rápida"}),e.jsxs("div",{className:"relative",children:[e.jsx(St,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(tt,{id:"search",type:"text",placeholder:"Nome, data, pacote...",value:a,onDebouncedChange:i,className:"pl-10 bg-background"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventType",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Tipo de Evento"}),e.jsxs(ne,{value:t.eventType||"all-items",onValueChange:n=>w("eventType",n),children:[e.jsx(le,{id:"eventType",className:"bg-background",children:e.jsx(oe,{placeholder:"Todos"})}),e.jsxs(ie,{className:"max-h-60",children:[e.jsx(q,{value:"all-items",children:"Todos"}),s.map(n=>e.jsx(q,{value:n,children:n},n))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"period",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Período"}),e.jsxs(ne,{value:t.period||"all-items",onValueChange:n=>w("period",n),children:[e.jsx(le,{id:"period",className:"bg-background",children:e.jsx(oe,{placeholder:"Qualquer"})}),e.jsxs(ie,{children:[e.jsx(q,{value:"all-items",children:"Qualquer"}),e.jsx(q,{value:"next7days",children:"Próximos 7 dias"}),e.jsx(q,{value:"next30days",children:"Próximos 30 dias"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"packageId",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Pacote"}),e.jsxs(ne,{value:t.packageId||"all-items",onValueChange:n=>w("packageId",n),children:[e.jsx(le,{id:"packageId",className:"min-w-[150px] bg-background",children:e.jsx(oe,{placeholder:"Todos"})}),e.jsxs(ie,{className:"max-h-60",children:[e.jsx(q,{value:"all-items",children:"Todos"}),Array.isArray(o)&&o.map(n=>e.jsx(q,{value:n.id,children:n.name},n.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"financialStatus",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Status Financeiro"}),e.jsxs(ne,{value:t.financialStatus||"all-items",onValueChange:n=>w("financialStatus",n),children:[e.jsx(le,{id:"financialStatus",className:"bg-background",children:e.jsx(oe,{placeholder:"Todos"})}),e.jsxs(ie,{children:[e.jsx(q,{value:"all-items",children:"Todos"}),e.jsx(q,{value:"paid",children:"Pago"}),e.jsx(q,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"tagFilter",className:"block text-sm font-medium text-muted-foreground mb-1 flex items-center",children:[e.jsx(ye,{className:"w-3.5 h-3.5 mr-1.5"}),"Tags"]}),e.jsxs(ne,{value:t.tag||"all-items",onValueChange:n=>w("tag",n),children:[e.jsx(le,{id:"tagFilter",className:"bg-background",children:e.jsx(oe,{placeholder:"Todas"})}),e.jsxs(ie,{className:"max-h-60",children:[e.jsx(q,{value:"all-items",children:"Todas"}),h.map(n=>e.jsx(q,{value:n,children:n},n))]})]})]})]}),N&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(g,{variant:"ghost",onClick:y,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(it,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})})]})},Ot=t=>{if(!t||t.includes("slate"))return"text-foreground";if(t.includes("yellow-300"))return"text-yellow-800 dark:text-yellow-200";const l=t.split("-")[1];return t.includes("dark")?`text-${l}-200`:`text-${l}-800`},Ke=(t,l,a=!1)=>{if(!t||t.includes("slate"))return`bg-card ${a?"dark:bg-muted/30":""}`;const i=t.split("dark:")[1];if(i){const m=i.replace(/-\d+/,""),s=t.split(" ")[0].replace(/-\d+/,"");return l==="dark"?a?`${m}-800`:`${m}-900`:a?`${s}-200`:`${s}-100`}const o=t.replace(/-\d+/,"");return a?`${o}-200`:`${o}-100`},Ut=(t,l)=>{if(!t||t.includes("slate"))return"border-border/40";const a=t.split("dark:")[1];if(a){const o=a.replace(/-\d+/,"");return l==="dark"?`border-${o.split("-")[1]}-700`:`border-${t.split(" ")[0].split("-")[1]}-200`}return`border-${t.replace(/-\d+/,"").split("-")[1]}-200`},Vt=({card:t,onAddComment:l})=>{const[a,i]=v.useState(""),o=s=>{s.preventDefault(),s.stopPropagation(),a.trim()&&(l(t.id,a),i(""))},m=s=>{if(!s)return"?";const h=s.split(" ");return h.length>1?`${h[0][0]}${h[h.length-1][0]}`.toUpperCase():s.substring(0,2).toUpperCase()};return e.jsxs("div",{className:"p-3 rounded-lg shadow-xl w-72 max-h-96 flex flex-col bg-background/80 dark:bg-background/70 backdrop-blur-xl border border-border",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-foreground",children:"Comentários"}),e.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 pr-2 scrollbar-thin",children:t.comments&&t.comments.length>0?t.comments.slice().sort((s,h)=>new Date(s.date)-new Date(h.date)).map(s=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsxs(xt,{className:"h-6 w-6",children:[e.jsx(ut,{src:s.user_photo_url,alt:s.user}),e.jsx(ht,{children:m(s.user)})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-2 flex-1",children:[e.jsx("p",{className:"text-xs text-foreground whitespace-pre-wrap",children:s.text}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1 text-right",children:new Date(s.date).toLocaleString("pt-BR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]})]},s.id||s.date)):e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4",children:"Nenhum comentário ainda."})}),e.jsxs("form",{onSubmit:o,className:"mt-2 pt-2 border-t border-border flex items-center space-x-2",children:[e.jsx(xe,{type:"text",placeholder:"Adicionar comentário...",value:a,onChange:s=>i(s.target.value),onClick:s=>s.stopPropagation(),className:"h-8 text-xs flex-grow bg-background/50"}),e.jsx(g,{type:"submit",size:"icon",className:"h-8 w-8",disabled:!a.trim(),children:e.jsx(gt,{size:14})})]})]})},Gt=({card:t,onEdit:l,onUpdateSubtask:a,onAddSubtask:i,onDeleteSubtask:o,onDeleteCard:m,onArchiveCard:s,columnColor:h,onAddComment:w,viewMode:y})=>{const{getClientById:N,getServicePackageById:n,financialData:x}=ee(),[j,V]=v.useState(!1),[M,u]=v.useState(""),[W,C]=v.useState(!1),J=Pt(),{theme:A}=Ye(),te=Xe(),P=t.client_id?N(t.client_id):null,Q=t.service_package_id?n(t.service_package_id):null,k=x.transactions.find(r=>r.workflow_id===t.id),p=Ke(h,A,!1),z=Ke(h,A,!0),_=Ut(h,A),$=Ot(h),E=r=>({Casamento:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",Gestante:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",Empresarial:"bg-sky-100 text-sky-800 dark:bg-sky-900 dark:text-sky-200","Ensaio Externo":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",Corporativo:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",Estúdio:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",Produto:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"})[r]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",je=r=>{if(r.stopPropagation(),P&&P.phone){const L=P.phone.replace(/\D/g,"");window.open(`https://wa.me/55${L}`,"_blank")}else alert("Número de WhatsApp do cliente não disponível.")},R=t.date?dt(de(t.date),new Date):null;let H=null;R!==null&&R>=0&&R<=7&&(H={message:R===0?"Evento é Hoje!":`Evento em ${R} dia${R!==1?"s":""}`,color:R<=3?"text-red-500 dark:text-red-400":"text-yellow-500 dark:text-yellow-400"});const Y=r=>{r.stopPropagation(),M.trim()!==""&&(i(t.id,M),u(""))},K=()=>{m(t.id),C(!1)},ke=r=>{r.stopPropagation(),te("/studio/contracts/new",{state:{clientId:t.client_id,workflowCardId:t.id}})},ve=({children:r})=>e.jsx("div",{className:"flex flex-col space-y-2",children:r}),ue=pe("rounded-lg p-3 sm:p-4 border cursor-pointer transition-all duration-200 group card-hover-effect",p,$,_,`hover:${z}`);return y==="summarized"?e.jsx(G.div,{ref:J,className:ue,onClick:()=>l(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm break-words leading-tight truncate",children:t.title||(P?P.name:"Título não definido")}),P&&e.jsxs("div",{className:"text-xs text-current/80 flex items-center truncate",children:[e.jsx(Ce,{size:12,className:"mr-1.5 flex-shrink-0"})," ",P.name]})]}),e.jsxs(Be,{children:[e.jsx(qe,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"w-6 h-6 opacity-50 group-hover:opacity-100 transition-opacity",onClick:r=>r.stopPropagation(),children:e.jsx(Ve,{className:"w-4 h-4"})})}),e.jsxs(Me,{align:"end",onClick:r=>r.stopPropagation(),children:[e.jsxs(Z,{onClick:()=>l(t),children:[e.jsx(we,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsxs(Z,{onClick:()=>s(t.id),children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Arquivar"]}),e.jsx(We,{}),e.jsxs(Z,{onClick:()=>C(!0),className:"text-red-600 dark:text-red-400 hover:!text-red-600 focus:text-red-600 dark:focus:text-red-400",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Excluir"]})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(G.div,{ref:J,className:ue,onClick:()=>l(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-sm flex-1 break-words leading-tight",children:t.title||(P?P.name:"Título não definido")}),e.jsxs(Be,{children:[e.jsx(qe,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"w-6 h-6 opacity-50 group-hover:opacity-100 transition-opacity",onClick:r=>r.stopPropagation(),children:e.jsx(Ve,{className:"w-4 h-4"})})}),e.jsxs(Me,{align:"end",onClick:r=>r.stopPropagation(),children:[e.jsxs(Z,{onClick:()=>l(t),children:[e.jsx(we,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsxs(Z,{onClick:()=>s(t.id),children:[e.jsx(me,{className:"mr-2 h-4 w-4"})," Arquivar"]}),e.jsx(We,{}),e.jsxs(Z,{onClick:()=>C(!0),className:"text-red-600 dark:text-red-400 hover:!text-red-600 focus:text-red-600 dark:focus:text-red-400",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Excluir"]})]})]})]}),e.jsxs(ve,{children:[P&&e.jsxs("div",{className:"text-xs text-current/80 flex items-center",children:[e.jsx(Ce,{size:12,className:"mr-1.5"})," ",P.name]}),Q&&e.jsxs("div",{className:"text-xs text-current/80",children:["Pacote: ",Q.name]}),t.description&&e.jsx("p",{className:"text-xs text-current/80 line-clamp-2",children:t.description}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.tags.map((r,L)=>e.jsxs("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium ${E(r)}`,children:[e.jsx(ye,{className:"w-2.5 h-2.5 mr-1"}),r]},L))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-green-600 dark:text-green-400",children:[e.jsx(fe,{className:"w-3.5 h-3.5 mr-1"}),e.jsxs("span",{className:"font-semibold text-xs sm:text-sm",children:["R$ ",Number(t.value||0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),t.date&&e.jsxs("div",{className:"flex items-center text-current/80",children:[e.jsx(Ze,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Oe(de(t.date),"dd/MM/yy")}),t.time&&e.jsxs("span",{className:"text-xs ml-1",children:["(",t.time,")"]})]})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[H&&e.jsxs("div",{className:`flex items-center ${H.color}`,children:[e.jsx(ct,{size:12,className:"mr-1"})," ",H.message]}),k&&e.jsxs("div",{className:`flex items-center ${k.paid?"text-green-500 dark:text-green-400":"text-orange-500 dark:text-orange-400"}`,children:[e.jsx(fe,{size:12,className:"mr-1"})," Pagamento:"," ",k.paid?"Pago":"Pendente"]})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("h5",{className:"font-semibold mb-1 text-current/90",children:"Contrato e Observações"}),e.jsx("div",{className:"space-y-1",children:t.contract_url?e.jsxs("a",{href:t.contract_url,target:"_blank",rel:"noopener noreferrer",className:"text-customPurple hover:underline flex items-center text-xs",onClick:r=>r.stopPropagation(),children:[e.jsx($t,{size:12,className:"mr-1"})," Ver Contrato:"," ",t.contract_name||"Contrato"," (",t.contract_status||"Status desconhecido",")"]}):e.jsxs(g,{variant:"link",size:"sm",className:"p-0 h-auto text-xs text-customPurple",onClick:ke,children:[e.jsx(Je,{size:12,className:"mr-1"})," Criar Contrato"]})})]}),e.jsxs("div",{children:[e.jsxs(g,{variant:"link",size:"sm",className:"p-0 h-auto text-xs text-neutral-600 dark:text-purple-400",onClick:r=>{r.stopPropagation(),V(!j)},children:[j?"Ocultar":"Mostrar"," Subtarefas (",t.subtasks?.length||0,")"]}),j&&e.jsxs("div",{className:"mt-1 space-y-1 pl-1 border-l-2 border-border dark:border-slate-600",children:[(t.subtasks||[]).map(r=>e.jsxs("div",{className:"flex items-center justify-between text-xs group/subtask",children:[e.jsxs("label",{className:"flex items-center space-x-1.5 text-current/80 cursor-pointer",children:[e.jsx(mt,{checked:r.completed,onCheckedChange:L=>{a(t.id,r.id,L)},onClick:L=>L.stopPropagation()}),e.jsx("span",{className:r.completed?"line-through text-current/60":"",children:r.text})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"w-5 h-5 opacity-0 group-hover/subtask:opacity-100",onClick:L=>{L.stopPropagation(),o(t.id,r.id)},children:e.jsx(ce,{size:12,className:"text-red-500"})})]},r.id)),e.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[e.jsx(xe,{type:"text",placeholder:"Nova subtarefa...",value:M,onChange:r=>u(r.target.value),onClick:r=>r.stopPropagation(),onKeyPress:r=>{r.key==="Enter"&&Y(r)},className:"h-6 text-xs flex-grow bg-background"}),e.jsx(g,{variant:"ghost",size:"icon",className:"w-5 h-5",onClick:Y,children:e.jsx(be,{size:14})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-current/20",children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:je,className:"text-green-600 hover:text-green-700 p-1 h-auto",disabled:!P||!P.phone,children:e.jsx(Ge,{className:"w-3.5 h-3.5"})}),e.jsx(At,{delayDuration:100,children:e.jsxs(Dt,{children:[e.jsx(zt,{asChild:!0,children:e.jsxs("div",{className:"flex items-center text-current/80 cursor-pointer",onClick:r=>r.stopPropagation(),children:[e.jsx(Ge,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"text-xs",children:t.comments?.length||0})]})}),e.jsx(Et,{children:e.jsx(_t,{side:"top",align:"center",className:"p-0 bg-transparent border-none shadow-none",onClick:r=>r.stopPropagation(),children:e.jsx(Vt,{card:t,onAddComment:w})})})]})})]}),t.history&&t.history.length>0&&e.jsxs("div",{className:"mt-1 text-[10px] text-current/60",children:["Última atualização:"," ",Oe(de(t.history[t.history.length-1].date),"dd/MM/yy HH:mm")]})]})]}),e.jsx(Se,{open:W,onOpenChange:C,children:e.jsxs(Te,{children:[e.jsxs(Pe,{children:[e.jsx(Ae,{children:"Confirmar Exclusão"}),e.jsx(De,{children:"Tem certeza que deseja excluir este card? Esta ação não pode ser desfeita."})]}),e.jsxs(ze,{children:[e.jsx(Ee,{onClick:r=>{r.stopPropagation(),C(!1)},children:"Cancelar"}),e.jsx(_e,{onClick:r=>{r.stopPropagation(),K()},className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})},Ht=(t,l)=>{if(!t||t.includes("slate"))return"bg-muted/30 dark:bg-muted/10";const a=t.split("dark:")[1];return l==="dark"&&a?`${a.replace(/-\d+/,"").split(" ")[0]}`:t.split(" ")[0]},Kt=({column:t,index:l,onAddCard:a,onEditCard:i,onSaveColumnSettings:o,onDeleteColumn:m,onDeleteCard:s,onArchiveCard:h,defaultColors:w,cardViewMode:y})=>{const[N,n]=v.useState(null),[x,j]=v.useState(""),[V,M]=v.useState(t.color||"bg-card"),{updateWorkflowCard:u,addComment:W}=ee(),{theme:C}=Ye(),J=k=>{n(k.id),j(k.title),M(k.color||"bg-card")},A=()=>{x.trim()&&o(N,x,V),n(null),j("")},te=async(k,p,z)=>{const _=t.cards.find(E=>E.id===k);if(!_)return;const $=(_.subtasks||[]).map(E=>E.id===p?{...E,completed:z}:E);await u(k,{subtasks:$})},P=async(k,p)=>{const z=t.cards.find(E=>E.id===k);if(!z||!p.trim())return;const _={id:Math.random().toString(36).substr(2,9),text:p.trim(),completed:!1},$=[...z.subtasks||[],_];await u(k,{subtasks:$})},Q=async(k,p)=>{const z=t.cards.find($=>$.id===k);if(!z)return;const _=(z.subtasks||[]).filter($=>$.id!==p);await u(k,{subtasks:_})};return e.jsx(Ue,{draggableId:t.id,index:l,children:k=>e.jsx("div",{ref:k.innerRef,...k.draggableProps,className:"w-[300px] sm:w-[350px] flex-shrink-0",children:e.jsxs("div",{className:pe("rounded-xl shadow-lg border border-border/50 flex flex-col h-full max-h-full",Ht(t.color,C)),children:[e.jsx("div",{...k.dragHandleProps,className:pe("p-3 rounded-t-xl flex items-center justify-between text-foreground cursor-grab"),children:N===t.id?e.jsxs("div",{className:"flex flex-col w-full space-y-2",children:[e.jsx(xe,{value:x,onChange:p=>j(p.target.value),className:"bg-background text-foreground border-border placeholder-muted-foreground",autoFocus:!0,onKeyPress:p=>p.key==="Enter"&&A()}),e.jsx("div",{className:"flex flex-wrap gap-1",children:w.map(p=>e.jsx("button",{type:"button",onClick:()=>M(p),className:`w-5 h-5 rounded-full border-2 ${V===p?"border-foreground ring-2 ring-offset-1 ring-offset-transparent ring-primary":"border-transparent"} ${C==="dark"&&p.split("dark:")[1]?.split(" ")[0]||p.split(" ")[0]}`,"aria-label":`Selecionar cor ${p}`},p))}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>n(null),className:"text-muted-foreground hover:bg-accent",children:"Cancelar"}),e.jsx(g,{size:"sm",variant:"ghost",onClick:A,className:"text-muted-foreground hover:bg-accent",children:"Salvar"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-semibold text-sm",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>J(t),className:"w-6 h-6 text-muted-foreground hover:bg-accent",children:e.jsx(It,{size:14})}),e.jsxs(Se,{children:[e.jsx(Tt,{asChild:!0,children:e.jsx(g,{variant:"ghost",size:"icon",className:"w-6 h-6 text-muted-foreground hover:bg-accent",children:e.jsx(ce,{size:14})})}),e.jsxs(Te,{children:[e.jsxs(Pe,{children:[e.jsx(Ae,{children:"Excluir Coluna?"}),e.jsxs(De,{children:['Tem certeza que deseja excluir a coluna "',t.title,'"?',t.cards&&t.cards.length>0&&" Esta coluna contém cards. Mova-os antes de excluir."]})]}),e.jsxs(ze,{children:[e.jsx(Ee,{children:"Cancelar"}),e.jsx(_e,{onClick:()=>m(t.id),disabled:t.cards&&t.cards.length>0,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})]}),e.jsx("span",{className:"bg-background/50 text-foreground px-1.5 py-0.5 rounded-full text-xs",children:t.cards?.length||0})]})]})}),e.jsx(et,{droppableId:t.id,type:"CARD",children:(p,z)=>e.jsxs("div",{ref:p.innerRef,...p.droppableProps,className:pe("p-3 space-y-3 transition-colors min-h-[100px]",z.isDraggingOver?"bg-accent/50":""),children:[(t.cards||[]).map((_,$)=>e.jsx(Ue,{draggableId:_.id,index:$,children:E=>e.jsx("div",{ref:E.innerRef,...E.draggableProps,...E.dragHandleProps,children:e.jsx(Gt,{card:_,onEdit:i,onUpdateSubtask:te,onAddSubtask:P,onDeleteSubtask:Q,onDeleteCard:s,onArchiveCard:h,columnColor:t.color,onAddComment:W,viewMode:y})})},_.id)),p.placeholder]})}),e.jsx("div",{className:"p-3 mt-auto border-t border-border flex-shrink-0",children:e.jsxs(g,{variant:"outline",className:"w-full border-dashed border-2 h-10 text-muted-foreground hover:text-foreground",onClick:()=>a(t.id),children:[e.jsx(be,{className:"w-4 h-4 mr-2"}),"Adicionar Card"]})})]})})})},Qt=({card:t,onUnarchive:l,onDelete:a,onEdit:i})=>{const{getClientById:o,getServicePackageById:m}=ee(),s=t.client_id?o(t.client_id):null,h=t.service_package_id?m(t.service_package_id):null,[w,y]=v.useState(!1),N=()=>{a(t.id),y(!1)},n=x=>({Casamento:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",Gestante:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",Empresarial:"bg-sky-100 text-sky-800 dark:bg-sky-900 dark:text-sky-200","Ensaio Externo":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",Corporativo:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",Estúdio:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",Produto:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"})[x]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200";return e.jsxs(e.Fragment,{children:[e.jsxs(G.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-slate-100 dark:bg-slate-700/50 p-4 rounded-lg shadow-md border border-slate-200 dark:border-slate-600",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100 break-all",children:t.title||(s?s.name:"Card Arquivado")}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(g,{variant:"ghost",size:"icon",className:"w-7 h-7 text-slate-600 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200",onClick:()=>i(t),children:e.jsx(we,{size:16})}),e.jsx(g,{variant:"ghost",size:"icon",className:"w-7 h-7 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>l(t.id),children:e.jsx(Bt,{size:16})}),e.jsx(g,{variant:"ghost",size:"icon",className:"w-7 h-7 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",onClick:()=>y(!0),children:e.jsx(ce,{size:16})})]})]}),s&&e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mb-1 flex items-center",children:[e.jsx(Ce,{size:12,className:"mr-1"})," ",s.name]}),h&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:["Pacote: ",h.name]}),t.date&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1 flex items-center",children:[e.jsx(Ze,{size:12,className:"mr-1"})," ",new Date(t.date).toLocaleDateString("pt-BR")]}),t.value>0&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mb-1 flex items-center",children:[e.jsx(fe,{size:12,className:"mr-1"})," R$ ",Number(t.value).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:t.tags.map((x,j)=>e.jsxs("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${n(x)} flex items-center`,children:[e.jsx(ye,{size:10,className:"mr-1"}),x]},j))}),t.history&&t.history.length>0&&e.jsxs("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-2",children:["Arquivado em: ",new Date(t.history.find(x=>x.action==="Card arquivado")?.date||t.updated_at||t.created_at).toLocaleDateString("pt-BR")]})]}),e.jsx(Se,{open:w,onOpenChange:y,children:e.jsxs(Te,{children:[e.jsxs(Pe,{children:[e.jsx(Ae,{children:"Excluir Card Permanentemente?"}),e.jsxs(De,{children:['Esta ação não pode ser desfeita. O card "',t.title||"este card",'" será excluído para sempre.']})]}),e.jsxs(ze,{children:[e.jsx(Ee,{onClick:()=>y(!1),children:"Cancelar"}),e.jsx(_e,{onClick:N,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})},Xt=({cards:t,onDeleteCard:l,onUnarchiveCard:a,onEditCard:i})=>!t||t.length===0?e.jsxs("div",{className:"text-center py-10 text-slate-500 dark:text-slate-400",children:[e.jsx(me,{size:48,className:"mx-auto mb-4 text-slate-400 dark:text-slate-500"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Nenhum card arquivado"}),e.jsx("p",{children:"Você ainda não arquivou nenhum card."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-slate-800 dark:text-slate-100",children:["Cards Arquivados (",t.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.sort((o,m)=>new Date(m.updated_at||m.created_at)-new Date(o.updated_at||o.created_at)).map(o=>e.jsx(Qt,{card:o,onUnarchive:a,onDelete:l,onEdit:i},o.id))})]}),Jt=({viewMode:t,onToggleViewMode:l,showArchived:a,onToggleArchived:i,archivedCount:o,showNewColumnInput:m,onToggleNewColumnInput:s,newColumnName:h,onSetNewColumnName:w,onAddNewColumn:y})=>e.jsxs(G.div,{initial:{y:100},animate:{y:0},exit:{y:100},transition:{type:"spring",stiffness:120,damping:20},className:"fixed bottom-0 left-0 right-0 bg-card/80 dark:bg-card/70 backdrop-blur-lg border-t border-border p-2 shadow-top-lg z-40 md:hidden",children:[e.jsxs("div",{className:"flex items-center justify-around space-x-1",children:[e.jsxs(g,{onClick:i,variant:"ghost",size:"sm",className:"flex-1 flex flex-col items-center h-auto py-1.5 text-xs text-muted-foreground hover:text-foreground",title:a?"Ocultar Arquivados":`Ver Arquivados (${o})`,children:[a?e.jsx(Ft,{className:"w-5 h-5 mb-0.5"}):e.jsx(me,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"truncate",children:a?"Visíveis":`Arquivos (${o})`})]}),e.jsxs(g,{onClick:l,variant:"ghost",size:"sm",className:"flex-1 flex flex-col items-center h-auto py-1.5 text-xs text-muted-foreground hover:text-foreground",title:t==="kanban"?"Visualizar Timeline":"Visualizar Kanban",disabled:a,children:[t==="kanban"?e.jsx(Rt,{className:"w-5 h-5 mb-0.5"}):e.jsx(Lt,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"truncate",children:t==="kanban"?"Timeline":"Kanban"})]}),!m&&!a&&e.jsxs(g,{onClick:s,variant:"ghost",size:"sm",className:"flex-1 flex flex-col items-center h-auto py-1.5 text-xs text-muted-foreground hover:text-foreground",title:"Adicionar Nova Coluna",children:[e.jsx(be,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"truncate",children:"Nova Coluna"})]})]}),m&&!a&&e.jsxs(G.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:"0.5rem"},exit:{height:0,opacity:0,marginTop:0},className:"flex flex-col space-y-2 p-2 bg-background rounded-md shadow-inner",children:[e.jsx(xe,{type:"text",value:h,onChange:N=>w(N.target.value),placeholder:"Nome da nova coluna",className:"w-full h-9 text-sm",autoFocus:!0,onKeyPress:N=>N.key==="Enter"&&y()}),e.jsxs("div",{className:"flex w-full space-x-2",children:[e.jsx(g,{onClick:y,size:"sm",className:"flex-1 h-9 text-xs",children:"Salvar Coluna"}),e.jsx(g,{onClick:s,variant:"outline",size:"sm",className:"flex-1 h-9 text-xs",children:"Cancelar"})]})]})]}),Yt=["bg-purple-300 dark:bg-purple-700","bg-blue-300 dark:bg-blue-700","bg-yellow-300 dark:bg-yellow-700","bg-pink-300 dark:bg-pink-700","bg-green-300 dark:bg-green-700","bg-rose-300 dark:bg-rose-700","bg-indigo-300 dark:bg-indigo-700","bg-teal-300 dark:bg-teal-700","bg-red-300 dark:bg-red-700","bg-sky-300 dark:bg-sky-700","bg-fuchsia-300 dark:bg-fuchsia-700","bg-cyan-300 dark:bg-cyan-700","bg-lime-300 dark:bg-lime-700","bg-amber-300 dark:bg-amber-700","bg-violet-300 dark:bg-violet-700","bg-slate-200 dark:bg-slate-700"],ws=({isMobile:t})=>{const{workflowCards:l,updateWorkflowCard:a,deleteWorkflowCard:i,settings:o,setSettings:m,getClientById:s,getServicePackageById:h,financialData:w,refreshData:y}=ee(),{toast:N}=Qe(),{openModal:n}=pt(),[x,j]=v.useState([]),[V,M]=v.useState(!1),[u,W]=v.useState(""),[C,J]=v.useState({eventType:"",period:"",packageId:"",financialStatus:"",tag:""}),[A,te]=v.useState(!1),[P,Q]=v.useState(!1),[k,p]=v.useState(""),[z,_]=v.useState(!0),[$,E]=v.useState(o?.workflow_card_view_mode||"detailed");v.useEffect(()=>{const d=requestAnimationFrame(()=>M(!0));return()=>{cancelAnimationFrame(d),M(!1)}},[]);const je=d=>{E(d),m({workflow_card_view_mode:d})},R=v.useMemo(()=>l.filter(d=>!d.archived),[l]),H=v.useMemo(()=>l.filter(d=>d.archived),[l]),Y=v.useMemo(()=>(A?H:R).filter(c=>{const f=c.client_id?s(c.client_id):null,S=c.service_package_id?h(c.service_package_id):null,b=u.toLowerCase(),I=c.title&&c.title.toLowerCase().includes(b)||f&&f.name&&f.name.toLowerCase().includes(b)||c.date&&c.date.includes(u)||S&&S.name&&S.name.toLowerCase().includes(b),T=!C.eventType||S&&S.niche===C.eventType,O=(()=>{if(!C.period||!c.date)return!0;const U=new Date(c.date),B=new Date;if(B.setHours(0,0,0,0),C.period==="next7days"){const X=new Date(B);return X.setDate(B.getDate()+7),U>=B&&U<=X}if(C.period==="next30days"){const X=new Date(B);return X.setDate(B.getDate()+30),U>=B&&U<=X}return!0})(),he=!C.packageId||c.service_package_id===C.packageId,F=w.transactions.find(U=>U.workflow_id===c.id),se=C.financialStatus?C.financialStatus==="paid"?F&&F.status==="PAGO":C.financialStatus==="pending"?!F||F.status!=="PAGO":!0:!0,ae=!C.tag||c.tags&&c.tags.includes(C.tag);return I&&T&&O&&he&&se&&ae}),[R,H,A,u,C,s,h,w.transactions]),K=v.useCallback(d=>{const c=d.map(({id:f,title:S,color:b})=>({id:f,title:S,color:b}));m({workflow_columns:c})},[m]);v.useEffect(()=>{if(A){j([]);return}const d=o?.workflow_columns;let c=d&&d.length>0?d.map(b=>({...b,cards:[]})):ft.map(b=>({...b,cards:[]}));const f=c.findIndex(b=>b.id==="novo-lead");f===-1&&c.unshift({id:"novo-lead",title:"Novos Leads",cards:[],color:"bg-slate-200 dark:bg-slate-700"});const S=c.map(b=>{let I=Y.filter(T=>T.status===b.id&&!T.archived);return I.sort((T,O)=>{if(b.id==="agendado"){if(!T.date&&!O.date)return 0;if(!T.date)return 1;if(!O.date)return-1;try{return de(T.date)-de(O.date)||(T.time||"00:00").localeCompare(O.time||"00:00")||0}catch{return 0}}return(T.order||0)-(O.order||0)}),{...b,cards:I}});j(S),(!d||d.length===0||f===-1)&&K(c.map(b=>({id:b.id,title:b.title,color:b.color})))},[o?.workflow_columns,Y,A,K]);const ke=()=>{Q(d=>!d),P||p("")},ve=()=>{if(!k.trim()){N({title:"Erro",description:"O nome da coluna não pode ser vazio.",variant:"destructive"});return}const d=k.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"");if(x.some(S=>S.id===d)){N({title:"Erro",description:"Já existe uma coluna com este ID.",variant:"destructive"});return}const c={id:d,title:k,color:"bg-slate-200 dark:bg-slate-700",cards:[]},f=[...x,c];j(f),K(f),p(""),Q(!1)},ue=async d=>{const{source:c,destination:f,draggableId:S,type:b}=d;if(!(!f||A)){if(b==="COLUMN"){const I=Array.from(x),[T]=I.splice(c.index,1);I.splice(f.index,0,T),j(I),K(I);return}if(b==="CARD"){if(c.droppableId===f.droppableId&&c.index===f.index)return;const I=x.find(D=>D.id===c.droppableId),T=x.find(D=>D.id===f.droppableId),O=R.find(D=>D.id===S);if(!O||!I||!T){N({title:"Erro ao Mover",description:"Não foi possível encontrar o card ou a coluna de destino.",variant:"destructive"});return}const he=T.id,F=[...x],se=F.findIndex(D=>D.id===c.droppableId),ae=F.findIndex(D=>D.id===f.droppableId);let U=Array.from(F[se].cards||[]);U.splice(c.index,1),F[se]={...F[se],cards:U};let B;c.droppableId===f.droppableId?B=U:B=Array.from(F[ae].cards||[]);const X={...O,status:he,order:f.index};B.splice(f.index,0,X),F[ae]={...F[ae],cards:B};const Fe=F.map(D=>({...D,cards:(D.cards||[]).map((re,ge)=>({...re,order:ge,status:D.id}))}));j(Fe);try{const D=Fe.flatMap(re=>(re.cards||[]).map((ge,Re)=>{const Ne=R.find(at=>at.id===ge.id);return Ne&&(Ne.status!==re.id||Ne.order!==Re)?a(ge.id,{status:re.id,order:Re}):null}).filter(Boolean));await Promise.all(D),await y("workflow_cards")}catch(D){N({title:"Erro ao mover projeto",description:D.message,variant:"destructive"}),j(x)}}}},r=d=>n("workflow",{initialStatus:d}),L=d=>n("workflow",{cardId:d.id}),$e=async d=>{try{await i(d),await y("workflow_cards")}catch(c){N({title:"Erro ao excluir",description:c.message,variant:"destructive"})}},Ie=async(d,c)=>{try{await a(d,{archived:c}),await y("workflow_cards")}catch(f){N({title:"Erro ao arquivar/restaurar",description:f.message,variant:"destructive"})}},st=(d,c,f)=>{const S=x.map(b=>b.id===d?{...b,title:c,color:f||b.color}:b);j(S),K(S)};return V?e.jsxs("div",{className:`flex flex-col h-full ${t?"pb-16":""}`,children:[e.jsxs("div",{className:`flex-shrink-0 space-y-4 sm:space-y-6 bg-background ${t?"pb-2":"pb-4 sm:pb-6"}`,children:[e.jsx(qt,{isMobile:t,onAddNewCard:()=>r("agendado"),showArchived:A,isSummaryExpandedDesktop:z,setIsSummaryExpandedDesktop:_,cardViewMode:$,onToggleCardViewMode:je}),!t&&!A&&e.jsxs(G.div,{initial:{height:0,opacity:0},animate:{height:z?"auto":0,opacity:z?1:0},transition:{duration:.3},className:"overflow-hidden",children:[e.jsx(Mt,{cards:R,columns:x}),e.jsx(Wt,{activeFilters:C,setActiveFilters:J,searchTerm:u,setSearchTerm:W})]})]}),e.jsx("div",{className:"flex-grow overflow-x-auto overflow-y-hidden scrollbar-thin",children:A?e.jsx("div",{className:"p-1",children:e.jsx(Xt,{cards:Y,onDeleteCard:$e,onUnarchiveCard:d=>Ie(d,!1),onEditCard:L})}):e.jsx(bt,{onDragEnd:ue,children:e.jsx(et,{droppableId:"all-columns",direction:"horizontal",type:"COLUMN",children:d=>e.jsxs("div",{...d.droppableProps,ref:d.innerRef,className:"flex space-x-4 p-1 workflow-columns-container min-h-[calc(100vh-400px)] sm:min-h-[calc(100vh-350px)]",children:[x.map((c,f)=>e.jsx(Kt,{column:c,index:f,onAddCard:r,onEditCard:L,onDeleteCard:$e,onArchiveCard:S=>Ie(S,!0),onSaveColumnSettings:st,defaultColors:Yt,onDeleteColumn:S=>{if(x.find(T=>T.id===S)?.cards?.length){N({title:"Atenção",description:"Não é possível excluir colunas com projetos. Mova-os primeiro.",variant:"destructive"});return}const I=x.filter(T=>T.id!==S);j(I),K(I)},cardViewMode:$},c.id||`col-key-${f}`)),d.placeholder]})})})}),!t&&e.jsx(Jt,{showArchived:A,onToggleArchived:()=>te(!A),archivedCount:H.length,showNewColumnInput:P,onToggleNewColumnInput:ke,newColumnName:k,onSetNewColumnName:p,onAddNewColumn:ve})]}):null};export{ws as default};
