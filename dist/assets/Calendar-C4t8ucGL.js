import{b3 as ae,ap as ie,ao as pe,c as Te,r as h,a7 as X,aS as se,j as e,B as C,u as he,C as Z,p as fe,m as E,I as R,b4 as Ie,b5 as Le,aD as Re,a1 as He,a2 as ze,a3 as Fe,a4 as $e,a5 as W,P as w,H as D,aa as Q,a9 as qe,af as M,aK as be,b1 as Ue,R as je,b6 as ee,U as Ve,aF as Be,f as ve,s as K,ae as We,Y as ne,Z as le,n as ce,_ as Qe,$ as Xe,a0 as Je,i as A,b2 as Ke,a6 as Ye,b as Ze,aC as et}from"./index-DHBNVHsv.js";import{l as tt,r as at,g as st}from"./googleCalendar-B6sFUS35.js";import{F as rt}from"./FeatureRestrictionModal-eN81Qxj_.js";import{S as ot}from"./search-DbNcPKSo.js";import{L as ye}from"./list-checks-k5Vjs9Lm.js";import{S as ke}from"./settings-BihSyCWF.js";import{s as de,a as me}from"./subMonths-Dk7whGvi.js";import{s as it,e as nt}from"./subDays-D86t1I3W.js";import{P as lt,a as ct,b as dt}from"./popover-pf7Mxtst.js";import{e as we,g as mt}from"./getDay-Doa7jYwd.js";import{c as Ne}from"./constructNow-DKKJTFER.js";import{s as ue}from"./startOfMonth-dlDON3ZA.js";import{e as ut}from"./endOfMonth-FRBqcOZp.js";import{i as gt}from"./isSameMonth-DbfKZyUB.js";import{M as Ce}from"./map-pin-CSRkdryr.js";import{E as xt}from"./external-link-DSa138R5.js";import{S as Y}from"./switch-C0tIeEyV.js";import{C as pt}from"./copy-Ydl0eOtw.js";import{A as ht}from"./AvailabilityModal-CVic8kHK.js";import{C as ft}from"./calendar-days-CFVjpzr4.js";import{C as bt}from"./compass-CL3PFqvZ.js";import"./alert-dialog-CA3sahhm.js";import"./extends-CF3RwP-h.js";function _e(r,m){const o=m*7;return ae(r,o)}function H(r,m){const o=ie(r),p=ie(m);return+o==+p}function Se(r){return pe(r).getHours()}function ge(r){return pe(r).getMinutes()}function te(r){return H(r,Ne(r))}function jt(r){return H(r,ae(Ne(r),1))}function vt(r,m){return _e(r,-1)}const yt=Te("UserCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),Ee=()=>{const[r,m]=h.useState(!1),{planStatus:o}=X(),{openModal:p}=se(),u=()=>{o==="PROFISSIONAL"||o==="STUDIO_PRO"?p("googleSupport"):m(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{onClick:u,variant:"outline",className:"hidden md:inline-flex items-center",title:"Vincular com Google Agenda",children:[e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Google_Calendar_icon_%282020%29.svg/2048px-Google_Calendar_icon_%282020%29.svg.png",alt:"Google Calendar Icon",className:"w-4 h-4 mr-2"}),"Vincular com Google Agenda"]}),e.jsx(rt,{isOpen:r,onClose:()=>m(!1),featureName:"Integração com Google Calendar",requiredPlans:["PROFISSIONAL","STUDIO_PRO"],currentPlan:o})]})},kt=({currentDate:r,setCurrentDate:m,currentView:o,setCurrentView:p,isMobile:u,onSearch:t})=>{const{settings:d}=X(),{openModal:g}=se(),[a,f]=h.useState(!1),[c,b]=h.useState(""),j=he(),x=()=>{let i;switch(o){case"month":i=de(r,1);break;case"week":i=vt(r);break;case"day":i=it(r,1);break;default:i=de(r,1)}m(i)},S=()=>{let i;switch(o){case"month":i=me(r,1);break;case"week":i=_e(r,1);break;case"day":i=ae(r,1);break;default:i=me(r,1)}m(i)},n=()=>o==="day"?w(r,"dd 'de' MMMM 'de' yyyy",{locale:D}):w(r,"MMMM yyyy",{locale:D}),v=i=>{b(i.target.value),t(i.target.value)},G=()=>{f(!a),a&&(b(""),t(""))};return e.jsxs("header",{className:"flex items-center justify-between p-2 md:p-4 border-b border-border flex-shrink-0 relative",children:[e.jsx("div",{className:"flex items-center space-x-2 md:space-x-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{size:32,className:"text-blue-500"}),e.jsx("span",{className:"text-xl text-foreground/80",children:"Agenda"})]})}),e.jsx(fe,{children:a&&e.jsx(E.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"absolute left-1/2 -translate-x-1/2 flex items-center",children:e.jsx(R,{type:"text",placeholder:"Buscar eventos...",value:c,onChange:v,className:"w-64 md:w-96"})})}),e.jsxs("div",{className:"flex items-center space-x-2",style:{visibility:a?"hidden":"visible"},children:[e.jsx(C,{variant:"outline",onClick:()=>m(new Date),children:"Hoje"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:x,children:e.jsx(Ie,{className:"h-5 w-5"})}),e.jsx(C,{variant:"ghost",size:"icon",onClick:S,children:e.jsx(Le,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-lg md:text-xl font-medium text-foreground capitalize w-auto md:w-48 text-center",children:n()})]}),e.jsxs("div",{className:"flex items-center space-x-1 md:space-x-2",children:[e.jsx(C,{variant:"ghost",size:"icon",className:"hidden md:inline-flex",onClick:G,children:a?e.jsx(Re,{className:"h-5 w-5"}):e.jsx(ot,{className:"h-5 w-5"})}),e.jsx(Ee,{}),e.jsx(C,{variant:"ghost",size:"icon",className:"hidden md:inline-flex",onClick:()=>j("/availability-manager"),title:"Gerenciar Disponibilidade",children:e.jsx(ye,{className:"h-5 w-5"})}),e.jsx(C,{variant:"ghost",size:"icon",className:"hidden md:inline-flex",onClick:()=>g("bookingSettings"),title:"Configurações da Agenda PRO",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsxs(He,{value:o,onValueChange:p,children:[e.jsx(ze,{className:"w-auto min-w-[80px] md:min-w-[120px]",children:e.jsx(Fe,{})}),e.jsxs($e,{children:[e.jsx(W,{value:"day",children:"Dia"}),e.jsx(W,{value:"week",children:"Semana"}),e.jsx(W,{value:"month",children:"Mês"}),e.jsx(W,{value:"agenda",children:"Agenda"})]})]}),e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-muted flex items-center justify-center overflow-hidden",children:d?.profile_photo?e.jsx("img",{src:d.profile_photo,alt:"Foto de Perfil",className:"w-full h-full object-cover"}):e.jsx(yt,{className:"w-6 h-6 text-muted-foreground"})})]})]})},xe=({currentDate:r,selectedDate:m,setSelectedDate:o,combinedEvents:p,onEventClick:u,onDateClick:t})=>{const[d,g]=h.useState(null),a=h.useRef(null),f=h.useRef(null),c=h.useMemo(()=>{const i=ue(r),y=ut(r);return we({start:i,end:y})},[r]),b=ue(r),j=mt(b),x=i=>p.filter(y=>{if(!y.start)return!1;try{return H(y.start,i)}catch{return!1}}),S=i=>{switch(i.type){case"app-event":return"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 border-l-4 border-purple-400";case"google-event":return"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 border-l-4 border-blue-400";case"available-slot":return"bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 border-l-4 border-green-400";case"booked-slot":return"bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300 border-l-4 border-orange-400";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-l-4 border-gray-400"}},n=i=>{clearTimeout(f.current),a.current=setTimeout(()=>{g(i.toString())},300)},v=()=>{clearTimeout(a.current),f.current=setTimeout(()=>{g(null)},200)},G=({day:i})=>{const y=x(i),O=y.slice(0,2),z=i.toString();return e.jsxs(lt,{open:d===z,onOpenChange:k=>g(k?z:null),children:[e.jsx(ct,{asChild:!0,children:e.jsxs("div",{onMouseEnter:()=>n(i),onMouseLeave:v,onClick:()=>{o(i),t&&t(i,null)},className:Q("p-2 min-h-[80px] sm:min-h-[120px] cursor-pointer transition-colors group relative flex flex-col",gt(i,r)?"bg-card hover:bg-accent":"bg-accent/30 text-muted-foreground hover:bg-accent/50",te(i)&&"ring-2 ring-primary dark:ring-primary z-10",m&&H(i,m)&&"bg-primary/10 dark:bg-primary/20"),children:[e.jsx("span",{className:Q("text-sm",te(i)?"font-bold text-primary":"text-foreground"),children:w(i,"d")}),e.jsxs("div",{className:"flex-grow mt-1 space-y-0.5 overflow-hidden",children:[e.jsx(fe,{children:O.map((k,q)=>e.jsx(E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:q*.05},className:Q("p-0.5 rounded-sm text-xs truncate cursor-pointer",S(k)),title:k.title,onClick:U=>{U.stopPropagation(),u(k)},children:k.title},k.id))}),y.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:["+ ",y.length-2," mais"]})]})]})}),y.length>0&&e.jsxs(dt,{onMouseEnter:()=>clearTimeout(f.current),onMouseLeave:v,className:"w-80 p-0",side:"top",align:"start",children:[e.jsx("div",{className:"p-4",children:e.jsx("h4",{className:"font-medium capitalize",children:w(i,"EEEE, dd 'de' MMMM",{locale:D})})}),e.jsx(qe,{className:"max-h-60",children:e.jsx("div",{className:"p-4 pt-0 space-y-2",children:y.map(k=>e.jsxs("div",{className:Q("p-2 rounded-md text-sm cursor-pointer",S(k)),onClick:()=>u(k),children:[e.jsx("p",{className:"font-semibold truncate",children:k.title}),e.jsx("p",{className:"text-xs opacity-80",children:k.time||"Dia todo"})]},k.id))})})]})]})};return e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-border border border-border rounded-lg overflow-hidden",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(i=>e.jsx("div",{className:"py-2 text-center text-xs font-medium text-muted-foreground bg-accent/50",children:i},i)),Array.from({length:j}).map((i,y)=>e.jsx("div",{className:"bg-accent/30 min-h-[80px] sm:min-h-[120px]"},`empty-${y}`)),c.map(i=>e.jsx(G,{day:i},i.toString()))]})},wt=({combinedEvents:r,onEventClick:m})=>{const o=r.reduce((u,t)=>{if(!t.date)return u;const d=M(t.date),g=w(d,"yyyy-MM-dd");return u[g]||(u[g]=[]),u[g].push(t),u},{}),p=Object.keys(o).sort();return e.jsxs("div",{className:"space-y-6 p-1",children:[p.length===0&&e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Nenhum evento agendado."}),p.map((u,t)=>{const d=o[u],g=M(u);return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3 capitalize",children:w(g,"EEEE, dd MMMM yyyy",{locale:D})}),e.jsx("div",{className:"space-y-2",children:d.map((a,f)=>e.jsxs(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.1+f*.05},className:"flex items-center justify-between p-3 bg-accent/50 dark:bg-accent/30 rounded-lg hover:shadow-md dark:hover:bg-accent/50 transition-all cursor-pointer",onClick:()=>m(a),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${a.isGoogleEvent?"bg-blue-500":"bg-orange-300"}`}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-medium text-sm text-foreground truncate",title:a.title,children:a.title}),e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-muted-foreground mt-0.5",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),a.time||"Dia todo"]}),a.location&&e.jsxs("div",{className:"flex items-center truncate",title:a.location,children:[e.jsx(Ce,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:a.location})]})]})]})]}),a.isGoogleEvent&&a.htmlLink&&e.jsx("a",{href:a.htmlLink,target:"_blank",rel:"noopener noreferrer",onClick:c=>c.stopPropagation(),children:e.jsx(xt,{className:"w-4 h-4 text-blue-500 hover:text-blue-600"})})]},a.id))})]},u)})]})},Nt=({currentDate:r,combinedEvents:m,onEventClick:o,onDateClick:p})=>{const u=Ue(r,{locale:D}),t=nt(r,{locale:D}),d=we({start:u,end:t}),g=Array.from({length:24},(c,b)=>b),a=(c,b)=>m.filter(j=>!j.start||!H(j.start,c)?!1:Se(j.start)===b),f=(c,b)=>{const j=w(new Date(0,0,0,b),"HH:mm");p&&p(c,j)};return e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[auto_repeat(7,1fr)]",children:[e.jsx("div",{className:"p-2 text-xs font-medium text-muted-foreground bg-accent/50 sticky top-0 z-10 border-b border-r border-border",children:"Hora"}),d.map(c=>e.jsxs("div",{className:"p-2 text-center text-xs font-medium text-muted-foreground bg-accent/50 sticky top-0 z-10 border-b border-border cursor-pointer hover:bg-accent/80",onClick:()=>p(c,null),children:[e.jsx("span",{className:"block sm:hidden",children:w(c,"E",{locale:D})}),e.jsx("span",{className:"hidden sm:block",children:w(c,"EEE dd/MM",{locale:D})})]},c.toString())),g.map(c=>e.jsxs(je.Fragment,{children:[e.jsx("div",{className:"p-2 text-xs text-center text-muted-foreground bg-accent/50 border-r border-border h-16 flex items-center justify-center cursor-pointer hover:bg-accent/80",onClick:()=>f(r,c),children:w(new Date(0,0,0,c),"HH:mm")}),d.map(b=>{const j=a(b,c);return e.jsx("div",{className:"border-b border-l border-border p-1 h-16 overflow-y-auto space-y-0.5 relative cursor-pointer hover:bg-accent/30",onClick:()=>f(b,c),children:j.map((x,S)=>e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:S*.05},className:`p-0.5 rounded-sm text-[10px] leading-tight truncate cursor-pointer ${x.isGoogleEvent?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300"}`,title:`${x.title} (${x.time})`,onClick:n=>{n.stopPropagation(),o(x)},children:[e.jsx("span",{className:"font-medium",children:x.time})," ",x.title]},x.id))},`${b.toString()}-${c}`)})]},c))]})})},Ct=({currentDate:r,combinedEvents:m,onEventClick:o,onDateClick:p})=>{const u=Array.from({length:24},(g,a)=>a),t=g=>m.filter(a=>!a.start||!H(a.start,r)?!1:Se(a.start)===g).sort((a,f)=>ge(a.start)-ge(f.start)),d=g=>{const a=w(new Date(0,0,0,g),"HH:mm");p&&p(r,a)};return e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[auto_1fr]",children:[e.jsx("div",{className:"p-2 text-xs font-medium text-muted-foreground bg-accent/50 sticky top-0 z-10 border-b border-r border-border col-span-2 text-center",children:w(r,"EEEE, dd MMMM yyyy",{locale:D})}),u.map(g=>e.jsxs(je.Fragment,{children:[e.jsx("div",{className:"p-2 text-xs text-center text-muted-foreground bg-accent/50 border-r border-b border-border h-20 flex items-center justify-center cursor-pointer hover:bg-accent/80 transition-colors",onClick:()=>d(g),children:w(new Date(0,0,0,g),"HH:mm")}),e.jsx("div",{className:"border-b border-border p-1 h-20 overflow-y-auto space-y-1 relative cursor-pointer hover:bg-accent/30 transition-colors",onClick:()=>d(g),children:t(g).map((a,f)=>e.jsxs(E.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:f*.05},className:`p-1 rounded text-xs leading-tight cursor-pointer ${a.isGoogleEvent?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300"}`,title:`${a.title} (${a.time})`,onClick:c=>{c.stopPropagation(),o(a)},children:[e.jsxs("div",{className:"font-semibold",children:[a.time," - ",a.title]}),a.description&&e.jsx("div",{className:"text-[10px] opacity-80 truncate",children:a.description})]},a.id))})]},g))]})})},_t=({combinedEvents:r,onEventClick:m})=>{const o=new Date,p=r.filter(t=>!t.start||!ee(new Date(t.start))?!1:new Date(t.start)>=o&&t.type!=="available-slot").sort((t,d)=>new Date(t.start)-new Date(d.start)).slice(0,7);if(p.length===0)return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6 p-6 bg-card rounded-xl shadow-lg border border-border text-center",children:[e.jsx(Z,{size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-foreground",children:"Sem Próximos Eventos"}),e.jsx("p",{className:"text-muted-foreground",children:"Não há eventos agendados para os próximos dias."})]});const u=t=>{const d=new Date(t);return ee(d)?te(d)?"Hoje":jt(d)?"Amanhã":w(d,"EEEE, dd 'de' MMMM",{locale:D}):"Data inválida"};return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"Próximos Eventos"}),e.jsx("div",{className:"space-y-4",children:p.map((t,d)=>e.jsxs(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.1},onClick:()=>m(t),className:"bg-card p-4 rounded-lg shadow-md border border-border cursor-pointer hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-foreground text-base sm:text-lg",children:t.title}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium
                ${t.isGoogleEvent?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300"}`,children:t.isGoogleEvent?"Google Calendar":"GO.Fotógrafo"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{size:14,className:"mr-2"}),e.jsx("span",{children:u(t.start)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{size:14,className:"mr-2"}),e.jsx("span",{children:t.time||w(new Date(t.start),"HH:mm")})]}),t.location&&e.jsxs("div",{className:"flex items-center sm:col-span-2",children:[e.jsx(Ce,{size:14,className:"mr-2"}),e.jsx("span",{children:t.location})]}),!t.isGoogleEvent&&t.clientData&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ve,{size:14,className:"mr-2"}),e.jsxs("span",{children:["Cliente: ",t.clientData.name]})]}),!t.isGoogleEvent&&t.packageData&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{size:14,className:"mr-2"}),e.jsxs("span",{children:["Pacote: ",t.packageData.name]})]})]}),t.description&&!t.isGoogleEvent&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:t.description})]},t.id))})]})},St=({isOpen:r,onClose:m})=>{const{user:o,refreshData:p}=X(),{toast:u}=ve(),[t,d]=h.useState(null),[g,a]=h.useState(!1),[f,c]=h.useState(!0),b=h.useCallback(async()=>{if(o){c(!0);try{const{data:n,error:v}=await K.from("booking_settings").select("*").eq("user_id",o.id).single();if(v&&v.code!=="PGRST116")throw v;if(n)d(n);else{const G={user_id:o.id,booking_enabled:!1,booking_link_id:We(),require_payment:!1,payment_percentage:10,pix_key:"",pix_qr_code_url:"",credit_card_link:"",show_footer_info:!0},{data:i,error:y}=await K.from("booking_settings").insert(G).select().single();if(y)throw y;d(i)}}catch(n){u({title:"Erro ao carregar configurações",description:n.message,variant:"destructive"})}finally{c(!1)}}},[o,u]);h.useEffect(()=>{r&&b()},[r,b]);const j=async()=>{if(t){a(!0);try{const{data:n,error:v}=await K.from("booking_settings").update(t).eq("id",t.id).select().single();if(v)throw v;d(n),u({title:"Configurações salvas!",description:"Suas configurações da Agenda PRO foram atualizadas."}),await p(),m()}catch(n){u({title:"Erro ao salvar",description:n.message,variant:"destructive"})}finally{a(!1)}}},x=(n,v)=>{d(G=>({...G,[n]:v}))},S=()=>{const n=`${window.location.origin}/agendar/${t.booking_link_id}`;navigator.clipboard.writeText(n),u({title:"Link copiado!",description:"O link de agendamento foi copiado para sua área de transferência."})};return f?e.jsx(ne,{open:r,onOpenChange:m,children:e.jsx(le,{children:e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(ce,{className:"w-8 h-8 animate-spin"})})})}):e.jsx(ne,{open:r,onOpenChange:m,children:e.jsxs(le,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(Qe,{children:[e.jsx(Xe,{children:"Configurações da Agenda PRO"}),e.jsx(Je,{children:"Ative e personalize sua página pública de agendamentos."})]}),t&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsx(A,{htmlFor:"booking-enabled",className:"font-semibold",children:"Ativar página de agendamento"}),e.jsx(Y,{id:"booking-enabled",checked:t.booking_enabled,onCheckedChange:n=>x("booking_enabled",n)})]}),t.booking_enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{children:"Link Público de Agendamento"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{value:`${window.location.origin}/agendar/${t.booking_link_id}`,readOnly:!0}),e.jsx(C,{variant:"outline",size:"icon",onClick:S,children:e.jsx(pt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"font-semibold",children:"Pagamento de Reserva"}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsx(A,{htmlFor:"require-payment",children:"Exigir pagamento para reservar"}),e.jsx(Y,{id:"require-payment",checked:t.require_payment,onCheckedChange:n=>x("require_payment",n)})]}),t.require_payment&&e.jsxs("div",{className:"space-y-4 pl-4 border-l-2 ml-2",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"payment-percentage",children:"Porcentagem de entrada (%)"}),e.jsx(R,{id:"payment-percentage",type:"number",value:t.payment_percentage,onChange:n=>x("payment_percentage",n.target.value)})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"pix-key",children:"Chave PIX"}),e.jsx(R,{id:"pix-key",value:t.pix_key,onChange:n=>x("pix_key",n.target.value),placeholder:"CPF, CNPJ, e-mail, telefone ou chave aleatória"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"pix-qr-code",children:"URL do QR Code PIX"}),e.jsx(R,{id:"pix-qr-code",value:t.pix_qr_code_url,onChange:n=>x("pix_qr_code_url",n.target.value),placeholder:"https://link-para-seu-qr-code.com/imagem.png"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"credit-card-link",children:"Link para Cartão de Crédito"}),e.jsx(R,{id:"credit-card-link",value:t.credit_card_link,onChange:n=>x("credit_card_link",n.target.value),placeholder:"https://link-de-pagamento.com"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"font-semibold",children:"Rodapé da Página"}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(A,{htmlFor:"show-footer",className:"font-semibold",children:"Exibir informações no rodapé"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mostra logo, endereço, telefone e redes sociais."})]}),e.jsx(Y,{id:"show-footer",checked:t.show_footer_info,onCheckedChange:n=>x("show_footer_info",n)})]}),e.jsxs("div",{className:"flex items-start gap-2 bg-accent/50 p-3 rounded-lg text-accent-foreground",children:[e.jsx(Ke,{size:16,className:"mt-1 shrink-0"}),e.jsx("p",{className:"text-xs",children:'As informações exibidas são baseadas nos dados preenchidos na aba "Minha Conta" em Configurações.'})]})]})]}),e.jsxs(Ye,{children:[e.jsx(C,{variant:"outline",onClick:m,children:"Cancelar"}),e.jsxs(C,{onClick:j,disabled:g,children:[g&&e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvar"]})]})]})})},Yt=({isMobile:r,setActiveTab:m})=>{const{toast:o}=ve(),p=he(),{workflowCards:u,getClientById:t,getServicePackageById:d,importGoogleEventsAsWorkflowCards:g,refreshData:a,user:f,planStatus:c,availabilitySlots:b,settings:j}=X(),{openModal:x,closeModal:S,openModals:n}=se(),[v,G]=h.useState(new Date),[i,y]=h.useState(new Date),[O,z]=h.useState([]),[k,q]=h.useState(!1),[U,Me]=h.useState("month"),F=h.useMemo(()=>j?.google_tokens,[j]),{isMobile:J}=Ze(),re=h.useCallback(async l=>{try{await a("settings")}catch(_){console.error("Error storing Google tokens in DB",_)}},[a]),V=h.useCallback(async()=>{try{await a("settings"),z([])}catch(l){console.error("Error clearing Google tokens from DB",l)}},[a]),T=h.useMemo(()=>{const l=u.filter(s=>s.date&&!s.archived&&s.status==="agendado").map(s=>{const P=s.client_id?t(s.client_id):null,Oe=s.service_package_id?d(s.service_package_id):null,oe=s.time||"00:00";let L;try{L=M(`${s.date}T${oe}:00`),ee(L)||(L=new Date)}catch{L=new Date}return{id:`app-${s.id}`,title:s.title||(P?P.name:"Evento App"),date:s.date,time:oe,start:L,end:new Date(L.getTime()+36e5),description:s.description||"Não especificado",type:"app-event",isGoogleEvent:!1,rawCard:s,clientData:P,packageData:Oe,google_event_id:s.google_event_id}}),_=O.map(s=>({id:`google-${s.id}`,title:s.summary||"Evento Google",date:s.start?.date||(s.start?.dateTime?s.start.dateTime.split("T")[0]:new Date().toISOString().split("T")[0]),time:s.start?.dateTime?w(M(s.start.dateTime),"HH:mm"):"Dia todo",start:s.start?.dateTime?M(s.start.dateTime):s.start?.date?M(s.start.date):new Date,end:s.end?.dateTime?M(s.end.dateTime):s.end?.date?M(s.end.date):new Date,location:s.location||"Não especificado",type:"google-event",isGoogleEvent:!0,rawEvent:s,htmlLink:s.htmlLink,google_event_id:s.id})),N=b.map(s=>({id:`avail-${s.id}`,title:s.is_booked?"Horário Reservado":"Disponível",start:M(s.start_time),end:M(s.end_time),type:s.is_booked?"booked-slot":"available-slot",isGoogleEvent:!1,rawSlot:s}));return[...l,..._,...N].sort((s,P)=>s.start-P.start)},[u,O,t,d,b]),$=h.useCallback(async(l,_=!1)=>{if(c==="PROFISSIONAL"||c==="STUDIO_PRO"){if(!l||!l.access_token){o({title:"Autenticação Necessária",description:"Por favor, autentique com o Google Calendar primeiro."});return}o({title:"Sincronizando...",description:"Buscando eventos do Google Calendar."});try{const N=await tt(l.access_token);if(z(N||[]),o({title:"Eventos do Google Calendar Carregados!"}),_&&N&&N.length>0){const s=await g(N);s>0?o({title:"Eventos Importados!",description:`${s} novo(s) evento(s) do Google Calendar foram adicionados ao fluxo de trabalho.`}):o({title:"Nenhum Novo Evento",description:"Nenhum novo evento do Google Calendar para importar."}),await a()}}catch(N){if(console.error("Error fetching Google Calendar events:",N),o({title:"Erro ao buscar eventos",description:N.message,variant:"destructive"}),N.message.toLowerCase().includes("token")||N.message.toLowerCase().includes("auth"))if(l.refresh_token){o({title:"Token Expirado",description:"Tentando atualizar token de acesso...",variant:"default"});try{const{newTokens:s}=await at(l.refresh_token),P={...l,access_token:s.access_token,expiry_date:Date.now()+s.expires_in*1e3};await re(P),o({title:"Token Atualizado!",description:"Tentando buscar eventos novamente.",variant:"success"}),await $(P,_)}catch(s){console.error("Error refreshing access token:",s),o({title:"Falha ao Atualizar Token",description:`Não foi possível atualizar a sessão com o Google. Por favor, autentique novamente: ${s.message}`,variant:"destructive"}),await V()}}else o({title:"Sessão Expirada",description:"Sua autenticação com o Google expirou e não há refresh token. Por favor, autentique novamente.",variant:"warning"}),await V()}}},[o,g,a,c,re,V]);h.useEffect(()=>{if(!(c==="PROFISSIONAL"||c==="STUDIO_PRO"))return;const l=new URLSearchParams(window.location.search),_=l.get("google_auth_success"),N=l.get("google_auth_error");if(N){o({title:"Erro de Autenticação Google",description:`O Google retornou um erro: ${N}`,variant:"destructive"}),window.history.replaceState({},document.title,window.location.pathname);return}_?(o({title:"Google Calendar Autenticado!",description:"Agora você pode sincronizar seus eventos."}),a("settings").then(()=>{j?.google_tokens&&$(j.google_tokens,!0)}),window.history.replaceState({},document.title,window.location.pathname)):F&&O.length===0&&!k&&$(F,!1)},[F,o,$,k,c,a,j]);const De=(l,_=null)=>{y(l);const N={date:w(l,"yyyy-MM-dd"),time:_,status:"agendado"};x("workflow",{cardId:null,initialData:N})},Ge=()=>{De(i||new Date)},I=l=>{l.isGoogleEvent?l.htmlLink?window.open(l.htmlLink,"_blank"):o({title:"Evento do Google",description:"Detalhes do evento: "+l.title}):l.type==="available-slot"||l.type==="booked-slot"?x("availability",{existingSlot:l.rawSlot,date:l.start}):x("workflow",{cardId:l.rawCard.id})},Pe=async()=>{if(!f){o({title:"Erro",description:"Usuário não encontrado.",variant:"destructive"});return}q(!0),o({title:"Iniciando autenticação com Google...",description:"Você será redirecionado."});try{const{authUrl:l}=await st(f.id);if(l)window.location.href=l;else throw new Error("URL de autenticação não recebida.")}catch(l){o({title:"Erro de Autenticação",description:`Não foi possível obter a URL de autenticação do Google: ${l.message}`,variant:"destructive"}),q(!1)}},B=(l,_)=>{x("availability",{date:l,time:_})},Ae=()=>{switch(U){case"month":return e.jsx(xe,{currentDate:v,selectedDate:i,setSelectedDate:y,combinedEvents:T,onEventClick:I,onDateClick:B});case"week":return e.jsx(Nt,{currentDate:v,combinedEvents:T,onEventClick:I,onDateClick:B});case"day":return e.jsx(Ct,{currentDate:v,combinedEvents:T,onEventClick:I,onDateClick:B});case"agenda":return e.jsx(wt,{combinedEvents:T,onEventClick:I});default:return e.jsx(xe,{currentDate:v,selectedDate:i,setSelectedDate:y,combinedEvents:T,onEventClick:I,onDateClick:B})}};return e.jsxs(e.Fragment,{children:[e.jsx(St,{isOpen:!!n.bookingSettings,onClose:()=>S("bookingSettings")}),e.jsx(ht,{isOpen:!!n.availability,onClose:()=>S("availability"),initialData:n.availability}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:`flex flex-col ${J?"items-center text-center":"sm:flex-row sm:items-center sm:justify-between"} gap-4`,children:[e.jsxs(E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:J?"hidden":"",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground titulo-gradiente",children:"Calendário"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm sm:text-base",children:"Gerencie seus agendamentos e compromissos"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto",children:[e.jsxs(C,{variant:"outline",onClick:()=>p("/availability-manager"),className:"w-full sm:w-auto",children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"Gerenciar Horários"]}),e.jsxs(C,{variant:"outline",onClick:()=>x("bookingSettings"),className:"w-full sm:w-auto",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Agenda PRO"]}),e.jsxs(C,{variant:"outline",onClick:()=>window.open("/season","_blank"),className:"w-full sm:w-auto bg-gradient-to-r from-yellow-50 to-orange-50 border-yellow-200 hover:bg-gradient-to-r hover:from-yellow-100 hover:to-orange-100 dark:from-yellow-900/20 dark:to-orange-900/20 dark:border-yellow-700",children:[e.jsx(ft,{className:"w-4 h-4 mr-2 text-yellow-600"}),"SEASON"]}),e.jsxs(C,{variant:"outline",onClick:()=>window.open("/opportune","_blank"),className:"w-full sm:w-auto bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200 hover:bg-gradient-to-r hover:from-purple-100 hover:to-blue-100 dark:from-purple-900/20 dark:to-blue-900/20 dark:border-purple-700",children:[e.jsx(bt,{className:"w-4 h-4 mr-2 text-purple-600"}),"OPPORTUNE"]}),e.jsx(Ee,{googleTokens:F,isGoogleAuthInProgress:k,onAuth:Pe,onSync:()=>$(F,!0),onLogout:V,className:"w-full sm:w-auto"}),e.jsxs(C,{onClick:Ge,className:"btn-custom-gradient text-white shadow-lg w-full sm:w-auto",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo Agendamento"}),e.jsx("span",{className:"sm:hidden",children:"Agendar"})]})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-3 sm:p-6 shadow-lg border border-border",children:[e.jsx(kt,{currentDate:v,setCurrentDate:G,currentView:U,setCurrentView:Me,isMobile:J}),Ae()]}),e.jsx(_t,{combinedEvents:T.filter(l=>l.type!=="available-slot"),onEventClick:I})]})]})};export{Yt as default};
