import{u as Z,f as D,e as V,r,j as e,o as G,m as b,a as H,B as v,l as C,n as K,k as S,h as u,I as h,s as g}from"./index-qkwE8oul.js";import{A as Q}from"./AuthLayout-DUond4t2.js";import{E}from"./eye-off-Pl14eHWt.js";import{E as P}from"./eye-Fh8Qjchm.js";const ae=()=>{const k=Z(),j=D(),{toast:i}=V(),[n,F]=r.useState(""),[d,L]=r.useState(""),[w,A]=r.useState(""),[x,q]=r.useState(""),[m,l]=r.useState(!1),[f,_]=r.useState(!1),[p,R]=r.useState(!1),[o,T]=r.useState({score:0,feedback:""}),[z,I]=r.useState(!1),[y,U]=r.useState(null);r.useEffect(()=>{const t=new URLSearchParams(j.search).get("ref");t&&U(t)},[j.search]);const $=a=>{let t=0,s=[];a.length<8?s.push("Pelo menos 8 caracteres"):t++,/[A-Z]/.test(a)?t++:s.push("Letra maiúscula"),/[a-z]/.test(a)?t++:s.push("Letra minúscula"),/[0-9]/.test(a)?t++:s.push("Número"),/[^A-Za-z0-9]/.test(a)?t++:s.push("Caractere especial"),T({score:t,feedback:s.join(", ")})},M=a=>{const t=a.target.value;L(t),$(t)},O=async a=>{if(a.preventDefault(),d!==w){i({title:"Erro",description:"As senhas não coincidem.",variant:"destructive"});return}if(o.score<4){i({title:"Senha Fraca",description:"Sua senha não atende aos requisitos mínimos de segurança.",variant:"destructive"});return}l(!0);const t={data:{full_name:x}};try{const{data:s,error:c}=await g.auth.signUp({email:n,password:d,options:t});if(c)throw c;if(s.user&&s.user.identities&&s.user.identities.length===0){i({title:"Usuário já existe",description:"Este e-mail já está cadastrado. Tente fazer login.",variant:"destructive"}),l(!1);return}if(s.user&&y){const{error:N}=await g.functions.invoke("handle-new-user-referral",{body:{record:{id:s.user.id,email:s.user.email,raw_user_meta_data:{full_name:x,referred_by:y}}}});N&&(console.error("Erro ao processar indicação:",N),i({title:"Aviso de Indicação",description:"Sua conta foi criada, mas houve um problema ao registrar sua indicação. Contate o suporte se necessário.",variant:"default"}))}I(!0)}catch(s){console.error("Erro no cadastro:",s),i({title:"Erro no cadastro",description:s.message||"Ocorreu um erro. Tente novamente.",variant:"destructive"})}finally{l(!1)}},B=async()=>{if(!n){i({title:"Erro",description:"O campo de e-mail está vazio.",variant:"destructive"});return}l(!0);try{const{error:a}=await g.auth.resend({type:"signup",email:n});if(a)throw a;i({title:"Email de confirmação reenviado! 🚀",description:"Verifique sua caixa de entrada (e spam)."})}catch(a){i({title:"Erro ao reenviar",description:a.message,variant:"destructive"})}finally{l(!1)}},J=()=>{const a=["bg-gray-200","bg-red-500","bg-red-500","bg-yellow-500","bg-yellow-500","bg-green-500"],t=["","Muito Fraca","Fraca","Média","Forte","Muito Forte"];return e.jsxs("div",{className:"w-full mt-1",children:[e.jsx("div",{className:"flex w-full h-1.5 rounded-full overflow-hidden",children:[...Array(5)].map((s,c)=>e.jsx("div",{className:"flex-1 mr-1 last:mr-0",children:e.jsx("div",{className:`h-full rounded-full transition-colors ${c<o.score?a[o.score]:"bg-gray-200 dark:bg-gray-700"}`})},c))}),d&&e.jsx("p",{className:`text-xs mt-1 ${o.score<3?"text-red-500":"text-green-500"}`,children:o.score>=4?`Força: ${t[o.score]}`:`Falta: ${o.feedback}`})]})};return e.jsx(Q,{children:e.jsx(G,{mode:"wait",children:z?e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center",children:[e.jsx(H,{className:"mx-auto h-16 w-16 text-green-500"}),e.jsx("h2",{className:"mt-6 text-2xl font-bold tracking-tight text-foreground",children:"Confirmação Necessária!"}),e.jsxs("p",{className:"mt-2 text-muted-foreground",children:["Enviamos um link de confirmação para ",e.jsx("span",{className:"font-semibold text-primary",children:n}),". Por favor, verifique sua caixa de entrada (e a pasta de spam) para ativar sua conta."]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsx(v,{className:"w-full",onClick:()=>k("/login"),children:"Já confirmei, ir para Login"}),e.jsxs(v,{variant:"outline",className:"w-full",onClick:B,disabled:m,children:[m?e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(K,{className:"mr-2 h-4 w-4"}),"Reenviar e-mail"]})]})]},"success"):e.jsxs(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold leading-9 tracking-tight text-foreground",children:"Crie sua conta"}),e.jsxs("p",{className:"mt-2 text-sm leading-6 text-muted-foreground",children:["Já tem uma conta?"," ",e.jsx(S,{to:"/login",className:"font-semibold text-primary hover:text-primary/90",children:"Faça login"})]})]}),e.jsx("div",{className:"mt-8",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"fullName",children:"Nome completo"}),e.jsx("div",{className:"mt-2",children:e.jsx(h,{id:"fullName",name:"fullName",type:"text",autoComplete:"name",required:!0,value:x,onChange:a=>q(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"email",children:"Endereço de e-mail"}),e.jsx("div",{className:"mt-2",children:e.jsx(h,{id:"email",name:"email",type:"email",autoComplete:"email",required:!0,value:n,onChange:a=>F(a.target.value)})})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"password",children:"Senha"}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsx(h,{id:"password",name:"password",type:f?"text":"password",autoComplete:"new-password",required:!0,value:d,onChange:M}),e.jsx("button",{type:"button",onClick:()=>_(!f),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400",children:f?e.jsx(E,{className:"h-5 w-5"}):e.jsx(P,{className:"h-5 w-5"})})]}),e.jsx(J,{})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"confirm-password",children:"Confirmar senha"}),e.jsxs("div",{className:"mt-2 relative",children:[e.jsx(h,{id:"confirm-password",name:"confirm-password",type:p?"text":"password",autoComplete:"new-password",required:!0,value:w,onChange:a=>A(a.target.value)}),e.jsx("button",{type:"button",onClick:()=>R(!p),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400",children:p?e.jsx(E,{className:"h-5 w-5"}):e.jsx(P,{className:"h-5 w-5"})})]})]}),e.jsx("div",{children:e.jsx(v,{type:"submit",className:"w-full",disabled:m,children:m?e.jsx(C,{className:"mr-2 h-4 w-4 animate-spin"}):"Criar conta"})})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ao criar uma conta, você concorda com nossos"," ",e.jsx(S,{to:"/politica-de-privacidade-e-dados",className:"font-semibold text-primary hover:text-primary/90",children:"Termos e Política de Privacidade"}),"."]})})]},"form")})})};export{ae as default};
