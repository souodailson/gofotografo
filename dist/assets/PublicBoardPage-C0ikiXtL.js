import{aj as q,f as D,r as i,s as N,j as e,n as P,as as S,E,aa as I,O as v,C as _}from"./index-B959_7_o.js";import{D as A,C as w,P as C}from"./dnd.esm-CNSIsYfb.js";import{M as B}from"./message-square-DK6t4m6u.js";import{C as R}from"./check-square-B62HY2Cl.js";import{S as z}from"./square-Yty-hvSV.js";import"./defineProperty-C-ST8_Gu.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";const T=({card:s,index:m})=>{const r=s.customizacao||{},o=r.cor&&r.cor!=="#3b82f6",l=o?(c=>{if(!c)return"#000000";const a=c.replace("#",""),n=parseInt(a.substr(0,2),16),t=parseInt(a.substr(2,2),16),d=parseInt(a.substr(4,2),16);return(.299*n+.587*t+.114*d)/255>.5?"#000000":"#ffffff"})(r.cor):null,x=Array.isArray(r.tags)?r.tags:[],h=Array.isArray(r.comentarios)?r.comentarios:[],b=()=>{if(s.conteudo?.type==="checklist"&&Array.isArray(s.conteudo.items)){const c=s.conteudo.items.filter(n=>n.completed).length,a=s.conteudo.items.length;return e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",style:{color:o?l:void 0},children:s.conteudo.title||"Checklist"}),e.jsx("div",{className:"space-y-1",children:s.conteudo.items.slice(0,3).map((n,t)=>e.jsxs("div",{className:"flex items-center text-xs",style:{color:o?l:void 0},children:[n.completed?e.jsx(R,{className:"w-3 h-3 mr-2 text-green-500",style:{color:o?l:void 0}}):e.jsx(z,{className:"w-3 h-3 mr-2",style:{color:o?l:void 0}}),e.jsx("span",{className:n.completed?"line-through":"",children:n.text})]},t))}),a>3&&e.jsxs("p",{className:"text-xs mt-1",style:{color:o?l:void 0},children:["...e mais ",a-3]}),a>0&&e.jsxs("div",{className:"text-xs text-right mt-2",style:{color:o?l:void 0},children:[c,"/",a]})]})}return e.jsx("h4",{className:"font-medium text-sm break-words",style:{color:o?l:void 0},children:s.conteudo?.text||""})};return e.jsx(C,{draggableId:s.id.toString(),index:m,isDragDisabled:!0,children:c=>e.jsxs("div",{ref:c.innerRef,...c.draggableProps,...c.dragHandleProps,style:{...c.draggableProps.style,...o?{backgroundColor:r.cor,borderColor:r.cor,color:l}:{}},className:I("bg-white/90 dark:bg-background/80 p-3 rounded-lg shadow-sm border cursor-default",o&&"border-2"),children:[x.length>0&&e.jsx("div",{className:"mb-2",children:e.jsxs("div",{className:"flex flex-wrap gap-1",children:[x.slice(0,4).map((a,n)=>e.jsx(v,{variant:"secondary",className:"text-xs px-2 py-1 rounded-full",style:{backgroundColor:a.color||"#6b7280",color:a.color&&(a.color==="#f59e0b"||a.color==="#84cc16")?"#000":"#fff",border:"none"},children:a.text||a},a.id||n)),x.length>4&&e.jsxs(v,{variant:"secondary",className:"text-xs px-2 py-1 rounded-sm",children:["+",x.length-4]})]})}),(r.dataVencimento||h.length>0)&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[r.dataVencimento&&e.jsxs("div",{className:"flex items-center text-xs",style:{color:o?l:void 0},children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),new Date(r.dataVencimento).toLocaleDateString()]}),h.length>0&&e.jsxs("div",{className:"flex items-center text-xs",style:{color:o?l:void 0},children:[e.jsx(B,{className:"w-3 h-3 mr-1"}),h.length]})]}),b(),r.observacoes&&e.jsx("div",{className:"mt-2 pt-2 border-t",style:{borderColor:o?`${l}20`:void 0},children:e.jsx("p",{className:"text-xs line-clamp-2",style:{color:o?l:void 0},children:r.observacoes})})]})})},L=({column:s,index:m})=>e.jsx(C,{draggableId:String(s.id),index:m,isDragDisabled:!0,children:r=>e.jsx("div",{...r.draggableProps,ref:r.innerRef,className:"w-72 flex-shrink-0",children:e.jsxs("div",{className:"relative rounded-lg flex flex-col max-h-full",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 dark:bg-black/50 backdrop-blur-md rounded-lg -z-10"}),e.jsx("div",{...r.dragHandleProps,className:"p-2 flex items-center justify-between text-white dark:text-gray-200",children:e.jsx("h3",{className:"font-semibold px-2 py-1",children:s.titulo_coluna})}),e.jsx(w,{droppableId:String(s.id),type:"CARD",isDropDisabled:!0,children:o=>e.jsxs("div",{ref:o.innerRef,...o.droppableProps,className:"px-2 py-1 overflow-y-auto flex-grow min-h-[50px] flex flex-col gap-2 scrollbar-hide",children:[s.cards&&s.cards.length>0&&s.cards.map((u,l)=>u?e.jsx(T,{card:u,index:l},u.id):null),o.placeholder]})})]})})}),F=()=>{const{shareId:s}=q(),{toast:m}=D(),[r,o]=i.useState(null),[u,l]=i.useState([]),[x,h]=i.useState(!0),[b,c]=i.useState({}),a=i.useCallback(async()=>{if(s){h(!0);try{console.log("🔍 Buscando quadro público com shareId:",s);const{data:t,error:d}=await N.from("quadros").select("*").eq("share_id",s).eq("is_public",!0).single();if(d)throw console.error("❌ Erro ao buscar quadro:",d),d.code==="PGRST116"?new Error("Quadro não encontrado ou não está público"):d;console.log("✅ Quadro encontrado:",t),o(t),t.imagem_fundo&&c({backgroundImage:`url(${t.imagem_fundo})`,backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}),console.log("🔍 Buscando colunas para quadro ID:",t.id);const{data:f,error:p}=await N.from("quadro_colunas").select("*, quadro_cards(*)").eq("quadro_id",t.id).order("ordem",{ascending:!0});if(p)throw console.error("❌ Erro ao buscar colunas:",p),p;console.log("✅ Colunas encontradas:",f);const j=f.map(y=>({...y,cards:(y.quadro_cards||[]).filter(g=>g.arquivado!==!0).sort((g,k)=>(g.ordem||0)-(k.ordem||0))}));console.log("✅ Colunas processadas:",j),l(j)}catch(t){console.error("Erro ao carregar quadro público:",t),m({title:"Erro ao carregar quadro",description:t.message||"Quadro não encontrado ou não está disponível publicamente",variant:"destructive"})}finally{h(!1)}}},[s,m]);if(i.useEffect(()=>{a()},[a]),i.useEffect(()=>{const t=document.body.style.cssText;return b.backgroundImage&&Object.assign(document.body.style,b),()=>{document.body.style.cssText=t}},[b]),x)return e.jsx("div",{className:"flex items-center justify-center h-screen bg-background",children:e.jsxs("div",{className:"text-center",children:[e.jsx(P,{className:"w-12 h-12 animate-spin text-primary mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Carregando quadro..."}),e.jsx("p",{className:"text-muted-foreground",children:"Aguarde enquanto buscamos o quadro compartilhado"})]})});if(!r)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-center p-4 bg-background",children:[e.jsx(S,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-destructive mb-2",children:"Quadro não encontrado"}),e.jsx("p",{className:"text-muted-foreground",children:"O quadro que você está procurando não existe ou não está disponível publicamente."})]});const n=()=>{};return e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx("header",{className:"bg-black/20 backdrop-blur-md border-b border-white/10 p-4 flex-shrink-0",children:e.jsxs("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"w-6 h-6 text-white"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-white",children:r.nome_quadro}),e.jsx("p",{className:"text-sm text-white/70",children:"Visualização pública"})]})]}),e.jsx("div",{className:"text-sm text-white/60",children:"Somente leitura"})]})}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx("div",{className:"h-full overflow-x-auto overflow-y-hidden scrollbar-hide",children:e.jsx(A,{onDragEnd:n,children:e.jsx(w,{droppableId:"board",type:"COLUMN",direction:"horizontal",isDropDisabled:!0,children:t=>e.jsxs("div",{...t.droppableProps,ref:t.innerRef,className:"flex items-start space-x-4 p-4 h-full min-w-max",children:[u.map((d,f)=>e.jsx(L,{column:d,index:f},d.id)),t.placeholder]})})})})})]})};export{F as default};
