import{c as Pe,b as se,j as e,m as J,a6 as _,B as P,K as oe,N as re,ax as Ie,O as ne,P as Z,ay as Be,ad as Fe,C as Ne,az as ze,D as Ce,aA as Ge,ae as qe,U as le,R as T,aB as De,a5 as ie,T as _e,ab as X,J as Y,q as ce,t as de,v as Se,aC as me,x as ue,S as Ae,aD as ke,Q as We,V as He,W as Ve,X as Ue,Y as Ye,a2 as Qe,a9 as Je,a3 as Ee,e as Re,aE as U,p as Ke,aF as Xe,aG as Me,r as G,aH as ee,aI as he,aJ as xe,aK as pe,aL as fe,aM as ge,ag as Ze}from"./index-Dk_dtFm9.js";import{r as be}from"./index-DgjCAMD6.js";import{T as et,a as tt,b as at,c as st}from"./tooltip-DK_7MF2y.js";import{E as ot}from"./eye-off-yuamGpO7.js";import{E as rt}from"./eye-C-tMnAei.js";import{S as Te}from"./settings-CovqHU0J.js";import{u as Le}from"./useCardHoverEffect-BgGxRh-2.js";import{B as nt,S as A}from"./skeleton-BRh396sn.js";import{R as lt}from"./receipt-D2pHbcLL.js";import{L as it}from"./landmark-B2z80wL7.js";import{S as ct}from"./shield-check-BaQyuiDe.js";import{T as dt}from"./trending-down-v-sS57gE.js";import{T as ut}from"./trending-up-BXGxRQFI.js";import{T as mt}from"./target-C-50JywQ.js";import{P as ht,B as xt,a as pt}from"./PieChart-NwO_tvEG.js";import{A as ft,b as gt,c as bt,d as vt,e as jt,f as yt,g as wt,h as Nt}from"./alert-dialog-_NVGaXDP.js";import{L as Ct}from"./list-BZy1xZm9.js";import{M as Dt}from"./more-vertical-d9r-Xozj.js";import{P as _t}from"./pen-square-B48RsFad.js";import{p as Q}from"./pt-BR-CST98L_P.js";import{C as St}from"./cake-w_4n4R3Z.js";import{P as At}from"./progress-D4vYVtiV.js";import{B as kt}from"./badge-8Iub5rTL.js";import{i as ve}from"./isSameMonth-_6A1dN4x.js";import{s as $e}from"./subMonths-BcqYvc6z.js";import{G as Et}from"./grip-vertical-BK_A7S0M.js";import"./index-Chjiymov.js";import"./index-BoKBKUDC.js";import"./extends-CF3RwP-h.js";const Rt=Pe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Mt=({greeting:a,isPersonalizing:r,isSaving:u,onPersonalizeToggle:m,onSave:h,onCancel:n,onAddCard:l,initialCardConfigMemo:o,visibleCards:x,onResetLayout:p,onToggleBalances:s,showBalances:g,showGreetings:y})=>{const w=Object.keys(o).filter(E=>!x.includes(E)),{isMobile:D}=se();return e.jsxs("div",{className:"dashboard-header-container flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4",children:[e.jsxs(J.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"dashboard-greeting-container mb-4 sm:mb-0",children:[e.jsx("h1",{className:_("text-2xl md:text-3xl font-bold text-foreground",y&&"titulo-gradiente-animado"),children:a}),e.jsx("p",{className:"text-muted-foreground dashboard-subtitle",children:"Aqui está um resumo do seu negócio hoje."})]}),e.jsxs("div",{className:"dashboard-controls-container flex items-center space-x-2",children:[!D&&e.jsx(et,{children:e.jsxs(tt,{children:[e.jsx(at,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",onClick:s,children:g?e.jsx(ot,{className:"h-5 w-5"}):e.jsx(rt,{className:"h-5 w-5"})})}),e.jsx(st,{children:e.jsx("p",{children:g?"Ocultar saldos":"Mostrar saldos"})})]})}),r?e.jsxs(J.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},className:"flex items-center space-x-2",children:[e.jsxs(oe,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(P,{variant:"outline",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"})," Adicionar Card"]})}),e.jsx(ne,{children:w.length>0?w.map(E=>e.jsx(Z,{onClick:()=>l(E),children:o[E].title},E)):e.jsx(Z,{disabled:!0,children:"Todos os cards visíveis"})})]}),e.jsxs(P,{variant:"outline",onClick:p,children:[e.jsx(Rt,{className:"w-4 h-4 mr-2"})," Redefinir"]}),e.jsxs(P,{variant:"outline",onClick:n,children:[e.jsx(Be,{className:"w-4 h-4 mr-2"})," Cancelar"]}),e.jsxs(P,{onClick:h,disabled:u,className:"bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," ",u?"Salvando...":"Concluir"]})]}):!D&&e.jsxs(P,{variant:"outline",onClick:m,className:"dashboard-personalize-button",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"})," Personalizar"]})]})]})},Tt={DollarSign:Ce,TrendingUp:ut,TrendingDown:dt,ShieldCheck:ct,Landmark:it,Wallet:ze,Receipt:lt,BarChart:nt,Calendar:Ne},Lt=({title:a,value:r,icon:u,color:m,onClick:h,isPersonalizing:n,layout:l,iconUrl:o})=>{const x=Le(),p=Tt[u]||Ce;se();const g=(()=>{if(!l)return{title:"text-[11px]",value:"text-xl",icon:"w-3.5 h-3.5"};const{h:w,w:D}=l;return w<=1||D<=2?{title:"text-[10px] leading-tight",value:"text-base",icon:"w-3 h-3"}:D<=3?{title:"text-[11px] leading-tight",value:"text-xl",icon:"w-3.5 h-3.5"}:{title:"text-xs",value:"text-2xl",icon:"w-4 h-4"}})(),y={initial:{opacity:0,y:20},animate:{opacity:1,y:0}};return e.jsxs(J.div,{ref:x,variants:y,initial:"initial",animate:"animate",transition:{duration:.3},className:_("bg-card rounded-xl shadow-sm border border-border/50 p-3 flex flex-col justify-between h-full card-hover-effect",!n&&"cursor-pointer"),onClick:n?void 0:h,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:_("font-medium text-muted-foreground truncate",g.title),title:a,children:a}),o?e.jsx("img",{src:o,alt:a,className:_(g.icon,"object-contain")}):e.jsx(p,{className:_(g.icon,m)})]}),e.jsx("div",{children:e.jsx("p",{className:_("font-bold text-foreground truncate",g.value),title:typeof r=="string"&&r.startsWith("R$")?r:"",children:r})})]})},$t={Users:le,FileText:qe,Briefcase:Ge,Target:mt,Calendar:Ne},Ot=({title:a,value:r,icon:u,iconColor:m,onClick:h,isPersonalizing:n,layout:l})=>{const o=Le(),x=$t[u]||le;se();const s=(()=>{if(!l)return{value:"text-lg",title:"text-xs",iconContainer:"w-7 h-7 mb-1",icon:"w-4 h-4"};const{h:g,w:y}=l;return g<=1||y<=2?{value:"text-base",title:"text-[10px] leading-tight",iconContainer:"w-6 h-6 mb-0.5",icon:"w-3.5 h-3.5"}:{value:"text-lg",title:"text-xs",iconContainer:"w-7 h-7 mb-1",icon:"w-4 h-4"}})();return e.jsxs(J.div,{ref:o,layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-card rounded-xl p-3 shadow-sm border border-border/50 text-center card-hover-effect relative h-full flex flex-col justify-center items-center",onClick:n?void 0:h,style:{cursor:n?"grab":"pointer"},children:[e.jsx("div",{className:_("rounded-lg flex items-center justify-center mx-auto",s.iconContainer),children:e.jsx(x,{className:_(s.icon,m)})}),e.jsx("p",{className:_("font-bold text-foreground",s.value),children:r}),e.jsx("p",{className:_("text-muted-foreground mt-0.5",s.title),children:a})]})},Pt={BarChart2:De,PieChart:ht,List:Ct},It=({title:a,icon:r,color:u,chartData:m,chartType:h,onClick:n,isPersonalizing:l,deleteTransaction:o,setActiveTab:x,isDemo:p=!1,layout:s})=>{const g=Pt[r]||De,[y,w]=T.useState(!1),[D,E]=T.useState(null),k=b=>{E(b),w(!0)},I=()=>{D&&o&&o(D),w(!1),E(null)},M=()=>{w(!1),E(null)},q=b=>{if(!b)return"N/A";try{const R=X(b);return isNaN(R.getTime())?"Data inválida":Y(R,"dd/MM/yy",{locale:Q})}catch{return"Data inválida"}},$=(()=>{if(!s)return{title:"text-sm",icon:"w-4 h-4",listText:"text-xs",listValue:"text-xs"};const{h:b,w:R}=s;return R<=2?{title:"text-[11px]",icon:"w-3.5 h-3.5",listText:"text-[10px]",listValue:"text-[11px]"}:b<=3||R<=4?{title:"text-xs",icon:"w-3.5 h-3.5",listText:"text-[11px]",listValue:"text-xs"}:{title:"text-sm",icon:"w-4 h-4",listText:"text-xs",listValue:"text-sm"}})(),O=()=>m?h==="bar"?e.jsx(xt,{chartData:m,isCompact:s?.h<=3||s?.w<=4}):h==="pie"?e.jsx(pt,{chartData:m,isCompact:s?.h<=3||s?.w<=2}):h==="list"?m.items?m.items.length===0?e.jsx("p",{className:"text-center text-muted-foreground text-xs py-4",children:"Nenhum lançamento recente."}):e.jsx(ie,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-2",children:m.items.map((b,R)=>{const B=()=>{!p&&x&&x("financial",{modal:"editTransaction",transactionId:b.id})};return e.jsxs("div",{onClick:B,className:"flex items-center justify-between p-1.5 rounded-md transition-all duration-200 ease-in-out "+(b.tipo==="ENTRADA"?"bg-green-500/10 hover:bg-green-500/20":"bg-red-500/10 hover:bg-red-500/20"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:_("font-medium text-foreground truncate",$.listText),title:b.descricao,children:b.descricao}),e.jsxs("p",{className:_("text-muted-foreground",$.listText),children:[q(b.date)," - ",b.status]})]}),e.jsxs("div",{className:"flex items-center ml-1",onClick:F=>F.stopPropagation(),children:[e.jsxs("p",{className:_("font-semibold mr-1",$.listValue,b.tipo==="ENTRADA"?"text-customGreen":"text-red-500"),children:[b.tipo==="SAIDA"?"- R$":"+ R$",Number(b.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),!p&&o&&x&&e.jsxs(oe,{children:[e.jsx(re,{asChild:!0,children:e.jsxs(P,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 data-[state=open]:bg-muted",children:[e.jsx(Dt,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Abrir menu"})]})}),e.jsxs(ne,{align:"end",children:[e.jsxs(Z,{onClick:()=>x("financial",{modal:"editTransaction",transactionId:b.id}),children:[e.jsx(_t,{className:"mr-2 h-3 w-3 text-muted-foreground/70"}),e.jsx("span",{className:"text-xs",children:"Editar"})]}),e.jsxs(Z,{onClick:()=>k(b.id),className:"text-red-600 dark:text-red-400 hover:!text-red-600 dark:hover:!text-red-400",children:[e.jsx(_e,{className:"mr-2 h-3 w-3 text-muted-foreground/70"}),e.jsx("span",{className:"text-xs",children:"Excluir"})]})]})]})]})]},b.id||R)})})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Carregando..."}):e.jsx("p",{className:"text-center text-muted-foreground text-xs py-4",children:"Tipo de gráfico desconhecido."}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Carregando..."});return e.jsxs(e.Fragment,{children:[e.jsxs(J.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`bg-card rounded-xl shadow-sm border border-border/50 overflow-hidden flex flex-col h-full p-3 ${l?"cursor-grab active:cursor-grabbing":""}`,children:[e.jsx("div",{className:"flex items-center justify-between pb-2 mb-2 border-b border-border/50",onClick:!l&&n?n:void 0,style:{cursor:!l&&n?"pointer":"default"},children:e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx(g,{className:_("mr-2 shrink-0",$.icon,u||"text-primary")}),e.jsx("h3",{className:_("font-semibold text-foreground truncate",$.title),children:a})]})}),e.jsxs("div",{className:"flex-grow relative cursor-pointer hover:bg-accent/30",children:[p&&h!=="list"&&e.jsx("div",{className:"absolute top-0 left-0 w-full text-center z-10",children:e.jsx("p",{className:"text-xs text-muted-foreground bg-card/50 backdrop-blur-sm px-2 py-0.5 rounded-full inline-block",children:"Gráfico demonstrativo"})}),O()]})]}),e.jsx(ft,{open:y,onOpenChange:w,children:e.jsxs(gt,{children:[e.jsxs(bt,{children:[e.jsx(vt,{children:"Confirmar Exclusão"}),e.jsx(jt,{children:"Tem certeza que deseja excluir este lançamento? Esta ação não pode ser desfeita."})]}),e.jsxs(yt,{children:[e.jsx(wt,{onClick:M,children:"Cancelar"}),e.jsx(Nt,{onClick:I,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})},Bt=({icon:a,title:r,description:u,date:m,color:h,reminder:n,onFollowUp:l,layout:o})=>{const p=!o||o.h>=4?{icon:"w-3.5 h-3.5",title:"text-xs",desc:"text-[11px]"}:{icon:"w-3 h-3",title:"text-[11px]",desc:"text-[10px]"};return e.jsxs(J.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-start space-x-2 p-1.5 mb-1 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:_("p-1.5 rounded-full text-primary-foreground",h,o?.h<4&&"p-1"),children:a&&e.jsx(a,{className:p.icon})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:_("font-semibold text-foreground truncate",p.title),children:r}),e.jsx("p",{className:_("text-muted-foreground mt-0.5 truncate",p.desc),children:u}),m&&e.jsxs("p",{className:_("text-muted-foreground italic",p.desc),children:["Data:"," ",Y(X(m),"dd/MM",{locale:Q})]})]}),l&&e.jsx("button",{onClick:()=>l(n),className:"p-1",title:"Follow-up",children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/16566/16566143.png",alt:"WhatsApp",className:"w-4 h-4"})})]})},Ft=({reminders:a,isLoading:r,isDemo:u=!1,layout:m,onFollowUp:h})=>{const n=s=>{if(s.icon)return{icon:s.icon,title:s.title,description:s.description,date:s.date,color:s.color||"bg-primary"};switch(s.type){case"BIRTHDAY":return{icon:ke,title:`Aniversário de ${s.clientName}`,description:"Envie uma mensagem ou cupom.",date:s.date,color:"bg-pink-500"};case"WEDDING_ANNIVERSARY":return{icon:Ae,title:`Aniv. Casamento: ${s.clientName}`,description:"Ofereça um ensaio de casal.",date:s.date,color:"bg-red-500"};case"CHILD_BIRTHDAY":return{icon:St,title:`Aniv. de ${s.childName||"Filho(a)"}`,description:"Sugira um ensaio em família.",date:s.date,color:"bg-blue-500"};default:return{icon:me,title:"Lembrete",description:s.clientName,date:s.date,color:"bg-primary"}}},l=[{type:"BIRTHDAY",clientName:"Ana Silva",date:new Date(new Date().setDate(new Date().getDate()+5)).toISOString()},{type:"WEDDING_ANNIVERSARY",clientName:"Carlos e Bia",date:new Date(new Date().setDate(new Date().getDate()+12)).toISOString()}],o=u?l:a,p=!m||m.h>=4?{title:"text-sm",icon:"w-4 h-4"}:{title:"text-xs",icon:"w-3.5 h-3.5"};return e.jsxs(ce,{className:"h-full flex flex-col shadow-sm border-border bg-card/80 backdrop-blur-sm p-3",children:[e.jsx(de,{className:"flex flex-row items-center justify-between space-y-0 pb-2 px-0 pt-0 border-b border-border/50 mb-2",children:e.jsxs(Se,{className:_("font-semibold text-foreground flex items-center",p.title),children:[e.jsx(me,{className:_("mr-2",p.icon,"text-button-primary-foreground")}),"Lembretes e Oportunidades"]})}),e.jsx(ue,{className:"px-0 pb-0 flex-grow overflow-hidden",children:r?e.jsx("div",{className:"space-y-3 pt-2",children:[...Array(3)].map((s,g)=>e.jsxs("div",{className:"flex items-start space-x-3 p-1 rounded-lg",children:[e.jsx(A,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(A,{className:"h-4 w-3/4"}),e.jsx(A,{className:"h-3 w-full"})]})]},g))}):o&&o.length>0?e.jsx(ie,{className:"h-full pr-2",children:e.jsx("div",{className:"pt-1",children:o.map((s,g)=>{const y=n(s);return e.jsx(Bt,{...y,reminder:s,onFollowUp:h,layout:m},g)})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground p-2",children:[e.jsx(le,{className:"w-6 h-6 mb-2"}),e.jsx("p",{className:"text-xs font-medium",children:"Nenhum lembrete!"}),e.jsx("p",{className:"text-[10px]",children:"Cadastre as datas dos clientes."})]})})]})},zt=({goals:a,onClick:r,isDemo:u=!1,isLoading:m=!1})=>e.jsxs(ce,{className:"bg-card/80 backdrop-blur-sm border border-border rounded-xl shadow-sm h-full flex flex-col",onClick:r,style:{cursor:r?"pointer":"default"},children:[e.jsx(de,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(Se,{className:"text-sm font-medium",children:"Resumo das Metas"})}),e.jsx(ue,{className:"flex-1 space-y-4",children:m?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Carregando metas..."}):!a||a.length===0?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Nenhuma meta cadastrada."}):a.map(h=>{const n=h.saldo_atual/h.valor_meta*100,l=Math.min(Math.max(n,0),100),o=h.saldo_atual>=h.valor_meta?"bg-customGreen":"bg-primary";return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs font-medium",children:h.nome||h.name}),e.jsxs(kt,{variant:"outline",className:"text-xs border-border",children:[l.toFixed(1),"%"]})]}),e.jsx(At,{value:l,indicatorClassName:o})]},h.id||h.name)})})]}),je=()=>e.jsx("div",{className:"bg-card rounded-xl p-4 sm:p-6 shadow-lg border border-border h-full flex flex-col justify-center",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{className:"h-4 w-24 mb-2"}),e.jsx(A,{className:"h-8 w-32"})]}),e.jsx(A,{className:"w-12 h-12 rounded-lg"})]})}),Gt=()=>e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-lg border border-border text-center h-full flex flex-col justify-center items-center",children:[e.jsx(A,{className:"w-10 h-10 rounded-lg mx-auto mb-2"}),e.jsx(A,{className:"h-7 w-16 mx-auto mb-1"}),e.jsx(A,{className:"h-4 w-20 mx-auto"})]}),ye=({isList:a=!1})=>e.jsxs("div",{className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-3"}),e.jsx(A,{className:"h-5 w-32"})]})}),e.jsx("div",{className:"p-2 sm:p-4 flex-grow",children:a?e.jsx("div",{className:"space-y-3 px-2 py-2",children:[...Array(4)].map((r,u)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(A,{className:"h-4 w-4/5 mb-2"}),e.jsx(A,{className:"h-3 w-1/3"})]}),e.jsx("div",{className:"flex items-center ml-2",children:e.jsx(A,{className:"h-5 w-20"})})]},u))}):e.jsx(A,{className:"h-full w-full"})})]}),qt=()=>e.jsxs(ce,{className:"h-full flex flex-col shadow-lg border-border bg-card/80 backdrop-blur-sm",children:[e.jsx(de,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pt-4 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),e.jsx(A,{className:"h-5 w-48"})]})}),e.jsx(ue,{className:"px-2 pb-4 flex-grow overflow-hidden",children:e.jsx("div",{className:"space-y-3 p-2",children:[...Array(3)].map((a,r)=>e.jsxs("div",{className:"flex items-start space-x-3 p-1 rounded-lg",children:[e.jsx(A,{className:"w-9 h-9 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(A,{className:"h-4 w-3/4"}),e.jsx(A,{className:"h-3 w-full"})]})]},r))})})]});function Wt(a,r,u,m,h){const n=new Date,l=a.filter(t=>t.status==="PAGO"),o=l.filter(t=>ve(X(t.data_recebimento||t.data||t.created_at),n)),x=l.filter(t=>t.tipo==="ENTRADA").reduce((t,d)=>t+(Number(d.valor)||0),0),p=l.filter(t=>t.tipo==="SAIDA").reduce((t,d)=>t+(Number(d.valor)||0),0),s=o.filter(t=>t.tipo==="ENTRADA").reduce((t,d)=>t+(Number(d.valor)||0),0),g=o.filter(t=>t.tipo==="SAIDA"&&t.category!=="Pró-labore").reduce((t,d)=>t+(Number(d.valor)||0),0),y=o.filter(t=>t.tipo==="SAIDA"&&t.category==="Pró-labore").reduce((t,d)=>t+(Number(d.valor)||0),0),w=s-g,D=r.filter(t=>t.status!=="concluido"&&t.status!=="arquivado").reduce((t,d)=>t+(d.pending_amount||0),0)+a.filter(t=>t.tipo==="ENTRADA"&&t.status==="PENDENTE").reduce((t,d)=>t+(Number(d.valor)||0),0),E=a.filter(t=>t.tipo==="SAIDA"&&t.status==="PENDENTE"&&new Date(t.data_vencimento)>n).reduce((t,d)=>t+(Number(d.valor)||0),0),k=a.filter(t=>t.status==="AGUARDANDO_LIBERACAO"&&new Date(t.release_date)>n).reduce((t,d)=>t+(Number(d.valor)||0),0);let I=0;if(m?.regime_tributario==="mei")I=Number(m.valor_fixo_mei)||0;else if(m?.regime_tributario==="simples"&&m.aliquotas_simples_nacional){const t=m.aliquotas_simples_nacional.find(d=>s<=d.faixa_faturamento)?.aliquota||0;I=s*t/100}const M=x-p,q=r.filter(t=>t.status==="em-andamento").length,L=r.filter(t=>t.date&&ve(X(t.date),n)).length,$=["arquivado","excluido","cancelado","perdido"],O=["em-andamento","concluido","negocio-fechado"],b=(r||[]).filter(t=>!$.includes((t.status||"").toLowerCase())),R=b.filter(t=>O.includes((t.status||"").toLowerCase())),B=b.length,F=R.length,K=B>0?F/B*100:0,H=(h||[]).reduce((t,d)=>t+(Number(d.depreciacao_mensal)||0),0),N={},i={};for(let t=5;t>=0;t--){const d=$e(n,t),f=`${d.getMonth()+1}/${d.getFullYear()}`;N[f]=0,i[f]=0}l.forEach(t=>{const d=X(t.data_recebimento||t.data||t.created_at),f=`${d.getMonth()+1}/${d.getFullYear()}`;Object.prototype.hasOwnProperty.call(N,f)&&(t.tipo==="ENTRADA"?N[f]+=Number(t.valor)||0:t.tipo==="SAIDA"&&(i[f]+=Number(t.valor)||0))});let v=0;if(Array.isArray(u)&&Array.isArray(a)){const t=new Date,d=new Set;a.forEach(f=>{if(f.tipo==="ENTRADA"&&f.status==="PENDENTE"){const j=f.data_vencimento||f.data,S=j?new Date(j):null;(!S||S<t)&&d.add(f.cliente_id||f.clienteId)}}),v=Array.from(d).filter(f=>f!=null).length}const c=Array.isArray(u)?u.length:0;return{revenueThisMonth:s,expensesThisMonth:g,profitThisMonth:w,pendingToReceive:D,futurePendingPayments:E,estimatedTax:I,proLaboreThisMonth:y,netBalance:M,workInProgress:q,scheduledThisMonth:L,conversionRate:K,monthlyDepreciation:H,awaitingRelease:k,monthlyRevenue:N,monthlyExpenses:i,clientsInadimplentes:v,totalClients:c,validLeadsCount:B,convertedLeadsCount:F}}const W=(a,r,u,m,h,n=[])=>{switch(a){case"grafico_faturamento":{if(!r||!r.monthlyRevenue)return{labels:[],datasets:[]};const l=r.monthlyRevenue,o=Object.keys(l).sort((x,p)=>{const[s,g]=x.split("/"),[y,w]=p.split("/");return new Date(g,s-1)-new Date(w,y-1)});return{labels:o.map(x=>{const[p,s]=x.split("/"),g=new Date(s,p-1);return Y(g,"MMM/yy",{locale:Q})}),datasets:[{label:"Faturamento",data:o.map(x=>l[x]),backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1,tension:.4}]}}case"grafico_despesas_faturamento":{if(!r||!r.monthlyRevenue||!r.monthlyExpenses)return{labels:[],datasets:[]};const l=r.monthlyRevenue,o=r.monthlyExpenses,x=Object.keys(l).sort((p,s)=>{const[g,y]=p.split("/"),[w,D]=s.split("/");return new Date(y,g-1)-new Date(D,w-1)});return{labels:x.map(p=>{const[s,g]=p.split("/"),y=new Date(g,s-1);return Y(y,"MMM/yy",{locale:Q})}),datasets:[{label:"Faturamento",data:x.map(p=>l[p]),backgroundColor:"rgba(34, 197, 94, 0.6)",borderColor:"rgba(34, 197, 94, 1)",borderWidth:1},{label:"Despesas",data:x.map(p=>o[p]),backgroundColor:"rgba(239, 68, 68, 0.6)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:1}]}}case"grafico_despesas_lucro":{if(!r||!r.monthlyRevenue||!r.monthlyExpenses)return{labels:[],datasets:[]};const l=r.monthlyRevenue,o=r.monthlyExpenses,x=Object.keys(l).sort((p,s)=>{const[g,y]=p.split("/"),[w,D]=s.split("/");return new Date(y,g-1)-new Date(D,w-1)});return{labels:x.map(p=>{const[s,g]=p.split("/"),y=new Date(g,s-1);return Y(y,"MMM/yy",{locale:Q})}),datasets:[{label:"Lucro",data:x.map(p=>l[p]-o[p]),backgroundColor:"rgba(52, 211, 153, 0.6)",borderColor:"rgba(52, 211, 153, 1)",borderWidth:1},{label:"Despesas",data:x.map(p=>o[p]),backgroundColor:"rgba(234, 179, 8, 0.6)",borderColor:"rgba(234, 179, 8, 1)",borderWidth:1}]}}case"grafico_conversao_leads":{let l=r?.validLeadsCount,o=r?.convertedLeadsCount;if(typeof l!="number"||typeof o!="number"){if(!Array.isArray(u))return{labels:[],datasets:[]};const p=["arquivado","excluido","cancelado","perdido"],s=["em-andamento","concluido","negocio-fechado"],g=(u||[]).filter(w=>!p.includes((w.status||"").toLowerCase())),y=g.filter(w=>s.includes((w.status||"").toLowerCase()));l=g.length,o=y.length}const x=l-o;return l===0?{labels:["Sem dados"],datasets:[{data:[1],backgroundColor:["#E5E7EB"]}]}:{labels:["Convertidos","Não convertidos"],datasets:[{label:"Conversão de Leads",data:[o,x],backgroundColor:["rgba(59, 130, 246, 0.6)","rgba(156, 163, 175, 0.6)"],borderColor:["rgba(59, 130, 246, 1)","rgba(156, 163, 175, 1)"],borderWidth:1}]}}case"grafico_inadimplentes":{if(!r||typeof r.clientsInadimplentes!="number"||typeof r.totalClients!="number")return{labels:[],datasets:[]};const l=r.clientsInadimplentes,o=r.totalClients;if(o===0)return{labels:["Sem clientes"],datasets:[{data:[1],backgroundColor:["#E5E7EB"]}]};const x=Math.max(o-l,0);return{labels:["Inadimplentes","Outros"],datasets:[{label:"Clientes",data:[l,x],backgroundColor:["rgba(239, 68, 68, 0.6)","rgba(156, 163, 175, 0.6)"],borderColor:["rgba(239, 68, 68, 1)","rgba(156, 163, 175, 1)"],borderWidth:1}]}}case"status_trabalhos":{const l=(u||[]).reduce((o,x)=>{const p=x.status||"sem-status";return o[p]=(o[p]||0)+1,o},{});return{labels:Object.keys(l),datasets:[{label:"Status dos Trabalhos",data:Object.values(l),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]}}case"ultimos_lancamentos":return{items:(m||[]).slice().sort((o,x)=>{const p=o.created_at?new Date(o.created_at):new Date(o.data_recebimento||o.data||0);return(x.created_at?new Date(x.created_at):new Date(x.data_recebimento||x.data||0))-p}).slice(0,10).map(o=>({...o,date:o.data,wallet:(n||[]).find(x=>x.id===o.wallet_id)}))};default:return{labels:[],datasets:[]}}},Ht={labels:[],datasets:[{data:[]}]},Vt=a=>{if(a==="grafico_faturamento"){const r=[],u=[],m=[],h=new Date;for(let n=5;n>=0;n--){const l=$e(h,n);r.push(Y(l,"MMM/yy",{locale:Q})),u.push(Math.floor(Math.random()*5001)+2e3),m.push(Math.floor(Math.random()*2501)+500)}return{labels:r,datasets:[{label:"Faturamento",data:u,backgroundColor:"rgba(52, 211, 153, 0.7)",borderColor:"rgba(52, 211, 153, 1)",borderWidth:1,borderRadius:4,barPercentage:.6,categoryPercentage:.7},{label:"Saídas",data:m,backgroundColor:"rgba(239, 68, 68, 0.7)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:1,borderRadius:4,barPercentage:.6,categoryPercentage:.7}]}}if(a==="status_trabalhos"){const r=["Novos Leads","Propostas Enviadas","Em Andamento","Concluídos"],u=[5,3,8,12],m=["rgba(59, 130, 246, 0.7)","rgba(234, 179, 8, 0.7)","rgba(139, 92, 246, 0.7)","rgba(16, 185, 129, 0.7)"],h=m.map(n=>n.replace("0.7","1"));return{labels:r,datasets:[{label:"Status dos Trabalhos",data:u,backgroundColor:m,borderColor:h,borderWidth:1}]}}return a==="ultimos_lancamentos"?{items:[{id:"demo1",descricao:"Ensaio Fotográfico - Família Silva",valor:850,tipo:"ENTRADA",status:"PAGO",date:new Date().toISOString()},{id:"demo2",descricao:"Assinatura Adobe Creative Cloud",valor:275,tipo:"SAIDA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-2)).toISOString()},{id:"demo3",descricao:"Casamento - Joana e Pedro (Entrada)",valor:2500,tipo:"ENTRADA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-5)).toISOString()},{id:"demo4",descricao:"Aluguel do Estúdio",valor:600,tipo:"SAIDA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-7)).toISOString()}]}:Ht},Ut=()=>[{id:"demo_goal_1",nome_meta:"Comprar Nova Lente",valor_meta:5e3,saldo_atual:1750,icone:"Camera"},{id:"demo_goal_2",nome_meta:"Fundo de Emergência",valor_meta:1e4,saldo_atual:4500,icone:"Shield"},{id:"demo_goal_3",nome_meta:"Viagem de Férias",valor_meta:8e3,saldo_atual:8e3,icone:"Plane"}],we={payment_overdue:a=>[`Olá ${a.clientName}, estou passando para lembrar que o pagamento referente ao seu serviço ${a.service} no valor de ${a.amount} está atrasado. Por favor, entre em contato para regularizar.`,`Olá ${a.clientName}, seu pagamento de ${a.amount} referente a ${a.service} está vencido. Caso já tenha quitado, desconsidere. Do contrário, preciso que regularize, tudo bem?`],payment_due:a=>[`Olá ${a.clientName}, tudo bem? O pagamento referente ao seu serviço ${a.service} no valor de ${a.amount} vence em ${a.dueInDays} dia(s). Estou à disposição para dúvidas.`,`Oi ${a.clientName}! Lembrando que seu pagamento de ${a.amount} (${a.service}) vence em ${a.dueInDays} dia(s). Qualquer coisa estou por aqui.`],expense_overdue:a=>[`Conta ${a.service} (R$ ${a.amount}) venceu em ${a.dueDateStr}. Programe-se para regularizar.`],expense_due:a=>[`Alerta: sua conta ${a.service} no valor de R$ ${a.amount} vence em ${a.dueInDays} dia(s).`],birthday:a=>[`Olá ${a.clientName}, feliz aniversário! Desejo muitas felicidades e sucesso. Se precisar de um ensaio fotográfico, estarei à disposição com condições especiais!`,`Feliz aniversário, ${a.clientName}! Que tal aproveitar a data para registrar esse momento com um ensaio exclusivo?`],default:a=>[`Olá ${a.clientName}, tudo bem?`]},Yt=({open:a,onOpenChange:r,reminder:u})=>{const m=T.useMemo(()=>{if(!u)return[];const o=u.reminderType||"default";return(we[o]||we.default)(u)},[u]),[h,n]=T.useState("");T.useEffect(()=>{m&&m.length>0&&n(m[0])},[m]);const l=()=>{if(!h||!u?.clientPhone)return;const x=`https://wa.me/${u.clientPhone.replace(/\D/g,"")}?text=${encodeURIComponent(h)}`;window.open(x,"_blank"),r(!1)};return u?e.jsx(We,{open:a,onOpenChange:r,children:e.jsxs(He,{className:"max-w-md",children:[e.jsxs(Ve,{children:[e.jsxs(Ue,{children:["Enviar mensagem para ",u.clientName]}),e.jsx(Ye,{children:"Selecione uma mensagem de follow‑up para enviar via WhatsApp."})]}),e.jsx(ie,{className:"max-h-40",children:m.map((o,x)=>e.jsx("div",{onClick:()=>n(o),className:`p-2 mb-2 border rounded-md cursor-pointer ${h===o?"bg-accent":""}`,children:o},x))}),e.jsxs(Qe,{className:"space-x-2",children:[e.jsx(Je,{asChild:!0,children:e.jsx(P,{variant:"ghost",children:"Cancelar"})}),e.jsx(P,{onClick:l,disabled:!h,children:"Enviar via WhatsApp"})]})]})}):null},Qt=({cardId:a,layout:r,isEditing:u,setActiveTab:m})=>{const{workflowCards:h,financialData:n,clients:l,settings:o,loading:x,deleteTransaction:p,refreshData:s,equipments:g,savingGoals:y,wallets:w,getWalletBalance:D}=Ee(),{toast:E}=Re(),k=x||!n,M=!(n&&(n.transactions.length>0||h.length>0||l.length>0)),[q,L]=T.useState(!1),[$,O]=T.useState(null),b=T.useMemo(()=>k||!n?null:Wt(n.transactions,h,l,o,g),[k,n,h,l,o,g]),R=T.useMemo(()=>{if(k||!b)return{};const i=[b,h,n.transactions,m];return{grafico_faturamento:W("grafico_faturamento",...i),grafico_despesas_faturamento:W("grafico_despesas_faturamento",...i),grafico_despesas_lucro:W("grafico_despesas_lucro",...i),grafico_conversao_leads:W("grafico_conversao_leads",...i),grafico_inadimplentes:W("grafico_inadimplentes",...i),status_trabalhos:W("status_trabalhos",...i),ultimos_lancamentos:W("ultimos_lancamentos",b,h,n.transactions,m,w)}},[k,b,h,n.transactions,m,w]),B=T.useMemo(()=>{if(k)return[];const i=new Date,v=[];return(n?.transactions||[]).forEach(c=>{if(c.status!=="PENDENTE")return;const t=c.data_vencimento||c.data||c.created_at;if(!t)return;const d=new Date(t),f=Math.floor((d-i)/(1e3*60*60*24)),j=c.tipo==="SAIDA";if(f<0||f<=7){const S=f<0?j?"expense_overdue":"payment_overdue":j?"expense_due":"payment_due",C=(l||[]).find(Oe=>Oe.id===(c.cliente_id||c.clienteId)),z=C?.nome||C?.name||"",V={id:`${S}-${t}-${z}`,icon:f<0?Ke:Xe,color:f<0?"bg-red-500":"bg-yellow-500",title:f<0?j?"Despesa vencida":"Recebimento vencido":j?"Despesa a vencer":"Recebimento a vencer",description:`${z} - ${U(c.valor)}`,date:d.toISOString(),reminderType:S,clientName:z,clientPhone:C?.celular||C?.telefone||C?.whatsapp||C?.phone||"",onFollowUp:()=>{O(V),L(!0)}};v.push(V),(f<0||f===0)&&window.dispatchEvent(new CustomEvent("addNotification",{detail:V}))}}),(l||[]).forEach(c=>{const t=c.birthday||c.data_nascimento;if(!t)return;const d=new Date(t),f=new Date(i.getFullYear(),d.getMonth(),d.getDate());f<i&&f.setFullYear(i.getFullYear()+1);const j=Math.floor((f-i)/(1e3*60*60*24));if(j>=0&&j<=7){const C={id:`birthday-${c.id}-${f.toISOString()}`,icon:ke,color:"bg-pink-500",title:j===0?`Aniversário de ${c.nome||c.name}`:`Aniv. em ${j} dia(s): ${c.nome||c.name}`,description:"Envie uma mensagem ou oferta",date:f.toISOString(),reminderType:"birthday",clientName:c.nome||c.name||"",clientPhone:c.celular||c.telefone||c.whatsapp||c.phone||"",onFollowUp:()=>{O(C),L(!0)}};v.push(C),j===0&&window.dispatchEvent(new CustomEvent("addNotification",{detail:C}))}}),(h||[]).forEach(c=>{if(!c.date)return;const t=new Date(c.date),d=Math.floor((t-i)/(1e3*60*60*24));if(d>=0&&d<=7){const j={id:`task-${c.id||c.title}-${t.toISOString()}`,icon:Ae,color:"bg-cyan-500",title:d===0?`Tarefa hoje: ${c.title||c.titulo}`:`Tarefa em ${d} dia(s): ${c.title||c.titulo}`,description:`Agendado para ${t.toLocaleDateString("pt-BR")}`,date:t.toISOString(),reminderType:"task_due",onFollowUp:()=>{O(j),L(!0)}};v.push(j),d===0&&window.dispatchEvent(new CustomEvent("addNotification",{detail:j}))}}),v.sort((c,t)=>{const d=new Date(c.date||0),f=new Date(t.date||0);return d-f}),v},[k,n?.transactions,l,h]);T.useEffect(()=>{const i=v=>{v.detail&&(O(v.detail),L(!0))};return window.addEventListener("openFollowUp",i),()=>{window.removeEventListener("openFollowUp",i)}},[]);const F=T.useCallback(i=>{if(k||!b)return"...";if(M)return i.includes("conversao")?"0.0%":"R$ 0,00";const v=o?.hide_dashboard_balances===!1,c="••••";if(i.startsWith("wallet_")){const d=i.replace("wallet_",""),f=D(d);return v?U(f):c}const t=d=>v?U(d):c;switch(i){case"saldo_geral":return t(b.netBalance);case"pagamentos_receber":return t(b.pendingToReceive);case"despesas_pagar":return t(b.futurePendingPayments);case"imposto_estimado":return t(b.estimatedTax);case"pro_labore":return t(b.proLaboreThisMonth);case"despesas_mes":return t(b.expensesThisMonth);case"lucro_mes":return t(b.profitThisMonth);case"depreciacao_mensal":return t(b.monthlyDepreciation);case"awaiting_release":return t(b.awaitingRelease);case"clientes_ativos":return l.length;case"trabalhos_em_andamento":return b.workInProgress;case"trabalhos_agendados":return b.scheduledThisMonth;case"conversao_clientes":return`${b.conversionRate.toFixed(1)}%`;default:return""}},[k,b,o?.hide_dashboard_balances,l,M,D]),K=T.useCallback(i=>M?Vt(i):k||!R[i]?{labels:[],datasets:[{data:[]}]}:R[i],[k,R,M]),H=async i=>{try{await p(i),E({title:"Lançamento excluído",description:"O lançamento foi excluído com sucesso."}),await s()}catch(v){E({title:"Erro ao excluir",description:`Não foi possível excluir o lançamento: ${v.message}`,variant:"destructive"})}},N=T.useMemo(()=>{try{return Me(m,w)[a]}catch{return null}},[m,w,a]);if(!N)return null;if(k)switch(N.type){case"stat":return e.jsx(je,{});case"smallStat":return e.jsx(Gt,{});case"chart":return e.jsx(ye,{isList:N.chartType==="list"});case"reminders":return e.jsx(qt,{});case"goals_summary":return e.jsx(ye,{isList:!0});default:return e.jsx(je,{})}switch(N.type){case"stat":{const i=()=>{if(a==="lucro_mes"&&b){const v=b.revenueThisMonth||0,c=b.expensesThisMonth||0,t=b.profitThisMonth||0;E({title:"Lucro do mês",description:`Receitas: ${U(v)}
Despesas: ${U(c)}
Lucro: ${U(t)}`})}N.onClick&&N.onClick()};return e.jsx(Lt,{title:N.title,value:F(a),icon:N.icon,iconUrl:N.iconUrl,color:N.color,onClick:a==="lucro_mes"?i:N.onClick,isPersonalizing:u,layout:r})}case"smallStat":return e.jsx(Ot,{title:N.title,value:F(a),icon:N.icon,iconColor:N.iconColor,onClick:N.onClick,isPersonalizing:u,layout:r});case"chart":return e.jsx(It,{title:N.title,icon:N.icon,color:N.color,chartType:N.chartType,chartData:K(a),onClick:N.onClick,isPersonalizing:u,deleteTransaction:a==="ultimos_lancamentos"?H:void 0,setActiveTab:a==="ultimos_lancamentos"?m:void 0,isDemo:M,layout:r});case"reminders":return e.jsxs(e.Fragment,{children:[e.jsx(Ft,{reminders:M?[]:B,isLoading:k,isDemo:M,layout:r,onFollowUp:i=>{O(i),L(!0)}}),e.jsx(Yt,{open:q,onOpenChange:L,reminder:$})]});case"goals_summary":return e.jsx(zt,{goals:M?Ut():y,isLoading:k,onClick:N.onClick,isDemo:M});default:return null}},Jt=a=>{const r=new Date().getHours(),u=a?`, ${a}`:"",m=[`Bom dia${u}! Hora de brilhar.`,`Um café e um plano, ${a||"bora"}?`,`Que a sua criatividade floresça hoje${u}!`,"Bom dia! Vamos fazer mágica acontecer hoje?"],h=[`Boa tarde${u}! Como vai a produção?`,`Continue com o ótimo trabalho${u}!`,"Boa tarde! Uma pausa para o café e seguimos.",`Hora de criar algo incrível nesta tarde${u}!`],n=[`Boa noite${u}! Finalizando o dia com sucesso?`,`Bom descanso, ${a||"guerreiro(a)"}! Você merece.`,"Boa noite! As melhores ideias surgem sob as estrelas.",`Hora de recarregar as energias para amanhã${u}!`],l=o=>o[Math.floor(Math.random()*o.length)];return r>=5&&r<12?l(m):r>=12&&r<18?l(h):l(n)},Kt=be.WidthProvider(be.Responsive),te=(a,r)=>{if(!a||typeof a!="object")return null;const u={},m=["lg","md","sm","xs","xxs"];for(const h of m)Array.isArray(a[h])&&(u[h]=a[h].map((n,l)=>{if(!n||typeof n.i!="string")return console.error(`Layout item inválido no breakpoint ${h} no índice ${l}: `,n),null;const x=r[n.i]?.defaultSize||{w:4,h:2};return{...n,x:typeof n.x=="number"&&!isNaN(n.x)?n.x:0,y:typeof n.y=="number"&&!isNaN(n.y)?n.y:0,w:typeof n.w=="number"&&!isNaN(n.w)?n.w:x.w,h:typeof n.h=="number"&&!isNaN(n.h)?n.h:x.h}}).filter(Boolean));return u},Sa=({setActiveTab:a})=>{const{settings:r,setSettings:u,loading:m,wallets:h}=Ee(),{toast:n}=Re(),[l,o]=G.useState(!1),[x,p]=G.useState(!1),s=G.useMemo(()=>Me(a,h),[a,h]),[g,y]=G.useState({lg:[],md:[],sm:[],xs:[],xxs:[]}),[w,D]=G.useState({lg:[],md:[],sm:[],xs:[],xxs:[]}),[E,k]=G.useState("lg"),[I,M]=G.useState(!1);G.useEffect(()=>{M(!0);const i=r?.dashboard_layout,v=te(i,s);if(v&&Object.keys(v).length>0&&Object.values(v).some(c=>c.length>0))y(v),D(ee.cloneDeep(v));else{const c=he(s),t={lg:c,md:ge(c,s),sm:fe(c,s),xs:pe(c,s),xxs:xe(c,s)},d=te(t,s);y(d),D(ee.cloneDeep(d))}},[r,s]);const q=async()=>{p(!0);const i=te(g,s);try{await u({dashboard_layout:i},!0),D(ee.cloneDeep(i)),o(!1),n({title:"Layout salvo!",description:"Sua nova organização foi salva."})}catch(v){n({title:"Erro ao salvar",description:`Não foi possível salvar o layout: ${v.message}`,variant:"destructive"})}finally{p(!1)}},L=()=>{l||(D(ee.cloneDeep(g)),n({title:"Modo de edição ativado",description:"Arraste e redimensione os cards."})),o(!l)},$=()=>{y(w),o(!1),n({title:"Edição cancelada",description:"Suas alterações foram descartadas."})},O=(i,v)=>{I&&l&&y(v)},b=i=>{k(i)},R=()=>{const i=he(s),v={lg:i,md:ge(i,s),sm:fe(i,s),xs:pe(i,s),xxs:xe(i,s)},c=te(v,s);y(c),n({title:"Layout redefinido",description:"O layout voltou ao padrão. Clique em 'Concluir' para salvar."})},B=i=>{const v={...g};for(const c in v)v[c]=(v[c]||[]).filter(t=>t.i!==i);y(v)},F=i=>{if(Object.values(g).some(f=>f&&f.some(j=>j.i===i))){n({title:"Card já visível",description:"Este card já está no seu dashboard.",variant:"destructive"});return}const c=s[i];if(!c)return;const t=f=>{let{w:j,h:S}=c.defaultSize||{w:4,h:2};const C=c.type,z=c.chartType;switch(f){case"md":C==="stat"?(j=5,S=2):C==="smallStat"?(j=2,S=2):C==="chart"&&(j=Math.min(10,j*1.5));break;case"sm":C==="stat"||C==="smallStat"?(j=4,S=2):C==="chart"?(S=z==="list"?6:5,j=4):(C==="reminders"||C==="goals_summary")&&(S=6,j=4);break;case"xs":case"xxs":C==="stat"||C==="smallStat"?(j=2,S=2):C==="chart"?(S=z==="list"?f==="xs"?7:8:f==="xs"?5:6,j=2):(C==="reminders"||C==="goals_summary")&&(S=f==="xs"?7:8,j=2);break}return{w:j,h:S}},d={...g};["lg","md","sm","xs","xxs"].forEach(f=>{const j=d[f]?[...d[f]]:[];let S=0;j.forEach(ae=>{const V=(ae.y||0)+(ae.h||1);V>S&&(S=V)});const{w:C,h:z}=t(f);j.push({i,x:0,y:S,w:C,h:z}),d[f]=j}),y(d)},K=async()=>{const i=r?.hide_dashboard_balances===!1;await u({hide_dashboard_balances:!i},!0)};if(m||!I||!g||Object.keys(g).length===0)return e.jsx(Ze,{});const H=g[E]||g.lg||[],N=new Set(H.map(i=>i.i));return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(Mt,{greeting:Jt(r?.user_name),isPersonalizing:l,isSaving:x,onPersonalizeToggle:L,onSave:q,onCancel:$,onAddCard:F,initialCardConfigMemo:s,visibleCards:Array.from(N),onResetLayout:R,onToggleBalances:K,showBalances:r?.hide_dashboard_balances===!1,showGreetings:r?.show_greetings}),e.jsx(Kt,{className:"layout",layouts:g,breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:10,sm:4,xs:2,xxs:2},rowHeight:50,margin:[16,16],containerPadding:[0,0],onLayoutChange:O,onBreakpointChange:b,isDraggable:l,isResizable:l,draggableHandle:".drag-handle",preventCollision:!1,compactType:"vertical",children:H.map(i=>!i||!s[i.i]?null:e.jsxs("div",{className:"relative group dashboard-card",children:[l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"drag-handle absolute top-2 left-2 p-1.5 bg-card/80 rounded-full cursor-grab active:cursor-grabbing z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Et,{size:16})}),e.jsxs(oe,{children:[e.jsx(re,{asChild:!0,children:e.jsx(P,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-7 w-7 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Te,{size:16})})}),e.jsx(ne,{children:e.jsxs(Z,{className:"text-red-500",onClick:()=>B(i.i),children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Remover Card"]})})]})]}),e.jsx("div",{className:"flex-grow h-full w-full",children:e.jsx(Qt,{cardId:i.i,layout:i,isEditing:l,setActiveTab:a})})]},i.i))})]})};export{Sa as default};
