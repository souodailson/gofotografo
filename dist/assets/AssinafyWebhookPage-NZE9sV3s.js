import{f as p,u as m,r as g,j as d,s as l}from"./index-Dk_dtFm9.js";const x=()=>{const r=p(),t=m();return g.useEffect(()=>{const u=async a=>{if(!a||!a.id||!a.status){console.error("Webhook payload inválido recebido da Assinafy.");return}const{id:o,status:s,file_url:n}=a,{data:e,error:f}=await l.from("contratosgerados").select("id").eq("id_assinatura_assinafy",o).single();if(f||!e){console.error(`Contrato com ID Assinafy ${o} não encontrado no sistema.`);return}const c={status_assinatura:s.toLowerCase()};s.toLowerCase()==="assinado"&&n&&(c.link_documento_final_assinafy=n);const{error:i}=await l.from("contratosgerados").update(c).eq("id",e.id);i?console.error(`Erro ao atualizar o status do contrato ${e.id}:`,i.message):console.log(`Contrato ${e.id} atualizado para o status: ${s}.`)};(async()=>{console.log("Página de webhook acessada. A lógica real está na Edge Function. Redirecionando...");const a=new URLSearchParams(r.search).get("payload");if(a)try{const o=JSON.parse(decodeURIComponent(a));await u(o)}catch(o){console.error("Erro ao processar payload de exemplo:",o)}t("/contracts",{replace:!0})})()},[r,t]),d.jsx("div",{className:"flex items-center justify-center h-screen",children:d.jsx("p",{children:"Processando webhook..."})})};export{x as default};
