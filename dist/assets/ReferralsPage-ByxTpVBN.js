import{a3 as H,e as U,r as n,s as N,j as e,l as z,aD as G,B as k,q as o,t as m,v as x,w as C,x as u,I as J,U as O,a as _,aF as T,J as R,a8 as Q}from"./index-CsuWV44D.js";import{T as X,a as K,b as S,c as L}from"./tabs-d6mLrd2b.js";import{T as I,a as D,b as f,c as r,d as P,e as i}from"./table-DQI8P4e1.js";import{L as W}from"./link-BOiro_Jb.js";import{C as Y}from"./copy-jZEBkcbL.js";import{B as Z}from"./bar-chart-3-CuUQ_otV.js";import{p as q}from"./pt-BR-DZ8_n-vk.js";const j=({title:t,value:d,icon:c,description:p})=>e.jsxs(o,{className:"bg-card/50 backdrop-blur-sm",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:t}),e.jsx(c,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d}),e.jsx("p",{className:"text-xs text-muted-foreground",children:p})]})]}),ne=()=>{const{user:t,settings:d}=H(),{toast:c}=U(),[p,v]=n.useState(!0),[l,A]=n.useState({referrals:[],commissions:[]}),[g,$]=n.useState(null),[w,B]=n.useState(""),y=n.useCallback(async()=>{if(t){v(!0);try{const[s,a,b]=await Promise.all([N.from("referrals").select("*").eq("referrer_id",t.id).order("created_at",{ascending:!1}),N.from("commissions").select("*, referral:referrals(referred_name, referred_email)").eq("referrer_id",t.id).order("created_at",{ascending:!1}),N.from("affiliate_settings").select("*").eq("id",1).single()]);if(s.error)throw s.error;if(a.error)throw a.error;if(b.error)throw b.error;A({referrals:s.data,commissions:a.data}),$(b.data),d?.referral_code&&B(`${window.location.origin}/signup?ref=${d.referral_code}`)}catch(s){c({title:"Erro ao buscar dados de afiliados",description:s.message,variant:"destructive"})}finally{v(!1)}}},[t,d,c]);n.useEffect(()=>{y()},[y]);const M=()=>{navigator.clipboard.writeText(w),c({title:"Link copiado!",description:"Seu link de indicação foi copiado para a área de transferência."})},E=s=>{switch(s){case"registered":return e.jsx(T,{className:"w-4 h-4 text-yellow-500"});case"subscribed":return e.jsx(_,{className:"w-4 h-4 text-green-500"});case"cancelled":return e.jsx(Q,{className:"w-4 h-4 text-red-500"});default:return null}},F=s=>({registered:"Registrado",subscribed:"Assinante",cancelled:"Cancelado"})[s]||s,V=s=>({pending:"Pendente",paid:"Paga",cancelled:"Cancelada"})[s]||s,h={totalReferrals:l.referrals.length,subscribedReferrals:l.referrals.filter(s=>s.status==="subscribed").length,pendingCommissions:l.commissions.filter(s=>s.status==="pending").reduce((s,a)=>s+Number(a.amount),0),paidCommissions:l.commissions.filter(s=>s.status==="paid").reduce((s,a)=>s+Number(a.amount),0)};return p?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(z,{className:"w-8 h-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-4 space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground titulo-gradiente flex items-center gap-2",children:[e.jsx(G,{className:"w-8 h-8"}),"Programa de Afiliados"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Indique amigos e ganhe comissões por cada novo assinante."})]}),e.jsxs(k,{onClick:()=>window.open(g?.program_rules,"_blank"),variant:"outline",children:[e.jsx(W,{className:"w-4 h-4 mr-2"}),"Ver Regras do Programa"]})]}),e.jsxs(o,{className:"bg-card/50 backdrop-blur-sm shadow-lg",children:[e.jsxs(m,{children:[e.jsx(x,{children:"Seu Link de Indicação"}),e.jsx(C,{children:"Compartilhe este link para começar a ganhar."})]}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(J,{value:w,readOnly:!0,className:"bg-muted"}),e.jsx(k,{onClick:M,size:"icon",children:e.jsx(Y,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(j,{title:"Total de Indicados",value:h.totalReferrals,icon:O,description:"Pessoas que se cadastraram com seu link."}),e.jsx(j,{title:"Indicados Assinantes",value:h.subscribedReferrals,icon:_,description:"Indicados que se tornaram assinantes."}),e.jsx(j,{title:"Comissão Pendente",value:`R$ ${h.pendingCommissions.toFixed(2)}`,icon:T,description:"Comissões aguardando liberação."}),e.jsx(j,{title:"Total Pago",value:`R$ ${h.paidCommissions.toFixed(2)}`,icon:Z,description:"Valor total de comissões pagas."})]}),e.jsxs(X,{defaultValue:"referrals",children:[e.jsxs(K,{className:"grid w-full grid-cols-2",children:[e.jsx(S,{value:"referrals",children:"Minhas Indicações"}),e.jsx(S,{value:"commissions",children:"Minhas Comissões"})]}),e.jsx(L,{value:"referrals",children:e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Indicados"}),e.jsx(C,{children:"Acompanhe o status de todas as pessoas que você indicou."})]}),e.jsx(u,{children:e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(f,{children:[e.jsx(r,{children:"Nome"}),e.jsx(r,{children:"Email"}),e.jsx(r,{children:"Data de Cadastro"}),e.jsx(r,{children:"Status"})]})}),e.jsx(P,{children:l.referrals.map(s=>e.jsxs(f,{children:[e.jsx(i,{children:s.referred_name||"Não informado"}),e.jsx(i,{children:s.referred_email}),e.jsx(i,{children:R(new Date(s.created_at),"dd/MM/yyyy",{locale:q})}),e.jsxs(i,{className:"flex items-center gap-2",children:[E(s.status),F(s.status)]})]},s.id))})]})})]})}),e.jsx(L,{value:"commissions",children:e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Comissões"}),e.jsx(C,{children:"Veja o histórico de suas comissões."})]}),e.jsx(u,{children:e.jsxs(I,{children:[e.jsx(D,{children:e.jsxs(f,{children:[e.jsx(r,{children:"Indicado"}),e.jsx(r,{children:"Valor"}),e.jsx(r,{children:"Data Liberação"}),e.jsx(r,{children:"Status"})]})}),e.jsx(P,{children:l.commissions.map(s=>e.jsxs(f,{children:[e.jsx(i,{children:s.referral?.referred_name||s.referral?.referred_email||"N/A"}),e.jsxs(i,{children:["R$ ",Number(s.amount).toFixed(2)]}),e.jsx(i,{children:R(new Date(s.due_date),"dd/MM/yyyy",{locale:q})}),e.jsx(i,{children:V(s.status)})]},s.id))})]})})]})})]}),e.jsxs(o,{className:"bg-blue-900/20 border-blue-500",children:[e.jsx(m,{children:e.jsx(x,{children:"Como Funciona?"})}),e.jsxs(u,{className:"space-y-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"1"}),e.jsx("p",{children:"Compartilhe seu link de indicação único com amigos, colegas e em suas redes sociais."})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"2"}),e.jsx("p",{children:"Quando alguém se cadastra e se torna um assinante pago (plano Pro ou superior) através do seu link, você ganha uma comissão."})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"3"}),e.jsxs("p",{children:["Sua comissão é de ",e.jsxs("strong",{children:[g?.commission_percentage||0,"%"]})," sobre o valor da primeira mensalidade paga pelo seu indicado."]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"4"}),e.jsxs("p",{children:["A comissão fica pendente por ",e.jsxs("strong",{children:[g?.payout_waiting_days||0," dias"]})," (período de garantia) e depois é liberada para saque."]})]})]})]})]})};export{ne as default};
