import{af as k,e as S,r as a,j as e,l as b,a4 as q,I as E,B as I,n as F,s as l}from"./index-DRwGhh07.js";const A=()=>{const{formId:i}=k(),{toast:o}=S(),[r,h]=a.useState(null),[u,p]=a.useState([]),[n,v]=a.useState({}),[j,m]=a.useState(!0),[x,c]=a.useState(!1),[_,N]=a.useState(!1);a.useEffect(()=>{(async()=>{if(i){m(!0);try{const{data:t,error:d}=await l.from("client_forms").select("*").eq("shareable_link_id",i).single();if(d)throw new Error("Formulário não encontrado ou inválido.");h(t);const{data:y,error:f}=await l.from("form_questions").select("*").eq("form_id",t.id).order("order",{ascending:!0});if(f)throw f;p(y)}catch(t){o({title:"Erro",description:t.message,variant:"destructive"})}finally{m(!1)}}})()},[i,o]);const g=(s,t)=>{v(d=>({...d,[s]:t}))},w=async s=>{s.preventDefault(),c(!0);for(const t of u)if(t.is_required&&!n[t.question_text]?.trim()){o({title:"Campo obrigatório",description:`A pergunta "${t.question_text}" precisa ser respondida.`,variant:"destructive"}),c(!1);return}try{const{error:t}=await l.functions.invoke("submit-client-form",{body:JSON.stringify({formId:r.id,answers:n,userId:r.user_id})});if(t)throw t;N(!0)}catch(t){o({title:"Erro ao enviar",description:t.message,variant:"destructive"})}finally{c(!1)}};return j?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted",children:e.jsx(b,{className:"w-8 h-8 animate-spin"})}):r?_?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted p-4",style:{backgroundImage:`url(${r.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center"},children:e.jsxs("div",{className:"max-w-2xl w-full bg-card/80 backdrop-blur-lg p-8 rounded-lg shadow-lg text-center border border-border",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-4",children:"Obrigado!"}),e.jsx("p",{className:"text-muted-foreground",children:"Suas respostas foram enviadas com sucesso."})]})}):e.jsx("div",{className:"min-h-screen bg-muted py-12 px-4",style:{backgroundImage:`url(${r.background_image_url})`,backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},children:e.jsxs("div",{className:"max-w-2xl mx-auto bg-card/80 backdrop-blur-lg p-8 rounded-lg shadow-lg border border-border",children:[r.logo_url&&e.jsx("div",{className:"text-center mb-8",children:e.jsx("img",{src:r.logo_url,alt:"Logo",className:"max-h-24 mx-auto"})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground mb-2",children:r.title}),e.jsx("p",{className:"text-muted-foreground mb-8",children:r.description}),e.jsxs("form",{onSubmit:w,className:"space-y-6",children:[u.map(s=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-foreground mb-1",children:[s.question_text,s.is_required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),s.question_type==="long_text"?e.jsx(q,{value:n[s.question_text]||"",onChange:t=>g(s.question_text,t.target.value),required:s.is_required,rows:4,className:"bg-background/70"}):e.jsx(E,{type:s.question_type==="email"?"email":s.question_type==="phone"?"tel":"text",value:n[s.question_text]||"",onChange:t=>g(s.question_text,t.target.value),required:s.is_required,className:"bg-background/70"})]},s.id)),e.jsxs(I,{type:"submit",disabled:x,className:"w-full btn-custom-gradient text-white",children:[x?e.jsx(b,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(F,{className:"w-4 h-4 mr-2"}),"Enviar Respostas"]})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-muted text-destructive",children:"Formulário não encontrado."})};export{A as default};
