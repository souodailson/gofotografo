import{c as Je,j as e,m as G,B as j,ax as je,ac as st,a3 as ee,D as fe,U as at,ae as Qe,aA as rt,R as Le,I as me,Z as ne,_ as le,$ as oe,a0 as ie,a1 as q,aQ as ye,ay as nt,r as C,d as Xe,u as lt,aR as ot,ab as de,aS as pe,a7 as Ce,K as Be,N as qe,O as Ue,P as Y,aT as We,T as ce,C as Ze,J as Me,p as it,i as dt,y as ct,z as xt,E as mt,n as ut,e as ht,aN as gt,aU as pt}from"./index-hGCyqJo1.js";import{P as Oe,C as Ye,D as ft}from"./dnd.esm-DP1zC3am.js";import{L as jt}from"./list-X3xtmzTx.js";import{A as bt}from"./align-justify-DQWOq5OO.js";import{C as kt}from"./chevron-up-BEzVymsO.js";import{T as vt}from"./trending-up-eZoTO0um.js";import{A as xe}from"./archive-Dy5xM5Ar.js";import{S as Nt}from"./search-Ez8lp8eB.js";import{A as Se,b as Te,c as Ae,d as De,e as Pe,f as ze,g as Ee,h as _e,a as Ct}from"./alert-dialog-w4HeuV8X.js";import{u as wt}from"./useCardHoverEffect-DO74xcap.js";import{T as yt,a as St,b as Tt,d as At,c as Dt}from"./tooltip-DHDO-hPW.js";import{M as Ve}from"./more-vertical-CVjO1H9Z.js";import{P as we}from"./pen-square-fZTdjnkt.js";import{L as Pt}from"./link-1DFA_CaV.js";import{P as zt}from"./palette-B2XPTDko.js";import{E as Et}from"./eye-off-kVnMAG8r.js";import{C as _t}from"./calendar-days-BM5wKHs2.js";import{L as $t}from"./list-checks-BMcbLhD5.js";import"./defineProperty-DbXIQDXj.js";import"./typeof-QjJsDpFa.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";const It=Je("ArchiveRestore",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]]),Ge=Je("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]),Ft=({isMobile:t,onAddNewCard:l,showArchived:n,isSummaryExpandedDesktop:c,setIsSummaryExpandedDesktop:o,cardViewMode:u,onToggleCardViewMode:s})=>e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4",children:[e.jsxs(G.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"text-left flex-grow",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl titulo-gradiente",children:"Fluxo de Trabalho"}),e.jsx("p",{className:"text-slate-600 dark:text-slate-400 mt-1 text-sm sm:text-base",children:"Gerencie seus projetos e acompanhe o progresso"})]}),e.jsx("div",{className:`flex ${t?"hidden":"items-center space-x-2 flex-shrink-0"}`,children:!t&&!n&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(j,{onClick:l,size:"default",className:"btn-custom-gradient text-white shadow-lg h-9",children:[e.jsx(je,{className:"w-4 h-4 mr-2"})," Novo Trabalho"]}),e.jsxs("div",{className:"flex items-center rounded-md bg-muted p-0.5",children:[e.jsxs(j,{variant:u==="summarized"?"secondary":"ghost",size:"sm",className:"h-8 px-2",onClick:()=>s("summarized"),children:[e.jsx(jt,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Resumido"})]}),e.jsxs(j,{variant:u==="detailed"?"secondary":"ghost",size:"sm",className:"h-8 px-2",onClick:()=>s("detailed"),children:[e.jsx(bt,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Detalhado"})]})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>o(!c),className:"text-muted-foreground hover:bg-accent h-9",title:c?"Ocultar Resumo":"Mostrar Resumo",children:[c?e.jsx(kt,{className:"w-4 h-4 mr-1 sm:mr-2"}):e.jsx(st,{className:"w-4 h-4 mr-1 sm:mr-2"}),e.jsxs("span",{className:"hidden sm:inline",children:[c?"Ocultar":"Mostrar"," Resumo"]}),e.jsx("span",{className:"sm:hidden",children:c?"Ocultar":"Mostrar"})]})]})})]}),He=({title:t,value:l,icon:n,color:c,isMobile:o,activeViewSummary:u,isFeatured:s=!1,isInsideModal:h=!1})=>{const w="bg-card p-4 rounded-xl shadow-lg border flex items-center space-x-3 transition-all duration-200 ease-in-out",y="border-border",v=s&&(h||u==="cards")?"border-customGreen ring-2 ring-customGreen":"border-border";let a="";o?a=v:a=y;const x="flex flex-col items-center justify-center p-3 h-24";return o&&u==="icons"&&!h?e.jsxs(G.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{type:"spring",stiffness:200,damping:20},className:`${w} ${x} ${a}`,children:[e.jsx("div",{className:`p-2 rounded-full ${c} mb-1`,children:e.jsx(n,{className:"w-4 h-4 text-white"})}),e.jsx("p",{className:"text-[10px] text-muted-foreground text-center leading-tight",children:t}),e.jsx("p",{className:`text-sm font-semibold ${s?"text-lg text-customGreen dark:text-customGreen":"text-foreground"}`,children:l})]}):e.jsxs(G.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:100,damping:15},className:`${w} ${a} card-hover`,children:[e.jsx("div",{className:`p-3 rounded-lg ${c}`,children:e.jsx(n,{className:"text-white w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-xs",children:t}),e.jsx("p",{className:`font-semibold text-lg ${s&&!o?"text-customGreen dark:text-customGreen":"text-foreground"}`,children:l})]})]})},Rt=({cards:t,isMobile:l,activeViewSummary:n,isInsideModal:c=!1})=>{const{settings:o}=ee();if(!t)return null;const u=o?.workflow_columns?.[0]?.id||"novo-lead",s=["agendado","em-andamento","concluido"],h=t.filter(m=>m.status===u).length,w=t.filter(m=>m.status!==u&&s.includes(m.status)&&!m.archived).length,y=h>0?(w/h*100).toFixed(1):0,v=t.filter(m=>m.status==="proposta-enviada").length,a=t.filter(m=>m.status==="em-andamento").length,x=t.reduce((m,W)=>W.status!=="concluido"&&W.value&&!W.archived?m+Number(W.value):m,0),b=t.filter(m=>m.archived).length,V=[{title:"Previsto",value:`R$ ${x.toLocaleString("pt-BR",{minimumFractionDigits:2})}`,icon:fe,color:"bg-emerald-500",isFeatured:!0},{title:"Leads",value:t.filter(m=>m.status===u&&!m.archived).length,icon:at,color:"bg-sky-500"},{title:"Propostas",value:v,icon:Qe,color:"bg-amber-500"},{title:"Em Andamento",value:a,icon:rt,color:"bg-violet-500"},{title:"Conversão",value:`${y}%`,icon:vt,color:"bg-rose-500"},...l&&n==="icons"&&!c?[{title:"Arquivados",value:b,icon:xe,color:"bg-slate-500"}]:[]];if(l&&n==="icons"&&!c)return e.jsx("div",{className:"grid grid-cols-3 gap-2 mb-6",children:V.map(m=>e.jsx(He,{...m,isMobile:l,activeViewSummary:n,isInsideModal:c},m.title))});const U=c?"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6":"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mb-6";return e.jsx("div",{className:U,children:V.filter(m=>!(l&&n==="icons"&&m.title==="Arquivados")).map(m=>e.jsx("div",{className:`${c?"":"lg:col-span-1"} ${m.isFeatured&&c?"sm:col-span-2":""}`,children:e.jsx(He,{...m,isMobile:l,activeViewSummary:n,isInsideModal:c})},m.title))})},Lt=({activeFilters:t,setActiveFilters:l,searchTerm:n,setSearchTerm:c})=>{const{servicePackagesData:o,workflowCards:u}=ee(),s=Le.useMemo(()=>{const a=new Set;return Array.isArray(o)&&o.forEach(x=>{x.niche&&a.add(x.niche)}),Array.from(a)},[o]),h=Le.useMemo(()=>{const a=new Set;return Array.isArray(u)&&u.forEach(x=>{x.tags&&Array.isArray(x.tags)&&x.tags.forEach(b=>a.add(b))}),Array.from(a).sort()},[u]),w=(a,x)=>{l(b=>({...b,[a]:x==="all-items"?"":x}))},y=()=>{l({eventType:"",period:"",packageId:"",financialStatus:"",tag:""}),c("")},v=Object.values(t).some(a=>a!=="")||n!=="";return e.jsxs("div",{className:"p-4 bg-card rounded-xl shadow-lg border border-border mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 items-end",children:[e.jsxs("div",{className:"lg:col-span-1",children:[e.jsx("label",{htmlFor:"search",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Busca Rápida"}),e.jsxs("div",{className:"relative",children:[e.jsx(Nt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(me,{id:"search",type:"text",placeholder:"Nome, data, pacote...",value:n,onChange:a=>c(a.target.value),className:"pl-10 bg-background"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventType",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Tipo de Evento"}),e.jsxs(ne,{value:t.eventType||"all-items",onValueChange:a=>w("eventType",a),children:[e.jsx(le,{id:"eventType",className:"bg-background",children:e.jsx(oe,{placeholder:"Todos"})}),e.jsxs(ie,{children:[e.jsx(q,{value:"all-items",children:"Todos"}),s.map(a=>e.jsx(q,{value:a,children:a},a))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"period",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Período"}),e.jsxs(ne,{value:t.period||"all-items",onValueChange:a=>w("period",a),children:[e.jsx(le,{id:"period",className:"bg-background",children:e.jsx(oe,{placeholder:"Qualquer"})}),e.jsxs(ie,{children:[e.jsx(q,{value:"all-items",children:"Qualquer"}),e.jsx(q,{value:"next7days",children:"Próximos 7 dias"}),e.jsx(q,{value:"next30days",children:"Próximos 30 dias"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"packageId",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Pacote"}),e.jsxs(ne,{value:t.packageId||"all-items",onValueChange:a=>w("packageId",a),children:[e.jsx(le,{id:"packageId",className:"min-w-[150px] bg-background",children:e.jsx(oe,{placeholder:"Todos"})}),e.jsxs(ie,{children:[e.jsx(q,{value:"all-items",children:"Todos"}),Array.isArray(o)&&o.map(a=>e.jsx(q,{value:a.id,children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"financialStatus",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Status Financeiro"}),e.jsxs(ne,{value:t.financialStatus||"all-items",onValueChange:a=>w("financialStatus",a),children:[e.jsx(le,{id:"financialStatus",className:"bg-background",children:e.jsx(oe,{placeholder:"Todos"})}),e.jsxs(ie,{children:[e.jsx(q,{value:"all-items",children:"Todos"}),e.jsx(q,{value:"paid",children:"Pago"}),e.jsx(q,{value:"pending",children:"Pendente"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"tagFilter",className:"block text-sm font-medium text-muted-foreground mb-1 flex items-center",children:[e.jsx(ye,{className:"w-3.5 h-3.5 mr-1.5"}),"Tags"]}),e.jsxs(ne,{value:t.tag||"all-items",onValueChange:a=>w("tag",a),children:[e.jsx(le,{id:"tagFilter",className:"bg-background",children:e.jsx(oe,{placeholder:"Todas"})}),e.jsxs(ie,{children:[e.jsx(q,{value:"all-items",children:"Todas"}),h.map(a=>e.jsx(q,{value:a,children:a},a))]})]})]})]}),v&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs(j,{variant:"ghost",onClick:y,className:"text-muted-foreground hover:text-foreground",children:[e.jsx(nt,{className:"w-4 h-4 mr-2"}),"Limpar Filtros"]})})]})},Bt=t=>{if(!t||t.includes("slate"))return"text-foreground";if(t.includes("yellow-300"))return"text-yellow-800 dark:text-yellow-200";const l=t.split("-")[1];return t.includes("dark")?`text-${l}-200`:`text-${l}-800`},Ke=(t,l,n=!1)=>{if(!t||t.includes("slate"))return`bg-card ${n?"dark:bg-muted/30":""}`;const c=t.split("dark:")[1];if(c){const u=c.replace(/-\d+/,""),s=t.split(" ")[0].replace(/-\d+/,"");return l==="dark"?n?`${u}-800`:`${u}-900`:n?`${s}-200`:`${s}-100`}const o=t.replace(/-\d+/,"");return n?`${o}-200`:`${o}-100`},qt=(t,l)=>{if(!t||t.includes("slate"))return"border-border/40";const n=t.split("dark:")[1];if(n){const o=n.replace(/-\d+/,"");return l==="dark"?`border-${o.split("-")[1]}-700`:`border-${t.split(" ")[0].split("-")[1]}-200`}return`border-${t.replace(/-\d+/,"").split("-")[1]}-200`},Ut=({card:t,onAddComment:l})=>{const[n,c]=C.useState(""),o=s=>{s.preventDefault(),s.stopPropagation(),n.trim()&&(l(t.id,n),c(""))},u=s=>{if(!s)return"?";const h=s.split(" ");return h.length>1?`${h[0][0]}${h[h.length-1][0]}`.toUpperCase():s.substring(0,2).toUpperCase()};return e.jsxs("div",{className:"p-3 rounded-lg shadow-xl w-72 max-h-96 flex flex-col bg-background/80 dark:bg-background/70 backdrop-blur-xl border border-border",children:[e.jsx("h4",{className:"font-semibold text-sm mb-2 text-foreground",children:"Comentários"}),e.jsx("div",{className:"flex-grow overflow-y-auto space-y-2 pr-2 scrollbar-thin",children:t.comments&&t.comments.length>0?t.comments.slice().sort((s,h)=>new Date(s.date)-new Date(h.date)).map(s=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsxs(ct,{className:"h-6 w-6",children:[e.jsx(xt,{src:s.user_photo_url,alt:s.user}),e.jsx(mt,{children:u(s.user)})]}),e.jsxs("div",{className:"bg-muted/50 rounded-md p-2 flex-1",children:[e.jsx("p",{className:"text-xs text-foreground whitespace-pre-wrap",children:s.text}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1 text-right",children:new Date(s.date).toLocaleString("pt-BR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})})]})]},s.id||s.date)):e.jsx("p",{className:"text-xs text-muted-foreground text-center py-4",children:"Nenhum comentário ainda."})}),e.jsxs("form",{onSubmit:o,className:"mt-2 pt-2 border-t border-border flex items-center space-x-2",children:[e.jsx(me,{type:"text",placeholder:"Adicionar comentário...",value:n,onChange:s=>c(s.target.value),onClick:s=>s.stopPropagation(),className:"h-8 text-xs flex-grow bg-background/50"}),e.jsx(j,{type:"submit",size:"icon",className:"h-8 w-8",disabled:!n.trim(),children:e.jsx(ut,{size:14})})]})]})},Wt=({card:t,onEdit:l,onUpdateSubtask:n,onAddSubtask:c,onDeleteSubtask:o,onDeleteCard:u,onArchiveCard:s,columnColor:h,onAddComment:w,viewMode:y})=>{const{getClientById:v,getServicePackageById:a,financialData:x}=ee(),[b,V]=C.useState(!1),[U,m]=C.useState(""),[W,N]=C.useState(!1),X=wt(),{theme:D}=Xe(),te=lt(),A=t.client_id?v(t.client_id):null,J=t.service_package_id?a(t.service_package_id):null,k=x.transactions.find(r=>r.workflow_id===t.id),g=Ke(h,D,!1),z=Ke(h,D,!0),_=qt(h,D),$=Bt(h),E=r=>({Casamento:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",Gestante:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",Empresarial:"bg-sky-100 text-sky-800 dark:bg-sky-900 dark:text-sky-200","Ensaio Externo":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",Corporativo:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",Estúdio:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",Produto:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"})[r]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200",be=r=>{if(r.stopPropagation(),A&&A.phone){const L=A.phone.replace(/\D/g,"");window.open(`https://wa.me/55${L}`,"_blank")}else alert("Número de WhatsApp do cliente não disponível.")},R=t.date?ot(de(t.date),new Date):null;let H=null;R!==null&&R>=0&&R<=7&&(H={message:R===0?"Evento é Hoje!":`Evento em ${R} dia${R!==1?"s":""}`,color:R<=3?"text-red-500 dark:text-red-400":"text-yellow-500 dark:text-yellow-400"});const Z=r=>{r.stopPropagation(),U.trim()!==""&&(c(t.id,U),m(""))},K=()=>{u(t.id),N(!1)},ke=r=>{r.stopPropagation(),te("/studio/contracts/new",{state:{clientId:t.client_id,workflowCardId:t.id}})},ve=({children:r})=>e.jsx("div",{className:"flex flex-col space-y-2",children:r}),ue=pe("rounded-lg p-3 sm:p-4 border cursor-pointer transition-all duration-200 group card-hover-effect",g,$,_,`hover:${z}`);return y==="summarized"?e.jsx(G.div,{ref:X,className:ue,onClick:()=>l(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-sm break-words leading-tight truncate",children:t.title||(A?A.name:"Título não definido")}),A&&e.jsxs("div",{className:"text-xs text-current/80 flex items-center truncate",children:[e.jsx(Ce,{size:12,className:"mr-1.5 flex-shrink-0"})," ",A.name]})]}),e.jsxs(Be,{children:[e.jsx(qe,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6 opacity-50 group-hover:opacity-100 transition-opacity",onClick:r=>r.stopPropagation(),children:e.jsx(Ve,{className:"w-4 h-4"})})}),e.jsxs(Ue,{align:"end",onClick:r=>r.stopPropagation(),children:[e.jsxs(Y,{onClick:()=>l(t),children:[e.jsx(we,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsxs(Y,{onClick:()=>s(t.id),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Arquivar"]}),e.jsx(We,{}),e.jsxs(Y,{onClick:()=>N(!0),className:"text-red-600 dark:text-red-400 hover:!text-red-600 focus:text-red-600 dark:focus:text-red-400",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Excluir"]})]})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(G.div,{ref:X,className:ue,onClick:()=>l(t),children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-sm flex-1 break-words leading-tight",children:t.title||(A?A.name:"Título não definido")}),e.jsxs(Be,{children:[e.jsx(qe,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6 opacity-50 group-hover:opacity-100 transition-opacity",onClick:r=>r.stopPropagation(),children:e.jsx(Ve,{className:"w-4 h-4"})})}),e.jsxs(Ue,{align:"end",onClick:r=>r.stopPropagation(),children:[e.jsxs(Y,{onClick:()=>l(t),children:[e.jsx(we,{className:"mr-2 h-4 w-4"})," Editar"]}),e.jsxs(Y,{onClick:()=>s(t.id),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"})," Arquivar"]}),e.jsx(We,{}),e.jsxs(Y,{onClick:()=>N(!0),className:"text-red-600 dark:text-red-400 hover:!text-red-600 focus:text-red-600 dark:focus:text-red-400",children:[e.jsx(ce,{className:"mr-2 h-4 w-4"})," Excluir"]})]})]})]}),e.jsxs(ve,{children:[A&&e.jsxs("div",{className:"text-xs text-current/80 flex items-center",children:[e.jsx(Ce,{size:12,className:"mr-1.5"})," ",A.name]}),J&&e.jsxs("div",{className:"text-xs text-current/80",children:["Pacote: ",J.name]}),t.description&&e.jsx("p",{className:"text-xs text-current/80 line-clamp-2",children:t.description}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:t.tags.map((r,L)=>e.jsxs("span",{className:`inline-flex items-center px-1.5 py-0.5 rounded-full text-[10px] font-medium ${E(r)}`,children:[e.jsx(ye,{className:"w-2.5 h-2.5 mr-1"}),r]},L))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center text-green-600 dark:text-green-400",children:[e.jsx(fe,{className:"w-3.5 h-3.5 mr-1"}),e.jsxs("span",{className:"font-semibold text-xs sm:text-sm",children:["R$ ",Number(t.value||0).toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),t.date&&e.jsxs("div",{className:"flex items-center text-current/80",children:[e.jsx(Ze,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"text-xs",children:Me(de(t.date),"dd/MM/yy")}),t.time&&e.jsxs("span",{className:"text-xs ml-1",children:["(",t.time,")"]})]})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[H&&e.jsxs("div",{className:`flex items-center ${H.color}`,children:[e.jsx(it,{size:12,className:"mr-1"})," ",H.message]}),k&&e.jsxs("div",{className:`flex items-center ${k.paid?"text-green-500 dark:text-green-400":"text-orange-500 dark:text-orange-400"}`,children:[e.jsx(fe,{size:12,className:"mr-1"})," Pagamento:"," ",k.paid?"Pago":"Pendente"]})]}),e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("h5",{className:"font-semibold mb-1 text-current/90",children:"Contrato e Observações"}),e.jsx("div",{className:"space-y-1",children:t.contract_url?e.jsxs("a",{href:t.contract_url,target:"_blank",rel:"noopener noreferrer",className:"text-customPurple hover:underline flex items-center text-xs",onClick:r=>r.stopPropagation(),children:[e.jsx(Pt,{size:12,className:"mr-1"})," Ver Contrato:"," ",t.contract_name||"Contrato"," (",t.contract_status||"Status desconhecido",")"]}):e.jsxs(j,{variant:"link",size:"sm",className:"p-0 h-auto text-xs text-customPurple",onClick:ke,children:[e.jsx(Qe,{size:12,className:"mr-1"})," Criar Contrato"]})})]}),e.jsxs("div",{children:[e.jsxs(j,{variant:"link",size:"sm",className:"p-0 h-auto text-xs text-neutral-600 dark:text-purple-400",onClick:r=>{r.stopPropagation(),V(!b)},children:[b?"Ocultar":"Mostrar"," Subtarefas (",t.subtasks?.length||0,")"]}),b&&e.jsxs("div",{className:"mt-1 space-y-1 pl-1 border-l-2 border-border dark:border-slate-600",children:[(t.subtasks||[]).map(r=>e.jsxs("div",{className:"flex items-center justify-between text-xs group/subtask",children:[e.jsxs("label",{className:"flex items-center space-x-1.5 text-current/80 cursor-pointer",children:[e.jsx(dt,{checked:r.completed,onCheckedChange:L=>{n(t.id,r.id,L)},onClick:L=>L.stopPropagation()}),e.jsx("span",{className:r.completed?"line-through text-current/60":"",children:r.text})]}),e.jsx(j,{variant:"ghost",size:"icon",className:"w-5 h-5 opacity-0 group-hover/subtask:opacity-100",onClick:L=>{L.stopPropagation(),o(t.id,r.id)},children:e.jsx(ce,{size:12,className:"text-red-500"})})]},r.id)),e.jsxs("div",{className:"flex items-center space-x-1 pt-1",children:[e.jsx(me,{type:"text",placeholder:"Nova subtarefa...",value:U,onChange:r=>m(r.target.value),onClick:r=>r.stopPropagation(),onKeyPress:r=>{r.key==="Enter"&&Z(r)},className:"h-6 text-xs flex-grow bg-background"}),e.jsx(j,{variant:"ghost",size:"icon",className:"w-5 h-5",onClick:Z,children:e.jsx(je,{size:14})})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-current/20",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:be,className:"text-green-600 hover:text-green-700 p-1 h-auto",disabled:!A||!A.phone,children:e.jsx(Ge,{className:"w-3.5 h-3.5"})}),e.jsx(yt,{delayDuration:100,children:e.jsxs(St,{children:[e.jsx(Tt,{asChild:!0,children:e.jsxs("div",{className:"flex items-center text-current/80 cursor-pointer",onClick:r=>r.stopPropagation(),children:[e.jsx(Ge,{className:"w-3 h-3 mr-1"}),e.jsx("span",{className:"text-xs",children:t.comments?.length||0})]})}),e.jsx(At,{children:e.jsx(Dt,{side:"top",align:"center",className:"p-0 bg-transparent border-none shadow-none",onClick:r=>r.stopPropagation(),children:e.jsx(Ut,{card:t,onAddComment:w})})})]})})]}),t.history&&t.history.length>0&&e.jsxs("div",{className:"mt-1 text-[10px] text-current/60",children:["Última atualização:"," ",Me(de(t.history[t.history.length-1].date),"dd/MM/yy HH:mm")]})]})]}),e.jsx(Se,{open:W,onOpenChange:N,children:e.jsxs(Te,{children:[e.jsxs(Ae,{children:[e.jsx(De,{children:"Confirmar Exclusão"}),e.jsx(Pe,{children:"Tem certeza que deseja excluir este card? Esta ação não pode ser desfeita."})]}),e.jsxs(ze,{children:[e.jsx(Ee,{onClick:r=>{r.stopPropagation(),N(!1)},children:"Cancelar"}),e.jsx(_e,{onClick:r=>{r.stopPropagation(),K()},className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})},Mt=(t,l)=>{if(!t||t.includes("slate"))return"bg-muted/30 dark:bg-muted/10";const n=t.split("dark:")[1];return l==="dark"&&n?`${n.replace(/-\d+/,"").split(" ")[0]}`:t.split(" ")[0]},Ot=({column:t,index:l,onAddCard:n,onEditCard:c,onSaveColumnSettings:o,onDeleteColumn:u,onDeleteCard:s,onArchiveCard:h,defaultColors:w,cardViewMode:y})=>{const[v,a]=C.useState(null),[x,b]=C.useState(""),[V,U]=C.useState(t.color||"bg-card"),{updateWorkflowCard:m,addComment:W}=ee(),{theme:N}=Xe(),X=k=>{a(k.id),b(k.title),U(k.color||"bg-card")},D=()=>{x.trim()&&o(v,x,V),a(null),b("")},te=async(k,g,z)=>{const _=t.cards.find(E=>E.id===k);if(!_)return;const $=(_.subtasks||[]).map(E=>E.id===g?{...E,completed:z}:E);await m(k,{subtasks:$})},A=async(k,g)=>{const z=t.cards.find(E=>E.id===k);if(!z||!g.trim())return;const _={id:Math.random().toString(36).substr(2,9),text:g.trim(),completed:!1},$=[...z.subtasks||[],_];await m(k,{subtasks:$})},J=async(k,g)=>{const z=t.cards.find($=>$.id===k);if(!z)return;const _=(z.subtasks||[]).filter($=>$.id!==g);await m(k,{subtasks:_})};return e.jsx(Oe,{draggableId:t.id,index:l,children:k=>e.jsx("div",{ref:k.innerRef,...k.draggableProps,className:"w-[300px] sm:w-[350px] flex-shrink-0",children:e.jsxs("div",{className:pe("rounded-xl shadow-lg border border-border/50 flex flex-col h-full max-h-full",Mt(t.color,N)),children:[e.jsx("div",{...k.dragHandleProps,className:pe("p-3 rounded-t-xl flex items-center justify-between text-foreground cursor-grab"),children:v===t.id?e.jsxs("div",{className:"flex flex-col w-full space-y-2",children:[e.jsx(me,{value:x,onChange:g=>b(g.target.value),className:"bg-background text-foreground border-border placeholder-muted-foreground",autoFocus:!0,onKeyPress:g=>g.key==="Enter"&&D()}),e.jsx("div",{className:"flex flex-wrap gap-1",children:w.map(g=>e.jsx("button",{type:"button",onClick:()=>U(g),className:`w-5 h-5 rounded-full border-2 ${V===g?"border-foreground ring-2 ring-offset-1 ring-offset-transparent ring-primary":"border-transparent"} ${N==="dark"&&g.split("dark:")[1]?.split(" ")[0]||g.split(" ")[0]}`,"aria-label":`Selecionar cor ${g}`},g))}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(j,{size:"sm",variant:"ghost",onClick:()=>a(null),className:"text-muted-foreground hover:bg-accent",children:"Cancelar"}),e.jsx(j,{size:"sm",variant:"ghost",onClick:D,className:"text-muted-foreground hover:bg-accent",children:"Salvar"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"font-semibold text-sm",children:t.title}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>X(t),className:"w-6 h-6 text-muted-foreground hover:bg-accent",children:e.jsx(zt,{size:14})}),e.jsxs(Se,{children:[e.jsx(Ct,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",className:"w-6 h-6 text-muted-foreground hover:bg-accent",children:e.jsx(ce,{size:14})})}),e.jsxs(Te,{children:[e.jsxs(Ae,{children:[e.jsx(De,{children:"Excluir Coluna?"}),e.jsxs(Pe,{children:['Tem certeza que deseja excluir a coluna "',t.title,'"?',t.cards&&t.cards.length>0&&" Esta coluna contém cards. Mova-os antes de excluir."]})]}),e.jsxs(ze,{children:[e.jsx(Ee,{children:"Cancelar"}),e.jsx(_e,{onClick:()=>u(t.id),disabled:t.cards&&t.cards.length>0,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})]}),e.jsx("span",{className:"bg-background/50 text-foreground px-1.5 py-0.5 rounded-full text-xs",children:t.cards?.length||0})]})]})}),e.jsx(Ye,{droppableId:t.id,type:"CARD",children:(g,z)=>e.jsxs("div",{ref:g.innerRef,...g.droppableProps,className:pe("p-3 space-y-3 transition-colors min-h-[100px]",z.isDraggingOver?"bg-accent/50":""),children:[(t.cards||[]).map((_,$)=>e.jsx(Oe,{draggableId:_.id,index:$,children:E=>e.jsx("div",{ref:E.innerRef,...E.draggableProps,...E.dragHandleProps,children:e.jsx(Wt,{card:_,onEdit:c,onUpdateSubtask:te,onAddSubtask:A,onDeleteSubtask:J,onDeleteCard:s,onArchiveCard:h,columnColor:t.color,onAddComment:W,viewMode:y})})},_.id)),g.placeholder]})}),e.jsx("div",{className:"p-3 mt-auto border-t border-border flex-shrink-0",children:e.jsxs(j,{variant:"outline",className:"w-full border-dashed border-2 h-10 text-muted-foreground hover:text-foreground",onClick:()=>n(t.id),children:[e.jsx(je,{className:"w-4 h-4 mr-2"}),"Adicionar Card"]})})]})})})},Vt=({card:t,onUnarchive:l,onDelete:n,onEdit:c})=>{const{getClientById:o,getServicePackageById:u}=ee(),s=t.client_id?o(t.client_id):null,h=t.service_package_id?u(t.service_package_id):null,[w,y]=C.useState(!1),v=()=>{n(t.id),y(!1)},a=x=>({Casamento:"bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-200",Gestante:"bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200",Empresarial:"bg-sky-100 text-sky-800 dark:bg-sky-900 dark:text-sky-200","Ensaio Externo":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",Corporativo:"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",Estúdio:"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200",Produto:"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200"})[x]||"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200";return e.jsxs(e.Fragment,{children:[e.jsxs(G.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-slate-100 dark:bg-slate-700/50 p-4 rounded-lg shadow-md border border-slate-200 dark:border-slate-600",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold text-slate-800 dark:text-slate-100 break-all",children:t.title||(s?s.name:"Card Arquivado")}),e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(j,{variant:"ghost",size:"icon",className:"w-7 h-7 text-slate-600 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200",onClick:()=>c(t),children:e.jsx(we,{size:16})}),e.jsx(j,{variant:"ghost",size:"icon",className:"w-7 h-7 text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",onClick:()=>l(t.id),children:e.jsx(It,{size:16})}),e.jsx(j,{variant:"ghost",size:"icon",className:"w-7 h-7 text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",onClick:()=>y(!0),children:e.jsx(ce,{size:16})})]})]}),s&&e.jsxs("p",{className:"text-xs text-slate-600 dark:text-slate-300 mb-1 flex items-center",children:[e.jsx(Ce,{size:12,className:"mr-1"})," ",s.name]}),h&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1",children:["Pacote: ",h.name]}),t.date&&e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mb-1 flex items-center",children:[e.jsx(Ze,{size:12,className:"mr-1"})," ",new Date(t.date).toLocaleDateString("pt-BR")]}),t.value>0&&e.jsxs("p",{className:"text-xs text-green-600 dark:text-green-400 mb-1 flex items-center",children:[e.jsx(fe,{size:12,className:"mr-1"})," R$ ",Number(t.value).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),t.tags&&t.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:t.tags.map((x,b)=>e.jsxs("span",{className:`text-xs px-1.5 py-0.5 rounded-full ${a(x)} flex items-center`,children:[e.jsx(ye,{size:10,className:"mr-1"}),x]},b))}),t.history&&t.history.length>0&&e.jsxs("p",{className:"text-xs text-slate-400 dark:text-slate-500 mt-2",children:["Arquivado em: ",new Date(t.history.find(x=>x.action==="Card arquivado")?.date||t.updated_at||t.created_at).toLocaleDateString("pt-BR")]})]}),e.jsx(Se,{open:w,onOpenChange:y,children:e.jsxs(Te,{children:[e.jsxs(Ae,{children:[e.jsx(De,{children:"Excluir Card Permanentemente?"}),e.jsxs(Pe,{children:['Esta ação não pode ser desfeita. O card "',t.title||"este card",'" será excluído para sempre.']})]}),e.jsxs(ze,{children:[e.jsx(Ee,{onClick:()=>y(!1),children:"Cancelar"}),e.jsx(_e,{onClick:v,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})},Gt=({cards:t,onDeleteCard:l,onUnarchiveCard:n,onEditCard:c})=>!t||t.length===0?e.jsxs("div",{className:"text-center py-10 text-slate-500 dark:text-slate-400",children:[e.jsx(xe,{size:48,className:"mx-auto mb-4 text-slate-400 dark:text-slate-500"}),e.jsx("h3",{className:"text-xl font-semibold",children:"Nenhum card arquivado"}),e.jsx("p",{children:"Você ainda não arquivou nenhum card."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-slate-800 dark:text-slate-100",children:["Cards Arquivados (",t.length,")"]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.sort((o,u)=>new Date(u.updated_at||u.created_at)-new Date(o.updated_at||o.created_at)).map(o=>e.jsx(Vt,{card:o,onUnarchive:n,onDelete:l,onEdit:c},o.id))})]}),Ht=({viewMode:t,onToggleViewMode:l,showArchived:n,onToggleArchived:c,archivedCount:o,showNewColumnInput:u,onToggleNewColumnInput:s,newColumnName:h,onSetNewColumnName:w,onAddNewColumn:y})=>e.jsxs(G.div,{initial:{y:100},animate:{y:0},exit:{y:100},transition:{type:"spring",stiffness:120,damping:20},className:"fixed bottom-0 left-0 right-0 bg-card/80 dark:bg-card/70 backdrop-blur-lg border-t border-border p-2 shadow-top-lg z-40 md:hidden",children:[e.jsxs("div",{className:"flex items-center justify-around space-x-1",children:[e.jsxs(j,{onClick:c,variant:"ghost",size:"sm",className:"flex-1 flex flex-col items-center h-auto py-1.5 text-xs text-muted-foreground hover:text-foreground",title:n?"Ocultar Arquivados":`Ver Arquivados (${o})`,children:[n?e.jsx(Et,{className:"w-5 h-5 mb-0.5"}):e.jsx(xe,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"truncate",children:n?"Visíveis":`Arquivos (${o})`})]}),e.jsxs(j,{onClick:l,variant:"ghost",size:"sm",className:"flex-1 flex flex-col items-center h-auto py-1.5 text-xs text-muted-foreground hover:text-foreground",title:t==="kanban"?"Visualizar Timeline":"Visualizar Kanban",disabled:n,children:[t==="kanban"?e.jsx(_t,{className:"w-5 h-5 mb-0.5"}):e.jsx($t,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"truncate",children:t==="kanban"?"Timeline":"Kanban"})]}),!u&&!n&&e.jsxs(j,{onClick:s,variant:"ghost",size:"sm",className:"flex-1 flex flex-col items-center h-auto py-1.5 text-xs text-muted-foreground hover:text-foreground",title:"Adicionar Nova Coluna",children:[e.jsx(je,{className:"w-5 h-5 mb-0.5"}),e.jsx("span",{className:"truncate",children:"Nova Coluna"})]})]}),u&&!n&&e.jsxs(G.div,{initial:{height:0,opacity:0,marginTop:0},animate:{height:"auto",opacity:1,marginTop:"0.5rem"},exit:{height:0,opacity:0,marginTop:0},className:"flex flex-col space-y-2 p-2 bg-background rounded-md shadow-inner",children:[e.jsx(me,{type:"text",value:h,onChange:v=>w(v.target.value),placeholder:"Nome da nova coluna",className:"w-full h-9 text-sm",autoFocus:!0,onKeyPress:v=>v.key==="Enter"&&y()}),e.jsxs("div",{className:"flex w-full space-x-2",children:[e.jsx(j,{onClick:y,size:"sm",className:"flex-1 h-9 text-xs",children:"Salvar Coluna"}),e.jsx(j,{onClick:s,variant:"outline",size:"sm",className:"flex-1 h-9 text-xs",children:"Cancelar"})]})]})]}),Kt=["bg-purple-300 dark:bg-purple-700","bg-blue-300 dark:bg-blue-700","bg-yellow-300 dark:bg-yellow-700","bg-pink-300 dark:bg-pink-700","bg-green-300 dark:bg-green-700","bg-rose-300 dark:bg-rose-700","bg-indigo-300 dark:bg-indigo-700","bg-teal-300 dark:bg-teal-700","bg-red-300 dark:bg-red-700","bg-sky-300 dark:bg-sky-700","bg-fuchsia-300 dark:bg-fuchsia-700","bg-cyan-300 dark:bg-cyan-700","bg-lime-300 dark:bg-lime-700","bg-amber-300 dark:bg-amber-700","bg-violet-300 dark:bg-violet-700","bg-slate-200 dark:bg-slate-700"],fs=({isMobile:t})=>{const{workflowCards:l,updateWorkflowCard:n,deleteWorkflowCard:c,settings:o,setSettings:u,getClientById:s,getServicePackageById:h,financialData:w,refreshData:y}=ee(),{toast:v}=ht(),{openModal:a}=gt(),[x,b]=C.useState([]),[V,U]=C.useState(!1),[m,W]=C.useState(""),[N,X]=C.useState({eventType:"",period:"",packageId:"",financialStatus:"",tag:""}),[D,te]=C.useState(!1),[A,J]=C.useState(!1),[k,g]=C.useState(""),[z,_]=C.useState(!0),[$,E]=C.useState(o?.workflow_card_view_mode||"detailed");C.useEffect(()=>{const i=requestAnimationFrame(()=>U(!0));return()=>{cancelAnimationFrame(i),U(!1)}},[]);const be=i=>{E(i),u({workflow_card_view_mode:i})},R=C.useMemo(()=>l.filter(i=>!i.archived),[l]),H=C.useMemo(()=>l.filter(i=>i.archived),[l]),Z=C.useMemo(()=>(D?H:R).filter(d=>{const p=d.client_id?s(d.client_id):null,S=d.service_package_id?h(d.service_package_id):null,f=m.toLowerCase(),I=d.title&&d.title.toLowerCase().includes(f)||p&&p.name&&p.name.toLowerCase().includes(f)||d.date&&d.date.includes(m)||S&&S.name&&S.name.toLowerCase().includes(f),T=!N.eventType||S&&S.niche===N.eventType,M=(()=>{if(!N.period||!d.date)return!0;const O=new Date(d.date),B=new Date;if(B.setHours(0,0,0,0),N.period==="next7days"){const Q=new Date(B);return Q.setDate(B.getDate()+7),O>=B&&O<=Q}if(N.period==="next30days"){const Q=new Date(B);return Q.setDate(B.getDate()+30),O>=B&&O<=Q}return!0})(),he=!N.packageId||d.service_package_id===N.packageId,F=w.transactions.find(O=>O.workflow_id===d.id),se=N.financialStatus?N.financialStatus==="paid"?F&&F.status==="PAGO":N.financialStatus==="pending"?!F||F.status!=="PAGO":!0:!0,ae=!N.tag||d.tags&&d.tags.includes(N.tag);return I&&T&&M&&he&&se&&ae}),[R,H,D,m,N,s,h,w.transactions]),K=C.useCallback(i=>{const d=i.map(({id:p,title:S,color:f})=>({id:p,title:S,color:f}));u({workflow_columns:d})},[u]);C.useEffect(()=>{if(D){b([]);return}const i=o?.workflow_columns;let d=i&&i.length>0?i.map(f=>({...f,cards:[]})):pt.map(f=>({...f,cards:[]}));const p=d.findIndex(f=>f.id==="novo-lead");p===-1&&d.unshift({id:"novo-lead",title:"Novos Leads",cards:[],color:"bg-slate-200 dark:bg-slate-700"});const S=d.map(f=>{let I=Z.filter(T=>T.status===f.id&&!T.archived);return I.sort((T,M)=>{if(f.id==="agendado"){if(!T.date&&!M.date)return 0;if(!T.date)return 1;if(!M.date)return-1;try{return de(T.date)-de(M.date)||(T.time||"00:00").localeCompare(M.time||"00:00")||0}catch{return 0}}return(T.order||0)-(M.order||0)}),{...f,cards:I}});b(S),(!i||i.length===0||p===-1)&&K(d.map(f=>({id:f.id,title:f.title,color:f.color})))},[o?.workflow_columns,Z,D,K]);const ke=()=>{J(i=>!i),A||g("")},ve=()=>{if(!k.trim()){v({title:"Erro",description:"O nome da coluna não pode ser vazio.",variant:"destructive"});return}const i=k.toLowerCase().replace(/\s+/g,"-").replace(/[^\w-]+/g,"");if(x.some(S=>S.id===i)){v({title:"Erro",description:"Já existe uma coluna com este ID.",variant:"destructive"});return}const d={id:i,title:k,color:"bg-slate-200 dark:bg-slate-700",cards:[]},p=[...x,d];b(p),K(p),g(""),J(!1)},ue=async i=>{const{source:d,destination:p,draggableId:S,type:f}=i;if(!(!p||D)){if(f==="COLUMN"){const I=Array.from(x),[T]=I.splice(d.index,1);I.splice(p.index,0,T),b(I),K(I);return}if(f==="CARD"){if(d.droppableId===p.droppableId&&d.index===p.index)return;const I=x.find(P=>P.id===d.droppableId),T=x.find(P=>P.id===p.droppableId),M=R.find(P=>P.id===S);if(!M||!I||!T){v({title:"Erro ao Mover",description:"Não foi possível encontrar o card ou a coluna de destino.",variant:"destructive"});return}const he=T.id,F=[...x],se=F.findIndex(P=>P.id===d.droppableId),ae=F.findIndex(P=>P.id===p.droppableId);let O=Array.from(F[se].cards||[]);O.splice(d.index,1),F[se]={...F[se],cards:O};let B;d.droppableId===p.droppableId?B=O:B=Array.from(F[ae].cards||[]);const Q={...M,status:he,order:p.index};B.splice(p.index,0,Q),F[ae]={...F[ae],cards:B};const Fe=F.map(P=>({...P,cards:(P.cards||[]).map((re,ge)=>({...re,order:ge,status:P.id}))}));b(Fe);try{const P=Fe.flatMap(re=>(re.cards||[]).map((ge,Re)=>{const Ne=R.find(tt=>tt.id===ge.id);return Ne&&(Ne.status!==re.id||Ne.order!==Re)?n(ge.id,{status:re.id,order:Re}):null}).filter(Boolean));await Promise.all(P),await y("workflow_cards")}catch(P){v({title:"Erro ao mover projeto",description:P.message,variant:"destructive"}),b(x)}}}},r=i=>a("workflow",{initialStatus:i}),L=i=>a("workflow",{cardId:i.id}),$e=async i=>{try{await c(i),await y("workflow_cards")}catch(d){v({title:"Erro ao excluir",description:d.message,variant:"destructive"})}},Ie=async(i,d)=>{try{await n(i,{archived:d}),await y("workflow_cards")}catch(p){v({title:"Erro ao arquivar/restaurar",description:p.message,variant:"destructive"})}},et=(i,d,p)=>{const S=x.map(f=>f.id===i?{...f,title:d,color:p||f.color}:f);b(S),K(S)};return V?e.jsxs("div",{className:`flex flex-col h-full ${t?"pb-16":""}`,children:[e.jsxs("div",{className:`flex-shrink-0 space-y-4 sm:space-y-6 bg-background ${t?"pb-2":"pb-4 sm:pb-6"}`,children:[e.jsx(Ft,{isMobile:t,onAddNewCard:()=>r("agendado"),showArchived:D,isSummaryExpandedDesktop:z,setIsSummaryExpandedDesktop:_,cardViewMode:$,onToggleCardViewMode:be}),!t&&!D&&e.jsxs(G.div,{initial:{height:0,opacity:0},animate:{height:z?"auto":0,opacity:z?1:0},transition:{duration:.3},className:"overflow-hidden",children:[e.jsx(Rt,{cards:R,columns:x}),e.jsx(Lt,{activeFilters:N,setActiveFilters:X,searchTerm:m,setSearchTerm:W})]})]}),e.jsx("div",{className:"flex-grow overflow-x-auto overflow-y-hidden scrollbar-thin",children:D?e.jsx("div",{className:"p-1",children:e.jsx(Gt,{cards:Z,onDeleteCard:$e,onUnarchiveCard:i=>Ie(i,!1),onEditCard:L})}):e.jsx(ft,{onDragEnd:ue,children:e.jsx(Ye,{droppableId:"all-columns",direction:"horizontal",type:"COLUMN",children:i=>e.jsxs("div",{...i.droppableProps,ref:i.innerRef,className:"flex space-x-4 p-1 workflow-columns-container min-h-[calc(100vh-400px)] sm:min-h-[calc(100vh-350px)]",children:[x.map((d,p)=>e.jsx(Ot,{column:d,index:p,onAddCard:r,onEditCard:L,onDeleteCard:$e,onArchiveCard:S=>Ie(S,!0),onSaveColumnSettings:et,defaultColors:Kt,onDeleteColumn:S=>{if(x.find(T=>T.id===S)?.cards?.length){v({title:"Atenção",description:"Não é possível excluir colunas com projetos. Mova-os primeiro.",variant:"destructive"});return}const I=x.filter(T=>T.id!==S);b(I),K(I)},cardViewMode:$},d.id||`col-key-${p}`)),i.placeholder]})})})}),!t&&e.jsx(Ht,{showArchived:D,onToggleArchived:()=>te(!D),archivedCount:H.length,showNewColumnInput:A,onToggleNewColumnInput:ke,newColumnName:k,onSetNewColumnName:g,onAddNewColumn:ve})]}):null};export{fs as default};
