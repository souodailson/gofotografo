import{f as U,R as ae,j as e,Y as ne,Z as ie,_ as re,$ as le,a0 as ce,I as de,B as l,ah as pe,a6 as ue,r as g,a7 as me,ak as he,p as _,az as xe,ae as fe,s as F}from"./index-B959_7_o.js";import{u as ge,a as je,b as ve,c as Ce,D as we,H as be,L as Se,E as ke,d as ye,e as Me,P as Re,f as Ee,S as Pe,R as Ne,C as ze}from"./EditorRulers-4JP48acx.js";import{L as Be,T as Ie,E as Le}from"./EditorCanvas-u08Q0126.js";import{C as $e}from"./copy-BXl6xJ0E.js";import{E as De}from"./external-link-BU0ovJ_C.js";import{M as Oe}from"./message-square-DK6t4m6u.js";import{G as Ae}from"./grip-vertical-B8wuY_M6.js";import"./dnd.esm-CNSIsYfb.js";import"./defineProperty-C-ST8_Gu.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";import"./useDebounce-DlCjF56H.js";import"./html2canvas.esm-BfxBtG_O.js";import"./tabs-5JwcCaKq.js";import"./alert-dialog-CMWSZjMP.js";import"./plus-circle-B0lITbZK.js";import"./upload-CdVbUmbv.js";import"./switch-wgn4gd4-.js";import"./instagram-P835G8_n.js";import"./image-CjjvHyfl.js";import"./link-BuAO9sRO.js";import"./popover-CitvH7H0.js";import"./ban-CuKnu2ih.js";import"./tooltip-Cwgo7U0h.js";import"./chevron-up-ckAvg4TR.js";import"./eye-off-CVDThO4Q.js";import"./type-CEpyDFf0.js";import"./settings-Cakr_w_3.js";import"./underline-DXQwgy9O.js";import"./video-ThlXC_2j.js";import"./star-CA4LwDww.js";import"./share-2-BzF6Ks-n.js";import"./square-Yty-hvSV.js";import"./palette-DYpEW6qD.js";import"./align-justify-pHCYe3KW.js";import"./list-BWAYK6lC.js";import"./index-DcEOeknW.js";import"./index-Chjiymov.js";const Ge=({isOpen:c,onClose:d,publicUrl:t,proposalName:o})=>{const{toast:r}=U(),[x,a]=ae.useState(!1),m=()=>{navigator.clipboard.writeText(t),a(!0),r({title:"Link copiado!"}),setTimeout(()=>a(!1),2e3)},p={whatsapp:`https://api.whatsapp.com/send?text=${encodeURIComponent(`Confira minha proposta: ${o}
${t}`)}`,linkedin:`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(t)}&title=${encodeURIComponent(o)}`,twitter:`https://twitter.com/intent/tweet?url=${encodeURIComponent(t)}&text=${encodeURIComponent(`Confira minha proposta: ${o}`)}`};return e.jsx(ne,{open:c,onOpenChange:d,children:e.jsxs(ie,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Proposta Publicada com Sucesso!"}),e.jsx(ce,{children:"Sua proposta estÃ¡ online e pronta para ser compartilhada."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{value:t,readOnly:!0}),e.jsx(l,{size:"icon",onClick:m,children:x?e.jsx(pe,{className:"h-4 w-4"}):e.jsx($e,{className:"h-4 w-4"})})]}),e.jsx(l,{asChild:!0,className:"w-full",children:e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Abrir em nova aba"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Compartilhar:"}),e.jsx(l,{asChild:!0,variant:"ghost",size:"icon",children:e.jsx("a",{href:p.whatsapp,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Oe,{})})}),e.jsx(l,{asChild:!0,variant:"ghost",size:"icon",children:e.jsx("a",{href:p.linkedin,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Be,{})})}),e.jsx(l,{asChild:!0,variant:"ghost",size:"icon",children:e.jsx("a",{href:p.twitter,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Ie,{})})})]})]}),e.jsx(ue,{children:e.jsx(l,{onClick:d,children:"Fechar"})})]})})},_e=({onResize:c})=>{const d=g.useRef(null),t=o=>{o.preventDefault();const r=o.clientX,x=d.current.parentElement.getBoundingClientRect().width,a=p=>{requestAnimationFrame(()=>{const b=p.clientX-r;c(x+b)})},m=()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",m)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",m)};return e.jsx("div",{ref:d,className:"absolute top-0 -right-2 h-full w-4 cursor-ew-resize flex items-center justify-center transition-opacity z-50",onMouseDown:t,children:e.jsx(Ae,{className:"text-muted-foreground"})})},yt=({isAdmin:c=!1})=>{const d=ge({isAdmin:c}),{proposal:t,setProposal:o,proposalId:r,isNew:x,activeSection:a,setActiveSection:m,loading:p,saving:M,saveStatus:b,uploads:q,loadingUploads:H,handleSave:S,handlePublish:X,fetchUploads:k}=d,j=je(),{selectedBlock:u,handleSetSelectedBlock:v,viewMode:f,setViewMode:R,canvasWidth:T,setCanvasWidth:W,isLeftSidebarOpen:E,setIsLeftSidebarOpen:P,isRightSidebarOpen:N,setIsRightSidebarOpen:z,snapLines:V,setSnapLines:Y,toolbarPosition:Z}=j,[J,B]=g.useState(!1),[K,Q]=g.useState(""),{addBlock:y,updateBlock:h}=ve(o,v,f),I=g.useRef(null),n=Ce({selectedBlock:u,updateBlock:h,addBlock:y,activeSection:a,canvasRef:I,viewMode:f,setViewMode:R,proposalName:t?.nome_da_proposta}),{fileInputRef:ee,handleFileInputClick:L}=n,{user:$}=me(),{toast:C}=U(),D=g.useRef(null),te=async(s,i)=>{const w=s.target.files?.[0];if(!w||!$||!i)return;if(w.size>10*1024*1024){C({title:"Arquivo muito grande",description:"O arquivo excede o limite de 10MB.",variant:"destructive"});return}C({title:"Enviando arquivo...",description:"Aguarde um momento."});const oe=xe(w.name),O=`${$.id}/${r||"new"}/${fe()}-${oe}`,{error:A}=await F.storage.from("propostas").upload(O,w);if(A){C({title:"Erro no upload",description:A.message,variant:"destructive"});return}const{data:{publicUrl:G}}=F.storage.from("propostas").getPublicUrl(O);i.type==="image"?h(i.id,{content:{...i.content,src:G}}):i.type==="pdf"&&h(i.id,{content:{src:G}}),k(r),C({title:"Arquivo atualizado!",variant:"success"}),s.target.value=""},se=async()=>{const s=await X();s&&(Q(s),B(!0))};return p||!t?e.jsx(he,{}):e.jsx(we,{backend:be,children:e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 w-full fixed inset-0 overflow-hidden",onClick:n.closeContextMenu,children:[e.jsx("input",{type:"file",ref:ee,className:"hidden",onChange:s=>te(s,u),accept:u?.type==="pdf"?"application/pdf":"image/*"}),e.jsx(_,{children:E&&e.jsx(Se,{onAddBlock:y,activeSection:a,uploads:q,loadingUploads:H,proposalId:r,onUploadComplete:()=>k(r),isNew:x,handleSave:()=>S(),onToggle:()=>P(!1)})}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden transition-all duration-300 ease-in-out app-toolbar",children:[e.jsx(ke,{navigateBack:()=>S(!0),viewMode:f,setViewMode:R,handleExportPdf:n.handleExportPdf,handleSave:()=>S(),handlePublish:se,saving:M,saveStatus:b,isAdmin:c,proposal:t}),e.jsx(ye,{selectedBlock:u,updateBlock:h,toolbarPosition:Z,onReplaceImage:()=>L()}),e.jsxs("div",{ref:D,className:"flex-1 overflow-auto bg-muted/40 p-4 sm:p-8 relative flex justify-center studio-editor-container",onClick:()=>v(null),children:[e.jsx(Me,{scrollContainerRef:D}),!E&&e.jsx(l,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 z-30",onClick:()=>P(!0),children:e.jsx(Re,{})}),!N&&u&&e.jsx(l,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-30",onClick:()=>z(!0),children:e.jsx(Ee,{})}),e.jsxs("div",{className:"mx-auto transition-all duration-300 relative group/canvas-container",style:{width:`${T}px`},onClick:s=>s.stopPropagation(),children:[e.jsx(Le,{ref:I,sections:t.sections,blocksBySection:t.blocksBySection,addBlock:y,setSelectedBlock:v,selectedBlockId:u?.id,updateBlock:h,showGrid:j.showGrid,globalStyles:t.theme,activeSection:a,viewMode:f,setProposal:o,onContextMenu:n.handleContextMenu,setSnapLines:Y}),e.jsx(_e,{onResize:W}),V.map((s,i)=>e.jsx("div",{className:"absolute bg-orange-300",style:{...s.type==="vertical"?{left:s.position,top:0,width:"1px",height:"100%"}:{top:s.position,left:0,height:"1px",width:"100%"},zIndex:99998}},i))]})]}),e.jsx(Pe,{sections:t.sections,activeSection:a,setActiveSection:m,setProposal:o,proposal:t})]}),e.jsx(_,{children:N&&e.jsx(Ne,{selectedBlock:u,updateBlock:h,setSelectedBlock:v,globalStyles:t.theme,setGlobalStyles:s=>o(i=>({...i,theme:s})),showGrid:j.showGrid,setShowGrid:j.setShowGrid,proposal:t,setProposal:o,isAdmin:c,onToggle:()=>z(!1),onUploadComplete:()=>k(r),viewMode:f})}),n.contextMenu&&e.jsx(ze,{x:n.contextMenu.x,y:n.contextMenu.y,block:n.contextMenu.block,onClose:n.closeContextMenu,onAction:n.handleContextMenuAction,onFileInputClick:L}),e.jsx(Ge,{isOpen:J,onClose:()=>B(!1),publicUrl:K,proposalName:t?.nome_da_proposta})]})})};export{yt as default};
