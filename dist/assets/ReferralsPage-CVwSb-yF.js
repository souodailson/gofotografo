import{a7 as G,f as K,r as n,s as j,j as e,n as O,aI as Q,B as R,t as o,v as m,w as x,x as v,y as u,I as X,U as J,a as T,aK as S,P as I,ac as W,H as L}from"./index-B959_7_o.js";import{T as Y,a as Z,b as P,c as q}from"./tabs-5JwcCaKq.js";import{T as A,a as D,b as g,c as r,d as E,e as i}from"./table-BGo4pF6F.js";import{L as ee}from"./link-BuAO9sRO.js";import{C as se}from"./copy-BXl6xJ0E.js";import{B as ae}from"./bar-chart-3-i6ZqdCjg.js";const p=({title:t,value:f,icon:d,description:b})=>e.jsxs(o,{className:"bg-card/50 backdrop-blur-sm",children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:t}),e.jsx(d,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f}),e.jsx("p",{className:"text-xs text-muted-foreground",children:b})]})]}),ce=()=>{const{user:t,settings:f}=G(),{toast:d}=K(),[b,w]=n.useState(!0),[l,M]=n.useState({referrals:[],commissions:[]}),[N,$]=n.useState(null),[y,B]=n.useState(""),V=()=>Math.random().toString(36).substring(2,8).toUpperCase(),k=n.useCallback(async()=>{if(t){w(!0);try{const[s,a,C]=await Promise.all([j.from("referrals").select("*").eq("referrer_id",t.id).order("created_at",{ascending:!1}),j.from("commissions").select("*, referral:referrals(referred_name, referred_email)").eq("referrer_id",t.id).order("created_at",{ascending:!1}),j.from("affiliate_settings").select("*").eq("id",1).single()]);if(s.error)throw s.error;if(a.error)throw a.error;if(C.error)throw C.error;M({referrals:s.data,commissions:a.data}),$(C.data);let c=f?.referral_code;if(!c){c=V();const{error:_}=await j.from("settings").update({referral_code:c}).eq("user_id",t.id);_&&console.error("Erro ao salvar código de referral:",_)}c&&B(`${window.location.origin}/signup?ref=${c}`)}catch(s){d({title:"Erro ao buscar dados de afiliados",description:s.message,variant:"destructive"})}finally{w(!1)}}},[t,f,d]);n.useEffect(()=>{k()},[k]);const F=()=>{navigator.clipboard.writeText(y),d({title:"Link copiado!",description:"Seu link de indicação foi copiado para a área de transferência."})},H=s=>{switch(s){case"registered":return e.jsx(S,{className:"w-4 h-4 text-yellow-500"});case"subscribed":return e.jsx(T,{className:"w-4 h-4 text-green-500"});case"cancelled":return e.jsx(W,{className:"w-4 h-4 text-red-500"});default:return null}},U=s=>({registered:"Registrado",subscribed:"Assinante",cancelled:"Cancelado"})[s]||s,z=s=>({pending:"Pendente",paid:"Paga",cancelled:"Cancelada"})[s]||s,h={totalReferrals:l.referrals.length,subscribedReferrals:l.referrals.filter(s=>s.status==="subscribed").length,pendingCommissions:l.commissions.filter(s=>s.status==="pending").reduce((s,a)=>s+Number(a.amount),0),paidCommissions:l.commissions.filter(s=>s.status==="paid").reduce((s,a)=>s+Number(a.amount),0)};return b?e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx(O,{className:"w-8 h-8 animate-spin"})}):e.jsxs("div",{className:"container mx-auto p-4 space-y-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-foreground titulo-gradiente flex items-center gap-2",children:[e.jsx(Q,{className:"w-8 h-8"}),"Programa de Afiliados"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Indique amigos e ganhe comissões por cada novo assinante."})]}),e.jsxs(R,{onClick:()=>window.open(N?.program_rules,"_blank"),variant:"outline",children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Ver Regras do Programa"]})]}),e.jsxs(o,{className:"bg-card/50 backdrop-blur-sm shadow-lg",children:[e.jsxs(m,{children:[e.jsx(x,{children:"Seu Link de Indicação"}),e.jsx(v,{children:"Compartilhe este link para começar a ganhar."})]}),e.jsx(u,{children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:y,readOnly:!0,className:"bg-muted"}),e.jsx(R,{onClick:F,size:"icon",children:e.jsx(se,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(p,{title:"Total de Indicados",value:h.totalReferrals,icon:J,description:"Pessoas que se cadastraram com seu link."}),e.jsx(p,{title:"Indicados Assinantes",value:h.subscribedReferrals,icon:T,description:"Indicados que se tornaram assinantes."}),e.jsx(p,{title:"Comissão Pendente",value:`R$ ${h.pendingCommissions.toFixed(2)}`,icon:S,description:"Comissões aguardando liberação."}),e.jsx(p,{title:"Total Pago",value:`R$ ${h.paidCommissions.toFixed(2)}`,icon:ae,description:"Valor total de comissões pagas."})]}),e.jsxs(Y,{defaultValue:"referrals",children:[e.jsxs(Z,{className:"grid w-full grid-cols-2",children:[e.jsx(P,{value:"referrals",children:"Minhas Indicações"}),e.jsx(P,{value:"commissions",children:"Minhas Comissões"})]}),e.jsx(q,{value:"referrals",children:e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Indicados"}),e.jsx(v,{children:"Acompanhe o status de todas as pessoas que você indicou."})]}),e.jsx(u,{children:e.jsxs(A,{children:[e.jsx(D,{children:e.jsxs(g,{children:[e.jsx(r,{children:"Nome"}),e.jsx(r,{children:"Email"}),e.jsx(r,{children:"Data de Cadastro"}),e.jsx(r,{children:"Status"})]})}),e.jsx(E,{children:l.referrals.map(s=>e.jsxs(g,{children:[e.jsx(i,{children:s.referred_name||"Não informado"}),e.jsx(i,{children:s.referred_email}),e.jsx(i,{children:I(new Date(s.created_at),"dd/MM/yyyy",{locale:L})}),e.jsxs(i,{className:"flex items-center gap-2",children:[H(s.status),U(s.status)]})]},s.id))})]})})]})}),e.jsx(q,{value:"commissions",children:e.jsxs(o,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Comissões"}),e.jsx(v,{children:"Veja o histórico de suas comissões."})]}),e.jsx(u,{children:e.jsxs(A,{children:[e.jsx(D,{children:e.jsxs(g,{children:[e.jsx(r,{children:"Indicado"}),e.jsx(r,{children:"Valor"}),e.jsx(r,{children:"Data Liberação"}),e.jsx(r,{children:"Status"})]})}),e.jsx(E,{children:l.commissions.map(s=>e.jsxs(g,{children:[e.jsx(i,{children:s.referral?.referred_name||s.referral?.referred_email||"N/A"}),e.jsxs(i,{children:["R$ ",Number(s.amount).toFixed(2)]}),e.jsx(i,{children:I(new Date(s.due_date),"dd/MM/yyyy",{locale:L})}),e.jsx(i,{children:z(s.status)})]},s.id))})]})})]})})]}),e.jsxs(o,{className:"bg-blue-900/20 border-blue-500",children:[e.jsx(m,{children:e.jsx(x,{children:"Como Funciona?"})}),e.jsxs(u,{className:"space-y-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"1"}),e.jsx("p",{children:"Compartilhe seu link de indicação único com amigos, colegas e em suas redes sociais."})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"2"}),e.jsx("p",{children:"Quando alguém se cadastra e se torna um assinante pago (plano Pro ou superior) através do seu link, você ganha uma comissão."})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"3"}),e.jsxs("p",{children:["Sua comissão é de ",e.jsxs("strong",{children:[N?.commission_percentage||0,"%"]})," sobre o valor da primeira mensalidade paga pelo seu indicado."]})]}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0 bg-blue-500/20 text-blue-300 rounded-full h-8 w-8 flex items-center justify-center",children:"4"}),e.jsxs("p",{children:["A comissão fica pendente por ",e.jsxs("strong",{children:[N?.payout_waiting_days||0," dias"]})," (período de garantia) e depois é liberada para saque."]})]})]})]})]})};export{ce as default};
