import{c as Pe,b as oe,j as e,m as Q,a6 as _,B as I,K as re,N as ne,ax as Ie,O as le,P as ee,ay as Be,ad as Fe,C as Ce,az as ze,D as De,aA as Ge,ae as We,U as ie,R as L,aB as _e,a5 as ce,T as Se,ab as Z,J as U,q as de,t as ue,v as Ae,aC as he,x as me,S as ke,aD as Ee,Q as qe,V as He,W as Ve,X as Ue,Y as Ye,a2 as Qe,a9 as Je,a3 as Me,e as Re,aE as V,p as Ke,aF as Xe,aG as Te,r as z,aH as ae,aI as xe,aJ as pe,aK as fe,aL as ge,aM as be,ag as Ze}from"./index-DosJhT9z.js";import{r as ve}from"./index-DkFdzkCr.js";import{T as et,a as tt,b as at,c as st}from"./tooltip-CeT8TWZO.js";import{E as ot}from"./eye-off-CPIOUVAy.js";import{E as rt}from"./eye-3aWynsIM.js";import{S as Le}from"./settings-BxYDetoK.js";import{u as $e}from"./useCardHoverEffect-B8hNuXWS.js";import{B as nt,S as A}from"./skeleton-Dtyu7jfQ.js";import{R as lt}from"./receipt-BUqmdCXQ.js";import{L as it}from"./landmark-6XeQXr0E.js";import{S as ct}from"./shield-check-sf02tfQl.js";import{T as dt}from"./trending-down-C0IVpLP_.js";import{T as ut}from"./trending-up-B1oXkSIa.js";import{T as mt}from"./target-B9JN3CdB.js";import{P as ht,B as xt,a as pt}from"./PieChart-C-IAs_Ju.js";import{A as ft,b as gt,c as bt,d as vt,e as jt,f as yt,g as wt,h as Nt}from"./alert-dialog-DPQNfubJ.js";import{L as Ct}from"./list-Cu720GNL.js";import{M as Dt}from"./more-vertical-DzrPyr0B.js";import{P as _t}from"./pen-square-B4TDd2Gh.js";import{p as Y}from"./pt-BR-Dqdi3X7i.js";import{C as St}from"./cake-CkTIRtdz.js";import{P as At}from"./progress-CNZ4UlLz.js";import{B as kt}from"./badge-Bl6V8i8p.js";import{i as je}from"./isSameMonth-BV_HUrDZ.js";import{s as Oe}from"./subMonths-BGQdG8An.js";import{G as Et}from"./grip-vertical-B6fgvkWV.js";import"./index-Chjiymov.js";import"./index-CTvT0PJr.js";import"./extends-CF3RwP-h.js";const Mt=Pe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),Rt=({greeting:a,isPersonalizing:o,isSaving:c,onPersonalizeToggle:d,onSave:u,onCancel:n,onAddCard:l,initialCardConfigMemo:r,visibleCards:h,onResetLayout:x,onToggleBalances:s,showBalances:b,showGreetings:j})=>{const y=Object.keys(r).filter(S=>!h.includes(S)),{isMobile:k}=oe();return e.jsxs("div",{className:"dashboard-header-container flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4",children:[e.jsxs(Q.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"dashboard-greeting-container mb-4 sm:mb-0",children:[e.jsx("h1",{className:_("text-2xl md:text-3xl font-bold text-foreground",j&&"titulo-gradiente-animado"),children:a}),e.jsx("p",{className:"text-muted-foreground dashboard-subtitle",children:"Aqui está um resumo do seu negócio hoje."})]}),e.jsxs("div",{className:"dashboard-controls-container flex items-center space-x-2",children:[!k&&e.jsx(et,{children:e.jsxs(tt,{children:[e.jsx(at,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",onClick:s,children:b?e.jsx(ot,{className:"h-5 w-5"}):e.jsx(rt,{className:"h-5 w-5"})})}),e.jsx(st,{children:e.jsx("p",{children:b?"Ocultar saldos":"Mostrar saldos"})})]})}),o?e.jsxs(Q.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},className:"flex items-center space-x-2",children:[e.jsxs(re,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(I,{variant:"outline",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"})," Adicionar Card"]})}),e.jsx(le,{children:y.length>0?y.map(S=>e.jsx(ee,{onClick:()=>l(S),children:r[S].title},S)):e.jsx(ee,{disabled:!0,children:"Todos os cards visíveis"})})]}),e.jsxs(I,{variant:"outline",onClick:x,children:[e.jsx(Mt,{className:"w-4 h-4 mr-2"})," Redefinir"]}),e.jsxs(I,{variant:"outline",onClick:n,children:[e.jsx(Be,{className:"w-4 h-4 mr-2"})," Cancelar"]}),e.jsxs(I,{onClick:u,disabled:c,className:"bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"})," ",c?"Salvando...":"Concluir"]})]}):!k&&e.jsxs(I,{variant:"outline",onClick:d,className:"dashboard-personalize-button",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"})," Personalizar"]})]})]})},Tt={DollarSign:De,TrendingUp:ut,TrendingDown:dt,ShieldCheck:ct,Landmark:it,Wallet:ze,Receipt:lt,BarChart:nt,Calendar:Ce},Lt=({title:a,value:o,icon:c,color:d,onClick:u,isPersonalizing:n,layout:l,iconUrl:r})=>{const h=$e(),x=Tt[c]||De;oe();const b=(()=>{if(!l)return{title:"text-[11px]",value:"text-xl",icon:"w-3.5 h-3.5"};const{h:y,w:k}=l;return y<=1||k<=2?{title:"text-[10px] leading-tight",value:"text-base",icon:"w-3 h-3"}:k<=3?{title:"text-[11px] leading-tight",value:"text-xl",icon:"w-3.5 h-3.5"}:{title:"text-xs",value:"text-2xl",icon:"w-4 h-4"}})(),j={initial:{opacity:0,y:20},animate:{opacity:1,y:0}};return e.jsxs(Q.div,{ref:h,variants:j,initial:"initial",animate:"animate",transition:{duration:.3},className:_("bg-card rounded-xl shadow-sm border border-border/50 p-3 flex flex-col justify-between h-full card-hover-effect",!n&&"cursor-pointer"),onClick:n?void 0:u,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:_("font-medium text-muted-foreground truncate",b.title),title:a,children:a}),r?e.jsx("img",{src:r,alt:a,className:_(b.icon,"object-contain")}):e.jsx(x,{className:_(b.icon,d)})]}),e.jsx("div",{children:e.jsx("p",{className:_("font-bold text-foreground truncate",b.value),title:typeof o=="string"&&o.startsWith("R$")?o:"",children:o})})]})},$t={Users:ie,FileText:We,Briefcase:Ge,Target:mt,Calendar:Ce},Ot=({title:a,value:o,icon:c,iconColor:d,onClick:u,isPersonalizing:n,layout:l})=>{const r=$e(),h=$t[c]||ie;oe();const s=(()=>{if(!l)return{value:"text-lg",title:"text-xs",iconContainer:"w-7 h-7 mb-1",icon:"w-4 h-4"};const{h:b,w:j}=l;return b<=1||j<=2?{value:"text-base",title:"text-[10px] leading-tight",iconContainer:"w-6 h-6 mb-0.5",icon:"w-3.5 h-3.5"}:{value:"text-lg",title:"text-xs",iconContainer:"w-7 h-7 mb-1",icon:"w-4 h-4"}})();return e.jsxs(Q.div,{ref:r,layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-card rounded-xl p-3 shadow-sm border border-border/50 text-center card-hover-effect relative h-full flex flex-col justify-center items-center",onClick:n?void 0:u,style:{cursor:n?"grab":"pointer"},children:[e.jsx("div",{className:_("rounded-lg flex items-center justify-center mx-auto",s.iconContainer),children:e.jsx(h,{className:_(s.icon,d)})}),e.jsx("p",{className:_("font-bold text-foreground",s.value),children:o}),e.jsx("p",{className:_("text-muted-foreground mt-0.5",s.title),children:a})]})},Pt={BarChart2:_e,PieChart:ht,List:Ct},It=({title:a,icon:o,color:c,chartData:d,chartType:u,onClick:n,isPersonalizing:l,deleteTransaction:r,setActiveTab:h,isDemo:x=!1,layout:s})=>{const b=Pt[o]||_e,[j,y]=L.useState(!1),[k,S]=L.useState(null),E=f=>{S(f),y(!0)},G=()=>{k&&r&&r(k),y(!1),S(null)},R=()=>{y(!1),S(null)},W=f=>{if(!f)return"N/A";try{const T=Z(f);return isNaN(T.getTime())?"Data inválida":U(T,"dd/MM/yy",{locale:Y})}catch{return"Data inválida"}},O=(()=>{if(!s)return{title:"text-sm",icon:"w-4 h-4",listText:"text-xs",listValue:"text-xs"};const{h:f,w:T}=s;return T<=2?{title:"text-[11px]",icon:"w-3.5 h-3.5",listText:"text-[10px]",listValue:"text-[11px]"}:f<=3||T<=4?{title:"text-xs",icon:"w-3.5 h-3.5",listText:"text-[11px]",listValue:"text-xs"}:{title:"text-sm",icon:"w-4 h-4",listText:"text-xs",listValue:"text-sm"}})(),P=()=>d?u==="bar"?e.jsx(xt,{chartData:d,isCompact:s?.h<=3||s?.w<=4}):u==="pie"?e.jsx(pt,{chartData:d,isCompact:s?.h<=3||s?.w<=2}):u==="list"?d.items?d.items.length===0?e.jsx("p",{className:"text-center text-muted-foreground text-xs py-4",children:"Nenhum lançamento recente."}):e.jsx(ce,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-2",children:d.items.map((f,T)=>{const B=()=>{!x&&h&&h("financial",{modal:"editTransaction",transactionId:f.id})};return e.jsxs("div",{onClick:B,className:"flex items-center justify-between p-1.5 rounded-md transition-all duration-200 ease-in-out "+(f.tipo==="ENTRADA"?"bg-green-500/10 hover:bg-green-500/20":"bg-red-500/10 hover:bg-red-500/20"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:_("font-medium text-foreground truncate",O.listText),title:f.descricao,children:f.descricao}),e.jsxs("p",{className:_("text-muted-foreground",O.listText),children:[W(f.date)," - ",f.status]})]}),e.jsxs("div",{className:"flex items-center ml-1",onClick:F=>F.stopPropagation(),children:[e.jsxs("p",{className:_("font-semibold mr-1",O.listValue,f.tipo==="ENTRADA"?"text-customGreen":"text-red-500"),children:[f.tipo==="SAIDA"?"- R$":"+ R$",Number(f.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),!x&&r&&h&&e.jsxs(re,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(I,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 data-[state=open]:bg-muted",children:[e.jsx(Dt,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Abrir menu"})]})}),e.jsxs(le,{align:"end",children:[e.jsxs(ee,{onClick:()=>h("financial",{modal:"editTransaction",transactionId:f.id}),children:[e.jsx(_t,{className:"mr-2 h-3 w-3 text-muted-foreground/70"}),e.jsx("span",{className:"text-xs",children:"Editar"})]}),e.jsxs(ee,{onClick:()=>E(f.id),className:"text-red-600 dark:text-red-400 hover:!text-red-600 dark:hover:!text-red-400",children:[e.jsx(Se,{className:"mr-2 h-3 w-3 text-muted-foreground/70"}),e.jsx("span",{className:"text-xs",children:"Excluir"})]})]})]})]})]},f.id||T)})})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Carregando..."}):e.jsx("p",{className:"text-center text-muted-foreground text-xs py-4",children:"Tipo de gráfico desconhecido."}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Carregando..."});return e.jsxs(e.Fragment,{children:[e.jsxs(Q.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`bg-card rounded-xl shadow-sm border border-border/50 overflow-hidden flex flex-col h-full p-3 ${l?"cursor-grab active:cursor-grabbing":""}`,children:[e.jsx("div",{className:"flex items-center justify-between pb-2 mb-2 border-b border-border/50",onClick:!l&&n?n:void 0,style:{cursor:!l&&n?"pointer":"default"},children:e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx(b,{className:_("mr-2 shrink-0",O.icon,c||"text-primary")}),e.jsx("h3",{className:_("font-semibold text-foreground truncate",O.title),children:a})]})}),e.jsxs("div",{className:"flex-grow relative cursor-pointer hover:bg-accent/30",children:[x&&u!=="list"&&e.jsx("div",{className:"absolute top-0 left-0 w-full text-center z-10",children:e.jsx("p",{className:"text-xs text-muted-foreground bg-card/50 backdrop-blur-sm px-2 py-0.5 rounded-full inline-block",children:"Gráfico demonstrativo"})}),P()]})]}),e.jsx(ft,{open:j,onOpenChange:y,children:e.jsxs(gt,{children:[e.jsxs(bt,{children:[e.jsx(vt,{children:"Confirmar Exclusão"}),e.jsx(jt,{children:"Tem certeza que deseja excluir este lançamento? Esta ação não pode ser desfeita."})]}),e.jsxs(yt,{children:[e.jsx(wt,{onClick:R,children:"Cancelar"}),e.jsx(Nt,{onClick:G,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})},Bt=({icon:a,title:o,description:c,date:d,color:u,reminder:n,onFollowUp:l,layout:r})=>{const x=!r||r.h>=4?{icon:"w-3.5 h-3.5",title:"text-xs",desc:"text-[11px]"}:{icon:"w-3 h-3",title:"text-[11px]",desc:"text-[10px]"};return e.jsxs(Q.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-start space-x-2 p-1.5 mb-1 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:_("p-1.5 rounded-full text-primary-foreground",u,r?.h<4&&"p-1"),children:a&&e.jsx(a,{className:x.icon})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:_("font-semibold text-foreground truncate",x.title),children:o}),e.jsx("p",{className:_("text-muted-foreground mt-0.5 truncate",x.desc),children:c}),d&&e.jsxs("p",{className:_("text-muted-foreground italic",x.desc),children:["Data:"," ",U(Z(d),"dd/MM",{locale:Y})]})]}),l&&e.jsx("button",{onClick:()=>l(n),className:"p-1 hover:bg-green-50 hover:text-green-600 rounded-full transition-all duration-200",title:"Entrar em contato via WhatsApp",children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/16566/16566143.png",alt:"WhatsApp",className:"w-4 h-4"})})]})},Ft=({reminders:a,isLoading:o,isDemo:c=!1,layout:d,onFollowUp:u})=>{const n=s=>{if(s.icon)return{icon:s.icon,title:s.title,description:s.description,date:s.date,color:s.color||"bg-primary"};switch(s.type){case"BIRTHDAY":return{icon:Ee,title:`Aniversário de ${s.clientName}`,description:"Envie uma mensagem ou cupom.",date:s.date,color:"bg-pink-500"};case"WEDDING_ANNIVERSARY":return{icon:ke,title:`Aniv. Casamento: ${s.clientName}`,description:"Ofereça um ensaio de casal.",date:s.date,color:"bg-red-500"};case"CHILD_BIRTHDAY":return{icon:St,title:`Aniv. de ${s.childName||"Filho(a)"}`,description:"Sugira um ensaio em família.",date:s.date,color:"bg-blue-500"};default:return{icon:he,title:"Lembrete",description:s.clientName,date:s.date,color:"bg-primary"}}},l=[{type:"BIRTHDAY",clientName:"Ana Silva",date:new Date(new Date().setDate(new Date().getDate()+5)).toISOString()},{type:"WEDDING_ANNIVERSARY",clientName:"Carlos e Bia",date:new Date(new Date().setDate(new Date().getDate()+12)).toISOString()}],r=c?l:a,x=!d||d.h>=4?{title:"text-sm",icon:"w-4 h-4"}:{title:"text-xs",icon:"w-3.5 h-3.5"};return e.jsxs(de,{className:"h-full flex flex-col shadow-sm border-border bg-card/80 backdrop-blur-sm p-3",children:[e.jsx(ue,{className:"flex flex-row items-center justify-between space-y-0 pb-2 px-0 pt-0 border-b border-border/50 mb-2",children:e.jsxs(Ae,{className:_("font-semibold text-foreground flex items-center",x.title),children:[e.jsx(he,{className:_("mr-2",x.icon,"text-button-primary-foreground")}),"Lembretes e Oportunidades"]})}),e.jsx(me,{className:"px-0 pb-0 flex-grow overflow-hidden",children:o?e.jsx("div",{className:"space-y-3 pt-2",children:[...Array(3)].map((s,b)=>e.jsxs("div",{className:"flex items-start space-x-3 p-1 rounded-lg",children:[e.jsx(A,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(A,{className:"h-4 w-3/4"}),e.jsx(A,{className:"h-3 w-full"})]})]},b))}):r&&r.length>0?e.jsx(ce,{className:"h-full pr-2",children:e.jsx("div",{className:"pt-1",children:r.map((s,b)=>{const j=n(s);return e.jsx(Bt,{...j,reminder:s,onFollowUp:u,layout:d},b)})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground p-2",children:[e.jsx(ie,{className:"w-6 h-6 mb-2"}),e.jsx("p",{className:"text-xs font-medium",children:"Nenhum lembrete!"}),e.jsx("p",{className:"text-[10px]",children:"Cadastre as datas dos clientes."})]})})]})},zt=({goals:a,onClick:o,isDemo:c=!1,isLoading:d=!1})=>e.jsxs(de,{className:"bg-card/80 backdrop-blur-sm border border-border rounded-xl shadow-sm h-full flex flex-col",onClick:o,style:{cursor:o?"pointer":"default"},children:[e.jsx(ue,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(Ae,{className:"text-sm font-medium",children:"Resumo das Metas"})}),e.jsx(me,{className:"flex-1 space-y-4",children:d?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Carregando metas..."}):!a||a.length===0?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Nenhuma meta cadastrada."}):a.map(u=>{const n=u.saldo_atual/u.valor_meta*100,l=Math.min(Math.max(n,0),100),r=u.saldo_atual>=u.valor_meta?"bg-customGreen":"bg-primary";return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs font-medium",children:u.nome||u.name}),e.jsxs(kt,{variant:"outline",className:"text-xs border-border",children:[l.toFixed(1),"%"]})]}),e.jsx(At,{value:l,indicatorClassName:r})]},u.id||u.name)})})]}),ye=()=>e.jsx("div",{className:"bg-card rounded-xl p-4 sm:p-6 shadow-lg border border-border h-full flex flex-col justify-center",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{className:"h-4 w-24 mb-2"}),e.jsx(A,{className:"h-8 w-32"})]}),e.jsx(A,{className:"w-12 h-12 rounded-lg"})]})}),Gt=()=>e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-lg border border-border text-center h-full flex flex-col justify-center items-center",children:[e.jsx(A,{className:"w-10 h-10 rounded-lg mx-auto mb-2"}),e.jsx(A,{className:"h-7 w-16 mx-auto mb-1"}),e.jsx(A,{className:"h-4 w-20 mx-auto"})]}),we=({isList:a=!1})=>e.jsxs("div",{className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-3"}),e.jsx(A,{className:"h-5 w-32"})]})}),e.jsx("div",{className:"p-2 sm:p-4 flex-grow",children:a?e.jsx("div",{className:"space-y-3 px-2 py-2",children:[...Array(4)].map((o,c)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(A,{className:"h-4 w-4/5 mb-2"}),e.jsx(A,{className:"h-3 w-1/3"})]}),e.jsx("div",{className:"flex items-center ml-2",children:e.jsx(A,{className:"h-5 w-20"})})]},c))}):e.jsx(A,{className:"h-full w-full"})})]}),Wt=()=>e.jsxs(de,{className:"h-full flex flex-col shadow-lg border-border bg-card/80 backdrop-blur-sm",children:[e.jsx(ue,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pt-4 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),e.jsx(A,{className:"h-5 w-48"})]})}),e.jsx(me,{className:"px-2 pb-4 flex-grow overflow-hidden",children:e.jsx("div",{className:"space-y-3 p-2",children:[...Array(3)].map((a,o)=>e.jsxs("div",{className:"flex items-start space-x-3 p-1 rounded-lg",children:[e.jsx(A,{className:"w-9 h-9 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(A,{className:"h-4 w-3/4"}),e.jsx(A,{className:"h-3 w-full"})]})]},o))})})]});function qt(a,o,c,d,u){const n=new Date,l=a.filter(t=>t.status==="PAGO"),r=l.filter(t=>je(Z(t.data_recebimento||t.data||t.created_at),n)),h=l.filter(t=>t.tipo==="ENTRADA").reduce((t,m)=>t+(Number(m.valor)||0),0),x=l.filter(t=>t.tipo==="SAIDA").reduce((t,m)=>t+(Number(m.valor)||0),0),s=r.filter(t=>t.tipo==="ENTRADA").reduce((t,m)=>t+(Number(m.valor)||0),0),b=r.filter(t=>t.tipo==="SAIDA"&&t.category!=="Pró-labore").reduce((t,m)=>t+(Number(m.valor)||0),0),j=r.filter(t=>t.tipo==="SAIDA"&&t.category==="Pró-labore").reduce((t,m)=>t+(Number(m.valor)||0),0),y=s-b,k=o.filter(t=>t.status!=="concluido"&&t.status!=="arquivado").reduce((t,m)=>t+(m.pending_amount||0),0)+a.filter(t=>t.tipo==="ENTRADA"&&t.status==="PENDENTE").reduce((t,m)=>t+(Number(m.valor)||0),0),S=a.filter(t=>t.tipo==="SAIDA"&&t.status==="PENDENTE"&&new Date(t.data_vencimento)>n).reduce((t,m)=>t+(Number(m.valor)||0),0),E=a.filter(t=>t.status==="AGUARDANDO_LIBERACAO"&&new Date(t.release_date)>n).reduce((t,m)=>t+(Number(m.valor)||0),0);let G=0;if(d?.regime_tributario==="mei")G=Number(d.valor_fixo_mei)||0;else if(d?.regime_tributario==="simples"&&d.aliquotas_simples_nacional){const t=d.aliquotas_simples_nacional.find(m=>s<=m.faixa_faturamento)?.aliquota||0;G=s*t/100}const R=h-x,W=o.filter(t=>t.status==="em-andamento").length,$=o.filter(t=>t.date&&je(Z(t.date),n)).length,O=["arquivado","excluido","cancelado","perdido"],P=["em-andamento","concluido","negocio-fechado"],f=(o||[]).filter(t=>!O.includes((t.status||"").toLowerCase())),T=f.filter(t=>P.includes((t.status||"").toLowerCase())),B=f.length,F=T.length,J=B>0?F/B*100:0,K=(u||[]).reduce((t,m)=>t+(Number(m.depreciacao_mensal)||0),0),N={},v={};for(let t=5;t>=0;t--){const m=Oe(n,t),g=`${m.getMonth()+1}/${m.getFullYear()}`;N[g]=0,v[g]=0}l.forEach(t=>{const m=Z(t.data_recebimento||t.data||t.created_at),g=`${m.getMonth()+1}/${m.getFullYear()}`;Object.prototype.hasOwnProperty.call(N,g)&&(t.tipo==="ENTRADA"?N[g]+=Number(t.valor)||0:t.tipo==="SAIDA"&&(v[g]+=Number(t.valor)||0))});let p=0;if(Array.isArray(c)&&Array.isArray(a)){const t=new Date,m=new Set;a.forEach(g=>{if(g.tipo==="ENTRADA"&&g.status==="PENDENTE"){const w=g.data_vencimento||g.data,C=w?new Date(w):null;(!C||C<t)&&m.add(g.cliente_id||g.clienteId)}}),p=Array.from(m).filter(g=>g!=null).length}const i=Array.isArray(c)?c.length:0;return{revenueThisMonth:s,expensesThisMonth:b,profitThisMonth:y,pendingToReceive:k,futurePendingPayments:S,estimatedTax:G,proLaboreThisMonth:j,netBalance:R,workInProgress:W,scheduledThisMonth:$,conversionRate:J,monthlyDepreciation:K,awaitingRelease:E,monthlyRevenue:N,monthlyExpenses:v,clientsInadimplentes:p,totalClients:i,validLeadsCount:B,convertedLeadsCount:F}}const q=(a,o,c,d,u,n=[])=>{switch(a){case"grafico_faturamento":{if(!o||!o.monthlyRevenue)return{labels:[],datasets:[]};const l=o.monthlyRevenue,r=Object.keys(l).sort((h,x)=>{const[s,b]=h.split("/"),[j,y]=x.split("/");return new Date(b,s-1)-new Date(y,j-1)});return{labels:r.map(h=>{const[x,s]=h.split("/"),b=new Date(s,x-1);return U(b,"MMM/yy",{locale:Y})}),datasets:[{label:"Faturamento",data:r.map(h=>l[h]),backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1,tension:.4}]}}case"grafico_despesas_faturamento":{if(!o||!o.monthlyRevenue||!o.monthlyExpenses)return{labels:[],datasets:[]};const l=o.monthlyRevenue,r=o.monthlyExpenses,h=Object.keys(l).sort((x,s)=>{const[b,j]=x.split("/"),[y,k]=s.split("/");return new Date(j,b-1)-new Date(k,y-1)});return{labels:h.map(x=>{const[s,b]=x.split("/"),j=new Date(b,s-1);return U(j,"MMM/yy",{locale:Y})}),datasets:[{label:"Faturamento",data:h.map(x=>l[x]),backgroundColor:"rgba(34, 197, 94, 0.6)",borderColor:"rgba(34, 197, 94, 1)",borderWidth:1},{label:"Despesas",data:h.map(x=>r[x]),backgroundColor:"rgba(239, 68, 68, 0.6)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:1}]}}case"grafico_despesas_lucro":{if(!o||!o.monthlyRevenue||!o.monthlyExpenses)return{labels:[],datasets:[]};const l=o.monthlyRevenue,r=o.monthlyExpenses,h=Object.keys(l).sort((x,s)=>{const[b,j]=x.split("/"),[y,k]=s.split("/");return new Date(j,b-1)-new Date(k,y-1)});return{labels:h.map(x=>{const[s,b]=x.split("/"),j=new Date(b,s-1);return U(j,"MMM/yy",{locale:Y})}),datasets:[{label:"Lucro",data:h.map(x=>l[x]-r[x]),backgroundColor:"rgba(52, 211, 153, 0.6)",borderColor:"rgba(52, 211, 153, 1)",borderWidth:1},{label:"Despesas",data:h.map(x=>r[x]),backgroundColor:"rgba(234, 179, 8, 0.6)",borderColor:"rgba(234, 179, 8, 1)",borderWidth:1}]}}case"grafico_conversao_leads":{let l=o?.validLeadsCount,r=o?.convertedLeadsCount;if(typeof l!="number"||typeof r!="number"){if(!Array.isArray(c))return{labels:[],datasets:[]};const x=["arquivado","excluido","cancelado","perdido"],s=["em-andamento","concluido","negocio-fechado"],b=(c||[]).filter(y=>!x.includes((y.status||"").toLowerCase())),j=b.filter(y=>s.includes((y.status||"").toLowerCase()));l=b.length,r=j.length}const h=l-r;return l===0?{labels:["Sem dados"],datasets:[{data:[1],backgroundColor:["#E5E7EB"]}]}:{labels:["Convertidos","Não convertidos"],datasets:[{label:"Conversão de Leads",data:[r,h],backgroundColor:["rgba(59, 130, 246, 0.6)","rgba(156, 163, 175, 0.6)"],borderColor:["rgba(59, 130, 246, 1)","rgba(156, 163, 175, 1)"],borderWidth:1}]}}case"grafico_inadimplentes":{if(!o||typeof o.clientsInadimplentes!="number"||typeof o.totalClients!="number")return{labels:[],datasets:[]};const l=o.clientsInadimplentes,r=o.totalClients;if(r===0)return{labels:["Sem clientes"],datasets:[{data:[1],backgroundColor:["#E5E7EB"]}]};const h=Math.max(r-l,0);return{labels:["Inadimplentes","Outros"],datasets:[{label:"Clientes",data:[l,h],backgroundColor:["rgba(239, 68, 68, 0.6)","rgba(156, 163, 175, 0.6)"],borderColor:["rgba(239, 68, 68, 1)","rgba(156, 163, 175, 1)"],borderWidth:1}]}}case"status_trabalhos":{const l=(c||[]).reduce((r,h)=>{const x=h.status||"sem-status";return r[x]=(r[x]||0)+1,r},{});return{labels:Object.keys(l),datasets:[{label:"Status dos Trabalhos",data:Object.values(l),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]}}case"ultimos_lancamentos":return{items:(d||[]).slice().sort((r,h)=>{const x=r.created_at?new Date(r.created_at):new Date(r.data_recebimento||r.data||0);return(h.created_at?new Date(h.created_at):new Date(h.data_recebimento||h.data||0))-x}).slice(0,10).map(r=>({...r,date:r.data,wallet:(n||[]).find(h=>h.id===r.wallet_id)}))};default:return{labels:[],datasets:[]}}},Ht={labels:[],datasets:[{data:[]}]},Vt=a=>{if(a==="grafico_faturamento"){const o=[],c=[],d=[],u=new Date;for(let n=5;n>=0;n--){const l=Oe(u,n);o.push(U(l,"MMM/yy",{locale:Y})),c.push(Math.floor(Math.random()*5001)+2e3),d.push(Math.floor(Math.random()*2501)+500)}return{labels:o,datasets:[{label:"Faturamento",data:c,backgroundColor:"rgba(52, 211, 153, 0.7)",borderColor:"rgba(52, 211, 153, 1)",borderWidth:1,borderRadius:4,barPercentage:.6,categoryPercentage:.7},{label:"Saídas",data:d,backgroundColor:"rgba(239, 68, 68, 0.7)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:1,borderRadius:4,barPercentage:.6,categoryPercentage:.7}]}}if(a==="status_trabalhos"){const o=["Novos Leads","Propostas Enviadas","Em Andamento","Concluídos"],c=[5,3,8,12],d=["rgba(59, 130, 246, 0.7)","rgba(234, 179, 8, 0.7)","rgba(139, 92, 246, 0.7)","rgba(16, 185, 129, 0.7)"],u=d.map(n=>n.replace("0.7","1"));return{labels:o,datasets:[{label:"Status dos Trabalhos",data:c,backgroundColor:d,borderColor:u,borderWidth:1}]}}return a==="ultimos_lancamentos"?{items:[{id:"demo1",descricao:"Ensaio Fotográfico - Família Silva",valor:850,tipo:"ENTRADA",status:"PAGO",date:new Date().toISOString()},{id:"demo2",descricao:"Assinatura Adobe Creative Cloud",valor:275,tipo:"SAIDA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-2)).toISOString()},{id:"demo3",descricao:"Casamento - Joana e Pedro (Entrada)",valor:2500,tipo:"ENTRADA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-5)).toISOString()},{id:"demo4",descricao:"Aluguel do Estúdio",valor:600,tipo:"SAIDA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-7)).toISOString()}]}:Ht},Ut=()=>[{id:"demo_goal_1",nome_meta:"Comprar Nova Lente",valor_meta:5e3,saldo_atual:1750,icone:"Camera"},{id:"demo_goal_2",nome_meta:"Fundo de Emergência",valor_meta:1e4,saldo_atual:4500,icone:"Shield"},{id:"demo_goal_3",nome_meta:"Viagem de Férias",valor_meta:8e3,saldo_atual:8e3,icone:"Plane"}],Ne={payment_overdue:a=>[`Olá ${a.clientName}, estou passando para lembrar que o pagamento referente ao seu serviço ${a.service} no valor de ${a.amount} está atrasado. Por favor, entre em contato para regularizar.`,`Olá ${a.clientName}, seu pagamento de ${a.amount} referente a ${a.service} está vencido. Caso já tenha quitado, desconsidere. Do contrário, preciso que regularize, tudo bem?`],payment_due:a=>[`Olá ${a.clientName}, tudo bem? O pagamento referente ao seu serviço ${a.service} no valor de ${a.amount} vence em ${a.dueInDays} dia(s). Estou à disposição para dúvidas.`,`Oi ${a.clientName}! Lembrando que seu pagamento de ${a.amount} (${a.service}) vence em ${a.dueInDays} dia(s). Qualquer coisa estou por aqui.`],expense_overdue:a=>[`Conta ${a.service} (R$ ${a.amount}) venceu em ${a.dueDateStr}. Programe-se para regularizar.`],expense_due:a=>[`Alerta: sua conta ${a.service} no valor de R$ ${a.amount} vence em ${a.dueInDays} dia(s).`],birthday:a=>[`Olá ${a.clientName}, feliz aniversário! Desejo muitas felicidades e sucesso. Se precisar de um ensaio fotográfico, estarei à disposição com condições especiais!`,`Feliz aniversário, ${a.clientName}! Que tal aproveitar a data para registrar esse momento com um ensaio exclusivo?`],default:a=>[`Olá ${a.clientName}, tudo bem?`]},Yt=({open:a,onOpenChange:o,reminder:c})=>{const d=L.useMemo(()=>{if(!c)return[];const r=c.reminderType||"default";return(Ne[r]||Ne.default)(c)},[c]),[u,n]=L.useState("");L.useEffect(()=>{d&&d.length>0&&n(d[0])},[d]);const l=()=>{if(!u||!c?.clientPhone)return;const h=`https://wa.me/${c.clientPhone.replace(/\D/g,"")}?text=${encodeURIComponent(u)}`;window.open(h,"_blank"),o(!1)};return c?e.jsx(qe,{open:a,onOpenChange:o,children:e.jsxs(He,{className:"max-w-md",children:[e.jsxs(Ve,{children:[e.jsxs(Ue,{children:["Enviar mensagem para ",c.clientName]}),e.jsx(Ye,{children:"Selecione uma mensagem de follow‑up para enviar via WhatsApp."})]}),e.jsx(ce,{className:"max-h-40",children:d.map((r,h)=>e.jsx("div",{onClick:()=>n(r),className:`p-2 mb-2 border rounded-md cursor-pointer ${u===r?"bg-accent":""}`,children:r},h))}),e.jsxs(Qe,{className:"space-x-2",children:[e.jsx(Je,{asChild:!0,children:e.jsx(I,{variant:"ghost",children:"Cancelar"})}),e.jsx(I,{onClick:l,disabled:!u,children:"Enviar via WhatsApp"})]})]})}):null},Qt=({cardId:a,layout:o,isEditing:c,setActiveTab:d})=>{const{workflowCards:u,financialData:n,clients:l,settings:r,loading:h,deleteTransaction:x,refreshData:s,equipments:b,savingGoals:j,wallets:y,getWalletBalance:k}=Me(),{toast:S}=Re(),E=h||!n,R=!(n&&(n.transactions.length>0||u.length>0||l.length>0)),[W,$]=L.useState(!1),[O,P]=L.useState(null),f=L.useMemo(()=>E||!n?null:qt(n.transactions,u,l,r,b),[E,n,u,l,r,b]),T=L.useMemo(()=>{if(E||!f)return{};const v=[f,u,n.transactions,d];return{grafico_faturamento:q("grafico_faturamento",...v),grafico_despesas_faturamento:q("grafico_despesas_faturamento",...v),grafico_despesas_lucro:q("grafico_despesas_lucro",...v),grafico_conversao_leads:q("grafico_conversao_leads",...v),grafico_inadimplentes:q("grafico_inadimplentes",...v),status_trabalhos:q("status_trabalhos",...v),ultimos_lancamentos:q("ultimos_lancamentos",f,u,n.transactions,d,y)}},[E,f,u,n.transactions,d,y]),B=L.useMemo(()=>{if(E)return[];const v=new Date,p=[];return(n?.transactions||[]).forEach(i=>{if(i.status!=="PENDENTE")return;const t=i.data_vencimento||i.data||i.created_at;if(!t)return;const m=new Date(t),g=Math.floor((m-v)/(1e3*60*60*24)),w=i.tipo==="SAIDA";if(g<0||g<=7){const C=g<0?w?"expense_overdue":"payment_overdue":w?"expense_due":"payment_due",D=(l||[]).find(te=>te.id===(i.cliente_id||i.clienteId)),M=D?.nome||D?.name||"",H={id:`${C}-${t}-${M}`,icon:g<0?Ke:Xe,color:g<0?"bg-red-500":"bg-yellow-500",title:g<0?w?"Despesa vencida":"Recebimento vencido":w?"Despesa a vencer":"Recebimento a vencer",description:`${M} - ${V(i.valor)}`,date:m.toISOString(),reminderType:C,clientName:M,clientPhone:D?.celular||D?.telefone||D?.whatsapp||D?.phone||"",onFollowUp:()=>{P(H),$(!0)}};p.push(H),(g<0||g===0)&&window.dispatchEvent(new CustomEvent("addNotification",{detail:H}))}}),(l||[]).forEach(i=>{const t=i.birthday||i.data_nascimento;if(!t)return;const m=new Date(t),g=new Date(v.getFullYear(),m.getMonth(),m.getDate());g<v&&g.setFullYear(v.getFullYear()+1);const w=Math.floor((g-v)/(1e3*60*60*24));if(w>=0&&w<=7){const D={id:`birthday-${i.id}-${g.toISOString()}`,icon:Ee,color:"bg-pink-500",title:w===0?`Aniversário de ${i.nome||i.name}`:`Aniv. em ${w} dia(s): ${i.nome||i.name}`,description:"Envie uma mensagem ou oferta",date:g.toISOString(),reminderType:"birthday",clientName:i.nome||i.name||"",clientPhone:i.celular||i.telefone||i.whatsapp||i.phone||"",onFollowUp:()=>{P(D),$(!0)}};p.push(D),w===0&&window.dispatchEvent(new CustomEvent("addNotification",{detail:D}))}}),(u||[]).forEach(i=>{if(!i.date)return;const t=new Date(i.date),m=Math.floor((t-v)/(1e3*60*60*24));if(m>=0&&m<=7){const w={id:`task-${i.id||i.title}-${t.toISOString()}`,icon:ke,color:"bg-cyan-500",title:m===0?`Tarefa hoje: ${i.title||i.titulo}`:`Tarefa em ${m} dia(s): ${i.title||i.titulo}`,description:`Agendado para ${t.toLocaleDateString("pt-BR")}`,date:t.toISOString(),reminderType:"task_due",onFollowUp:()=>{P(w),$(!0)}};p.push(w),m===0&&window.dispatchEvent(new CustomEvent("addNotification",{detail:w}))}}),p.sort((i,t)=>{const m=new Date(i.date||0),g=new Date(t.date||0);return m-g}),p},[E,n?.transactions,l,u]);L.useEffect(()=>{const v=p=>{p.detail&&(P(p.detail),$(!0))};return window.addEventListener("openFollowUp",v),()=>{window.removeEventListener("openFollowUp",v)}},[]);const F=L.useCallback(v=>{if(E||!f)return"...";if(R)return v.includes("conversao")?"0.0%":"R$ 0,00";const p=r?.hide_dashboard_balances===!1,i="••••";if(v.startsWith("wallet_")){const m=v.replace("wallet_",""),g=k(m);return p?V(g):i}const t=m=>p?V(m):i;switch(v){case"saldo_geral":return t(f.netBalance);case"pagamentos_receber":return t(f.pendingToReceive);case"despesas_pagar":return t(f.futurePendingPayments);case"imposto_estimado":return t(f.estimatedTax);case"pro_labore":return t(f.proLaboreThisMonth);case"despesas_mes":return t(f.expensesThisMonth);case"lucro_mes":return t(f.profitThisMonth);case"depreciacao_mensal":return t(f.monthlyDepreciation);case"awaiting_release":return t(f.awaitingRelease);case"clientes_ativos":return l.length;case"trabalhos_em_andamento":return f.workInProgress;case"trabalhos_agendados":return f.scheduledThisMonth;case"conversao_clientes":return`${f.conversionRate.toFixed(1)}%`;default:return""}},[E,f,r?.hide_dashboard_balances,l,R,k]),J=L.useCallback(v=>R?Vt(v):E||!T[v]?{labels:[],datasets:[{data:[]}]}:T[v],[E,T,R]),K=async v=>{try{await x(v),S({title:"Lançamento excluído",description:"O lançamento foi excluído com sucesso."}),await s()}catch(p){S({title:"Erro ao excluir",description:`Não foi possível excluir o lançamento: ${p.message}`,variant:"destructive"})}},N=L.useMemo(()=>{try{return Te(d,y)[a]}catch{return null}},[d,y,a]);if(!N)return null;if(E)switch(N.type){case"stat":return e.jsx(ye,{});case"smallStat":return e.jsx(Gt,{});case"chart":return e.jsx(we,{isList:N.chartType==="list"});case"reminders":return e.jsx(Wt,{});case"goals_summary":return e.jsx(we,{isList:!0});default:return e.jsx(ye,{})}switch(N.type){case"stat":{const v=()=>{if(a==="lucro_mes"&&f){const p=f.revenueThisMonth||0,i=f.expensesThisMonth||0,t=f.profitThisMonth||0;S({title:"Lucro do mês",description:`Receitas: ${V(p)}
Despesas: ${V(i)}
Lucro: ${V(t)}`})}N.onClick&&N.onClick()};return e.jsx(Lt,{title:N.title,value:F(a),icon:N.icon,iconUrl:N.iconUrl,color:N.color,onClick:a==="lucro_mes"?v:N.onClick,isPersonalizing:c,layout:o})}case"smallStat":return e.jsx(Ot,{title:N.title,value:F(a),icon:N.icon,iconColor:N.iconColor,onClick:N.onClick,isPersonalizing:c,layout:o});case"chart":return e.jsx(It,{title:N.title,icon:N.icon,color:N.color,chartType:N.chartType,chartData:J(a),onClick:N.onClick,isPersonalizing:c,deleteTransaction:a==="ultimos_lancamentos"?K:void 0,setActiveTab:a==="ultimos_lancamentos"?d:void 0,isDemo:R,layout:o});case"reminders":return e.jsxs(e.Fragment,{children:[e.jsx(Ft,{reminders:R?[]:B,isLoading:E,isDemo:R,layout:o,onFollowUp:v=>{P(v),$(!0)}}),e.jsx(Yt,{open:W,onOpenChange:$,reminder:O})]});case"goals_summary":return e.jsx(zt,{goals:R?Ut():j,isLoading:E,onClick:N.onClick,isDemo:R});default:return null}},Jt=a=>{const o=new Date().getHours(),c=a?`, ${a}`:"",d=[`Bom dia${c}! Hora de brilhar.`,`Um café e um plano, ${a||"bora"}?`,`Que a sua criatividade floresça hoje${c}!`,"Bom dia! Vamos fazer mágica acontecer hoje?"],u=[`Boa tarde${c}! Como vai a produção?`,`Continue com o ótimo trabalho${c}!`,"Boa tarde! Uma pausa para o café e seguimos.",`Hora de criar algo incrível nesta tarde${c}!`],n=[`Boa noite${c}! Finalizando o dia com sucesso?`,`Bom descanso, ${a||"guerreiro(a)"}! Você merece.`,"Boa noite! As melhores ideias surgem sob as estrelas.",`Hora de recarregar as energias para amanhã${c}!`],l=r=>r[Math.floor(Math.random()*r.length)];return o>=5&&o<12?l(d):o>=12&&o<18?l(u):l(n)},Kt=ve.WidthProvider(ve.Responsive),se=(a,o)=>{if(!a||typeof a!="object")return null;const c={},d=["lg","md","sm","xs","xxs"];for(const u of d)Array.isArray(a[u])&&(c[u]=a[u].map((n,l)=>{if(!n||typeof n.i!="string")return console.error(`Layout item inválido no breakpoint ${u} no índice ${l}: `,n),null;const h=o[n.i]?.defaultSize||{w:4,h:2};return{...n,x:typeof n.x=="number"&&!isNaN(n.x)?n.x:0,y:typeof n.y=="number"&&!isNaN(n.y)?n.y:0,w:typeof n.w=="number"&&!isNaN(n.w)?n.w:h.w,h:typeof n.h=="number"&&!isNaN(n.h)?n.h:h.h}}).filter(Boolean));return c},Sa=({setActiveTab:a})=>{const{settings:o,setSettings:c,loading:d,wallets:u}=Me(),{toast:n}=Re(),[l,r]=z.useState(!1),[h,x]=z.useState(!1),s=z.useMemo(()=>Te(a,u),[a,u]),b=z.useMemo(()=>Jt(o?.user_name),[o?.user_name]),[j,y]=z.useState({lg:[],md:[],sm:[],xs:[],xxs:[]}),[k,S]=z.useState({lg:[],md:[],sm:[],xs:[],xxs:[]}),[E,G]=z.useState("lg"),[R,W]=z.useState(!1);z.useEffect(()=>{W(!0);const p=o?.dashboard_layout,i=se(p,s);if(i&&Object.keys(i).length>0&&Object.values(i).some(t=>t.length>0))y(i),S(ae.cloneDeep(i));else{const t=xe(s),m={lg:t,md:be(t,s),sm:ge(t,s),xs:fe(t,s),xxs:pe(t,s)},g=se(m,s);y(g),S(ae.cloneDeep(g))}},[o,s]);const $=async()=>{x(!0);const p=se(j,s);try{await c({dashboard_layout:p},!0),S(ae.cloneDeep(p)),r(!1),n({title:"Layout salvo!",description:"Sua nova organização foi salva."})}catch(i){n({title:"Erro ao salvar",description:`Não foi possível salvar o layout: ${i.message}`,variant:"destructive"})}finally{x(!1)}},O=()=>{l||(S(ae.cloneDeep(j)),n({title:"Modo de edição ativado",description:"Arraste e redimensione os cards."})),r(!l)},P=()=>{y(k),r(!1),n({title:"Edição cancelada",description:"Suas alterações foram descartadas."})},f=(p,i)=>{R&&l&&y(i)},T=p=>{G(p)},B=()=>{const p=xe(s),i={lg:p,md:be(p,s),sm:ge(p,s),xs:fe(p,s),xxs:pe(p,s)},t=se(i,s);y(t),n({title:"Layout redefinido",description:"O layout voltou ao padrão. Clique em 'Concluir' para salvar."})},F=p=>{const i={...j};for(const t in i)i[t]=(i[t]||[]).filter(m=>m.i!==p);y(i)},J=p=>{if(Object.values(j).some(w=>w&&w.some(C=>C.i===p))){n({title:"Card já visível",description:"Este card já está no seu dashboard.",variant:"destructive"});return}const t=s[p];if(!t)return;const m=w=>{let{w:C,h:D}=t.defaultSize||{w:4,h:2};const M=t.type,X=t.chartType;switch(w){case"md":M==="stat"?(C=5,D=2):M==="smallStat"?(C=2,D=2):M==="chart"&&(C=Math.min(10,C*1.5));break;case"sm":M==="stat"||M==="smallStat"?(C=4,D=2):M==="chart"?(D=X==="list"?6:5,C=4):(M==="reminders"||M==="goals_summary")&&(D=6,C=4);break;case"xs":case"xxs":M==="stat"||M==="smallStat"?(C=2,D=2):M==="chart"?(D=X==="list"?w==="xs"?7:8:w==="xs"?5:6,C=2):(M==="reminders"||M==="goals_summary")&&(D=w==="xs"?7:8,C=2);break}return{w:C,h:D}},g={...j};["lg","md","sm","xs","xxs"].forEach(w=>{const C=g[w]?[...g[w]]:[];let D=0;C.forEach(H=>{const te=(H.y||0)+(H.h||1);te>D&&(D=te)});const{w:M,h:X}=m(w);C.push({i:p,x:0,y:D,w:M,h:X}),g[w]=C}),y(g)},K=async()=>{const p=o?.hide_dashboard_balances!==!1;await c({hide_dashboard_balances:!p},!0)};if(d||!R||!j||Object.keys(j).length===0)return e.jsx(Ze,{});const N=j[E]||j.lg||[],v=new Set(N.map(p=>p.i));return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(Rt,{greeting:b,isPersonalizing:l,isSaving:h,onPersonalizeToggle:O,onSave:$,onCancel:P,onAddCard:J,initialCardConfigMemo:s,visibleCards:Array.from(v),onResetLayout:B,onToggleBalances:K,showBalances:o?.hide_dashboard_balances===!1,showGreetings:o?.show_greetings}),e.jsx(Kt,{className:"layout",layouts:j,breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:12,sm:4,xs:2,xxs:2},rowHeight:50,margin:[16,16],containerPadding:[0,0],onLayoutChange:f,onBreakpointChange:T,isDraggable:l,isResizable:l,draggableHandle:".drag-handle",preventCollision:!1,compactType:"vertical",children:N.map(p=>!p||!s[p.i]?null:e.jsxs("div",{className:"relative group dashboard-card",children:[l&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"drag-handle absolute top-2 left-2 p-1.5 bg-card/80 rounded-full cursor-grab active:cursor-grabbing z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Et,{size:16})}),e.jsxs(re,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-7 w-7 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Le,{size:16})})}),e.jsx(le,{children:e.jsxs(ee,{className:"text-red-500",onClick:()=>F(p.i),children:[e.jsx(Se,{className:"mr-2 h-4 w-4"}),"Remover Card"]})})]})]}),e.jsx("div",{className:"flex-grow h-full w-full",children:e.jsx(Qt,{cardId:p.i,layout:p,isEditing:l,setActiveTab:a})})]},p.i))})]})};export{Sa as default};
