import{r as N,a7 as Z,f as ee,u as te,j as e,ak as oe,p as z,B as I,aa as se,az as ae,ae as ie,s as L}from"./index-B959_7_o.js";import{u as ne,a as re,b as le,c as ce,D as de,H as pe,L as me,E as ue,d as fe,e as xe,P as he,f as ge,S as ve,R as Se,C as be}from"./EditorRulers-4JP48acx.js";import{E as je}from"./EditorCanvas-u08Q0126.js";import"./dnd.esm-CNSIsYfb.js";import"./defineProperty-C-ST8_Gu.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";import"./useDebounce-DlCjF56H.js";import"./html2canvas.esm-BfxBtG_O.js";import"./tabs-5JwcCaKq.js";import"./alert-dialog-CMWSZjMP.js";import"./plus-circle-B0lITbZK.js";import"./upload-CdVbUmbv.js";import"./switch-wgn4gd4-.js";import"./instagram-P835G8_n.js";import"./message-square-DK6t4m6u.js";import"./image-CjjvHyfl.js";import"./link-BuAO9sRO.js";import"./popover-CitvH7H0.js";import"./ban-CuKnu2ih.js";import"./tooltip-Cwgo7U0h.js";import"./chevron-up-ckAvg4TR.js";import"./grip-vertical-B8wuY_M6.js";import"./eye-off-CVDThO4Q.js";import"./type-CEpyDFf0.js";import"./settings-Cakr_w_3.js";import"./copy-BXl6xJ0E.js";import"./underline-DXQwgy9O.js";import"./video-ThlXC_2j.js";import"./star-CA4LwDww.js";import"./share-2-BzF6Ks-n.js";import"./square-Yty-hvSV.js";import"./palette-DYpEW6qD.js";import"./align-justify-pHCYe3KW.js";import"./list-BWAYK6lC.js";import"./index-DcEOeknW.js";import"./index-Chjiymov.js";const it=({isAdmin:x=!1})=>{const A=ne({isAdmin:x}),{proposal:o,setProposal:l,proposalId:c,isNew:G,activeSection:d,setActiveSection:O,loading:F,saving:$,saveStatus:q,uploads:D,loadingUploads:H,handleSave:v,handlePublish:U,fetchUploads:h,navigateBackPath:_}=A,p=re(),{selectedBlock:n,handleSetSelectedBlock:m,viewMode:i,setViewMode:S,canvasWidth:V,isLeftSidebarOpen:b,setIsLeftSidebarOpen:j,isRightSidebarOpen:w,setIsRightSidebarOpen:k,snapLines:W,setSnapLines:J,toolbarPosition:K}=p,{addBlock:g,updateBlock:r}=le(l,m,i),C=N.useRef(null),s=ce({selectedBlock:n,updateBlock:r,addBlock:g,activeSection:d,canvasRef:C,viewMode:i,setViewMode:S,proposalName:o?.nome_da_proposta}),{fileInputRef:Q,handleFileInputClick:y}=s,{user:B}=Z(),{toast:u}=ee(),P=N.useRef(null),T=te(),X=async(t,a)=>{const f=t.target.files?.[0];if(!f||!B||!a)return;if(f.size>10*1024*1024){u({title:"Arquivo muito grande",description:"O arquivo excede o limite de 10MB.",variant:"destructive"});return}u({title:"Enviando arquivo...",description:"Aguarde um momento."});const Y=ae(f.name),E=`${B.id}/${c||"new"}/${ie()}-${Y}`,{error:M}=await L.storage.from("propostas").upload(E,f);if(M){u({title:"Erro no upload",description:M.message,variant:"destructive"});return}const{data:{publicUrl:R}}=L.storage.from("propostas").getPublicUrl(E);a.type==="image"?r(a.id,{content:{...a.content,src:R}}):a.type==="pdf"&&r(a.id,{content:{src:R}}),h(c),u({title:"Arquivo atualizado!",variant:"success"}),t.target.value=""};return F||!o?e.jsx(oe,{}):e.jsx(de,{backend:pe,children:e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 w-full fixed inset-0 overflow-hidden",onClick:s.closeContextMenu,children:[e.jsx("input",{type:"file",ref:Q,className:"hidden",onChange:t=>X(t,n),accept:n?.type==="pdf"?"application/pdf":"image/*"}),e.jsx(z,{children:b&&e.jsx(me,{onAddBlock:g,activeSection:d,uploads:D,loadingUploads:H,proposalId:c,onUploadComplete:()=>h(c),isNew:G,handleSave:()=>v(),onToggle:()=>j(!1)})}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden transition-all duration-300 ease-in-out",children:[e.jsx(ue,{navigateBack:()=>T(_),viewMode:i,setViewMode:S,handleExportPdf:s.handleExportPdf,handleSave:()=>v(),handlePublish:U,saving:$,saveStatus:q,isAdmin:x,proposal:o}),e.jsx(fe,{selectedBlock:n,updateBlock:r,toolbarPosition:K,onReplaceImage:()=>y()}),e.jsxs("div",{ref:P,className:"flex-1 overflow-auto bg-muted/40 p-4 sm:p-8 relative flex justify-center",onClick:()=>m(null),children:[e.jsx(xe,{scrollContainerRef:P}),!b&&e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 z-30",onClick:()=>j(!0),children:e.jsx(he,{})}),!w&&n&&e.jsx(I,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-30",onClick:()=>k(!0),children:e.jsx(ge,{})}),e.jsxs("div",{className:se("mx-auto transition-all duration-300 relative",i==="desktop"&&"w-full max-w-4xl",i==="tablet"&&"w-full max-w-md",i==="mobile"&&"w-full max-w-xs"),style:{width:`${V}px`},onClick:t=>t.stopPropagation(),children:[e.jsx(je,{ref:C,sections:o.sections,blocksBySection:o.blocksBySection,addBlock:g,setSelectedBlock:m,selectedBlockId:n?.id,updateBlock:r,showGrid:p.showGrid,globalStyles:o.theme,activeSection:d,viewMode:i,setProposal:l,onContextMenu:s.handleContextMenu,setSnapLines:J}),W.map((t,a)=>e.jsx("div",{className:"absolute bg-orange-300",style:{...t.type==="vertical"?{left:t.position,top:0,width:"1px",height:"100%"}:{top:t.position,left:0,height:"1px",width:"100%"},zIndex:99998}},a))]})]}),e.jsx(ve,{sections:o.sections,activeSection:d,setActiveSection:O,setProposal:l,proposal:o})]}),e.jsx(z,{children:w&&e.jsx(Se,{selectedBlock:n,updateBlock:r,setSelectedBlock:m,globalStyles:o.theme,setGlobalStyles:t=>l(a=>({...a,theme:t})),showGrid:p.showGrid,setShowGrid:p.setShowGrid,proposal:o,setProposal:l,isAdmin:x,onToggle:()=>k(!1),onUploadComplete:()=>h(c),viewMode:i})}),s.contextMenu&&e.jsx(be,{x:s.contextMenu.x,y:s.contextMenu.y,block:s.contextMenu.block,onClose:s.closeContextMenu,onAction:s.handleContextMenuAction,onFileInputClick:y})]})})};export{it as default};
