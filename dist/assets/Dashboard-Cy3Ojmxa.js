import{c as Oe,R,j as e,b as re,f as oe,u as Be,m as X,aa as k,B as $,E as Fe,Q as ne,T as ie,aC as ze,V as le,W as ee,aD as Ge,ah as Ve,C as De,aE as He,D as _e,aF as We,ai as qe,U as ce,aG as Se,a9 as de,X as Ae,af as Z,P as Q,H as J,t as ue,v as me,w as ke,aH as xe,y as he,S as Ee,aI as Re,O as Ue,Y as Ye,Z as Qe,_ as Je,$ as Xe,a0 as Ke,a6 as Ze,ad as et,a7 as Me,aJ as Y,q as tt,aK as at,aL as Te,r as B,aM as ae,aN as fe,aO as pe,aP as ge,aQ as be,aR as ve,ak as st}from"./index-B959_7_o.js";import{r as je}from"./index-BkzoHSh8.js";import{S as A,B as rt}from"./skeleton-DGr2DvYe.js";import{T as ot,a as nt,b as it,c as lt}from"./tooltip-Cwgo7U0h.js";import{T as Le}from"./target-0v8Xu6Ir.js";import{T as ct}from"./trophy-C4AHTxGd.js";import{E as dt}from"./eye-off-CVDThO4Q.js";import{S as $e}from"./settings-Cakr_w_3.js";import{u as Pe}from"./useCardHoverEffect-OZDMdtp8.js";import{L as ut,a as mt}from"./LazyImage-w8qN2dVT.js";import{R as ht}from"./receipt-D12oCdOp.js";import{S as xt}from"./shield-check-CjVSLj8l.js";import{T as ft}from"./trending-down-Ca0GvqbE.js";import{T as pt}from"./trending-up-CJXHKgjy.js";import{B as gt,P as bt}from"./PieChart-C4-pnNYG.js";import{A as vt,b as jt,c as yt,d as wt,e as Nt,f as Ct,g as Dt,h as _t}from"./alert-dialog-CMWSZjMP.js";import{L as St}from"./list-BWAYK6lC.js";import{P as At}from"./pie-chart-CuOhjEBx.js";import{M as kt}from"./more-vertical-_AfS99pC.js";import{P as Et}from"./pen-square-CcxMKlNU.js";import{C as Rt}from"./cake-BjucJzo4.js";import{P as Mt}from"./progress-CvQypriY.js";import{i as ye}from"./isSameMonth-C4Oyy8q6.js";import{s as Ie}from"./subMonths-BcpZhqkJ.js";import{G as Tt}from"./grip-vertical-B8wuY_M6.js";import"./index-Chjiymov.js";import"./index-DcEOeknW.js";import"./extends-CF3RwP-h.js";const Lt=Oe("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]),$t=({children:a,threshold:s=.1,fallback:d=e.jsx(A,{className:"h-32 w-full"}),className:h=""})=>{const[u,i]=R.useState(!1),[o,n]=R.useState(!1),m=R.useRef();return R.useEffect(()=>{const x=new IntersectionObserver(([r])=>{r.isIntersecting&&!o&&(i(!0),n(!0),x.disconnect())},{threshold:s});return m.current&&x.observe(m.current),()=>x.disconnect()},[s,o]),e.jsx("div",{ref:m,className:h,children:u?a:d})},Pt=({greeting:a,isPersonalizing:s,isSaving:d,onPersonalizeToggle:h,onSave:u,onCancel:i,onAddCard:o,initialCardConfigMemo:n,visibleCards:m,onResetLayout:x,onToggleBalances:r,showBalances:b,showGreetings:j})=>{const w=Object.keys(n).filter(D=>!m.includes(D)),{isMobile:E}=re();oe();const M=Be();return e.jsxs("div",{className:"dashboard-header-container flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4",children:[e.jsxs(X.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"dashboard-greeting-container mb-4 sm:mb-0",children:[e.jsx("h1",{className:k("text-2xl md:text-3xl font-bold text-foreground",j&&"titulo-gradiente-animado"),children:a}),e.jsx("p",{className:"text-muted-foreground dashboard-subtitle",children:"Aqui está um resumo do seu negócio hoje."})]}),e.jsxs("div",{className:"dashboard-controls-container flex items-center space-x-2",children:[!E&&e.jsxs(e.Fragment,{children:[e.jsxs($,{variant:"outline",onClick:()=>M("/rival"),className:"bg-gradient-to-r from-orange-50 to-red-50 border-orange-200 hover:bg-gradient-to-r hover:from-orange-100 hover:to-red-100 dark:from-orange-900/20 dark:to-red-900/20 dark:border-orange-700",children:[e.jsx(Le,{className:"w-4 h-4 mr-2 text-orange-600"}),"RIVAL"]}),e.jsxs($,{variant:"outline",onClick:()=>M("/metas"),className:"bg-gradient-to-r from-yellow-50 to-amber-50 border-yellow-200 hover:bg-gradient-to-r hover:from-yellow-100 hover:to-amber-100 dark:from-yellow-900/20 dark:to-amber-900/20 dark:border-yellow-700",children:[e.jsx(ct,{className:"w-4 h-4 mr-2 text-yellow-600"}),"METAS"]}),e.jsx(ot,{children:e.jsxs(nt,{children:[e.jsx(it,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",onClick:r,children:b?e.jsx(dt,{className:"h-5 w-5"}):e.jsx(Fe,{className:"h-5 w-5"})})}),e.jsx(lt,{children:e.jsx("p",{children:b?"Ocultar saldos":"Mostrar saldos"})})]})})]}),s?e.jsxs(X.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},className:"flex items-center space-x-2",children:[e.jsxs(ne,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs($,{variant:"outline",children:[e.jsx(ze,{className:"w-4 h-4 mr-2"})," Adicionar Card"]})}),e.jsx(le,{children:w.length>0?w.map(D=>e.jsx(ee,{onClick:()=>o(D),children:n[D].title},D)):e.jsx(ee,{disabled:!0,children:"Todos os cards visíveis"})})]}),e.jsxs($,{variant:"outline",onClick:x,children:[e.jsx(Lt,{className:"w-4 h-4 mr-2"})," Redefinir"]}),e.jsxs($,{variant:"outline",onClick:i,children:[e.jsx(Ge,{className:"w-4 h-4 mr-2"})," Cancelar"]}),e.jsxs($,{onClick:u,disabled:d,className:"bg-green-500 hover:bg-green-600 text-white",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"})," ",d?"Salvando...":"Concluir"]})]}):!E&&e.jsxs($,{variant:"outline",onClick:h,className:"dashboard-personalize-button",children:[e.jsx($e,{className:"w-4 h-4 mr-2"})," Personalizar"]})]})]})},It={DollarSign:_e,TrendingUp:pt,TrendingDown:ft,ShieldCheck:xt,Landmark:mt,Wallet:He,Receipt:ht,BarChart:rt,Calendar:De},Ot=({title:a,value:s,icon:d,color:h,onClick:u,isPersonalizing:i,layout:o,iconUrl:n})=>{const m=Pe(),x=It[d]||_e;re();const b=(()=>{if(!o)return{title:"text-[11px]",value:"text-xl",icon:"w-3.5 h-3.5"};const{h:w,w:E}=o;return w<=1||E<=2?{title:"text-[10px] leading-tight",value:"text-base",icon:"w-3 h-3"}:E<=3?{title:"text-[11px] leading-tight",value:"text-xl",icon:"w-3.5 h-3.5"}:{title:"text-xs",value:"text-2xl",icon:"w-4 h-4"}})(),j={initial:{opacity:0,y:20},animate:{opacity:1,y:0}};return e.jsxs(X.div,{ref:m,variants:j,initial:"initial",animate:"animate",transition:{duration:.3},className:k("bg-card rounded-xl shadow-sm border border-border/50 p-3 flex flex-col justify-between h-full card-hover-effect",!i&&"cursor-pointer"),onClick:i?void 0:u,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:k("font-medium text-muted-foreground truncate",b.title),title:a,children:a}),n?e.jsx(ut,{src:n,alt:a,className:k(b.icon,"object-contain")}):e.jsx(x,{className:k(b.icon,h)})]}),e.jsx("div",{children:e.jsx("p",{className:k("font-bold text-foreground truncate",b.value),title:typeof s=="string"&&s.startsWith("R$")?s:"",children:s})})]})},Bt={Users:ce,FileText:qe,Briefcase:We,Target:Le,Calendar:De},Ft=({title:a,value:s,icon:d,iconColor:h,onClick:u,isPersonalizing:i,layout:o})=>{const n=Pe(),m=Bt[d]||ce;re();const r=(()=>{if(!o)return{value:"text-lg",title:"text-xs",iconContainer:"w-7 h-7 mb-1",icon:"w-4 h-4"};const{h:b,w:j}=o;return b<=1||j<=2?{value:"text-base",title:"text-[10px] leading-tight",iconContainer:"w-6 h-6 mb-0.5",icon:"w-3.5 h-3.5"}:{value:"text-lg",title:"text-xs",iconContainer:"w-7 h-7 mb-1",icon:"w-4 h-4"}})();return e.jsxs(X.div,{ref:n,layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-card rounded-xl p-3 shadow-sm border border-border/50 text-center card-hover-effect relative h-full flex flex-col justify-center items-center",onClick:i?void 0:u,style:{cursor:i?"grab":"pointer"},children:[e.jsx("div",{className:k("rounded-lg flex items-center justify-center mx-auto",r.iconContainer),children:e.jsx(m,{className:k(r.icon,h)})}),e.jsx("p",{className:k("font-bold text-foreground",r.value),children:s}),e.jsx("p",{className:k("text-muted-foreground mt-0.5",r.title),children:a})]})},zt={BarChart2:Se,PieChart:At,List:St},Gt=({title:a,icon:s,color:d,chartData:h,chartType:u,onClick:i,isPersonalizing:o,deleteTransaction:n,setActiveTab:m,isDemo:x=!1,layout:r})=>{const b=zt[s]||Se,[j,w]=R.useState(!1),[E,M]=R.useState(null),D=p=>{M(p),w(!0)},W=()=>{E&&n&&n(E),w(!1),M(null)},T=()=>{w(!1),M(null)},F=p=>{if(!p)return"N/A";try{const L=Z(p);return isNaN(L.getTime())?"Data inválida":Q(L,"dd/MM/yy",{locale:J})}catch{return"Data inválida"}},I=(()=>{if(!r)return{title:"text-sm",icon:"w-4 h-4",listText:"text-xs",listValue:"text-xs"};const{h:p,w:L}=r;return L<=2?{title:"text-[11px]",icon:"w-3.5 h-3.5",listText:"text-[10px]",listValue:"text-[11px]"}:p<=3||L<=4?{title:"text-xs",icon:"w-3.5 h-3.5",listText:"text-[11px]",listValue:"text-xs"}:{title:"text-sm",icon:"w-4 h-4",listText:"text-xs",listValue:"text-sm"}})(),O=()=>h?u==="bar"?e.jsx(gt,{chartData:h,isCompact:r?.h<=3||r?.w<=4}):u==="pie"?e.jsx(bt,{chartData:h,isCompact:r?.h<=3||r?.w<=2}):u==="list"?h.items?h.items.length===0?e.jsx("p",{className:"text-center text-muted-foreground text-xs py-4",children:"Nenhum lançamento recente."}):e.jsx(de,{className:"h-full pr-2",children:e.jsx("div",{className:"space-y-2",children:h.items.map((p,L)=>{const z=()=>{!x&&m&&m("financial",{modal:"editTransaction",transactionId:p.id})};return e.jsxs("div",{onClick:z,className:"flex items-center justify-between p-1.5 rounded-md transition-all duration-200 ease-in-out "+(p.tipo==="ENTRADA"?"bg-green-500/10 hover:bg-green-500/20":"bg-red-500/10 hover:bg-red-500/20"),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:k("font-medium text-foreground truncate",I.listText),title:p.descricao,children:p.descricao}),e.jsxs("p",{className:k("text-muted-foreground",I.listText),children:[F(p.date)," - ",p.status]})]}),e.jsxs("div",{className:"flex items-center ml-1",onClick:G=>G.stopPropagation(),children:[e.jsxs("p",{className:k("font-semibold mr-1",I.listValue,p.tipo==="ENTRADA"?"text-customGreen":"text-red-500"),children:[p.tipo==="SAIDA"?"- R$":"+ R$",Number(p.valor).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),!x&&n&&m&&e.jsxs(ne,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs($,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 data-[state=open]:bg-muted",children:[e.jsx(kt,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Abrir menu"})]})}),e.jsxs(le,{align:"end",children:[e.jsxs(ee,{onClick:()=>m("financial",{modal:"editTransaction",transactionId:p.id}),children:[e.jsx(Et,{className:"mr-2 h-3 w-3 text-muted-foreground/70"}),e.jsx("span",{className:"text-xs",children:"Editar"})]}),e.jsxs(ee,{onClick:()=>D(p.id),className:"text-red-600 dark:text-red-400 hover:!text-red-600 dark:hover:!text-red-400",children:[e.jsx(Ae,{className:"mr-2 h-3 w-3 text-muted-foreground/70"}),e.jsx("span",{className:"text-xs",children:"Excluir"})]})]})]})]})]},p.id||L)})})}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Carregando..."}):e.jsx("p",{className:"text-center text-muted-foreground text-xs py-4",children:"Tipo de gráfico desconhecido."}):e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"Carregando..."});return e.jsxs(e.Fragment,{children:[e.jsxs(X.div,{layout:!0,initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:`bg-card rounded-xl shadow-sm border border-border/50 overflow-hidden flex flex-col h-full p-3 ${o?"cursor-grab active:cursor-grabbing":""}`,children:[e.jsx("div",{className:"flex items-center justify-between pb-2 mb-2 border-b border-border/50",onClick:!o&&i?i:void 0,style:{cursor:!o&&i?"pointer":"default"},children:e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx(b,{className:k("mr-2 shrink-0",I.icon,d||"text-primary")}),e.jsx("h3",{className:k("font-semibold text-foreground truncate",I.title),children:a})]})}),e.jsxs("div",{className:"flex-grow relative cursor-pointer hover:bg-accent/30",children:[x&&u!=="list"&&e.jsx("div",{className:"absolute top-0 left-0 w-full text-center z-10",children:e.jsx("p",{className:"text-xs text-muted-foreground bg-card/50 backdrop-blur-sm px-2 py-0.5 rounded-full inline-block",children:"Gráfico demonstrativo"})}),O()]})]}),e.jsx(vt,{open:j,onOpenChange:w,children:e.jsxs(jt,{children:[e.jsxs(yt,{children:[e.jsx(wt,{children:"Confirmar Exclusão"}),e.jsx(Nt,{children:"Tem certeza que deseja excluir este lançamento? Esta ação não pode ser desfeita."})]}),e.jsxs(Ct,{children:[e.jsx(Dt,{onClick:T,children:"Cancelar"}),e.jsx(_t,{onClick:W,className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})})]})},Vt=({icon:a,title:s,description:d,date:h,color:u,reminder:i,onFollowUp:o,layout:n})=>{const x=!n||n.h>=4?{icon:"w-3.5 h-3.5",title:"text-xs",desc:"text-[11px]"}:{icon:"w-3 h-3",title:"text-[11px]",desc:"text-[10px]"};return e.jsxs(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},className:"flex items-start space-x-2 p-1.5 mb-1 rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:k("p-1.5 rounded-full text-primary-foreground",u,n?.h<4&&"p-1"),children:a&&e.jsx(a,{className:x.icon})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:k("font-semibold text-foreground truncate",x.title),children:s}),e.jsx("p",{className:k("text-muted-foreground mt-0.5 truncate",x.desc),children:d}),h&&e.jsxs("p",{className:k("text-muted-foreground italic",x.desc),children:["Data:"," ",Q(Z(h),"dd/MM",{locale:J})]})]}),o&&e.jsx("button",{onClick:()=>o(i),className:"p-1 hover:bg-green-50 hover:text-green-600 rounded-full transition-all duration-200",title:"Entrar em contato via WhatsApp",children:e.jsx("img",{src:"https://cdn-icons-png.flaticon.com/512/16566/16566143.png",alt:"WhatsApp",className:"w-4 h-4"})})]})},Ht=({reminders:a,isLoading:s,isDemo:d=!1,layout:h,onFollowUp:u})=>{const i=r=>{if(r.icon)return{icon:r.icon,title:r.title,description:r.description,date:r.date,color:r.color||"bg-primary"};switch(r.type){case"BIRTHDAY":return{icon:Re,title:`Aniversário de ${r.clientName}`,description:"Envie uma mensagem ou cupom.",date:r.date,color:"bg-pink-500"};case"WEDDING_ANNIVERSARY":return{icon:Ee,title:`Aniv. Casamento: ${r.clientName}`,description:"Ofereça um ensaio de casal.",date:r.date,color:"bg-red-500"};case"CHILD_BIRTHDAY":return{icon:Rt,title:`Aniv. de ${r.childName||"Filho(a)"}`,description:"Sugira um ensaio em família.",date:r.date,color:"bg-blue-500"};default:return{icon:xe,title:"Lembrete",description:r.clientName,date:r.date,color:"bg-primary"}}},o=[{type:"BIRTHDAY",clientName:"Ana Silva",date:new Date(new Date().setDate(new Date().getDate()+5)).toISOString()},{type:"WEDDING_ANNIVERSARY",clientName:"Carlos e Bia",date:new Date(new Date().setDate(new Date().getDate()+12)).toISOString()}],n=d?o:a,x=!h||h.h>=4?{title:"text-sm",icon:"w-4 h-4"}:{title:"text-xs",icon:"w-3.5 h-3.5"};return e.jsxs(ue,{className:"h-full flex flex-col shadow-sm border-border bg-card/80 backdrop-blur-sm p-3",children:[e.jsx(me,{className:"flex flex-row items-center justify-between space-y-0 pb-2 px-0 pt-0 border-b border-border/50 mb-2",children:e.jsxs(ke,{className:k("font-semibold text-foreground flex items-center",x.title),children:[e.jsx(xe,{className:k("mr-2",x.icon,"text-button-primary-foreground")}),"Lembretes e Oportunidades"]})}),e.jsx(he,{className:"px-0 pb-0 flex-grow overflow-hidden",children:s?e.jsx("div",{className:"space-y-3 pt-2",children:[...Array(3)].map((r,b)=>e.jsxs("div",{className:"flex items-start space-x-3 p-1 rounded-lg",children:[e.jsx(A,{className:"w-8 h-8 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(A,{className:"h-4 w-3/4"}),e.jsx(A,{className:"h-3 w-full"})]})]},b))}):n&&n.length>0?e.jsx(de,{className:"h-full pr-2",children:e.jsx("div",{className:"pt-1",children:n.map((r,b)=>{const j=i(r);return e.jsx(Vt,{...j,reminder:r,onFollowUp:u,layout:h},b)})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center text-muted-foreground p-2",children:[e.jsx(ce,{className:"w-6 h-6 mb-2"}),e.jsx("p",{className:"text-xs font-medium",children:"Nenhum lembrete!"}),e.jsx("p",{className:"text-[10px]",children:"Cadastre as datas dos clientes."})]})})]})},Wt=({goals:a,onClick:s,isDemo:d=!1,isLoading:h=!1})=>e.jsxs(ue,{className:"bg-card/80 backdrop-blur-sm border border-border rounded-xl shadow-sm h-full flex flex-col",onClick:s,style:{cursor:s?"pointer":"default"},children:[e.jsx(me,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(ke,{className:"text-sm font-medium",children:"Resumo das Metas"})}),e.jsx(he,{className:"flex-1 space-y-4",children:h?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Carregando metas..."}):!a||a.length===0?e.jsx("p",{className:"text-muted-foreground text-xs",children:"Nenhuma meta cadastrada."}):a.map(u=>{const i=u.saldo_atual/u.valor_meta*100,o=Math.min(Math.max(i,0),100),n=u.saldo_atual>=u.valor_meta?"bg-customGreen":"bg-primary";return e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-xs font-medium",children:u.nome||u.name}),e.jsxs(Ue,{variant:"outline",className:"text-xs border-border",children:[o.toFixed(1),"%"]})]}),e.jsx(Mt,{value:o,indicatorClassName:n})]},u.id||u.name)})})]}),we=()=>e.jsx("div",{className:"bg-card rounded-xl p-4 sm:p-6 shadow-lg border border-border h-full flex flex-col justify-center",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(A,{className:"h-4 w-24 mb-2"}),e.jsx(A,{className:"h-8 w-32"})]}),e.jsx(A,{className:"w-12 h-12 rounded-lg"})]})}),qt=()=>e.jsxs("div",{className:"bg-card rounded-xl p-4 shadow-lg border border-border text-center h-full flex flex-col justify-center items-center",children:[e.jsx(A,{className:"w-10 h-10 rounded-lg mx-auto mb-2"}),e.jsx(A,{className:"h-7 w-16 mx-auto mb-1"}),e.jsx(A,{className:"h-4 w-20 mx-auto"})]}),Ne=({isList:a=!1})=>e.jsxs("div",{className:"bg-card rounded-xl shadow-lg border border-border overflow-hidden flex flex-col h-full",children:[e.jsx("div",{className:"flex items-center justify-between p-4 sm:p-5 border-b border-border",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-3"}),e.jsx(A,{className:"h-5 w-32"})]})}),e.jsx("div",{className:"p-2 sm:p-4 flex-grow",children:a?e.jsx("div",{className:"space-y-3 px-2 py-2",children:[...Array(4)].map((s,d)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(A,{className:"h-4 w-4/5 mb-2"}),e.jsx(A,{className:"h-3 w-1/3"})]}),e.jsx("div",{className:"flex items-center ml-2",children:e.jsx(A,{className:"h-5 w-20"})})]},d))}):e.jsx(A,{className:"h-full w-full"})})]}),Ut=()=>e.jsxs(ue,{className:"h-full flex flex-col shadow-lg border-border bg-card/80 backdrop-blur-sm",children:[e.jsx(me,{className:"flex flex-row items-center justify-between space-y-0 pb-2 pt-4 px-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),e.jsx(A,{className:"h-5 w-48"})]})}),e.jsx(he,{className:"px-2 pb-4 flex-grow overflow-hidden",children:e.jsx("div",{className:"space-y-3 p-2",children:[...Array(3)].map((a,s)=>e.jsxs("div",{className:"flex items-start space-x-3 p-1 rounded-lg",children:[e.jsx(A,{className:"w-9 h-9 rounded-full"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(A,{className:"h-4 w-3/4"}),e.jsx(A,{className:"h-3 w-full"})]})]},s))})})]});function Yt(a,s,d,h,u){const i=new Date;Array.isArray(a)||(a=[]),Array.isArray(s)||(s=[]),Array.isArray(d)||(d=[]),Array.isArray(u)||(u=[]);const o=a.filter(t=>t.status==="PAGO"),n=o.filter(t=>{const l=t.data_recebimento||t.data||t.created_at;if(!l)return!1;try{return ye(Z(l),i)}catch{return!1}}),m=o.filter(t=>t.tipo==="ENTRADA").reduce((t,l)=>t+(Number(l.valor)||0),0),x=o.filter(t=>t.tipo==="SAIDA").reduce((t,l)=>t+(Number(l.valor)||0),0),r=n.filter(t=>t.tipo==="ENTRADA").reduce((t,l)=>t+(Number(l.valor)||0),0),b=n.filter(t=>t.tipo==="SAIDA"&&t.category!=="Pró-labore").reduce((t,l)=>t+(Number(l.valor)||0),0),j=n.filter(t=>t.tipo==="SAIDA"&&t.category==="Pró-labore").reduce((t,l)=>t+(Number(l.valor)||0),0),w=r-b,E=s.filter(t=>t.status!=="concluido"&&t.status!=="arquivado"&&!t.archived).reduce((t,l)=>{const v=Number(l.value)||0,N=Number(l.pending_amount)||0;return t+(N>0?N:v)},0),M=a.filter(t=>t.tipo==="ENTRADA"&&t.status==="PENDENTE").reduce((t,l)=>t+(Number(l.valor)||0),0),D=E+M,W=a.filter(t=>t.tipo==="SAIDA"&&t.status==="PENDENTE"&&t.data_vencimento&&new Date(t.data_vencimento)>i).reduce((t,l)=>t+(Number(l.valor)||0),0),T=a.filter(t=>t.status==="AGUARDANDO_LIBERACAO"&&t.release_date&&new Date(t.release_date)>i).reduce((t,l)=>t+(Number(l.valor)||0),0);let F=0;if(h?.regime_tributario==="mei")F=Number(h.valor_fixo_mei)||0;else if(h?.regime_tributario==="simples"&&h.aliquotas_simples_nacional){const t=h.aliquotas_simples_nacional.find(l=>r<=l.faixa_faturamento)?.aliquota||0;F=r*t/100}const P=m-x,I=s.filter(t=>t.status==="em-andamento"&&!t.archived).length,O=s.filter(t=>{if(!t.date||t.archived)return!1;try{return ye(Z(t.date),i)}catch{return!1}}).length,p=["arquivado","excluido","cancelado","perdido"],L=["em-andamento","concluido","negocio-fechado"],z=(s||[]).filter(t=>!p.includes((t.status||"").toLowerCase())),G=z.filter(t=>L.includes((t.status||"").toLowerCase())),V=z.length,q=G.length,C=V>0?q/V*100:0,y=(u||[]).reduce((t,l)=>t+(Number(l.depreciacao_mensal)||0),0),f={},c={};for(let t=5;t>=0;t--){const l=Ie(i,t),v=`${l.getMonth()+1}/${l.getFullYear()}`;f[v]=0,c[v]=0}o.forEach(t=>{const l=t.data_recebimento||t.data||t.created_at;if(l)try{const v=Z(l),N=`${v.getMonth()+1}/${v.getFullYear()}`;if(!Object.prototype.hasOwnProperty.call(f,N))return;t.tipo==="ENTRADA"?f[N]+=Number(t.valor)||0:t.tipo==="SAIDA"&&(c[N]+=Number(t.valor)||0)}catch{}});let g=0;if(Array.isArray(d)&&Array.isArray(a)){const t=new Date,l=new Set;a.forEach(v=>{if(v.tipo==="ENTRADA"&&v.status==="PENDENTE"){const N=v.data_vencimento||v.data,S=N?new Date(N):null;(!S||S<t)&&l.add(v.cliente_id||v.clienteId)}}),g=Array.from(l).filter(v=>v!=null).length}const _=Array.isArray(d)?d.length:0;return{revenueThisMonth:r,expensesThisMonth:b,profitThisMonth:w,pendingToReceive:D,futurePendingPayments:W,estimatedTax:F,proLaboreThisMonth:j,netBalance:P,workInProgress:I,scheduledThisMonth:O,conversionRate:C,monthlyDepreciation:y,awaitingRelease:T,monthlyRevenue:f,monthlyExpenses:c,clientsInadimplentes:g,totalClients:_,validLeadsCount:V,convertedLeadsCount:q}}const H=(a,s,d,h,u,i=[])=>{switch(a){case"grafico_faturamento":{if(!s||!s.monthlyRevenue)return{labels:[],datasets:[]};const o=s.monthlyRevenue,n=Object.keys(o).sort((m,x)=>{const[r,b]=m.split("/"),[j,w]=x.split("/");return new Date(b,r-1)-new Date(w,j-1)});return{labels:n.map(m=>{const[x,r]=m.split("/"),b=new Date(r,x-1);return Q(b,"MMM/yy",{locale:J})}),datasets:[{label:"Faturamento",data:n.map(m=>o[m]),backgroundColor:"rgba(59, 130, 246, 0.6)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:1,tension:.4}]}}case"grafico_despesas_faturamento":{if(!s||!s.monthlyRevenue||!s.monthlyExpenses)return{labels:[],datasets:[]};const o=s.monthlyRevenue,n=s.monthlyExpenses,m=Object.keys(o).sort((x,r)=>{const[b,j]=x.split("/"),[w,E]=r.split("/");return new Date(j,b-1)-new Date(E,w-1)});return{labels:m.map(x=>{const[r,b]=x.split("/"),j=new Date(b,r-1);return Q(j,"MMM/yy",{locale:J})}),datasets:[{label:"Faturamento",data:m.map(x=>o[x]),backgroundColor:"rgba(34, 197, 94, 0.6)",borderColor:"rgba(34, 197, 94, 1)",borderWidth:1},{label:"Despesas",data:m.map(x=>n[x]),backgroundColor:"rgba(239, 68, 68, 0.6)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:1}]}}case"grafico_despesas_lucro":{if(!s||!s.monthlyRevenue||!s.monthlyExpenses)return{labels:[],datasets:[]};const o=s.monthlyRevenue,n=s.monthlyExpenses,m=Object.keys(o).sort((x,r)=>{const[b,j]=x.split("/"),[w,E]=r.split("/");return new Date(j,b-1)-new Date(E,w-1)});return{labels:m.map(x=>{const[r,b]=x.split("/"),j=new Date(b,r-1);return Q(j,"MMM/yy",{locale:J})}),datasets:[{label:"Lucro",data:m.map(x=>o[x]-n[x]),backgroundColor:"rgba(52, 211, 153, 0.6)",borderColor:"rgba(52, 211, 153, 1)",borderWidth:1},{label:"Despesas",data:m.map(x=>n[x]),backgroundColor:"rgba(234, 179, 8, 0.6)",borderColor:"rgba(234, 179, 8, 1)",borderWidth:1}]}}case"grafico_conversao_leads":{let o=s?.validLeadsCount,n=s?.convertedLeadsCount;if(typeof o!="number"||typeof n!="number"){if(!Array.isArray(d))return{labels:[],datasets:[]};const x=["arquivado","excluido","cancelado","perdido"],r=["em-andamento","concluido","negocio-fechado"],b=(d||[]).filter(w=>!x.includes((w.status||"").toLowerCase())),j=b.filter(w=>r.includes((w.status||"").toLowerCase()));o=b.length,n=j.length}const m=o-n;return o===0?{labels:["Sem dados"],datasets:[{data:[1],backgroundColor:["#E5E7EB"]}]}:{labels:["Convertidos","Não convertidos"],datasets:[{label:"Conversão de Leads",data:[n,m],backgroundColor:["rgba(59, 130, 246, 0.6)","rgba(156, 163, 175, 0.6)"],borderColor:["rgba(59, 130, 246, 1)","rgba(156, 163, 175, 1)"],borderWidth:1}]}}case"grafico_inadimplentes":{if(!s||typeof s.clientsInadimplentes!="number"||typeof s.totalClients!="number")return{labels:[],datasets:[]};const o=s.clientsInadimplentes,n=s.totalClients;if(n===0)return{labels:["Sem clientes"],datasets:[{data:[1],backgroundColor:["#E5E7EB"]}]};const m=Math.max(n-o,0);return{labels:["Inadimplentes","Outros"],datasets:[{label:"Clientes",data:[o,m],backgroundColor:["rgba(239, 68, 68, 0.6)","rgba(156, 163, 175, 0.6)"],borderColor:["rgba(239, 68, 68, 1)","rgba(156, 163, 175, 1)"],borderWidth:1}]}}case"status_trabalhos":{const o=(d||[]).reduce((n,m)=>{const x=m.status||"sem-status";return n[x]=(n[x]||0)+1,n},{});return{labels:Object.keys(o),datasets:[{label:"Status dos Trabalhos",data:Object.values(o),backgroundColor:["rgba(255, 99, 132, 0.6)","rgba(54, 162, 235, 0.6)","rgba(255, 206, 86, 0.6)","rgba(75, 192, 192, 0.6)","rgba(153, 102, 255, 0.6)","rgba(255, 159, 64, 0.6)"]}]}}case"ultimos_lancamentos":return{items:(h||[]).slice().sort((n,m)=>{const x=n.created_at?new Date(n.created_at):new Date(n.data_recebimento||n.data||0);return(m.created_at?new Date(m.created_at):new Date(m.data_recebimento||m.data||0))-x}).slice(0,10).map(n=>({...n,date:n.data,wallet:(i||[]).find(m=>m.id===n.wallet_id)}))};default:return{labels:[],datasets:[]}}},Qt={labels:[],datasets:[{data:[]}]},Jt=a=>{if(a==="grafico_faturamento"){const s=[],d=[],h=[],u=new Date;for(let i=5;i>=0;i--){const o=Ie(u,i);s.push(Q(o,"MMM/yy",{locale:J})),d.push(Math.floor(Math.random()*5001)+2e3),h.push(Math.floor(Math.random()*2501)+500)}return{labels:s,datasets:[{label:"Faturamento",data:d,backgroundColor:"rgba(52, 211, 153, 0.7)",borderColor:"rgba(52, 211, 153, 1)",borderWidth:1,borderRadius:4,barPercentage:.6,categoryPercentage:.7},{label:"Saídas",data:h,backgroundColor:"rgba(239, 68, 68, 0.7)",borderColor:"rgba(239, 68, 68, 1)",borderWidth:1,borderRadius:4,barPercentage:.6,categoryPercentage:.7}]}}if(a==="status_trabalhos"){const s=["Novos Leads","Propostas Enviadas","Em Andamento","Concluídos"],d=[5,3,8,12],h=["rgba(59, 130, 246, 0.7)","rgba(234, 179, 8, 0.7)","rgba(139, 92, 246, 0.7)","rgba(16, 185, 129, 0.7)"],u=h.map(i=>i.replace("0.7","1"));return{labels:s,datasets:[{label:"Status dos Trabalhos",data:d,backgroundColor:h,borderColor:u,borderWidth:1}]}}return a==="ultimos_lancamentos"?{items:[{id:"demo1",descricao:"Ensaio Fotográfico - Família Silva",valor:850,tipo:"ENTRADA",status:"PAGO",date:new Date().toISOString()},{id:"demo2",descricao:"Assinatura Adobe Creative Cloud",valor:275,tipo:"SAIDA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-2)).toISOString()},{id:"demo3",descricao:"Casamento - Joana e Pedro (Entrada)",valor:2500,tipo:"ENTRADA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-5)).toISOString()},{id:"demo4",descricao:"Aluguel do Estúdio",valor:600,tipo:"SAIDA",status:"PAGO",date:new Date(new Date().setDate(new Date().getDate()-7)).toISOString()}]}:Qt},Xt=()=>[{id:"demo_goal_1",nome_meta:"Comprar Nova Lente",valor_meta:5e3,saldo_atual:1750,icone:"Camera"},{id:"demo_goal_2",nome_meta:"Fundo de Emergência",valor_meta:1e4,saldo_atual:4500,icone:"Shield"},{id:"demo_goal_3",nome_meta:"Viagem de Férias",valor_meta:8e3,saldo_atual:8e3,icone:"Plane"}],Ce={payment_overdue:a=>[`Olá ${a.clientName}, estou passando para lembrar que o pagamento referente ao seu serviço ${a.service} no valor de ${a.amount} está atrasado. Por favor, entre em contato para regularizar.`,`Olá ${a.clientName}, seu pagamento de ${a.amount} referente a ${a.service} está vencido. Caso já tenha quitado, desconsidere. Do contrário, preciso que regularize, tudo bem?`],payment_due:a=>[`Olá ${a.clientName}, tudo bem? O pagamento referente ao seu serviço ${a.service} no valor de ${a.amount} vence em ${a.dueInDays} dia(s). Estou à disposição para dúvidas.`,`Oi ${a.clientName}! Lembrando que seu pagamento de ${a.amount} (${a.service}) vence em ${a.dueInDays} dia(s). Qualquer coisa estou por aqui.`],expense_overdue:a=>[`Conta ${a.service} (R$ ${a.amount}) venceu em ${a.dueDateStr}. Programe-se para regularizar.`],expense_due:a=>[`Alerta: sua conta ${a.service} no valor de R$ ${a.amount} vence em ${a.dueInDays} dia(s).`],birthday:a=>[`Olá ${a.clientName}, feliz aniversário! Desejo muitas felicidades e sucesso. Se precisar de um ensaio fotográfico, estarei à disposição com condições especiais!`,`Feliz aniversário, ${a.clientName}! Que tal aproveitar a data para registrar esse momento com um ensaio exclusivo?`],default:a=>[`Olá ${a.clientName}, tudo bem?`]},Kt=({open:a,onOpenChange:s,reminder:d})=>{const h=R.useMemo(()=>{if(!d)return[];const n=d.reminderType||"default";return(Ce[n]||Ce.default)(d)},[d]),[u,i]=R.useState("");R.useEffect(()=>{h&&h.length>0&&i(h[0])},[h]);const o=()=>{if(!u||!d?.clientPhone)return;const m=`https://wa.me/${d.clientPhone.replace(/\D/g,"")}?text=${encodeURIComponent(u)}`;window.open(m,"_blank"),s(!1)};return d?e.jsx(Ye,{open:a,onOpenChange:s,children:e.jsxs(Qe,{className:"max-w-md",children:[e.jsxs(Je,{children:[e.jsxs(Xe,{children:["Enviar mensagem para ",d.clientName]}),e.jsx(Ke,{children:"Selecione uma mensagem de follow‑up para enviar via WhatsApp."})]}),e.jsx(de,{className:"max-h-40",children:h.map((n,m)=>e.jsx("div",{onClick:()=>i(n),className:`p-2 mb-2 border rounded-md cursor-pointer ${u===n?"bg-accent":""}`,children:n},m))}),e.jsxs(Ze,{className:"space-x-2",children:[e.jsx(et,{asChild:!0,children:e.jsx($,{variant:"ghost",children:"Cancelar"})}),e.jsx($,{onClick:o,disabled:!u,children:"Enviar via WhatsApp"})]})]})}):null},Zt=({cardId:a,layout:s,isEditing:d,setActiveTab:h})=>{const{workflowCards:u,financialData:i,clients:o,settings:n,loading:m,deleteTransaction:x,refreshData:r,equipments:b,savingGoals:j,wallets:w,getWalletBalance:E}=Me(),{toast:M}=oe(),D=m||!i,T=!(i&&(i.transactions.length>0||u.length>0||o.length>0)),[F,P]=R.useState(!1),[I,O]=R.useState(null),p=R.useMemo(()=>D||!i?null:Yt(i.transactions,u,o,n,b),[D,i,u,o,n,b]),L=R.useMemo(()=>{if(D||!p)return{};const y=[p,u,i.transactions,h];return{grafico_faturamento:H("grafico_faturamento",...y),grafico_despesas_faturamento:H("grafico_despesas_faturamento",...y),grafico_despesas_lucro:H("grafico_despesas_lucro",...y),grafico_conversao_leads:H("grafico_conversao_leads",...y),grafico_inadimplentes:H("grafico_inadimplentes",...y),status_trabalhos:H("status_trabalhos",...y),ultimos_lancamentos:H("ultimos_lancamentos",p,u,i.transactions,h,w)}},[D,p,u,i.transactions,h,w]),z=R.useMemo(()=>{if(D)return[];const y=new Date,f=[];return(i?.transactions||[]).forEach(c=>{if(c.status!=="PENDENTE")return;const g=c.data_vencimento||c.data||c.created_at;if(!g)return;const _=new Date(g),t=Math.floor((_-y)/(1e3*60*60*24)),l=c.tipo==="SAIDA";if(t<0||t<=7){const v=t<0?l?"expense_overdue":"payment_overdue":l?"expense_due":"payment_due",N=(o||[]).find(te=>te.id===(c.cliente_id||c.clienteId)),S=N?.nome||N?.name||"",U={id:`${v}-${g}-${S}`,icon:t<0?tt:at,color:t<0?"bg-red-500":"bg-yellow-500",title:t<0?l?"Despesa vencida":"Recebimento vencido":l?"Despesa a vencer":"Recebimento a vencer",description:`${S} - ${Y(c.valor)}`,date:_.toISOString(),reminderType:v,clientName:S,clientPhone:N?.celular||N?.telefone||N?.whatsapp||N?.phone||"",onFollowUp:()=>{O(U),P(!0)}};f.push(U),(t<0||t===0)&&window.dispatchEvent(new CustomEvent("addNotification",{detail:U}))}}),(o||[]).forEach(c=>{const g=c.birthday||c.data_nascimento;if(!g)return;const _=new Date(g),t=new Date(y.getFullYear(),_.getMonth(),_.getDate());t<y&&t.setFullYear(y.getFullYear()+1);const l=Math.floor((t-y)/(1e3*60*60*24));if(l>=0&&l<=7){const N={id:`birthday-${c.id}-${t.toISOString()}`,icon:Re,color:"bg-pink-500",title:l===0?`Aniversário de ${c.nome||c.name}`:`Aniv. em ${l} dia(s): ${c.nome||c.name}`,description:"Envie uma mensagem ou oferta",date:t.toISOString(),reminderType:"birthday",clientName:c.nome||c.name||"",clientPhone:c.celular||c.telefone||c.whatsapp||c.phone||"",onFollowUp:()=>{O(N),P(!0)}};f.push(N),l===0&&window.dispatchEvent(new CustomEvent("addNotification",{detail:N}))}}),(u||[]).forEach(c=>{if(!c.date)return;const g=new Date(c.date),_=Math.floor((g-y)/(1e3*60*60*24));if(_>=0&&_<=7){const l={id:`task-${c.id||c.title}-${g.toISOString()}`,icon:Ee,color:"bg-cyan-500",title:_===0?`Tarefa hoje: ${c.title||c.titulo}`:`Tarefa em ${_} dia(s): ${c.title||c.titulo}`,description:`Agendado para ${g.toLocaleDateString("pt-BR")}`,date:g.toISOString(),reminderType:"task_due",onFollowUp:()=>{O(l),P(!0)}};f.push(l),_===0&&window.dispatchEvent(new CustomEvent("addNotification",{detail:l}))}}),f.sort((c,g)=>{const _=new Date(c.date||0),t=new Date(g.date||0);return _-t}),f},[D,i?.transactions,o,u]);R.useEffect(()=>{const y=f=>{f.detail&&(O(f.detail),P(!0))};return window.addEventListener("openFollowUp",y),()=>{window.removeEventListener("openFollowUp",y)}},[]);const G=R.useCallback(y=>{if(D||!p)return"...";if(T)return y.includes("conversao")?"0.0%":"R$ 0,00";const f=n?.hide_dashboard_balances===!1,c="••••";if(y.startsWith("wallet_")){const _=y.replace("wallet_",""),t=E(_);return f?Y(t):c}const g=_=>f?Y(_):c;switch(y){case"saldo_geral":return g(p.netBalance);case"pagamentos_receber":return g(p.pendingToReceive);case"despesas_pagar":return g(p.futurePendingPayments);case"imposto_estimado":return g(p.estimatedTax);case"pro_labore":return g(p.proLaboreThisMonth);case"despesas_mes":return g(p.expensesThisMonth);case"lucro_mes":return g(p.profitThisMonth);case"depreciacao_mensal":return g(p.monthlyDepreciation);case"awaiting_release":return g(p.awaitingRelease);case"clientes_ativos":return o.length;case"trabalhos_em_andamento":return p.workInProgress;case"trabalhos_agendados":return p.scheduledThisMonth;case"conversao_clientes":return`${p.conversionRate.toFixed(1)}%`;default:return""}},[D,p,n?.hide_dashboard_balances,o,T,E]),V=R.useCallback(y=>T?Jt(y):D||!L[y]?{labels:[],datasets:[{data:[]}]}:L[y],[D,L,T]),q=async y=>{try{await x(y),M({title:"Lançamento excluído",description:"O lançamento foi excluído com sucesso."}),await r()}catch(f){M({title:"Erro ao excluir",description:`Não foi possível excluir o lançamento: ${f.message}`,variant:"destructive"})}},C=R.useMemo(()=>{try{return Te(h,w)[a]}catch{return null}},[h,w,a]);if(!C)return null;if(D)switch(C.type){case"stat":return e.jsx(we,{});case"smallStat":return e.jsx(qt,{});case"chart":return e.jsx(Ne,{isList:C.chartType==="list"});case"reminders":return e.jsx(Ut,{});case"goals_summary":return e.jsx(Ne,{isList:!0});default:return e.jsx(we,{})}switch(C.type){case"stat":{const y=()=>{if(a==="lucro_mes"&&p){const f=p.revenueThisMonth||0,c=p.expensesThisMonth||0,g=p.profitThisMonth||0;M({title:"Lucro do mês",description:`Receitas: ${Y(f)}
Despesas: ${Y(c)}
Lucro: ${Y(g)}`})}C.onClick&&C.onClick()};return e.jsx(Ot,{title:C.title,value:G(a),icon:C.icon,iconUrl:C.iconUrl,color:C.color,onClick:a==="lucro_mes"?y:C.onClick,isPersonalizing:d,layout:s})}case"smallStat":return e.jsx(Ft,{title:C.title,value:G(a),icon:C.icon,iconColor:C.iconColor,onClick:C.onClick,isPersonalizing:d,layout:s});case"chart":return e.jsx(Gt,{title:C.title,icon:C.icon,color:C.color,chartType:C.chartType,chartData:V(a),onClick:C.onClick,isPersonalizing:d,deleteTransaction:a==="ultimos_lancamentos"?q:void 0,setActiveTab:a==="ultimos_lancamentos"?h:void 0,isDemo:T,layout:s});case"reminders":return e.jsxs(e.Fragment,{children:[e.jsx(Ht,{reminders:T?[]:z,isLoading:D,isDemo:T,layout:s,onFollowUp:y=>{O(y),P(!0)}}),e.jsx(Kt,{open:F,onOpenChange:P,reminder:I})]});case"goals_summary":return e.jsx(Wt,{goals:T?Xt():j,isLoading:D,onClick:C.onClick,isDemo:T});default:return null}},ea=a=>{const s=new Date().getHours(),d=a?`, ${a}`:"",h=[`Bom dia${d}! Hora de brilhar.`,`Um café e um plano, ${a||"bora"}?`,`Que a sua criatividade floresça hoje${d}!`,"Bom dia! Vamos fazer mágica acontecer hoje?"],u=[`Boa tarde${d}! Como vai a produção?`,`Continue com o ótimo trabalho${d}!`,"Boa tarde! Uma pausa para o café e seguimos.",`Hora de criar algo incrível nesta tarde${d}!`],i=[`Boa noite${d}! Finalizando o dia com sucesso?`,`Bom descanso, ${a||"guerreiro(a)"}! Você merece.`,"Boa noite! As melhores ideias surgem sob as estrelas.",`Hora de recarregar as energias para amanhã${d}!`],o=n=>n[Math.floor(Math.random()*n.length)];return s>=5&&s<12?o(h):s>=12&&s<18?o(u):o(i)},ta=je.WidthProvider(je.Responsive),se=(a,s)=>{if(!a||typeof a!="object")return null;const d={},h=["lg","md","sm","xs","xxs"];for(const u of h)Array.isArray(a[u])&&(d[u]=a[u].map((i,o)=>{if(!i||typeof i.i!="string")return console.error(`Layout item inválido no breakpoint ${u} no índice ${o}: `,i),null;const m=s[i.i]?.defaultSize||{w:4,h:2};return{...i,x:typeof i.x=="number"&&!isNaN(i.x)?i.x:0,y:typeof i.y=="number"&&!isNaN(i.y)?i.y:0,w:typeof i.w=="number"&&!isNaN(i.w)?i.w:m.w,h:typeof i.h=="number"&&!isNaN(i.h)?i.h:m.h}}).filter(Boolean));return d},aa=({setActiveTab:a})=>{const{settings:s,setSettings:d,loading:h,wallets:u}=Me(),{toast:i}=oe(),[o,n]=B.useState(!1),[m,x]=B.useState(!1),r=B.useMemo(()=>Te(a,u),[a,u]),b=B.useMemo(()=>ea(s?.user_name),[s?.user_name]),[j,w]=B.useState({lg:[],md:[],sm:[],xs:[],xxs:[]}),[E,M]=B.useState({lg:[],md:[],sm:[],xs:[],xxs:[]}),[D,W]=B.useState("lg"),[T,F]=B.useState(!1);B.useEffect(()=>{F(!0);const f=s?.dashboard_layout,c=se(f,r);if(c&&Object.keys(c).length>0&&Object.values(c).some(g=>g.length>0))w(c),M(ae.cloneDeep(c));else{const g=fe(r),_={lg:g,md:ve(g,r),sm:be(g,r),xs:ge(g,r),xxs:pe(g,r)},t=se(_,r);w(t),M(ae.cloneDeep(t))}},[s,r]);const P=async()=>{x(!0);const f=se(j,r);try{await d({dashboard_layout:f},!0),M(ae.cloneDeep(f)),n(!1),i({title:"Layout salvo!",description:"Sua nova organização foi salva."})}catch(c){i({title:"Erro ao salvar",description:`Não foi possível salvar o layout: ${c.message}`,variant:"destructive"})}finally{x(!1)}},I=()=>{o||(M(ae.cloneDeep(j)),i({title:"Modo de edição ativado",description:"Arraste e redimensione os cards."})),n(!o)},O=()=>{w(E),n(!1),i({title:"Edição cancelada",description:"Suas alterações foram descartadas."})},p=(f,c)=>{T&&o&&w(c)},L=f=>{W(f)},z=()=>{const f=fe(r),c={lg:f,md:ve(f,r),sm:be(f,r),xs:ge(f,r),xxs:pe(f,r)},g=se(c,r);w(g),i({title:"Layout redefinido",description:"O layout voltou ao padrão. Clique em 'Concluir' para salvar."})},G=f=>{const c={...j};for(const g in c)c[g]=(c[g]||[]).filter(_=>_.i!==f);w(c)},V=f=>{if(Object.values(j).some(l=>l&&l.some(v=>v.i===f))){i({title:"Card já visível",description:"Este card já está no seu dashboard.",variant:"destructive"});return}const g=r[f];if(!g)return;const _=l=>{let{w:v,h:N}=g.defaultSize||{w:4,h:2};const S=g.type,K=g.chartType;switch(l){case"md":S==="stat"?(v=5,N=2):S==="smallStat"?(v=2,N=2):S==="chart"&&(v=Math.min(10,v*1.5));break;case"sm":S==="stat"||S==="smallStat"?(v=4,N=2):S==="chart"?(N=K==="list"?6:5,v=4):(S==="reminders"||S==="goals_summary")&&(N=6,v=4);break;case"xs":case"xxs":S==="stat"||S==="smallStat"?(v=2,N=2):S==="chart"?(N=K==="list"?l==="xs"?7:8:l==="xs"?5:6,v=2):(S==="reminders"||S==="goals_summary")&&(N=l==="xs"?7:8,v=2);break}return{w:v,h:N}},t={...j};["lg","md","sm","xs","xxs"].forEach(l=>{const v=t[l]?[...t[l]]:[];let N=0;v.forEach(U=>{const te=(U.y||0)+(U.h||1);te>N&&(N=te)});const{w:S,h:K}=_(l);v.push({i:f,x:0,y:N,w:S,h:K}),t[l]=v}),w(t)},q=async()=>{const f=s?.hide_dashboard_balances!==!1;await d({hide_dashboard_balances:!f},!0)};if(h||!T||!j||Object.keys(j).length===0)return e.jsx(st,{});const C=j[D]||j.lg||[],y=new Set(C.map(f=>f.i));return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(Pt,{greeting:b,isPersonalizing:o,isSaving:m,onPersonalizeToggle:I,onSave:P,onCancel:O,onAddCard:V,initialCardConfigMemo:r,visibleCards:Array.from(y),onResetLayout:z,onToggleBalances:q,showBalances:s?.hide_dashboard_balances===!1,showGreetings:s?.show_greetings}),e.jsx(ta,{className:"layout",layouts:j,breakpoints:{lg:1200,md:996,sm:768,xs:480,xxs:0},cols:{lg:12,md:12,sm:4,xs:2,xxs:2},rowHeight:50,margin:[16,16],containerPadding:[0,0],onLayoutChange:p,onBreakpointChange:L,isDraggable:o,isResizable:o,draggableHandle:".drag-handle",preventCollision:!1,compactType:"vertical",children:C.map(f=>!f||!r[f.i]?null:e.jsxs("div",{className:"relative group dashboard-card",children:[o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"drag-handle absolute top-2 left-2 p-1.5 bg-card/80 rounded-full cursor-grab active:cursor-grabbing z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Tt,{size:16})}),e.jsxs(ne,{children:[e.jsx(ie,{asChild:!0,children:e.jsx($,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 h-7 w-7 z-20 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx($e,{size:16})})}),e.jsx(le,{children:e.jsxs(ee,{className:"text-red-500",onClick:()=>G(f.i),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"}),"Remover Card"]})})]})]}),e.jsx("div",{className:"flex-grow h-full w-full",children:e.jsx($t,{threshold:.1,className:"h-full w-full",children:e.jsx(Zt,{cardId:f.i,layout:f,isEditing:o,setActiveTab:a})})})]},f.i))})]})},Ra=B.memo(aa);export{Ra as default};
