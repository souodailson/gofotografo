import{r as N,a3 as Z,e as ee,u as te,j as e,ag as oe,o as I,B as z,a6 as se,at as ae,aa as ie,s as L}from"./index-BNk_ELpO.js";import{u as ne,a as re,b as le,c as ce,D as de,H as pe,L as me,E as ue,d as xe,e as fe,P as he,f as ge,S as ve,R as Se,C as be}from"./EditorRulers-ByQ7r5NY.js";import{E as je}from"./EditorCanvas-Zcy4viaW.js";import"./dnd.esm-CwihRAVH.js";import"./defineProperty-DbXIQDXj.js";import"./typeof-QjJsDpFa.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";import"./useDebounce-BxwOHRT5.js";import"./jspdf.es.min-CIAw-4UP.js";import"./html2canvas.esm-BfxBtG_O.js";import"./tabs-BPniRr2c.js";import"./alert-dialog-B6TPqobf.js";import"./plus-circle-B1LTYiUD.js";import"./upload-C3MsHwtv.js";import"./switch-B034y77f.js";import"./instagram-708OdClw.js";import"./message-square-Bf4Ps9kY.js";import"./image-DipmbZE9.js";import"./link-N7GKhB3p.js";import"./popover-CzkaMyMB.js";import"./ban-CUZGZKZ7.js";import"./tooltip-ctBIbYYp.js";import"./chevron-up-BBnEZWlz.js";import"./grip-vertical-DXhRXyP3.js";import"./eye-D8-jh49q.js";import"./eye-off-Bumrs_fl.js";import"./type-0HvQCc20.js";import"./settings-BmbIlgRw.js";import"./copy-FB_ryr5R.js";import"./arrow-left-CdCOlOOG.js";import"./underline-D7fxLUaL.js";import"./star-dR_kcU-z.js";import"./share-2-Dja4G2qI.js";import"./square-CrI1VeL9.js";import"./palette-Bi-fqRAB.js";import"./align-justify-55j09m-v.js";import"./list-CmCLAdLK.js";import"./index-CqpONDs2.js";import"./index-Chjiymov.js";const lt=({isAdmin:f=!1})=>{const A=ne({isAdmin:f}),{proposal:o,setProposal:l,proposalId:c,isNew:G,activeSection:d,setActiveSection:O,loading:F,saving:$,saveStatus:q,uploads:D,loadingUploads:H,handleSave:v,handlePublish:U,fetchUploads:h,navigateBackPath:_}=A,p=re(),{selectedBlock:n,handleSetSelectedBlock:m,viewMode:i,setViewMode:S,canvasWidth:V,isLeftSidebarOpen:b,setIsLeftSidebarOpen:j,isRightSidebarOpen:w,setIsRightSidebarOpen:k,snapLines:W,setSnapLines:J,toolbarPosition:K}=p,{addBlock:g,updateBlock:r}=le(l,m,i),C=N.useRef(null),s=ce({selectedBlock:n,updateBlock:r,addBlock:g,activeSection:d,canvasRef:C,viewMode:i,setViewMode:S,proposalName:o?.nome_da_proposta}),{fileInputRef:Q,handleFileInputClick:y}=s,{user:B}=Z(),{toast:u}=ee(),P=N.useRef(null),T=te(),X=async(t,a)=>{const x=t.target.files?.[0];if(!x||!B||!a)return;if(x.size>10*1024*1024){u({title:"Arquivo muito grande",description:"O arquivo excede o limite de 10MB.",variant:"destructive"});return}u({title:"Enviando arquivo...",description:"Aguarde um momento."});const Y=ae(x.name),E=`${B.id}/${c||"new"}/${ie()}-${Y}`,{error:M}=await L.storage.from("propostas").upload(E,x);if(M){u({title:"Erro no upload",description:M.message,variant:"destructive"});return}const{data:{publicUrl:R}}=L.storage.from("propostas").getPublicUrl(E);a.type==="image"?r(a.id,{content:{...a.content,src:R}}):a.type==="pdf"&&r(a.id,{content:{src:R}}),h(c),u({title:"Arquivo atualizado!",variant:"success"}),t.target.value=""};return F||!o?e.jsx(oe,{}):e.jsx(de,{backend:pe,children:e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 w-full fixed inset-0 overflow-hidden",onClick:s.closeContextMenu,children:[e.jsx("input",{type:"file",ref:Q,className:"hidden",onChange:t=>X(t,n),accept:n?.type==="pdf"?"application/pdf":"image/*"}),e.jsx(I,{children:b&&e.jsx(me,{onAddBlock:g,activeSection:d,uploads:D,loadingUploads:H,proposalId:c,onUploadComplete:()=>h(c),isNew:G,handleSave:()=>v(),onToggle:()=>j(!1)})}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden transition-all duration-300 ease-in-out",children:[e.jsx(ue,{navigateBack:()=>T(_),viewMode:i,setViewMode:S,handleExportPdf:s.handleExportPdf,handleSave:()=>v(),handlePublish:U,saving:$,saveStatus:q,isAdmin:f,proposal:o}),e.jsx(xe,{selectedBlock:n,updateBlock:r,toolbarPosition:K,onReplaceImage:()=>y()}),e.jsxs("div",{ref:P,className:"flex-1 overflow-auto bg-muted/40 p-4 sm:p-8 relative flex justify-center",onClick:()=>m(null),children:[e.jsx(fe,{scrollContainerRef:P}),!b&&e.jsx(z,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 z-30",onClick:()=>j(!0),children:e.jsx(he,{})}),!w&&n&&e.jsx(z,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-30",onClick:()=>k(!0),children:e.jsx(ge,{})}),e.jsxs("div",{className:se("mx-auto transition-all duration-300 relative",i==="desktop"&&"w-full max-w-4xl",i==="tablet"&&"w-full max-w-md",i==="mobile"&&"w-full max-w-xs"),style:{width:`${V}px`},onClick:t=>t.stopPropagation(),children:[e.jsx(je,{ref:C,sections:o.sections,blocksBySection:o.blocksBySection,addBlock:g,setSelectedBlock:m,selectedBlockId:n?.id,updateBlock:r,showGrid:p.showGrid,globalStyles:o.theme,activeSection:d,viewMode:i,setProposal:l,onContextMenu:s.handleContextMenu,setSnapLines:J}),W.map((t,a)=>e.jsx("div",{className:"absolute bg-orange-300",style:{...t.type==="vertical"?{left:t.position,top:0,width:"1px",height:"100%"}:{top:t.position,left:0,height:"1px",width:"100%"},zIndex:99998}},a))]})]}),e.jsx(ve,{sections:o.sections,activeSection:d,setActiveSection:O,setProposal:l,proposal:o})]}),e.jsx(I,{children:w&&e.jsx(Se,{selectedBlock:n,updateBlock:r,setSelectedBlock:m,globalStyles:o.theme,setGlobalStyles:t=>l(a=>({...a,theme:t})),showGrid:p.showGrid,setShowGrid:p.setShowGrid,proposal:o,setProposal:l,isAdmin:f,onToggle:()=>k(!1),onUploadComplete:()=>h(c),viewMode:i})}),s.contextMenu&&e.jsx(be,{x:s.contextMenu.x,y:s.contextMenu.y,block:s.contextMenu.block,onClose:s.closeContextMenu,onAction:s.handleContextMenuAction,onFileInputClick:y})]})})};export{lt as default};
