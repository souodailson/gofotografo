import{P as j,H as C,af as $,b8 as ne,a7 as M,r as h,j as a,B as U,L as le,b9 as ce,m as F,f as ae,s as L,b as de,C as me}from"./index-DHBNVHsv.js";import{C as ue,B as ge,P as pe}from"./PieChart-bzxDLHws.js";import"./jspdf.plugin.autotable-DtM0_LT_.js";import{F as be}from"./FeatureRestrictionModal-eN81Qxj_.js";import{T as xe,a as he,b as fe,c as ye}from"./tooltip-DrghJOUq.js";import{s as V}from"./startOfMonth-dlDON3ZA.js";import{s as B}from"./subMonths-Dk7whGvi.js";import{e as K}from"./endOfMonth-FRBqcOZp.js";import{F as De}from"./filter-CVlwnKjx.js";import{T as Se}from"./trending-up-DiR4IApi.js";import{P as Pe}from"./pie-chart-DG8CR8gk.js";import{B as ve}from"./bar-chart-3-CPnpJOix.js";import{A as Re}from"./alert-circle-DF9xjBLi.js";import"./alert-dialog-CA3sahhm.js";import"./extends-CF3RwP-h.js";const _=(e,o,s,d)=>{const i=e.internal.pageSize.getWidth(),t=15;let l=d;if(o.logo)try{const u=new Image;u.crossOrigin="anonymous",u.src=o.logo;const f=30,y=u.height*f/u.width;e.addImage(u,"PNG",t,l,f,y>15?15:y),l+=(y>15?15:y)+2}catch(u){console.warn("Não foi possível carregar o logo para o PDF:",u),o.business_name&&(e.setFontSize(12),e.setFont(void 0,"bold"),e.text(o.business_name,t,l),l+=6)}else o.business_name&&(e.setFontSize(12),e.setFont(void 0,"bold"),e.text(o.business_name,t,l),l+=6);o.business_name&&o.logo&&(e.setFontSize(10),e.setFont(void 0,"normal"),e.text(o.business_name,t,l),l+=5),o.cnpj&&(e.setFontSize(9),e.text(`CNPJ: ${o.cnpj}`,t,l),l+=4),o.address&&(e.setFontSize(9),e.splitTextToSize(o.address,i-t*2).forEach(f=>{e.text(f,t,l),l+=4})),o.contact_email&&(e.setFontSize(9),e.text(`Email: ${o.contact_email}`,t,l),l+=4),o.phones&&o.phones.length>0&&o.phones[0].number&&(e.setFontSize(9),e.text(`Telefone: ${o.phones[0].number}`,t,l),l+=4),l+=5,e.setLineWidth(.5),e.line(t,l,i-t,l),l+=8,e.setFontSize(16),e.setFont(void 0,"bold");const c=e.getTextWidth(s);e.text(s,(i-c)/2,l),l+=8,e.setFontSize(9),e.setFont(void 0,"normal");const r=`Gerado em: ${j(new Date,"dd/MM/yyyy HH:mm",{locale:C})}`,m=e.getTextWidth(r);return e.text(r,i-t-m,t+5),l},je=e=>{const o=e.internal.pageSize.getWidth(),s=e.internal.pageSize.getHeight(),d=15,i=e.internal.getNumberOfPages();for(let t=1;t<=i;t++)e.setPage(t),e.setFontSize(8),e.text(`Página ${t} de ${i}`,o-d-20,s-d+10)},Fe=(e,o,s,d)=>{let i=s;return o&&(e.setFontSize(11),e.setFont(void 0,"bold"),e.text("Informações do Cliente:",d,i),i+=6,e.setFontSize(10),e.setFont(void 0,"normal"),e.text(`Nome: ${o.name||"N/A"}`,d,i),i+=5,o.email&&(e.text(`Email: ${o.email}`,d,i),i+=5),o.phone&&(e.text(`Telefone: ${o.phone}`,d,i),i+=5),i+=3),i},Ce=async(e,o,s,d,i,t,l)=>{if(!o||!o.labels||o.labels.length===0||!o.datasets||o.datasets.length===0||!o.datasets.some(u=>u.data&&u.data.length>0)){console.warn("Dados do gráfico insuficientes para renderização no PDF.");return}const c=document.createElement("canvas");c.width=t*3,c.height=l*3;const r=c.getContext("2d");new ue(r,{type:s,data:o,options:{responsive:!1,animation:{duration:0},devicePixelRatio:3,plugins:{legend:{display:!0,position:"bottom"}}}}),await new Promise(u=>setTimeout(u,500));const m=c.toDataURL("image/png");e.addImage(m,"PNG",d,i,t,l),c.remove()},q=async(e,o,s,d,i=null)=>{const t=new ne("p","mm","a4"),l=t.internal.pageSize.getWidth(),c=15;let r=c;if(r=_(t,o,e,r),i&&(r=Fe(t,i,r,c)),t.setFontSize(10),t.setFont(void 0,"normal"),t.text(`Período do Relatório: ${d}`,c,r),r+=8,s.sections)for(const m of s.sections){if(r>t.internal.pageSize.getHeight()-c-20&&(t.addPage(),r=c,r=_(t,o,`${e} (cont.)`,r)),t.setFontSize(12),t.setFont(void 0,"bold"),t.text(m.title,c,r),r+=7,t.setFontSize(10),t.setFont(void 0,"normal"),m.summary&&(m.summary.forEach(u=>{r>t.internal.pageSize.getHeight()-c-10&&(t.addPage(),r=c,r=_(t,o,`${e} (cont.)`,r),t.setFontSize(12),t.setFont(void 0,"bold"),t.text(`${m.title} (cont.)`,c,r),r+=7,t.setFontSize(10),t.setFont(void 0,"normal")),t.text(`${u.label}: ${u.value}`,c+5,r),r+=5}),r+=3),m.tableData&&m.tableData.rows&&m.tableData.rows.length>0?(r>t.internal.pageSize.getHeight()-c-30&&(t.addPage(),r=c,r=_(t,o,`${e} (cont.)`,r),t.setFontSize(12),t.setFont(void 0,"bold"),t.text(`${m.title} (cont.)`,c,r),r+=7),t.autoTable({head:[m.tableData.headers],body:m.tableData.rows,startY:r,theme:"grid",headStyles:{fillColor:[62,18,128],textColor:255,fontStyle:"bold"},styles:{fontSize:8,cellPadding:1.5},columnStyles:{0:{cellWidth:"auto"}},didDrawPage:u=>{r=u.cursor.y+5}}),r=t.previousAutoTable.finalY+10):m.tableData&&(t.text("Nenhum dado para exibir nesta tabela.",c+5,r),r+=8),m.chartData&&m.chartType){r>t.internal.pageSize.getHeight()-c-60&&(t.addPage(),r=c,r=_(t,o,`${e} (cont.)`,r),t.setFontSize(12),t.setFont(void 0,"bold"),t.text(`${m.title} (cont.)`,c,r),r+=7);const u=l-c*2,f=50;await Ce(t,m.chartData,m.chartType,c,r,u,f),r+=f+10}r+=5}je(t),t.save(`${e.toLowerCase().replace(/\s+/g,"_")}_${j(new Date,"yyyyMMdd_HHmm")}.pdf`)},Ne=async(e,o,s,d)=>{const i={sections:[{title:"Resumo Financeiro",summary:[{label:"Receita Total (Paga)",value:`R$ ${e.quickStats.totalRevenue.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Despesa Operacional Total (Paga)",value:`R$ ${e.quickStats.totalExpenses.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Lucro Operacional (Receitas - Desp. Operacionais)",value:`R$ ${e.quickStats.operationalProfit.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Total Pró-labore (Pago)",value:`R$ ${e.quickStats.totalProLabore.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Lucro Líquido Final (Lucro Operacional - Pró-labore)",value:`R$ ${e.quickStats.netProfit.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`}],chartData:d?.revenueExpense,chartType:"bar"},{title:"Transações do Período (Pagas)",tableData:{headers:["Data Receb.","Descrição","Categoria","Tipo","Valor (R$)"],rows:e.transactions.map(t=>[t.data_recebimento?j($(t.data_recebimento),"dd/MM/yyyy",{locale:C}):"N/A",t.descricao,t.category||"Sem categoria",t.tipo==="ENTRADA"?"Receita":"Despesa",Number(t.valor).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})])}}]};d?.categoryDistribution&&d.categoryDistribution.labels.length>0&&i.sections.push({title:"Distribuição de Receitas por Categoria",chartData:d.categoryDistribution,chartType:"pie"}),await q("Relatório Financeiro Detalhado",o,i,s)},we=async(e,o,s)=>{const d={sections:[{title:"Estatísticas de Clientes",summary:[{label:"Novos Clientes no Período",value:e.quickStats.newClients}]},{title:"Clientes com Projetos no Período",tableData:{headers:["Nome","Cadastrado em","Nº Projetos","Valor Total Projetos (R$)"],rows:e.clientsWithProjects.map(i=>[i.name,i.created_at?j($(i.created_at),"dd/MM/yyyy",{locale:C}):"N/A",i.projectCount,Number(i.totalValue).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})])}}]};await q("Relatório de Desempenho de Clientes",o,d,s)},_e=async(e,o,s)=>{const d={sections:[{title:"Estatísticas de Projetos",summary:[{label:"Total de Projetos Concluídos no Período",value:e.quickStats.completedProjects}]},{title:"Lista de Projetos",tableData:{headers:["Título","Cliente","Status","Valor (R$)","Criado em"],rows:e.projects.map(i=>[i.title||"Projeto sem título",i.client_name||"Não informado",e.getStatusLabel?e.getStatusLabel(i.status):i.status,Number(i.value||0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}),i.created_at?j($(i.created_at),"dd/MM/yyyy",{locale:C}):"N/A"])}}]};await q("Relatório de Produtividade de Projetos",o,d,s)},Le=async(e,o,s,d)=>{const i={sections:[{title:"Resumo Financeiro",summary:[{label:"Receita Total (Paga)",value:`R$ ${e.quickStats.totalRevenue.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Despesa Operacional Total (Paga)",value:`R$ ${e.quickStats.totalExpenses.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Lucro Operacional",value:`R$ ${e.quickStats.operationalProfit.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Total Pró-labore (Pago)",value:`R$ ${e.quickStats.totalProLabore.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`},{label:"Lucro Líquido Final",value:`R$ ${e.quickStats.netProfit.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`}],chartData:d?.revenueExpense,chartType:"bar"},{title:"Transações Financeiras (Pagas)",tableData:{headers:["Data Receb.","Descrição","Categoria","Tipo","Valor (R$)"],rows:e.transactions.map(t=>[t.data_recebimento?j($(t.data_recebimento),"dd/MM/yyyy",{locale:C}):"N/A",t.descricao,t.category||"Sem categoria",t.tipo==="ENTRADA"?"Receita":"Despesa",Number(t.valor).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})])}},{title:"Resumo de Clientes",summary:[{label:"Novos Clientes no Período",value:e.quickStats.newClients}]},{title:"Clientes com Projetos",tableData:{headers:["Nome","Nº Projetos","Valor Total Projetos (R$)"],rows:e.clientsWithProjects.map(t=>[t.name,t.projectCount,Number(t.totalValue).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})])}},{title:"Resumo de Projetos",summary:[{label:"Total de Projetos Concluídos",value:e.quickStats.completedProjects}]},{title:"Lista de Projetos",tableData:{headers:["Título","Cliente","Status","Valor (R$)"],rows:e.projects.map(t=>[t.title||"Projeto sem título",t.client_name||"Não informado",e.getStatusLabel?e.getStatusLabel(t.status):t.status,Number(t.value||0).toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})])}}]};d?.categoryDistribution&&d.categoryDistribution.labels.length>0&&i.sections.splice(2,0,{title:"Distribuição de Receitas por Categoria",chartData:d.categoryDistribution,chartType:"pie"}),await q("Relatório Completo Consolidado",o,i,s)},oe=({onGenerate:e,reportType:o,loading:s,disabled:d})=>{const{planStatus:i}=M(),[t,l]=h.useState(!1),c=i==="PROFISSIONAL"||i==="STUDIO_PRO",m={financial_detailed:"Gerar PDF Financeiro",client_performance:"Gerar PDF de Clientes",project_productivity:"Gerar PDF de Projetos",full_report:"Exportar Relatório Completo"}[o]||"Gerar PDF",u=()=>{c?e&&e():l(!0)};return c?a.jsxs(U,{onClick:u,className:"w-full btn-custom-gradient text-white shadow-lg",disabled:s||d,children:[a.jsx(ce,{className:"w-4 h-4 mr-2"}),s?"Gerando...":m]}):a.jsxs(a.Fragment,{children:[a.jsx(xe,{children:a.jsxs(he,{children:[a.jsx(fe,{asChild:!0,children:a.jsx("div",{className:"inline-flex w-full",children:a.jsxs(U,{variant:"outline",disabled:!0,className:"w-full cursor-not-allowed",onClick:u,children:[a.jsx(le,{className:"w-4 h-4 mr-2"}),m]})})}),a.jsx(ye,{children:a.jsx("p",{children:"Funcionalidade Premium"})})]})}),a.jsx(be,{isOpen:t,onClose:()=>l(!1),featureName:"Download de Relatórios",requiredPlans:["PROFISSIONAL","STUDIO_PRO"],currentPlan:i})]})},$e=({onGenerateFullReport:e,loading:o})=>a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[a.jsxs(F.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},children:[a.jsx("h1",{className:"text-3xl font-bold text-foreground titulo-gradiente",children:"Relatórios Dinâmicos"}),a.jsx("p",{className:"text-muted-foreground mt-1",children:"Análises e insights do seu negócio em tempo real."})]}),a.jsx(oe,{onGenerate:e,reportType:"full_report",loading:o})]}),ke=({report:e,onGenerate:o,loading:s,index:d})=>{const i=e.icon;return a.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5+d*.1},className:"bg-card rounded-xl p-6 shadow-lg border border-border flex flex-col",children:[a.jsx("div",{className:`w-12 h-12 rounded-lg bg-gradient-to-br ${e.color} flex items-center justify-center mb-4`,children:a.jsx(i,{className:"w-6 h-6 text-white"})}),a.jsx("h3",{className:"text-lg font-semibold text-foreground mb-2",children:e.title}),a.jsx("p",{className:"text-muted-foreground text-sm flex-grow",children:e.description}),a.jsx("div",{className:"mt-4",children:a.jsx(oe,{onGenerate:()=>o(e.reportKey),reportType:e.reportKey,loading:s})})]},e.title)},Te=(e,o)=>{const{user:s,getStatusLabel:d}=M(),{toast:i}=ae(),[t,l]=h.useState(!1),[c,r]=h.useState(null),[m,u]=h.useState(null),[f,y]=h.useState({totalRevenue:0,totalExpenses:0,netProfit:0,operationalProfit:0,totalProLabore:0,completedProjects:0,newClients:0}),[k,T]=h.useState({transactions:[],clientsWithProjects:[],projects:[],quickStats:{},getStatusLabel:null}),v=h.useCallback(async(N,E)=>{if(s){l(!0);try{let p,b;const D=new Date;switch(N){case"last_month":p=V(B(D,1)),b=K(B(D,1));break;case"last_3_months":p=V(B(D,3)),b=K(D);break;case"last_year":p=V(B(D,12)),b=K(D);break;default:p=new Date(2e3,0,1),b=D}const{data:g,error:S}=await L.from("transacoes").select("tipo, valor, category, data_recebimento, status, descricao, cliente_id, trabalho_id").eq("user_id",s.id).gte("data_recebimento",p.toISOString()).lte("data_recebimento",b.toISOString());if(S)throw S;const{data:O,error:Y}=await L.from("workflow_cards").select("id, status, created_at, client_id, value, title").eq("user_id",s.id).gte("created_at",p.toISOString()).lte("created_at",b.toISOString());if(Y)throw Y;const Q=[...new Set(O.map(n=>n.client_id).filter(Boolean))];let J=[];if(Q.length>0){const{data:n,error:x}=await L.from("clients").select("id, name, created_at, email, phone").in("id",Q);if(x)throw x;J=n}const I=O.map(n=>{const x=J.find(P=>P.id===n.client_id);return{...n,client_name:x?.name||"Cliente Desconhecido",client_email:x?.email,client_phone:x?.phone}}),{data:X,error:Z}=await L.from("clients").select("id, name, created_at, email, phone").eq("user_id",s.id).gte("created_at",p.toISOString()).lte("created_at",b.toISOString());if(Z)throw Z;const re=X.map(n=>{const x=I.filter(P=>P.client_id===n.id);return{...n,projectCount:x.length,totalValue:x.reduce((P,se)=>P+Number(se.value||0),0)}}).filter(n=>n.projectCount>0||new Date(n.created_at)>=p&&new Date(n.created_at)<=b),R={},w=[];let z=new Date(p);for(;z<=b;){const n=j(z,"MMM/yy",{locale:C});w.push(n),R[n]={revenue:0,expense:0,proLabore:0},z.setMonth(z.getMonth()+1)}let G=0,W=0,H=0;const A={};g.forEach(n=>{const x=n.data_recebimento?$(n.data_recebimento):null;if(x&&x>=p&&x<=b){const P=j(x,"MMM/yy",{locale:C});R[P]&&(n.tipo==="ENTRADA"&&n.status==="PAGO"?(R[P].revenue+=Number(n.valor),G+=Number(n.valor),(E==="all"||E===n.category)&&(A[n.category||"Sem Categoria"]=(A[n.category||"Sem Categoria"]||0)+Number(n.valor))):n.tipo==="SAIDA"&&n.status==="PAGO"&&(n.category==="Pró-labore"?(R[P].proLabore+=Number(n.valor),H+=Number(n.valor)):(R[P].expense+=Number(n.valor),W+=Number(n.valor))))}});const ee=G-W,ie=ee-H,te={totalRevenue:G,totalExpenses:W,operationalProfit:ee,totalProLabore:H,netProfit:ie,completedProjects:I.filter(n=>n.status==="concluido").length,newClients:X.length};y(te),T({transactions:g.filter(n=>n.status==="PAGO"),clientsWithProjects:re,projects:I,quickStats:te,getStatusLabel:d}),r({labels:w,datasets:[{label:"Receitas (Pagas)",data:w.map(n=>R[n]?.revenue||0),backgroundColor:"rgba(13, 223, 155, 0.7)",borderColor:"rgba(13, 223, 155, 1)",borderWidth:1},{label:"Despesas Operacionais (Pagas)",data:w.map(n=>R[n]?.expense||0),backgroundColor:"rgba(255, 99, 132, 0.7)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1},{label:"Pró-labore (Pago)",data:w.map(n=>R[n]?.proLabore||0),backgroundColor:"rgba(255, 159, 64, 0.7)",borderColor:"rgba(255, 159, 64, 1)",borderWidth:1}]}),u({labels:Object.keys(A),datasets:[{label:"Distribuição de Receitas por Categoria",data:Object.values(A),backgroundColor:["rgba(62, 18, 128, 0.7)","rgba(13, 223, 155, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)"],borderColor:["rgba(62, 18, 128, 1)","rgba(13, 223, 155, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]})}catch(p){console.error("Error fetching chart data:",p),i({title:"Erro ao buscar dados",description:`Não foi possível carregar os dados para os relatórios: ${p.message}`,variant:"destructive"}),r(null),u(null),T({transactions:[],clientsWithProjects:[],projects:[],quickStats:{},getStatusLabel:null})}finally{l(!1)}}},[s,i,d]);return h.useEffect(()=>{v(e,o)},[v,e,o]),{loadingReportData:t,revenueExpenseData:c,categoryDistributionData:m,quickStats:f,detailedReportData:k,fetchReportData:v}},Ee=({selectedPeriod:e,setSelectedPeriod:o})=>a.jsxs("select",{value:e,onChange:s=>o(s.target.value),className:"flex-1 px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:ring-2 focus:ring-primary focus:border-transparent",children:[a.jsx("option",{value:"last_month",children:"Último mês"}),a.jsx("option",{value:"last_3_months",children:"Últimos 3 meses"}),a.jsx("option",{value:"last_year",children:"Último ano"}),a.jsx("option",{value:"all_time",children:"Todo o período"})]}),Oe=({selectedCategory:e,setSelectedCategory:o})=>{const{user:s}=M(),[d,i]=h.useState([]);return h.useEffect(()=>{(async()=>{if(!s)return;const{data:l,error:c}=await L.from("transacoes").select("category").eq("user_id",s.id).eq("tipo","ENTRADA").not("category","is",null).limit(100);if(c){console.error("Error fetching categories:",c);return}const r=[...new Set(l.map(m=>m.category).filter(Boolean))];i(r)})()},[s]),a.jsxs("select",{value:e,onChange:t=>o(t.target.value),className:"flex-1 px-3 py-2 border border-border rounded-lg bg-background text-foreground focus:ring-2 focus:ring-primary focus:border-transparent",children:[a.jsx("option",{value:"all",children:"Todas as Categorias (Receita)"}),d.map(t=>a.jsx("option",{value:t,children:t},t))]})},Xe=()=>{const{toast:e}=ae(),{settings:o}=M(),[s,d]=h.useState("last_3_months"),[i,t]=h.useState("all");de();const{loadingReportData:l,revenueExpenseData:c,categoryDistributionData:r,quickStats:m,detailedReportData:u,fetchReportData:f}=Te(s,i),y=g=>({last_month:"Último Mês",last_3_months:"Últimos 3 Meses",last_year:"Último Ano",all_time:"Todo o Período"})[g]||g,k=[{title:"Relatório Financeiro Detalhado",description:"Análise completa de receitas, despesas e lucros.",icon:Se,color:"from-customPurple to-customGreen",reportKey:"financial_detailed",action:()=>Ne(u,o,y(s),{revenueExpense:c,categoryDistribution:r})},{title:"Relatório de Desempenho de Clientes",description:"Estatísticas sobre aquisição e valor por cliente.",icon:Pe,color:"from-blue-500 to-cyan-600",reportKey:"client_performance",action:()=>we(u,o,y(s))},{title:"Relatório de Produtividade de Projetos",description:"Análise de status, tempo e rentabilidade por projeto.",icon:ve,color:"from-purple-500 to-pink-600",reportKey:"project_productivity",action:()=>_e(u,o,y(s))}],T=()=>{f(s,i),e({title:"Relatórios Atualizados",description:"Os gráficos e estatísticas foram atualizados com base nos filtros selecionados."})},[v,N]=h.useState({loading:!1,key:null}),E=async g=>{N({loading:!0,key:g});try{const S=k.find(O=>O.reportKey===g)?.action;if(S)await S(),e({title:"Download Iniciado",description:"Seu relatório está sendo gerado."});else throw new Error("Tipo de relatório desconhecido.")}catch(S){e({title:"Erro ao Gerar PDF",description:S.message,variant:"destructive"})}finally{N({loading:!1,key:null})}},p=async()=>{N({loading:!0,key:"full_report"});try{await Le(u,o,y(s),{revenueExpense:c,categoryDistribution:r}),e({title:"Download Iniciado",description:"Seu relatório completo está sendo gerado."})}catch(g){e({title:"Erro ao Gerar PDF",description:g.message,variant:"destructive"})}finally{N({loading:!1,key:null})}},b=(g="Carregando dados...")=>a.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground p-4",children:[a.jsx(F.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:"w-8 h-8 border-4 border-customPurple dark:border-customGreen border-t-transparent rounded-full mb-3"}),g]}),D=(g="Sem dados para exibir.")=>a.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-muted-foreground p-4 text-center",children:[a.jsx(Re,{className:"w-12 h-12 text-muted-foreground/50 mb-3"}),g]});return a.jsxs("div",{className:"space-y-8",children:[a.jsx($e,{onGenerateFullReport:p,loading:v.loading&&v.key==="full_report"}),a.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-card rounded-xl p-6 shadow-lg border border-border",children:[a.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Filtros de Relatório"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end",children:[a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Período"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(me,{className:"w-5 h-5 text-muted-foreground"}),a.jsx(Ee,{selectedPeriod:s,setSelectedPeriod:d})]})]}),a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Categoria (Receitas)"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(De,{className:"w-5 h-5 text-muted-foreground"}),a.jsx(Oe,{selectedCategory:i,setSelectedCategory:t})]})]}),a.jsx(U,{onClick:T,className:"w-full md:w-auto btn-custom-gradient text-white self-end",disabled:l,children:l?"Atualizando...":"Aplicar Filtros e Atualizar"})]})]}),a.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-card rounded-xl p-6 shadow-lg border border-border",children:[a.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Estatísticas Rápidas do Período (Valores Pagos)"}),l?b():a.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4",children:[{label:"Receita Total",value:`R$ ${m.totalRevenue.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`,color:"text-customGreen"},{label:"Despesas Operacionais",value:`R$ ${m.totalExpenses.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`,color:"text-red-600 dark:text-red-400"},{label:"Lucro Operacional",value:`R$ ${m.operationalProfit.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`,color:m.operationalProfit>=0?"text-sky-500 dark:text-sky-400":"text-orange-500"},{label:"Pró-labore",value:`R$ ${m.totalProLabore.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`,color:"text-amber-500 dark:text-amber-400"},{label:"Lucro Líquido Final",value:`R$ ${m.netProfit.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`,color:m.netProfit>=0?"text-blue-600 dark:text-blue-400":"text-orange-500"},{label:"Projetos Concluídos",value:m.completedProjects,color:"text-neutral-600 dark:text-purple-400"},{label:"Novos Clientes",value:m.newClients,color:"text-pink-600 dark:text-pink-400"}].map(g=>a.jsxs("div",{className:"text-center bg-background p-4 rounded-lg border border-border",children:[a.jsx("p",{className:`text-2xl font-bold ${g.color}`,children:g.value}),a.jsx("p",{className:"text-sm text-muted-foreground",children:g.label})]},g.label))})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-card rounded-xl p-6 shadow-lg border border-border",children:[a.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Fluxo Financeiro Mensal (Valores Pagos)"}),a.jsx("div",{className:"h-80",children:l?b():c&&c.labels.length>0?a.jsx(ge,{chartData:c}):D("Sem dados de receita/despesa para o período.")})]}),a.jsxs(F.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"bg-card rounded-xl p-6 shadow-lg border border-border",children:[a.jsx("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"Distribuição de Receitas (Pagas) por Categoria"}),a.jsx("div",{className:"h-80",children:l?b():r&&r.labels.length>0?a.jsx(pe,{chartData:r}):D(r?"Sem dados de receita para o período/categoria selecionado.":"Sem dados para exibir.")})]})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:k.map((g,S)=>a.jsx(ke,{report:g,onGenerate:()=>E(g.reportKey),loading:v.loading&&v.key===g.reportKey,index:S},g.reportKey))})]})};export{Xe as default};
