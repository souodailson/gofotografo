import{aX as Q,al as ie,ak as pe,c as Te,r as h,a3 as J,aN as se,j as e,B as C,u as he,C as ee,o as fe,m as E,I as R,aY as Ie,aZ as Le,ay as Re,Z as He,_ as ze,$ as Fe,a0 as $e,a1 as W,J as w,a6 as X,a5 as qe,ab as M,aF as be,aV as Ue,R as je,a_ as te,U as Ve,aA as Be,e as ye,s as Z,aa as We,Q as ne,V as le,l as ce,W as Xe,X as Qe,Y as Je,h as P,aW as Ye,a2 as Ze,b as Ke,ax as et}from"./index-Dk_dtFm9.js";import{l as tt,r as at,g as st}from"./googleCalendar-BZF7vwZ1.js";import{F as rt}from"./FeatureRestrictionModal-bOT_tEYo.js";import{S as ot}from"./search-DOV1OfGo.js";import{L as ve}from"./list-checks-B1vK-Pp0.js";import{S as ke}from"./settings-CovqHU0J.js";import{s as de,a as me}from"./subMonths-BcqYvc6z.js";import{p as D}from"./pt-BR-CST98L_P.js";import{P as it,a as nt,b as lt}from"./popover-sfahkZyf.js";import{e as we,g as ct}from"./getDay-CoNfcTc7.js";import{c as Ne}from"./constructNow-DIrs0ptN.js";import{s as ue}from"./startOfMonth-DIL-I9yG.js";import{e as dt}from"./endOfMonth-CeyeWwvg.js";import{i as mt}from"./isSameMonth-_6A1dN4x.js";import{M as Ce}from"./map-pin-CeyrLQxe.js";import{E as ut}from"./external-link-BJie2mfi.js";import{e as gt}from"./endOfWeek-DIMVTkgY.js";import{S as K}from"./switch-CP317X5J.js";import{C as xt}from"./copy-Csu1xgfI.js";import{A as pt}from"./AvailabilityModal-Dmr02gmU.js";import"./alert-dialog-_NVGaXDP.js";import"./extends-CF3RwP-h.js";function _e(a,m){const o=m*7;return Q(a,o)}function H(a,m){const o=ie(a),p=ie(m);return+o==+p}function Se(a){return pe(a).getHours()}function ge(a){return pe(a).getMinutes()}function ae(a){return H(a,Ne(a))}function ht(a){return H(a,Q(Ne(a),1))}function ft(a,m){return Q(a,-1)}function bt(a,m){return _e(a,-1)}const jt=Te("UserCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]]),Ee=()=>{const[a,m]=h.useState(!1),{planStatus:o}=J(),{openModal:p}=se(),u=()=>{o==="PROFISSIONAL"||o==="STUDIO_PRO"?p("googleSupport"):m(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(C,{onClick:u,variant:"outline",className:"hidden md:inline-flex items-center",title:"Vincular com Google Agenda",children:[e.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/commons/thumb/a/a5/Google_Calendar_icon_%282020%29.svg/2048px-Google_Calendar_icon_%282020%29.svg.png",alt:"Google Calendar Icon",className:"w-4 h-4 mr-2"}),"Vincular com Google Agenda"]}),e.jsx(rt,{isOpen:a,onClose:()=>m(!1),featureName:"Integração com Google Calendar",requiredPlans:["PROFISSIONAL","STUDIO_PRO"],currentPlan:o})]})},yt=({currentDate:a,setCurrentDate:m,currentView:o,setCurrentView:p,isMobile:u,onSearch:t})=>{const{settings:d}=J(),{openModal:g}=se(),[s,f]=h.useState(!1),[c,b]=h.useState(""),j=he(),x=()=>{let i;switch(o){case"month":i=de(a,1);break;case"week":i=bt(a);break;case"day":i=ft(a);break;default:i=de(a,1)}m(i)},S=()=>{let i;switch(o){case"month":i=me(a,1);break;case"week":i=_e(a,1);break;case"day":i=Q(a,1);break;default:i=me(a,1)}m(i)},n=()=>o==="day"?w(a,"dd 'de' MMMM 'de' yyyy",{locale:D}):w(a,"MMMM yyyy",{locale:D}),y=i=>{b(i.target.value),t(i.target.value)},G=()=>{f(!s),s&&(b(""),t(""))};return e.jsxs("header",{className:"flex items-center justify-between p-2 md:p-4 border-b border-border flex-shrink-0 relative",children:[e.jsx("div",{className:"flex items-center space-x-2 md:space-x-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{size:32,className:"text-blue-500"}),e.jsx("span",{className:"text-xl text-foreground/80",children:"Agenda"})]})}),e.jsx(fe,{children:s&&e.jsx(E.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},className:"absolute left-1/2 -translate-x-1/2 flex items-center",children:e.jsx(R,{type:"text",placeholder:"Buscar eventos...",value:c,onChange:y,className:"w-64 md:w-96"})})}),e.jsxs("div",{className:"flex items-center space-x-2",style:{visibility:s?"hidden":"visible"},children:[e.jsx(C,{variant:"outline",onClick:()=>m(new Date),children:"Hoje"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:x,children:e.jsx(Ie,{className:"h-5 w-5"})}),e.jsx(C,{variant:"ghost",size:"icon",onClick:S,children:e.jsx(Le,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-lg md:text-xl font-medium text-foreground capitalize w-auto md:w-48 text-center",children:n()})]}),e.jsxs("div",{className:"flex items-center space-x-1 md:space-x-2",children:[e.jsx(C,{variant:"ghost",size:"icon",className:"hidden md:inline-flex",onClick:G,children:s?e.jsx(Re,{className:"h-5 w-5"}):e.jsx(ot,{className:"h-5 w-5"})}),e.jsx(Ee,{}),e.jsx(C,{variant:"ghost",size:"icon",className:"hidden md:inline-flex",onClick:()=>j("/availability-manager"),title:"Gerenciar Disponibilidade",children:e.jsx(ve,{className:"h-5 w-5"})}),e.jsx(C,{variant:"ghost",size:"icon",className:"hidden md:inline-flex",onClick:()=>g("bookingSettings"),title:"Configurações da Agenda PRO",children:e.jsx(ke,{className:"h-5 w-5"})}),e.jsxs(He,{value:o,onValueChange:p,children:[e.jsx(ze,{className:"w-auto min-w-[80px] md:min-w-[120px]",children:e.jsx(Fe,{})}),e.jsxs($e,{children:[e.jsx(W,{value:"day",children:"Dia"}),e.jsx(W,{value:"week",children:"Semana"}),e.jsx(W,{value:"month",children:"Mês"}),e.jsx(W,{value:"agenda",children:"Agenda"})]})]}),e.jsx("div",{className:"w-8 h-8 md:w-10 md:h-10 rounded-full bg-muted flex items-center justify-center overflow-hidden",children:d?.profile_photo?e.jsx("img",{src:d.profile_photo,alt:"Foto de Perfil",className:"w-full h-full object-cover"}):e.jsx(jt,{className:"w-6 h-6 text-muted-foreground"})})]})]})},xe=({currentDate:a,selectedDate:m,setSelectedDate:o,combinedEvents:p,onEventClick:u,onDateClick:t})=>{const[d,g]=h.useState(null),s=h.useRef(null),f=h.useRef(null),c=h.useMemo(()=>{const i=ue(a),v=dt(a);return we({start:i,end:v})},[a]),b=ue(a),j=ct(b),x=i=>p.filter(v=>{if(!v.start)return!1;try{return H(v.start,i)}catch{return!1}}),S=i=>{switch(i.type){case"app-event":return"bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 border-l-4 border-purple-400";case"google-event":return"bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 border-l-4 border-blue-400";case"available-slot":return"bg-green-100 dark:bg-green-900/50 text-green-700 dark:text-green-300 border-l-4 border-green-400";case"booked-slot":return"bg-orange-100 dark:bg-orange-900/50 text-orange-700 dark:text-orange-300 border-l-4 border-orange-400";default:return"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-l-4 border-gray-400"}},n=i=>{clearTimeout(f.current),s.current=setTimeout(()=>{g(i.toString())},300)},y=()=>{clearTimeout(s.current),f.current=setTimeout(()=>{g(null)},200)},G=({day:i})=>{const v=x(i),O=v.slice(0,2),z=i.toString();return e.jsxs(it,{open:d===z,onOpenChange:k=>g(k?z:null),children:[e.jsx(nt,{asChild:!0,children:e.jsxs("div",{onMouseEnter:()=>n(i),onMouseLeave:y,onClick:()=>{o(i),t&&t(i,null)},className:X("p-2 min-h-[80px] sm:min-h-[120px] cursor-pointer transition-colors group relative flex flex-col",mt(i,a)?"bg-card hover:bg-accent":"bg-accent/30 text-muted-foreground hover:bg-accent/50",ae(i)&&"ring-2 ring-primary dark:ring-primary z-10",m&&H(i,m)&&"bg-primary/10 dark:bg-primary/20"),children:[e.jsx("span",{className:X("text-sm",ae(i)?"font-bold text-primary":"text-foreground"),children:w(i,"d")}),e.jsxs("div",{className:"flex-grow mt-1 space-y-0.5 overflow-hidden",children:[e.jsx(fe,{children:O.map((k,q)=>e.jsx(E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:q*.05},className:X("p-0.5 rounded-sm text-xs truncate cursor-pointer",S(k)),title:k.title,onClick:U=>{U.stopPropagation(),u(k)},children:k.title},k.id))}),v.length>2&&e.jsxs("div",{className:"text-xs text-muted-foreground mt-0.5",children:["+ ",v.length-2," mais"]})]})]})}),v.length>0&&e.jsxs(lt,{onMouseEnter:()=>clearTimeout(f.current),onMouseLeave:y,className:"w-80 p-0",side:"top",align:"start",children:[e.jsx("div",{className:"p-4",children:e.jsx("h4",{className:"font-medium capitalize",children:w(i,"EEEE, dd 'de' MMMM",{locale:D})})}),e.jsx(qe,{className:"max-h-60",children:e.jsx("div",{className:"p-4 pt-0 space-y-2",children:v.map(k=>e.jsxs("div",{className:X("p-2 rounded-md text-sm cursor-pointer",S(k)),onClick:()=>u(k),children:[e.jsx("p",{className:"font-semibold truncate",children:k.title}),e.jsx("p",{className:"text-xs opacity-80",children:k.time||"Dia todo"})]},k.id))})})]})]})};return e.jsxs("div",{className:"grid grid-cols-7 gap-px bg-border border border-border rounded-lg overflow-hidden",children:[["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(i=>e.jsx("div",{className:"py-2 text-center text-xs font-medium text-muted-foreground bg-accent/50",children:i},i)),Array.from({length:j}).map((i,v)=>e.jsx("div",{className:"bg-accent/30 min-h-[80px] sm:min-h-[120px]"},`empty-${v}`)),c.map(i=>e.jsx(G,{day:i},i.toString()))]})},vt=({combinedEvents:a,onEventClick:m})=>{const o=a.reduce((u,t)=>{if(!t.date)return u;const d=M(t.date),g=w(d,"yyyy-MM-dd");return u[g]||(u[g]=[]),u[g].push(t),u},{}),p=Object.keys(o).sort();return e.jsxs("div",{className:"space-y-6 p-1",children:[p.length===0&&e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"Nenhum evento agendado."}),p.map((u,t)=>{const d=o[u],g=M(u);return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.1},children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-3 capitalize",children:w(g,"EEEE, dd MMMM yyyy",{locale:D})}),e.jsx("div",{className:"space-y-2",children:d.map((s,f)=>e.jsxs(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.1+f*.05},className:"flex items-center justify-between p-3 bg-accent/50 dark:bg-accent/30 rounded-lg hover:shadow-md dark:hover:bg-accent/50 transition-all cursor-pointer",onClick:()=>m(s),children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-2.5 h-2.5 rounded-full flex-shrink-0 ${s.isGoogleEvent?"bg-blue-500":"bg-orange-300"}`}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("h4",{className:"font-medium text-sm text-foreground truncate",title:s.title,children:s.title}),e.jsxs("div",{className:"flex items-center space-x-3 text-xs text-muted-foreground mt-0.5",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),s.time||"Dia todo"]}),s.location&&e.jsxs("div",{className:"flex items-center truncate",title:s.location,children:[e.jsx(Ce,{className:"w-3 h-3 mr-1 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:s.location})]})]})]})]}),s.isGoogleEvent&&s.htmlLink&&e.jsx("a",{href:s.htmlLink,target:"_blank",rel:"noopener noreferrer",onClick:c=>c.stopPropagation(),children:e.jsx(ut,{className:"w-4 h-4 text-blue-500 hover:text-blue-600"})})]},s.id))})]},u)})]})},kt=({currentDate:a,combinedEvents:m,onEventClick:o,onDateClick:p})=>{const u=Ue(a,{locale:D}),t=gt(a,{locale:D}),d=we({start:u,end:t}),g=Array.from({length:24},(c,b)=>b),s=(c,b)=>m.filter(j=>!j.start||!H(j.start,c)?!1:Se(j.start)===b),f=(c,b)=>{const j=w(new Date(0,0,0,b),"HH:mm");p&&p(c,j)};return e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[auto_repeat(7,1fr)]",children:[e.jsx("div",{className:"p-2 text-xs font-medium text-muted-foreground bg-accent/50 sticky top-0 z-10 border-b border-r border-border",children:"Hora"}),d.map(c=>e.jsxs("div",{className:"p-2 text-center text-xs font-medium text-muted-foreground bg-accent/50 sticky top-0 z-10 border-b border-border cursor-pointer hover:bg-accent/80",onClick:()=>p(c,null),children:[e.jsx("span",{className:"block sm:hidden",children:w(c,"E",{locale:D})}),e.jsx("span",{className:"hidden sm:block",children:w(c,"EEE dd/MM",{locale:D})})]},c.toString())),g.map(c=>e.jsxs(je.Fragment,{children:[e.jsx("div",{className:"p-2 text-xs text-center text-muted-foreground bg-accent/50 border-r border-border h-16 flex items-center justify-center cursor-pointer hover:bg-accent/80",onClick:()=>f(a,c),children:w(new Date(0,0,0,c),"HH:mm")}),d.map(b=>{const j=s(b,c);return e.jsx("div",{className:"border-b border-l border-border p-1 h-16 overflow-y-auto space-y-0.5 relative cursor-pointer hover:bg-accent/30",onClick:()=>f(b,c),children:j.map((x,S)=>e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:S*.05},className:`p-0.5 rounded-sm text-[10px] leading-tight truncate cursor-pointer ${x.isGoogleEvent?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300"}`,title:`${x.title} (${x.time})`,onClick:n=>{n.stopPropagation(),o(x)},children:[e.jsx("span",{className:"font-medium",children:x.time})," ",x.title]},x.id))},`${b.toString()}-${c}`)})]},c))]})})},wt=({currentDate:a,combinedEvents:m,onEventClick:o,onDateClick:p})=>{const u=Array.from({length:24},(g,s)=>s),t=g=>m.filter(s=>!s.start||!H(s.start,a)?!1:Se(s.start)===g).sort((s,f)=>ge(s.start)-ge(f.start)),d=g=>{const s=w(new Date(0,0,0,g),"HH:mm");p&&p(a,s)};return e.jsx("div",{className:"border border-border rounded-lg overflow-hidden",children:e.jsxs("div",{className:"grid grid-cols-[auto_1fr]",children:[e.jsx("div",{className:"p-2 text-xs font-medium text-muted-foreground bg-accent/50 sticky top-0 z-10 border-b border-r border-border col-span-2 text-center",children:w(a,"EEEE, dd MMMM yyyy",{locale:D})}),u.map(g=>e.jsxs(je.Fragment,{children:[e.jsx("div",{className:"p-2 text-xs text-center text-muted-foreground bg-accent/50 border-r border-b border-border h-20 flex items-center justify-center cursor-pointer hover:bg-accent/80 transition-colors",onClick:()=>d(g),children:w(new Date(0,0,0,g),"HH:mm")}),e.jsx("div",{className:"border-b border-border p-1 h-20 overflow-y-auto space-y-1 relative cursor-pointer hover:bg-accent/30 transition-colors",onClick:()=>d(g),children:t(g).map((s,f)=>e.jsxs(E.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:f*.05},className:`p-1 rounded text-xs leading-tight cursor-pointer ${s.isGoogleEvent?"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300":"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300"}`,title:`${s.title} (${s.time})`,onClick:c=>{c.stopPropagation(),o(s)},children:[e.jsxs("div",{className:"font-semibold",children:[s.time," - ",s.title]}),s.description&&e.jsx("div",{className:"text-[10px] opacity-80 truncate",children:s.description})]},s.id))})]},g))]})})},Nt=({combinedEvents:a,onEventClick:m})=>{const o=new Date,p=a.filter(t=>!t.start||!te(new Date(t.start))?!1:new Date(t.start)>=o&&t.type!=="available-slot").sort((t,d)=>new Date(t.start)-new Date(d.start)).slice(0,7);if(p.length===0)return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6 p-6 bg-card rounded-xl shadow-lg border border-border text-center",children:[e.jsx(ee,{size:48,className:"mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-xl font-semibold mb-2 text-foreground",children:"Sem Próximos Eventos"}),e.jsx("p",{className:"text-muted-foreground",children:"Não há eventos agendados para os próximos dias."})]});const u=t=>{const d=new Date(t);return te(d)?ae(d)?"Hoje":ht(d)?"Amanhã":w(d,"EEEE, dd 'de' MMMM",{locale:D}):"Data inválida"};return e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-4",children:"Próximos Eventos"}),e.jsx("div",{className:"space-y-4",children:p.map((t,d)=>e.jsxs(E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:d*.1},onClick:()=>m(t),className:"bg-card p-4 rounded-lg shadow-md border border-border cursor-pointer hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-2",children:[e.jsx("h3",{className:"font-semibold text-foreground text-base sm:text-lg",children:t.title}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full font-medium
                ${t.isGoogleEvent?"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-300":"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-300"}`,children:t.isGoogleEvent?"Google Calendar":"GO.Fotógrafo"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-1 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{size:14,className:"mr-2"}),e.jsx("span",{children:u(t.start)})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(be,{size:14,className:"mr-2"}),e.jsx("span",{children:t.time||w(new Date(t.start),"HH:mm")})]}),t.location&&e.jsxs("div",{className:"flex items-center sm:col-span-2",children:[e.jsx(Ce,{size:14,className:"mr-2"}),e.jsx("span",{children:t.location})]}),!t.isGoogleEvent&&t.clientData&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ve,{size:14,className:"mr-2"}),e.jsxs("span",{children:["Cliente: ",t.clientData.name]})]}),!t.isGoogleEvent&&t.packageData&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(Be,{size:14,className:"mr-2"}),e.jsxs("span",{children:["Pacote: ",t.packageData.name]})]})]}),t.description&&!t.isGoogleEvent&&e.jsx("p",{className:"text-xs text-muted-foreground mt-2 line-clamp-2",children:t.description})]},t.id))})]})},Ct=({isOpen:a,onClose:m})=>{const{user:o,refreshData:p}=J(),{toast:u}=ye(),[t,d]=h.useState(null),[g,s]=h.useState(!1),[f,c]=h.useState(!0),b=h.useCallback(async()=>{if(o){c(!0);try{const{data:n,error:y}=await Z.from("booking_settings").select("*").eq("user_id",o.id).single();if(y&&y.code!=="PGRST116")throw y;if(n)d(n);else{const G={user_id:o.id,booking_enabled:!1,booking_link_id:We(),require_payment:!1,payment_percentage:10,pix_key:"",pix_qr_code_url:"",credit_card_link:"",show_footer_info:!0},{data:i,error:v}=await Z.from("booking_settings").insert(G).select().single();if(v)throw v;d(i)}}catch(n){u({title:"Erro ao carregar configurações",description:n.message,variant:"destructive"})}finally{c(!1)}}},[o,u]);h.useEffect(()=>{a&&b()},[a,b]);const j=async()=>{if(t){s(!0);try{const{data:n,error:y}=await Z.from("booking_settings").update(t).eq("id",t.id).select().single();if(y)throw y;d(n),u({title:"Configurações salvas!",description:"Suas configurações da Agenda PRO foram atualizadas."}),await p(),m()}catch(n){u({title:"Erro ao salvar",description:n.message,variant:"destructive"})}finally{s(!1)}}},x=(n,y)=>{d(G=>({...G,[n]:y}))},S=()=>{const n=`${window.location.origin}/agendar/${t.booking_link_id}`;navigator.clipboard.writeText(n),u({title:"Link copiado!",description:"O link de agendamento foi copiado para sua área de transferência."})};return f?e.jsx(ne,{open:a,onOpenChange:m,children:e.jsx(le,{children:e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(ce,{className:"w-8 h-8 animate-spin"})})})}):e.jsx(ne,{open:a,onOpenChange:m,children:e.jsxs(le,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(Xe,{children:[e.jsx(Qe,{children:"Configurações da Agenda PRO"}),e.jsx(Je,{children:"Ative e personalize sua página pública de agendamentos."})]}),t&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsx(P,{htmlFor:"booking-enabled",className:"font-semibold",children:"Ativar página de agendamento"}),e.jsx(K,{id:"booking-enabled",checked:t.booking_enabled,onCheckedChange:n=>x("booking_enabled",n)})]}),t.booking_enabled&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Link Público de Agendamento"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{value:`${window.location.origin}/agendar/${t.booking_link_id}`,readOnly:!0}),e.jsx(C,{variant:"outline",size:"icon",onClick:S,children:e.jsx(xt,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"font-semibold",children:"Pagamento de Reserva"}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsx(P,{htmlFor:"require-payment",children:"Exigir pagamento para reservar"}),e.jsx(K,{id:"require-payment",checked:t.require_payment,onCheckedChange:n=>x("require_payment",n)})]}),t.require_payment&&e.jsxs("div",{className:"space-y-4 pl-4 border-l-2 ml-2",children:[e.jsxs("div",{children:[e.jsx(P,{htmlFor:"payment-percentage",children:"Porcentagem de entrada (%)"}),e.jsx(R,{id:"payment-percentage",type:"number",value:t.payment_percentage,onChange:n=>x("payment_percentage",n.target.value)})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"pix-key",children:"Chave PIX"}),e.jsx(R,{id:"pix-key",value:t.pix_key,onChange:n=>x("pix_key",n.target.value),placeholder:"CPF, CNPJ, e-mail, telefone ou chave aleatória"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"pix-qr-code",children:"URL do QR Code PIX"}),e.jsx(R,{id:"pix-qr-code",value:t.pix_qr_code_url,onChange:n=>x("pix_qr_code_url",n.target.value),placeholder:"https://link-para-seu-qr-code.com/imagem.png"})]}),e.jsxs("div",{children:[e.jsx(P,{htmlFor:"credit-card-link",children:"Link para Cartão de Crédito"}),e.jsx(R,{id:"credit-card-link",value:t.credit_card_link,onChange:n=>x("credit_card_link",n.target.value),placeholder:"https://link-de-pagamento.com"})]})]})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"font-semibold",children:"Rodapé da Página"}),e.jsxs("div",{className:"flex items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(P,{htmlFor:"show-footer",className:"font-semibold",children:"Exibir informações no rodapé"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mostra logo, endereço, telefone e redes sociais."})]}),e.jsx(K,{id:"show-footer",checked:t.show_footer_info,onCheckedChange:n=>x("show_footer_info",n)})]}),e.jsxs("div",{className:"flex items-start gap-2 bg-accent/50 p-3 rounded-lg text-accent-foreground",children:[e.jsx(Ye,{size:16,className:"mt-1 shrink-0"}),e.jsx("p",{className:"text-xs",children:'As informações exibidas são baseadas nos dados preenchidos na aba "Minha Conta" em Configurações.'})]})]})]}),e.jsxs(Ze,{children:[e.jsx(C,{variant:"outline",onClick:m,children:"Cancelar"}),e.jsxs(C,{onClick:j,disabled:g,children:[g&&e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Salvar"]})]})]})})},Qt=({isMobile:a,setActiveTab:m})=>{const{toast:o}=ye(),p=he(),{workflowCards:u,getClientById:t,getServicePackageById:d,importGoogleEventsAsWorkflowCards:g,refreshData:s,user:f,planStatus:c,availabilitySlots:b,settings:j}=J(),{openModal:x,closeModal:S,openModals:n}=se(),[y,G]=h.useState(new Date),[i,v]=h.useState(new Date),[O,z]=h.useState([]),[k,q]=h.useState(!1),[U,Me]=h.useState("month"),F=h.useMemo(()=>j?.google_tokens,[j]),{isMobile:Y}=Ke(),re=h.useCallback(async l=>{try{await s("settings")}catch(_){console.error("Error storing Google tokens in DB",_)}},[s]),V=h.useCallback(async()=>{try{await s("settings"),z([])}catch(l){console.error("Error clearing Google tokens from DB",l)}},[s]),T=h.useMemo(()=>{const l=u.filter(r=>r.date&&!r.archived&&r.status==="agendado").map(r=>{const A=r.client_id?t(r.client_id):null,Oe=r.service_package_id?d(r.service_package_id):null,oe=r.time||"00:00";let L;try{L=M(`${r.date}T${oe}:00`),te(L)||(L=new Date)}catch{L=new Date}return{id:`app-${r.id}`,title:r.title||(A?A.name:"Evento App"),date:r.date,time:oe,start:L,end:new Date(L.getTime()+36e5),description:r.description||"Não especificado",type:"app-event",isGoogleEvent:!1,rawCard:r,clientData:A,packageData:Oe,google_event_id:r.google_event_id}}),_=O.map(r=>({id:`google-${r.id}`,title:r.summary||"Evento Google",date:r.start?.date||(r.start?.dateTime?r.start.dateTime.split("T")[0]:new Date().toISOString().split("T")[0]),time:r.start?.dateTime?w(M(r.start.dateTime),"HH:mm"):"Dia todo",start:r.start?.dateTime?M(r.start.dateTime):r.start?.date?M(r.start.date):new Date,end:r.end?.dateTime?M(r.end.dateTime):r.end?.date?M(r.end.date):new Date,location:r.location||"Não especificado",type:"google-event",isGoogleEvent:!0,rawEvent:r,htmlLink:r.htmlLink,google_event_id:r.id})),N=b.map(r=>({id:`avail-${r.id}`,title:r.is_booked?"Horário Reservado":"Disponível",start:M(r.start_time),end:M(r.end_time),type:r.is_booked?"booked-slot":"available-slot",isGoogleEvent:!1,rawSlot:r}));return[...l,..._,...N].sort((r,A)=>r.start-A.start)},[u,O,t,d,b]),$=h.useCallback(async(l,_=!1)=>{if(c==="PROFISSIONAL"||c==="STUDIO_PRO"){if(!l||!l.access_token){o({title:"Autenticação Necessária",description:"Por favor, autentique com o Google Calendar primeiro."});return}o({title:"Sincronizando...",description:"Buscando eventos do Google Calendar."});try{const N=await tt(l.access_token);if(z(N||[]),o({title:"Eventos do Google Calendar Carregados!"}),_&&N&&N.length>0){const r=await g(N);r>0?o({title:"Eventos Importados!",description:`${r} novo(s) evento(s) do Google Calendar foram adicionados ao fluxo de trabalho.`}):o({title:"Nenhum Novo Evento",description:"Nenhum novo evento do Google Calendar para importar."}),await s()}}catch(N){if(console.error("Error fetching Google Calendar events:",N),o({title:"Erro ao buscar eventos",description:N.message,variant:"destructive"}),N.message.toLowerCase().includes("token")||N.message.toLowerCase().includes("auth"))if(l.refresh_token){o({title:"Token Expirado",description:"Tentando atualizar token de acesso...",variant:"default"});try{const{newTokens:r}=await at(l.refresh_token),A={...l,access_token:r.access_token,expiry_date:Date.now()+r.expires_in*1e3};await re(A),o({title:"Token Atualizado!",description:"Tentando buscar eventos novamente.",variant:"success"}),await $(A,_)}catch(r){console.error("Error refreshing access token:",r),o({title:"Falha ao Atualizar Token",description:`Não foi possível atualizar a sessão com o Google. Por favor, autentique novamente: ${r.message}`,variant:"destructive"}),await V()}}else o({title:"Sessão Expirada",description:"Sua autenticação com o Google expirou e não há refresh token. Por favor, autentique novamente.",variant:"warning"}),await V()}}},[o,g,s,c,re,V]);h.useEffect(()=>{if(!(c==="PROFISSIONAL"||c==="STUDIO_PRO"))return;const l=new URLSearchParams(window.location.search),_=l.get("google_auth_success"),N=l.get("google_auth_error");if(N){o({title:"Erro de Autenticação Google",description:`O Google retornou um erro: ${N}`,variant:"destructive"}),window.history.replaceState({},document.title,window.location.pathname);return}_?(o({title:"Google Calendar Autenticado!",description:"Agora você pode sincronizar seus eventos."}),s("settings").then(()=>{j?.google_tokens&&$(j.google_tokens,!0)}),window.history.replaceState({},document.title,window.location.pathname)):F&&O.length===0&&!k&&$(F,!1)},[F,o,$,k,c,s,j]);const De=(l,_=null)=>{v(l);const N={date:w(l,"yyyy-MM-dd"),time:_,status:"agendado"};x("workflow",{cardId:null,initialData:N})},Ge=()=>{De(i||new Date)},I=l=>{l.isGoogleEvent?l.htmlLink?window.open(l.htmlLink,"_blank"):o({title:"Evento do Google",description:"Detalhes do evento: "+l.title}):l.type==="available-slot"||l.type==="booked-slot"?x("availability",{existingSlot:l.rawSlot,date:l.start}):x("workflow",{cardId:l.rawCard.id})},Ae=async()=>{if(!f){o({title:"Erro",description:"Usuário não encontrado.",variant:"destructive"});return}q(!0),o({title:"Iniciando autenticação com Google...",description:"Você será redirecionado."});try{const{authUrl:l}=await st(f.id);if(l)window.location.href=l;else throw new Error("URL de autenticação não recebida.")}catch(l){o({title:"Erro de Autenticação",description:`Não foi possível obter a URL de autenticação do Google: ${l.message}`,variant:"destructive"}),q(!1)}},B=(l,_)=>{x("availability",{date:l,time:_})},Pe=()=>{switch(U){case"month":return e.jsx(xe,{currentDate:y,selectedDate:i,setSelectedDate:v,combinedEvents:T,onEventClick:I,onDateClick:B});case"week":return e.jsx(kt,{currentDate:y,combinedEvents:T,onEventClick:I,onDateClick:B});case"day":return e.jsx(wt,{currentDate:y,combinedEvents:T,onEventClick:I,onDateClick:B});case"agenda":return e.jsx(vt,{combinedEvents:T,onEventClick:I});default:return e.jsx(xe,{currentDate:y,selectedDate:i,setSelectedDate:v,combinedEvents:T,onEventClick:I,onDateClick:B})}};return e.jsxs(e.Fragment,{children:[e.jsx(Ct,{isOpen:!!n.bookingSettings,onClose:()=>S("bookingSettings")}),e.jsx(pt,{isOpen:!!n.availability,onClose:()=>S("availability"),initialData:n.availability}),e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:`flex flex-col ${Y?"items-center text-center":"sm:flex-row sm:items-center sm:justify-between"} gap-4`,children:[e.jsxs(E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:Y?"hidden":"",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-foreground titulo-gradiente",children:"Calendário"}),e.jsx("p",{className:"text-muted-foreground mt-1 text-sm sm:text-base",children:"Gerencie seus agendamentos e compromissos"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2 w-full sm:w-auto",children:[e.jsxs(C,{variant:"outline",onClick:()=>p("/availability-manager"),className:"w-full sm:w-auto",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Gerenciar Horários"]}),e.jsxs(C,{variant:"outline",onClick:()=>x("bookingSettings"),className:"w-full sm:w-auto",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Agenda PRO"]}),e.jsx(Ee,{googleTokens:F,isGoogleAuthInProgress:k,onAuth:Ae,onSync:()=>$(F,!0),onLogout:V,className:"w-full sm:w-auto"}),e.jsxs(C,{onClick:Ge,className:"btn-custom-gradient text-white shadow-lg w-full sm:w-auto",children:[e.jsx(et,{className:"w-4 h-4 mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"Novo Agendamento"}),e.jsx("span",{className:"sm:hidden",children:"Agendar"})]})]})]}),e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-card rounded-xl p-3 sm:p-6 shadow-lg border border-border",children:[e.jsx(yt,{currentDate:y,setCurrentDate:G,currentView:U,setCurrentView:Me,isMobile:Y}),Pe()]}),e.jsx(Nt,{combinedEvents:T.filter(l=>l.type!=="available-slot"),onEventClick:I})]})]})};export{Qt as default};
