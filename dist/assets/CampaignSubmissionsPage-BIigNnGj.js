import{af as _,u as E,a3 as C,e as S,r as l,j as e,B as m,b0 as k,J as h,s as f}from"./index-hGCyqJo1.js";import{E as P}from"./jspdf.es.min-CyFs_XKR.js";import"./jspdf.plugin.autotable-DtM0_LT_.js";import{A as R}from"./arrow-left-Dxkegdz9.js";import{U as F}from"./user-plus-DdRjLAtS.js";import"./typeof-QjJsDpFa.js";const A=()=>{const{formId:i}=_(),n=E(),{user:u}=C(),{toast:x}=S(),[c,b]=l.useState(null),[d,j]=l.useState([]),[g,p]=l.useState(!0);l.useEffect(()=>{(async()=>{if(u){p(!0);try{const{data:s,error:t}=await f.from("client_forms").select("*").eq("id",i).single();if(t||!s)throw new Error("Formulário não encontrado.");b(s);let r,o;if(s.form_type==="feedback"?{data:r,error:o}=await f.from("feedback_submissions").select("*").eq("form_id",i).order("created_at",{ascending:!1}):{data:r,error:o}=await f.from("lead_submissions").select("*").eq("form_id",i).order("created_at",{ascending:!1}),o)throw o;j(r||[])}catch(s){x({title:"Erro ao buscar dados",description:s.message,variant:"destructive"}),n("/forms")}finally{p(!1)}}})()},[i,u,x,n]);const w=()=>{const a=new P;a.text(`Respostas para: ${c.title}`,14,16);const s=["Data de Envio","Respostas"],t=[];d.forEach(r=>{const o=h(new Date(r.created_at),"dd/MM/yyyy HH:mm"),y=Object.entries(r.answers).map(([N,D])=>`${N}: ${D}`).join(`
`),v=[o,y];t.push(v)}),a.autoTable({head:[s],body:t,startY:20,styles:{valign:"middle"},headStyles:{fillColor:[22,163,74]},columnStyles:{1:{cellWidth:"auto"}}}),a.save(`respostas_${c.title.replace(/\s+/g,"_")}.pdf`)};return g?e.jsx("div",{children:"Carregando respostas..."}):e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>n("/forms"),children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Voltar"]}),e.jsx("h1",{className:"text-2xl font-bold mt-2 titulo-gradiente",children:c?.title}),e.jsxs("p",{className:"text-muted-foreground",children:[d.length," respostas recebidas"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",onClick:w,children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Exportar PDF"]}),c?.form_type!=="feedback"&&e.jsxs(m,{onClick:()=>n("/clients"),children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Ver Leads como Clientes"]})]})]}),e.jsx("div",{className:"bg-card p-4 rounded-lg shadow-md border",children:d.length>0?e.jsx("div",{className:"space-y-4",children:d.map(a=>e.jsxs("div",{className:"border-b pb-4 last:border-b-0",children:[e.jsxs("p",{className:"text-sm text-muted-foreground mb-2",children:["Recebido em: ",h(new Date(a.created_at),"dd/MM/yyyy 'às' HH:mm")]}),e.jsx("div",{className:"space-y-1",children:Object.entries(a.answers).map(([s,t])=>e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-foreground",children:[s,":"]}),e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:String(t)})]},s))})]},a.id))}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma resposta para este formulário ainda."})})})]})};export{A as default};
