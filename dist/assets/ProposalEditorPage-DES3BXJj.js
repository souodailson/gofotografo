import{e as U,R as ae,j as e,Q as ne,V as ie,W as re,X as le,Y as ce,I as de,B as l,ad as pe,a2 as ue,r as g,a3 as me,ag as he,o as F,at as xe,aa as fe,s as _}from"./index-CsuWV44D.js";import{u as ge,a as je,b as ve,c as Ce,D as we,H as be,L as Se,E as ke,d as ye,e as Me,P as Re,f as Ee,S as Pe,R as Ne,C as ze}from"./EditorRulers-DaTkNM8-.js";import{L as Be,T as Ie,E as Le}from"./EditorCanvas-BLuHZ3AJ.js";import{C as De}from"./copy-jZEBkcbL.js";import{E as Oe}from"./external-link-BXxE1D86.js";import{M as $e}from"./message-square-8cSxknpH.js";import{G as Ae}from"./grip-vertical-8lNaHOAN.js";import"./dnd.esm-CTDRg8Fb.js";import"./defineProperty-DbXIQDXj.js";import"./typeof-QjJsDpFa.js";import"./extends-CF3RwP-h.js";import"./tiny-invariant-CopsF_GD.js";import"./useDebounce-C0UXpH0o.js";import"./jspdf.es.min-CxLqaaCD.js";import"./html2canvas.esm-BfxBtG_O.js";import"./tabs-d6mLrd2b.js";import"./alert-dialog-DCpSHYr3.js";import"./plus-circle-By27hXvU.js";import"./upload-BXfLDO8L.js";import"./switch-BYbInfSL.js";import"./instagram-B6PM5wTg.js";import"./image-BdS79y2z.js";import"./link-BOiro_Jb.js";import"./popover-BUN5D7nz.js";import"./ban-CWZXDNuW.js";import"./tooltip-DQQEbUQ4.js";import"./chevron-up-Mkf2P_rO.js";import"./eye-BINIZlYE.js";import"./eye-off-CaDeEfEa.js";import"./type-BVpCsaud.js";import"./settings-pny4a10P.js";import"./arrow-left-f-zo1ixY.js";import"./underline-CgqPfBkJ.js";import"./star-BkV2QQFC.js";import"./share-2-qftt3Yqt.js";import"./square-pk0MGHAZ.js";import"./palette-Bb-y2WOP.js";import"./align-justify-BLBOHdli.js";import"./list-BSFRY5tW.js";import"./index-VINhjdwK.js";import"./index-Chjiymov.js";const Ge=({isOpen:c,onClose:d,publicUrl:t,proposalName:o})=>{const{toast:r}=U(),[x,a]=ae.useState(!1),m=()=>{navigator.clipboard.writeText(t),a(!0),r({title:"Link copiado!"}),setTimeout(()=>a(!1),2e3)},p={whatsapp:`https://api.whatsapp.com/send?text=${encodeURIComponent(`Confira minha proposta: ${o}
${t}`)}`,linkedin:`https://www.linkedin.com/shareArticle?mini=true&url=${encodeURIComponent(t)}&title=${encodeURIComponent(o)}`,twitter:`https://twitter.com/intent/tweet?url=${encodeURIComponent(t)}&text=${encodeURIComponent(`Confira minha proposta: ${o}`)}`};return e.jsx(ne,{open:c,onOpenChange:d,children:e.jsxs(ie,{children:[e.jsxs(re,{children:[e.jsx(le,{children:"Proposta Publicada com Sucesso!"}),e.jsx(ce,{children:"Sua proposta estÃ¡ online e pronta para ser compartilhada."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{value:t,readOnly:!0}),e.jsx(l,{size:"icon",onClick:m,children:x?e.jsx(pe,{className:"h-4 w-4"}):e.jsx(De,{className:"h-4 w-4"})})]}),e.jsx(l,{asChild:!0,className:"w-full",children:e.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Oe,{className:"mr-2 h-4 w-4"}),"Abrir em nova aba"]})}),e.jsxs("div",{className:"flex items-center justify-center gap-2 pt-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Compartilhar:"}),e.jsx(l,{asChild:!0,variant:"ghost",size:"icon",children:e.jsx("a",{href:p.whatsapp,target:"_blank",rel:"noopener noreferrer",children:e.jsx($e,{})})}),e.jsx(l,{asChild:!0,variant:"ghost",size:"icon",children:e.jsx("a",{href:p.linkedin,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Be,{})})}),e.jsx(l,{asChild:!0,variant:"ghost",size:"icon",children:e.jsx("a",{href:p.twitter,target:"_blank",rel:"noopener noreferrer",children:e.jsx(Ie,{})})})]})]}),e.jsx(ue,{children:e.jsx(l,{onClick:d,children:"Fechar"})})]})})},Fe=({onResize:c})=>{const d=g.useRef(null),t=o=>{o.preventDefault();const r=o.clientX,x=d.current.parentElement.getBoundingClientRect().width,a=p=>{requestAnimationFrame(()=>{const b=p.clientX-r;c(x+b)})},m=()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",m)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",m)};return e.jsx("div",{ref:d,className:"absolute top-0 -right-2 h-full w-4 cursor-ew-resize flex items-center justify-center transition-opacity z-50",onMouseDown:t,children:e.jsx(Ae,{className:"text-muted-foreground"})})},Et=({isAdmin:c=!1})=>{const d=ge({isAdmin:c}),{proposal:t,setProposal:o,proposalId:r,isNew:x,activeSection:a,setActiveSection:m,loading:p,saving:M,saveStatus:b,uploads:X,loadingUploads:q,handleSave:S,handlePublish:H,fetchUploads:k}=d,j=je(),{selectedBlock:u,handleSetSelectedBlock:v,viewMode:f,setViewMode:R,canvasWidth:T,setCanvasWidth:W,isLeftSidebarOpen:E,setIsLeftSidebarOpen:P,isRightSidebarOpen:N,setIsRightSidebarOpen:z,snapLines:V,setSnapLines:Q,toolbarPosition:Y}=j,[J,B]=g.useState(!1),[K,Z]=g.useState(""),{addBlock:y,updateBlock:h}=ve(o,v,f),I=g.useRef(null),n=Ce({selectedBlock:u,updateBlock:h,addBlock:y,activeSection:a,canvasRef:I,viewMode:f,setViewMode:R,proposalName:t?.nome_da_proposta}),{fileInputRef:ee,handleFileInputClick:L}=n,{user:D}=me(),{toast:C}=U(),O=g.useRef(null),te=async(s,i)=>{const w=s.target.files?.[0];if(!w||!D||!i)return;if(w.size>10*1024*1024){C({title:"Arquivo muito grande",description:"O arquivo excede o limite de 10MB.",variant:"destructive"});return}C({title:"Enviando arquivo...",description:"Aguarde um momento."});const oe=xe(w.name),$=`${D.id}/${r||"new"}/${fe()}-${oe}`,{error:A}=await _.storage.from("propostas").upload($,w);if(A){C({title:"Erro no upload",description:A.message,variant:"destructive"});return}const{data:{publicUrl:G}}=_.storage.from("propostas").getPublicUrl($);i.type==="image"?h(i.id,{content:{...i.content,src:G}}):i.type==="pdf"&&h(i.id,{content:{src:G}}),k(r),C({title:"Arquivo atualizado!",variant:"success"}),s.target.value=""},se=async()=>{const s=await H();s&&(Z(s),B(!0))};return p||!t?e.jsx(he,{}):e.jsx(we,{backend:be,children:e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900 w-full fixed inset-0 overflow-hidden",onClick:n.closeContextMenu,children:[e.jsx("input",{type:"file",ref:ee,className:"hidden",onChange:s=>te(s,u),accept:u?.type==="pdf"?"application/pdf":"image/*"}),e.jsx(F,{children:E&&e.jsx(Se,{onAddBlock:y,activeSection:a,uploads:X,loadingUploads:q,proposalId:r,onUploadComplete:()=>k(r),isNew:x,handleSave:()=>S(),onToggle:()=>P(!1)})}),e.jsxs("main",{className:"flex-1 flex flex-col overflow-hidden transition-all duration-300 ease-in-out app-toolbar",children:[e.jsx(ke,{navigateBack:()=>S(!0),viewMode:f,setViewMode:R,handleExportPdf:n.handleExportPdf,handleSave:()=>S(),handlePublish:se,saving:M,saveStatus:b,isAdmin:c,proposal:t}),e.jsx(ye,{selectedBlock:u,updateBlock:h,toolbarPosition:Y,onReplaceImage:()=>L()}),e.jsxs("div",{ref:O,className:"flex-1 overflow-auto bg-muted/40 p-4 sm:p-8 relative flex justify-center studio-editor-container",onClick:()=>v(null),children:[e.jsx(Me,{scrollContainerRef:O}),!E&&e.jsx(l,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 z-30",onClick:()=>P(!0),children:e.jsx(Re,{})}),!N&&u&&e.jsx(l,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-30",onClick:()=>z(!0),children:e.jsx(Ee,{})}),e.jsxs("div",{className:"mx-auto transition-all duration-300 relative group/canvas-container",style:{width:`${T}px`},onClick:s=>s.stopPropagation(),children:[e.jsx(Le,{ref:I,sections:t.sections,blocksBySection:t.blocksBySection,addBlock:y,setSelectedBlock:v,selectedBlockId:u?.id,updateBlock:h,showGrid:j.showGrid,globalStyles:t.theme,activeSection:a,viewMode:f,setProposal:o,onContextMenu:n.handleContextMenu,setSnapLines:Q}),e.jsx(Fe,{onResize:W}),V.map((s,i)=>e.jsx("div",{className:"absolute bg-orange-300",style:{...s.type==="vertical"?{left:s.position,top:0,width:"1px",height:"100%"}:{top:s.position,left:0,height:"1px",width:"100%"},zIndex:99998}},i))]})]}),e.jsx(Pe,{sections:t.sections,activeSection:a,setActiveSection:m,setProposal:o,proposal:t})]}),e.jsx(F,{children:N&&e.jsx(Ne,{selectedBlock:u,updateBlock:h,setSelectedBlock:v,globalStyles:t.theme,setGlobalStyles:s=>o(i=>({...i,theme:s})),showGrid:j.showGrid,setShowGrid:j.setShowGrid,proposal:t,setProposal:o,isAdmin:c,onToggle:()=>z(!1),onUploadComplete:()=>k(r),viewMode:f})}),n.contextMenu&&e.jsx(ze,{x:n.contextMenu.x,y:n.contextMenu.y,block:n.contextMenu.block,onClose:n.closeContextMenu,onAction:n.handleContextMenuAction,onFileInputClick:L}),e.jsx(Ge,{isOpen:J,onClose:()=>B(!1),publicUrl:K,proposalName:t?.nome_da_proposta})]})})};export{Et as default};
