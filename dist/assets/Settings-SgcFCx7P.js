import{c as ue,j as e,m as w,h as xe,r as d,I as ae,B as g,l as L,a3 as A,L as q,i as ke,d as Pe,e as F,s as _,p as Z,T as Me,C as ne,a as Oe,a4 as Te,n as he,a6 as P,ac as Fe,a5 as De,y as ie,E as ce,z as Ee,o as ge,q as Y,t as J,v as W,w as K,x as X,f as Ie,u as Ge,b as Re,aL as Le}from"./index-4y5FCHHl.js";import{g as qe,e as Ue}from"./googleCalendar-D6rl2VV9.js";import{S as fe}from"./switch-Kb-SWC7G.js";import{G as Be}from"./globe-BHOrixid.js";import{M as pe}from"./message-square-BqWpQ5x6.js";import{A as je,b as be,c as ve,d as Ne,e as ye,f as we,a as $e,g as ze,h as Ve}from"./alert-dialog-DhXlLYQ6.js";import{T as U,a as B,b as $,c as z}from"./tooltip-DRDfD7tc.js";import{F as V}from"./FeatureRestrictionModal-DiSWRpkR.js";import{S as ee}from"./shield-DehDF7Sx.js";import{P as se}from"./palette-BUE3btkq.js";import{P as He}from"./plus-circle-wCnyduKs.js";import{R as Se}from"./refresh-cw-9WFD0m77.js";import{B as Qe}from"./badge-DfvgCtvX.js";import{f as Ce}from"./formatDistanceToNow-DqSt7Mk_.js";import{C as Ye}from"./chevron-up-ChCTpsoS.js";import{p as _e}from"./pt-BR-BZmCGEt5.js";import{L as te,a as Je}from"./lightbulb-BE8XW7Nl.js";import{S as le}from"./settings-BYt_7WJj.js";import"./extends-CF3RwP-h.js";import"./constructNow-CbkLzTT3.js";import"./endOfDay-C-GA39Ru.js";import"./endOfMonth-9pjN7R8H.js";const We=ue("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]),de=ue("Blocks",[["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["path",{d:"M10 21V8a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-5a1 1 0 0 0-1-1H3",key:"1fpvtg"}]]),Ke="w-full px-3 py-2 border border-slate-300 dark:border-slate-600 rounded-lg bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 focus:ring-2 focus:ring-customPurple focus:border-transparent",R=(a,r,s,i,n,l="Selecione...")=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:r,className:"block text-sm font-medium text-muted-foreground mb-1",children:a}),e.jsxs("select",{id:r,value:s||"",onChange:c=>i(c.target.value),className:Ke,children:[e.jsx("option",{value:"",disabled:!0,children:l}),n.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]})]}),Xe=({formData:a,handleInputChange:r})=>e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:1*.05},className:"bg-card rounded-xl p-6 shadow-lg border border-border lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-customPurple to-customGreen rounded-lg flex items-center justify-center",children:e.jsx(Be,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold text-card-foreground",children:"Preferências da Conta"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[R("Idioma","language",a.language,s=>r("language",s),[{label:"Português (Brasil)",value:"pt-BR"},{label:"English (US)",value:"en-US"}],"Selecione o Idioma"),R("Moeda Padrão","currency",a.currency,s=>r("currency",s),[{label:"Real Brasileiro (R$)",value:"BRL"},{label:"Dólar Americano ($)",value:"USD"},{label:"Euro (€)",value:"EUR"}],"Selecione a Moeda"),R("Fuso Horário","timezone",a.timezone,s=>r("timezone",s),[{label:"Brasília (GMT-3)",value:"America/Sao_Paulo"},{label:"Nova York (GMT-4/-5)",value:"America/New_York"},{label:"Londres (GMT+0/+1)",value:"Europe/London"}],"Selecione seu fuso horário"),R("Formato de Data","date_format",a.date_format,s=>r("date_format",s),[{label:"DD/MM/AAAA",value:"dd/mm/yyyy"},{label:"MM/DD/AAAA",value:"mm/dd/yyyy"}],"Selecione o Formato de Data"),e.jsx("div",{className:"md:col-span-2 border-t border-border pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(xe,{htmlFor:"show-greetings",className:"font-medium text-card-foreground flex items-center",children:[e.jsx(pe,{className:"w-4 h-4 mr-2 text-customPurple"}),"Exibir Saudações Iniciais"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Mostrar saudações criativas no topo do dashboard."})]}),e.jsx(fe,{id:"show-greetings",checked:a.show_greetings,onCheckedChange:s=>r("show_greetings",s)})]})})]})]}),Ze=({isOpen:a,onClose:r,enrollData:s,onSuccess:i,toast:n})=>{const[l,c]=d.useState(""),[m,p]=d.useState(""),[b,u]=d.useState(!1),[j,x]=d.useState("");d.useEffect(()=>{s?.totp?.qr_code&&c(s.totp.qr_code)},[s]);const N=async f=>{if(f.preventDefault(),x(""),!m.trim()){x("Por favor, insira o código de verificação.");return}u(!0);try{const{error:v}=await supabase.auth.mfa.challenge({factorId:s.id});if(v)throw v;const{error:M}=await supabase.auth.mfa.verify({factorId:s.id,code:m});if(M)throw M;i()}catch(v){console.error("Error verifying MFA:",v),x(v.message||"Código de verificação inválido ou erro ao ativar 2FA."),n({title:"Erro ao verificar MFA",description:"Não foi possível verificar o código. Verifique e tente novamente.",variant:"destructive"})}finally{u(!1)}};return a?e.jsx(je,{open:a,onOpenChange:f=>!f&&r(),children:e.jsxs(be,{className:"sm:max-w-[425px]",children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Ativar Autenticação de Dois Fatores"}),e.jsx(ye,{children:"Escaneie o QR Code abaixo com um aplicativo autenticador e insira o código gerado para ativar o 2FA."})]}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"py-4 space-y-6",children:[l?e.jsx("div",{className:"mx-auto w-48 h-48 border",dangerouslySetInnerHTML:{__html:l}}):e.jsx("p",{className:"text-sm text-center",children:"Gerando QR Code..."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"mfa-code",className:"block text-sm font-medium",children:"Código de Verificação"}),e.jsx(ae,{id:"mfa-code",type:"text",value:m,onChange:f=>p(f.target.value),placeholder:"Insira o código do autenticador"})]}),j&&e.jsx("p",{className:"text-sm text-red-500 dark:text-red-400",children:j})]}),e.jsxs(we,{children:[e.jsx(g,{type:"button",variant:"secondary",onClick:r,disabled:b,children:"Cancelar"}),e.jsxs(g,{type:"submit",disabled:b,children:[b&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Ativar 2FA"]})]})]})]})}):null},es=()=>{const{planStatus:a}=A(),[r,s]=d.useState(!1),[i,n]=d.useState(!1),l=a==="PROFISSIONAL"||a==="STUDIO_PRO",c=()=>{l?s(!0):n(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-foreground",children:"Autenticação de Dois Fatores (MFA)"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Adicione uma camada extra de segurança à sua conta. A autenticação de dois fatores é uma funcionalidade premium."})]}),l?e.jsxs(g,{onClick:c,children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Ativar Autenticação de Dois Fatores"]}):e.jsx(U,{children:e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsx("div",{className:"inline-block",children:e.jsxs(g,{onClick:c,disabled:!0,className:"cursor-not-allowed",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Ativar Autenticação de Dois Fatores"]})})}),e.jsx(z,{children:e.jsx("p",{children:"Funcionalidade Premium"})})]})})]}),e.jsx(Ze,{isOpen:r,onClose:()=>s(!1)}),e.jsx(V,{isOpen:i,onClose:()=>n(!1),featureName:"Autenticação de Dois Fatores",requiredPlans:["PROFISSIONAL","STUDIO_PRO"],currentPlan:a})]})},ss=({formData:a,handleNotificationChange:r})=>e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:4*.05},className:"bg-card rounded-xl p-6 shadow-lg border border-border lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-customPurple to-customGreen rounded-lg flex items-center justify-center",children:e.jsx(We,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold text-card-foreground",children:"Notificações"})]}),e.jsx("div",{className:"space-y-4",children:["email","whatsapp","calendar"].map(s=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-card-foreground capitalize",children:s==="calendar"?"Calendário (Google)":s}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Receber notificações ",s==="calendar"?"e sincronizar":"por"," ",s]})]}),e.jsx(ke,{checked:a.notifications[s],onCheckedChange:i=>r(s,i),id:`notif-${s}`})]},s))})]}),as=()=>{const{theme:a,toggleTheme:r}=Pe();return e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:5*.05},className:"bg-card rounded-xl p-6 shadow-lg border border-border lg:col-span-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-customPurple to-customGreen rounded-lg flex items-center justify-center",children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold text-card-foreground",children:"Aparência"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-muted-foreground mb-2",children:"Tema"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(g,{variant:a==="light"?"default":"outline",onClick:()=>a!=="light"&&r(),className:`flex items-center space-x-2 ${a==="light"?"btn-custom-gradient text-white":""}`,children:[e.jsx("span",{children:"☀️"}),e.jsx("span",{children:"Claro"})]}),e.jsxs(g,{variant:a==="dark"?"default":"outline",onClick:()=>a!=="dark"&&r(),className:`flex items-center space-x-2 ${a==="dark"?"btn-custom-gradient text-white":""}`,children:[e.jsx("span",{children:"🌙"}),e.jsx("span",{children:"Escuro"})]})]})]})})]})},ts=()=>{const{planStatus:a}=A(),[r,s]=d.useState(!1),i=a==="STUDIO_PRO",n=()=>{i||s(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-foreground",children:"Equipe"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Convide membros para sua equipe e gerencie permissões. Disponível no plano STUDIO PRO."})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex -space-x-2 overflow-hidden",children:[e.jsx("img",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-background",src:"https://images.unsplash.com/photo-1491528323818-fdd1faba62cc?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",alt:""}),e.jsx("img",{className:"inline-block h-8 w-8 rounded-full ring-2 ring-background",src:"https://images.unsplash.com/photo-1550525811-e5869dd03032?ixlib=rb-1.2.1&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",alt:""})]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Você e mais 1 membro."})]}),i?e.jsxs(g,{onClick:n,children:[e.jsx(He,{className:"w-4 h-4 mr-2"}),"Convidar Membro"]}):e.jsx(U,{children:e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsx("div",{className:"inline-block",children:e.jsxs(g,{disabled:!0,className:"cursor-not-allowed",onClick:n,children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Convidar Membro"]})})}),e.jsx(z,{children:e.jsx("p",{children:"Disponível no plano STUDIO PRO"})})]})}),e.jsx(V,{isOpen:r,onClose:()=>s(!1),featureName:"Gestão de Equipe",requiredPlans:["STUDIO_PRO"],currentPlan:a})]})},rs=({formData:a,handleAutomationChange:r})=>{const{googleTokens:s,setGoogleTokens:i,planStatus:n}=A(),{toast:l}=F(),[c,m]=d.useState(!1),[p,b]=d.useState(!1),u=n==="PROFISSIONAL"||n==="STUDIO_PRO",j=async()=>{if(!u){b(!0);return}m(!0);try{const{data:f,error:v}=await _.functions.invoke("google-generate-auth-url");if(v)throw v;window.location.href=f.authUrl}catch(f){l({title:"Erro de Autenticação",description:`Não foi possível iniciar a autenticação com o Google: ${f.message}`,variant:"destructive"}),m(!1)}},x=async()=>{i(null),l({title:"Desconectado",description:"Sua conta Google foi desconectada."})},N=()=>s?e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Conectado ao Google Calendar."}),e.jsx(g,{onClick:x,variant:"destructive_outline",size:"sm",children:"Desconectar"})]}):u?e.jsxs(g,{onClick:j,disabled:c,className:"bg-gradient-to-r from-blue-500 to-sky-600 hover:from-blue-600 hover:to-sky-700 text-white",children:[e.jsx(Se,{className:`w-4 h-4 mr-2 ${c?"animate-spin":""}`}),"Autenticar com Google"]}):e.jsx(U,{children:e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsx("div",{className:"inline-flex items-center",children:e.jsxs(g,{disabled:!0,className:"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Autenticar com Google"]})})}),e.jsx(z,{children:e.jsx("p",{children:"Funcionalidade Premium"})})]})});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(V,{isOpen:p,onClose:()=>b(!1),featureName:"Integração com Google Calendar",requiredPlans:["PROFISSIONAL","STUDIO_PRO"],currentPlan:n}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Integração com Google Calendar"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Sincronize seus agendamentos e eventos diretamente com sua agenda do Google para nunca perder um compromisso."}),N()]}),e.jsxs("div",{className:"border-t border-border pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Automações de Comunicação"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Ative lembretes automáticos para economizar tempo e manter seus clientes informados. (Funcionalidade em desenvolvimento)"}),e.jsx("div",{className:"space-y-4",children:[{id:"session_reminder",label:"Lembrete de Sessão/Evento"},{id:"payment_reminder",label:"Lembrete de Pagamento Pendente"},{id:"meeting_reminder",label:"Lembrete de Reunião Agendada"},{id:"pre_event_sequence",label:"Sequência de E-mails Pré-Evento"},{id:"post_event_sequence",label:"Sequência de E-mails Pós-Evento (Feedback/Upsell)"}].map(f=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-background rounded-lg border border-border",children:[e.jsx(xe,{htmlFor:f.id,className:"text-sm text-foreground",children:f.label}),e.jsx(fe,{id:f.id,checked:a.automation?.[f.id]||!1,onCheckedChange:v=>r(f.id,v),disabled:!0})]},f.id))})]})]})},os=()=>{const{toast:a}=F(),{user:r,signOut:s}=A(),i=async()=>{try{const{error:n}=await _.functions.invoke("delete-user-account");if(n)throw n;a({title:"Conta excluída",description:"Sua conta e todos os dados foram excluídos com sucesso. Você será desconectado."}),setTimeout(()=>{s()},3e3)}catch(n){a({title:"Erro ao excluir a conta",description:`Não foi possível processar sua solicitação: ${n.message}`,variant:"destructive"})}};return e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-foreground",children:"Gerenciamento de Dados e Conta"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Exporte seus dados ou exclua sua conta permanentemente."}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"border border-destructive/50 bg-destructive/5 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Z,{className:"w-5 h-5 text-destructive flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-destructive",children:"Excluir Conta"}),e.jsx("p",{className:"text-sm text-destructive/80 mb-3",children:"Esta ação é irreversível. Todos os seus dados, incluindo clientes, trabalhos e informações financeiras, serão permanentemente apagados."}),e.jsxs(je,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(g,{variant:"destructive",children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"Excluir minha conta"]})}),e.jsxs(be,{children:[e.jsxs(ve,{children:[e.jsx(Ne,{children:"Você tem certeza absoluta?"}),e.jsx(ye,{children:"Esta ação não pode ser desfeita. Isso irá apagar permanentemente sua conta e remover seus dados de nossos servidores."})]}),e.jsxs(we,{children:[e.jsx(ze,{children:"Cancelar"}),e.jsx(Ve,{onClick:i,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Sim, excluir conta"})]})]})]})]})]})})})]})},ns=()=>{const{planStatus:a,settings:r,setSettings:s}=A(),[i,n]=d.useState(!1),[l,c]=d.useState(!1),{toast:m}=F(),p=a==="PROFISSIONAL"||a==="STUDIO_PRO",b=r?.google_calendar_credentials?.access_token,u=async()=>{if(!p){n(!0);return}c(!0);try{const{authUrl:x,error:N}=await qe();if(N)throw new Error(N);window.location.href=x}catch(x){m({title:"Erro ao autenticar com Google",description:x.message,variant:"destructive"}),c(!1)}},j=()=>{const x={...r,google_calendar_credentials:null};s(x),m({title:"Google Calendar Desconectado",description:"A integração foi removida com sucesso."})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg text-foreground",children:"Integrações"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Conecte o GO.FOTÓGRAFO com outras ferramentas para automatizar seu fluxo de trabalho."})]}),e.jsxs("div",{className:"border border-border rounded-lg p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-muted p-3 rounded-full",children:e.jsx(ne,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-foreground",children:"Google Calendar"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sincronize seus agendamentos automaticamente."})]})]}),b?e.jsxs(g,{variant:"outline",onClick:j,children:[e.jsx(Oe,{className:"w-4 h-4 mr-2 text-green-500"}),"Conectado"]}):p?e.jsxs(g,{onClick:u,disabled:l,children:[l?e.jsx(Se,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(ne,{className:"w-4 h-4 mr-2"}),l?"Aguardando...":"Autenticar com Google"]}):e.jsx(U,{children:e.jsxs(B,{children:[e.jsx($,{asChild:!0,children:e.jsx("div",{className:"inline-block",children:e.jsxs(g,{onClick:()=>n(!0),children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Autenticar com Google"]})})}),e.jsx(z,{children:e.jsx("p",{children:"Funcionalidade Premium"})})]})})]}),e.jsx(V,{isOpen:i,onClose:()=>n(!1),featureName:"Integração com Google Calendar",requiredPlans:["PROFISSIONAL","STUDIO_PRO"],currentPlan:a})]})},me=({type:a,onSubmit:r,isSubmitting:s})=>{const[i,n]=d.useState(""),[l,c]=d.useState(""),m=p=>{if(p.preventDefault(),a==="support"&&(!i||!l)){alert("Por favor, preencha o assunto e a mensagem.");return}if(a==="suggestion"&&!l){alert("Por favor, escreva sua sugestão.");return}r({type:a,subject:i,message:l}),n(""),c("")};return e.jsxs("form",{onSubmit:m,className:"space-y-4 p-1",children:[a==="support"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"support-subject",className:"block text-sm font-medium text-muted-foreground mb-1",children:"Assunto"}),e.jsx(ae,{id:"support-subject",type:"text",placeholder:"Ex: Dúvida sobre faturamento",value:i,onChange:p=>n(p.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:`${a}-message`,className:"block text-sm font-medium text-muted-foreground mb-1",children:a==="support"?"Descreva seu problema":"Sua sugestão"}),e.jsx(Te,{id:`${a}-message`,placeholder:a==="support"?"Detalhe sua dúvida ou problema aqui...":"Como podemos melhorar o GO.FOTÓGRAFO?",value:l,onChange:p=>c(p.target.value),required:!0,rows:5})]}),e.jsxs(g,{type:"submit",className:"w-full btn-custom-gradient text-white",disabled:s,children:[s?e.jsx(L,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(he,{className:"w-4 h-4 mr-2"}),s?"Enviando...":"Enviar"]})]})},is=({ticket:a,onSelect:r,isSelected:s})=>{const i=n=>{switch(n){case"aberto":return"warning";case"fechado":return"success";default:return"secondary"}};return e.jsxs("div",{className:P("p-4 border rounded-lg cursor-pointer transition-all duration-200",s?"bg-muted border-primary":"hover:bg-muted/50"),onClick:()=>r(a.id),children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-foreground",children:a.assunto||"Sugestão"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Protocolo: ",a.protocolo]})]}),e.jsx(Qe,{variant:i(a.status),children:a.status})]}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:Ce(new Date(a.created_at),{addSuffix:!0,locale:_e})}),s?e.jsx(Ye,{className:"w-4 h-4"}):e.jsx(Fe,{className:"w-4 h-4"})]})]})},cs=({ticket:a,messages:r,onSendMessage:s,isSending:i,messageSenders:n})=>{const{user:l}=A(),[c,m]=d.useState(""),p=u=>{u.preventDefault(),c.trim()&&(s(a.id,c),m(""))},b=(u,j)=>{if(j==="admin")return e.jsx(ie,{className:"h-8 w-8",children:e.jsx(ce,{className:"bg-primary text-primary-foreground",children:e.jsx(te,{className:"h-5 w-5"})})});const x=n[u];return e.jsxs(ie,{className:"h-8 w-8",children:[e.jsx(Ee,{src:x?.profile_photo,alt:x?.user_name}),e.jsx(ce,{children:x?.user_name?.charAt(0).toUpperCase()||"U"})]})};return e.jsxs(w.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3},className:"mt-2 p-4 bg-muted/30 rounded-lg",children:[e.jsx(De,{className:"h-64 pr-4",children:e.jsx("div",{className:"space-y-4",children:r.map(u=>{const j=u.sender_id===l.id;return e.jsxs("div",{className:P("flex items-end gap-2",j?"flex-row-reverse":"flex-row"),children:[b(u.sender_id,u.sender_role),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("div",{className:P("p-3 rounded-lg max-w-xs md:max-w-md",j?"bg-primary text-primary-foreground":"bg-background"),children:e.jsx("p",{className:"text-sm",children:u.mensagem})}),e.jsx("p",{className:P("text-xs text-muted-foreground",j?"text-right":"text-left"),children:Ce(new Date(u.created_at),{addSuffix:!0,locale:_e})})]})]},u.id)})})}),a.status==="aberto"&&e.jsxs("form",{onSubmit:p,className:"mt-4 flex gap-2",children:[e.jsx(ae,{value:c,onChange:u=>m(u.target.value),placeholder:"Digite sua resposta...",disabled:i}),e.jsx(g,{type:"submit",disabled:i,children:i?e.jsx(L,{className:"w-4 h-4 animate-spin"}):e.jsx(he,{className:"w-4 h-4"})})]})]})},ls=({tickets:a,selectedTicketId:r,onSelectTicket:s,messages:i,onSendMessage:n,isSendingMessage:l,messageSenders:c})=>a.length===0?e.jsx("p",{className:"text-center text-muted-foreground py-8",children:"Você ainda não abriu nenhum chamado."}):e.jsx("div",{className:"space-y-2",children:a.map(m=>e.jsxs("div",{children:[e.jsx(is,{ticket:m,onSelect:s,isSelected:r===m.id}),r===m.id&&e.jsx(cs,{ticket:m,messages:i[m.id]||[],onSendMessage:n,isSending:l,messageSenders:c})]},m.id))}),ds=()=>{const{user:a}=A(),{toast:r}=F(),[s,i]=d.useState("new"),[n,l]=d.useState([]),[c,m]=d.useState({}),[p,b]=d.useState({}),[u,j]=d.useState(null),[x,N]=d.useState(!0),[f,v]=d.useState(!1),[M,D]=d.useState(!1),O=d.useCallback(async()=>{if(!a)return;N(!0);const{data:t,error:o}=await _.from("suporte_chamados").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});o?r({title:"Erro ao buscar chamados",description:o.message,variant:"destructive"}):l(t),N(!1)},[a,r]);d.useEffect(()=>{O()},[O]);const y=async t=>{const{data:o,error:h}=await _.from("suporte_mensagens").select("*").eq("chamado_id",t).order("created_at",{ascending:!0});if(h){r({title:"Erro ao buscar mensagens",description:h.message,variant:"destructive"});return}m(S=>({...S,[t]:o}));const k=[...new Set(o.map(S=>S.sender_id))];if(k.length>0){const{data:S,error:re}=await _.from("settings").select("user_id, user_name, profile_photo").in("user_id",k);if(re)r({title:"Erro ao buscar dados dos remetentes",description:re.message,variant:"destructive"});else{const Ae=S.reduce((G,oe)=>(G[oe.user_id]=oe,G),{});b(G=>({...G,...Ae}))}}},H=t=>{u===t?j(null):(j(t),c[t]||y(t))},E=async t=>{if(a){v(!0);try{const o=`GO-${Date.now()}`,{data:h,error:k}=await _.from("suporte_chamados").insert({user_id:a.id,protocolo:o,tipo:t.type,assunto:t.subject,status:"aberto"}).select().single();if(k)throw k;const{error:S}=await _.from("suporte_mensagens").insert({chamado_id:h.id,sender_id:a.id,sender_role:"user",mensagem:t.message});if(S)throw S;r({title:"Enviado com sucesso!",description:`Seu protocolo é ${o}.`}),await O(),i("history")}catch(o){r({title:"Erro ao enviar",description:o.message,variant:"destructive"})}finally{v(!1)}}},I=async(t,o)=>{if(a){D(!0);try{const{error:h}=await _.from("suporte_mensagens").insert({chamado_id:t,sender_id:a.id,sender_role:"user",mensagem:o});if(h)throw h;await y(t)}catch(h){r({title:"Erro ao enviar mensagem",description:h.message,variant:"destructive"})}finally{D(!1)}}},Q=()=>{if(s==="new")return e.jsxs(Y,{children:[e.jsxs(J,{children:[e.jsx(W,{children:"Abrir Novo Chamado"}),e.jsx(K,{children:"Precisa de ajuda ou tem uma sugestão? Nos diga aqui."})]}),e.jsx(X,{children:e.jsx(me,{type:"support",onSubmit:E,isSubmitting:f})})]});if(s==="suggestion")return e.jsxs(Y,{children:[e.jsxs(J,{children:[e.jsx(W,{children:"Enviar Sugestão"}),e.jsx(K,{children:"Adoramos ouvir suas ideias para melhorar o GO.FOTÓGRAFO!"})]}),e.jsx(X,{children:e.jsx(me,{type:"suggestion",onSubmit:E,isSubmitting:f})})]});if(s==="history")return e.jsxs(Y,{children:[e.jsxs(J,{children:[e.jsx(W,{children:"Histórico de Chamados"}),e.jsx(K,{children:"Acompanhe suas solicitações e sugestões."})]}),e.jsx(X,{children:x?e.jsx(L,{className:"mx-auto my-8 h-8 w-8 animate-spin"}):e.jsx(ls,{tickets:n,selectedTicketId:u,onSelectTicket:H,messages:c,onSendMessage:I,isSendingMessage:M,messageSenders:p})})]})};return e.jsxs(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6},children:[e.jsxs("div",{className:"flex space-x-1 bg-muted p-1 rounded-lg mb-4",children:[e.jsxs(g,{onClick:()=>i("new"),className:P("flex-1 h-9 text-sm",s==="new"?"bg-background text-foreground shadow-sm":"bg-transparent text-muted-foreground"),children:[e.jsx(te,{className:"w-4 h-4 mr-2"})," Novo Suporte"]}),e.jsxs(g,{onClick:()=>i("suggestion"),className:P("flex-1 h-9 text-sm",s==="suggestion"?"bg-background text-foreground shadow-sm":"bg-transparent text-muted-foreground"),children:[e.jsx(Je,{className:"w-4 h-4 mr-2"})," Sugestão"]}),e.jsxs(g,{onClick:()=>i("history"),className:P("flex-1 h-9 text-sm",s==="history"?"bg-background text-foreground shadow-sm":"bg-transparent text-muted-foreground"),children:[e.jsx(pe,{className:"w-4 h-4 mr-2"})," Meus Chamados"]})]}),e.jsx(ge,{mode:"wait",children:e.jsx(w.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:Q()},s)})]})},C={language:"pt-BR",currency:"BRL",timezone:"America/Sao_Paulo",date_format:"dd/mm/yyyy",notifications:{email:!0,whatsapp:!0,calendar:!0},automation:{session_reminder:!1,payment_reminder:!1,meeting_reminder:!1,pre_event_sequence:!1,post_event_sequence:!1},user_name:"",business_name:"",photography_type:"",cnpj:"",cpf:"",phones:[{number:""}],contact_email:"",website_social:[{type:"website",url:""}],address:"",profile_photo:null,logo:null,subdomain:"",hide_dashboard_balances:!1,workflow_columns:null,google_calendar_credentials:null,show_greetings:!0},T=({title:a,icon:r,children:s,delay:i,className:n})=>e.jsx(w.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i},className:`bg-card rounded-xl shadow-lg border border-border ${n}`,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-customPurple to-customGreen rounded-lg flex items-center justify-center",children:e.jsx(r,{className:"w-5 h-5 text-white"})}),e.jsx("h2",{className:"text-xl font-semibold text-card-foreground",children:a})]}),e.jsx("div",{className:"space-y-6",children:s})]})}),Fs=({isMobile:a,updateUrl:r})=>{const{settings:s,setSettings:i,user:n}=A(),{toast:l}=F(),[c,m]=d.useState(C),p=Ie(),b=Ge(),[u,j]=d.useState("preferences"),{isMobile:x}=Re(),N=d.useCallback(async t=>{try{const{tokens:o,error:h}=await Ue(t);if(h)throw new Error(h);const k={...s,google_calendar_credentials:o};await i(k),l({title:"Google Calendar Conectado!",description:"Sua conta foi autenticada com sucesso."})}catch(o){l({title:"Erro na autenticação",description:`Não foi possível conectar com o Google Calendar: ${o.message}`,variant:"destructive"})}finally{b("/settings?tab=integrations",{replace:!0})}},[s,i,l,b]);d.useEffect(()=>{const t=new URLSearchParams(p.search),o=t.get("code"),h=t.get("tab")||"preferences";o&&N(o),["preferences","functionalities","integrations","security","dataManagement","support"].includes(h)?j(h):j("preferences")},[p.search,N]);const f=t=>{j(t),b(`/settings?tab=${t}`,{replace:!0})};d.useEffect(()=>{if(s){const t={};for(const o in C)s.hasOwnProperty(o)?o==="show_greetings"?t[o]=s[o]===null||s[o]===void 0?!0:s[o]:typeof C[o]=="object"&&C[o]!==null&&!Array.isArray(C[o])?t[o]={...C[o],...s[o]}:t[o]=s[o]:t[o]=C[o];!t.user_name&&n?.user_metadata?.full_name&&(t.user_name=n.user_metadata.full_name),!t.contact_email&&n?.email&&(t.contact_email=n.email),m(t)}},[s,n]);const v=(t,o)=>{m(h=>({...h,[t]:o}))},M=(t,o)=>{m(h=>({...h,notifications:{...h.notifications,[t]:o}}))},D=(t,o)=>{m(h=>({...h,automation:{...h.automation||C.automation,[t]:o}}))},O=()=>{const t={...c};t.show_greetings=c.show_greetings,delete t.google_calendar_credentials,i(t),l({title:"Configurações salvas 💾",description:"Suas configurações foram atualizadas com sucesso!"})},y={formData:c,handleInputChange:v,toast:l},H={...y,handleNotificationChange:M},E={...y,handleAutomationChange:D},I=()=>e.jsxs(g,{onClick:O,className:"btn-custom-gradient text-white shadow-lg w-full sm:w-auto",children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"Salvar Alterações"]}),Q=()=>{switch(u){case"preferences":return e.jsxs(T,{title:"Preferências e Aparência",icon:se,delay:.1,children:[e.jsx(Xe,{...y,formData:c,handleInputChange:v}),e.jsx(as,{})]});case"functionalities":return e.jsxs(T,{title:"Funcionalidades do Sistema",icon:le,delay:.2,children:[e.jsx(ss,{...H,formData:c}),e.jsx(rs,{...E,formData:c}),e.jsx(ts,{...y,formData:c})]});case"integrations":return e.jsx(T,{title:"Integrações",icon:de,delay:.3,children:e.jsx(ns,{...y})});case"security":return e.jsx(T,{title:"Segurança da Conta",icon:ee,delay:.4,children:e.jsx(es,{...y})});case"dataManagement":return e.jsx(T,{title:"Gerenciamento de Dados",icon:Z,delay:.5,children:e.jsx(os,{...y})});case"support":return e.jsx(ds,{});default:return null}};return e.jsxs("div",{className:"space-y-8 pb-12",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs(w.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:x?"hidden":"",children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Configurações do Sistema"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Ajuste suas preferências e funcionalidades."})]}),!x&&e.jsx(I,{})]}),e.jsx("div",{className:"flex space-x-1 border-b border-border mb-6 overflow-x-auto scrollbar-thin pb-px",children:[{id:"preferences",label:"Preferências",icon:se},{id:"functionalities",label:"Funcionalidades",icon:le},{id:"integrations",label:"Integrações",icon:de},{id:"security",label:"Segurança",icon:ee},{id:"dataManagement",label:"Dados",icon:Z},{id:"support",label:"Suporte",icon:te}].map(t=>e.jsxs(g,{variant:u===t.id?"default":"ghost",onClick:()=>f(t.id),className:`rounded-b-none whitespace-nowrap px-3 py-2 h-auto sm:px-4 ${u===t.id?"bg-primary/5 text-primary border-b-2 border-primary":"text-muted-foreground"}`,children:[e.jsx(t.icon,{className:`w-4 h-4 ${x?"":"mr-2"}`}),!x&&t.label]},t.id))}),e.jsx(ge,{mode:"wait",children:e.jsx(w.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.2},children:Q()},u)}),x&&e.jsx("div",{className:"mt-8",children:e.jsx(I,{})})]})};export{Fs as default};
