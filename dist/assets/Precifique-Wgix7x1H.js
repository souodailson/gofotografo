import{c as be,j as e,q as y,t as C,v as P,x as S,m as f,w as E,B as N,o as Ne,T as re,bF as ye,h as j,I as v,aF as Ce,aA as Pe,co as Se,i as _e,a6 as we,D as X,aY as Fe,cp as Ee,aP as De,e as oe,r as l,Q as Me,V as ke,W as Ae,X as qe,Y as Te,a2 as Ve,l as He,a3 as Re,aa as Y}from"./index-qkwE8oul.js";import{A as $e,a as Be,b as Ge,c as Ie,d as Le,e as ze,f as Oe,g as Qe,h as Ue}from"./alert-dialog-CrFx3DpK.js";import{R as ie}from"./receipt-BFN5siZu.js";import{P as ne}from"./plus-circle-CcYN74Zw.js";import{H as W}from"./hourglass-C43YqPwq.js";import{P as Ye}from"./pen-square-CutDEGL4.js";import{A as le}from"./alert-circle-ywz-mxe-.js";import{T as We}from"./trending-up-QFuWA9wG.js";import{T as Xe}from"./target-BL3UvRd7.js";import{P as Je}from"./percent-DkqS4I3z.js";import{P as Ke}from"./pen-line-Dqal8hBW.js";const Ze=be("SmilePlus",[["path",{d:"M22 11v1a10 10 0 1 1-9-10",key:"ew0xw9"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}],["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}]]),te=({title:s,value:n,icon:c,description:o,colorClass:t="text-customPurple"})=>e.jsxs(y,{className:"precifique-card-standard flex flex-col",children:[e.jsxs(C,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(P,{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx(c,{className:`h-5 w-5 ${t}`})]}),e.jsxs(S,{className:"flex-grow flex flex-col justify-center",children:[e.jsx("div",{className:`text-3xl font-bold ${t}`,children:n}),o&&e.jsx("p",{className:"text-xs text-muted-foreground pt-1",children:o})]})]}),es={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},ss=({fixedCosts:s,dataLoading:n,onAddNew:c,onEdit:o,onDelete:t,totalMonthlyFixedCost:r,costPerHour:d,formatCurrency:p})=>e.jsx(f.section,{variants:es,initial:"hidden",animate:"visible",children:e.jsxs(y,{className:"precifique-card-standard",children:[e.jsx(C,{className:"pb-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsxs("div",{children:[e.jsxs(P,{className:"text-2xl font-bold text-foreground flex items-center",children:[e.jsx(ie,{className:"w-7 h-7 mr-3 text-customPurple"}),"Passo 1: Seus Custos Fixos Mensais"]}),e.jsx(E,{className:"mt-1 text-muted-foreground",children:"Liste todas as suas despesas mensais recorrentes para entender a base dos seus custos."})]}),e.jsxs(N,{onClick:c,className:"btn-custom-gradient mt-4 sm:mt-0 shadow-lg hover:opacity-90 transition-opacity",children:[e.jsx(ne,{className:"w-5 h-5 mr-2"}),"Adicionar Custo Fixo"]})]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:n&&s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"mx-auto h-12 w-12 text-muted-foreground animate-spin mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando custos fixos..."})]}):s.length>0?e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto pr-2 scrollbar-thin",children:e.jsx(Ne,{children:s.map(m=>e.jsxs(f.div,{layout:!0,initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"flex items-center justify-between p-3 bg-muted/50 dark:bg-muted/20 rounded-lg shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("span",{className:"font-medium text-foreground",children:m.nome_custo}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-customGreen font-semibold",children:p(m.valor_mensal)}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>o(m),className:"text-blue-500 hover:text-blue-700 h-8 w-8",children:e.jsx(Ye,{className:"h-4 w-4"})}),e.jsxs($e,{children:[e.jsx(Be,{asChild:!0,children:e.jsx(N,{variant:"ghost",size:"icon",className:"text-red-500 hover:text-red-700 h-8 w-8",children:e.jsx(re,{className:"h-4 w-4"})})}),e.jsxs(Ge,{children:[e.jsxs(Ie,{children:[e.jsx(Le,{children:"Confirmar Exclusão"}),e.jsxs(ze,{children:['Tem certeza que deseja excluir o custo "',m.nome_custo,'"?']})]}),e.jsxs(Oe,{children:[e.jsx(Qe,{children:"Cancelar"}),e.jsx(Ue,{onClick:()=>t(m.id),className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})]})]})]},m.id))})}):e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-border rounded-lg",children:[e.jsx(le,{className:"mx-auto h-12 w-12 text-muted-foreground opacity-50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum custo fixo adicionado ainda."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:'Clique em "+ Adicionar Custo Fixo" para começar.'})]})}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx(te,{title:"Custo Fixo Total Mensal",value:p(r),icon:We,description:"Soma de todos os seus custos fixos mensais.",colorClass:"text-customGreen"}),e.jsx(te,{title:"Seu Custo por Hora",value:`${p(d)} / hora`,icon:W,description:"Baseado em 160h/mês. Essencial para precificar!",colorClass:"text-red-500"})]})]})})]})}),as={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},ts=({serviceName:s,setServiceName:n})=>e.jsx(f.section,{variants:as,initial:"hidden",animate:"visible",children:e.jsxs(y,{className:"precifique-card-standard",children:[e.jsxs(C,{children:[e.jsxs(P,{className:"text-2xl font-bold text-foreground flex items-center",children:[e.jsx(ye,{className:"w-7 h-7 mr-3 text-customPurple"}),"Passo 2: Descreva seu Serviço"]}),e.jsx(E,{className:"mt-1 text-muted-foreground",children:"Qual nome você dará a este pacote ou serviço?"})]}),e.jsxs(S,{children:[e.jsx(j,{htmlFor:"serviceName",className:"text-muted-foreground",children:"Nome do Pacote ou Serviço*"}),e.jsx(v,{id:"serviceName",value:s,onChange:c=>n(c.target.value),placeholder:"Ex: Ensaio de Gestante - Pacote Ouro",className:"mt-1 bg-input border-border focus:border-customPurple"})]})]})}),rs={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},os=({hours:s,setHours:n,totalDedicatedHours:c})=>{const o=(t,r)=>{n(d=>({...d,[t]:r}))};return e.jsx(f.section,{variants:rs,initial:"hidden",animate:"visible",children:e.jsxs(y,{className:"precifique-card-standard",children:[e.jsxs(C,{children:[e.jsxs(P,{className:"text-2xl font-bold text-foreground flex items-center",children:[e.jsx(Ce,{className:"w-7 h-7 mr-3 text-customPurple"}),"Passo 3: Custo do Seu Tempo"]}),e.jsx(E,{className:"mt-1 text-muted-foreground",children:"Quantas horas você dedicará a este serviço?"})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"hoursMeeting",children:"Horas de Reunião e Planejamento"}),e.jsx(v,{id:"hoursMeeting",type:"number",value:s.meeting,onChange:t=>o("meeting",t.target.value),placeholder:"Ex: 2",className:"mt-1 bg-input border-border focus:border-customPurple"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"hoursTravel",children:"Horas de Deslocamento"}),e.jsx(v,{id:"hoursTravel",type:"number",value:s.travel,onChange:t=>o("travel",t.target.value),placeholder:"Ex: 1.5",className:"mt-1 bg-input border-border focus:border-customPurple"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"hoursEvent",children:"Horas Fotografando no Evento"}),e.jsx(v,{id:"hoursEvent",type:"number",value:s.event,onChange:t=>o("event",t.target.value),placeholder:"Ex: 4",className:"mt-1 bg-input border-border focus:border-customPurple"})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"hoursEditing",children:"Horas de Edição e Tratamento"}),e.jsx(v,{id:"hoursEditing",type:"number",value:s.editing,onChange:t=>o("editing",t.target.value),placeholder:"Ex: 8",className:"mt-1 bg-input border-border focus:border-customPurple"})]})]}),e.jsx("div",{className:"pt-2",children:e.jsxs("p",{className:"text-lg font-semibold",children:["Total de Horas Dedicadas: ",e.jsxs("span",{className:"text-customGreen",children:[c.toFixed(2)," horas"]})]})})]})]})})},is={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},ns=({variableCosts:s,onAdd:n,onChange:c,onRemove:o})=>e.jsx(f.section,{variants:is,initial:"hidden",animate:"visible",children:e.jsxs(y,{className:"precifique-card-standard",children:[e.jsxs(C,{children:[e.jsxs(P,{className:"text-2xl font-bold text-foreground flex items-center",children:[e.jsx(Pe,{className:"w-7 h-7 mr-3 text-customPurple"}),"Passo 4: Custos Variáveis do Projeto"]}),e.jsx(E,{className:"mt-1 text-muted-foreground",children:"Quais são os custos que só existem para este trabalho específico? (Ex: álbum, taxas, frete)"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"space-y-3",children:s.map(t=>e.jsxs(f.div,{layout:!0,initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},className:"flex items-center space-x-2 p-3 bg-muted/50 dark:bg-muted/20 rounded-lg",children:[e.jsx(v,{type:"text",placeholder:"Descrição do Custo (Ex: Álbum 20x20)",value:t.description,onChange:r=>c(t.id,"description",r.target.value),className:"flex-grow bg-input border-border focus:border-customPurple"}),e.jsx(v,{type:"number",placeholder:"Valor (R$)",value:t.value,onChange:r=>c(t.id,"value",r.target.value),className:"w-32 bg-input border-border focus:border-customPurple"}),e.jsx(N,{variant:"ghost",size:"icon",onClick:()=>o(t.id),className:"text-red-500 hover:text-red-700",children:e.jsx(re,{className:"h-4 w-4"})})]},t.id))}),e.jsxs(N,{onClick:n,variant:"outline",className:"mt-4 border-customPurple text-customPurple hover:bg-customPurple/10",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"})," Adicionar Custo Variável"]})]})]})}),ls={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},cs=({equipments:s,selectedEquipments:n,onSelect:c,dataLoading:o,formatCurrency:t})=>e.jsx(f.section,{variants:ls,initial:"hidden",animate:"visible",children:e.jsxs(y,{className:"precifique-card-standard",children:[e.jsxs(C,{children:[e.jsxs(P,{className:"text-2xl font-bold text-foreground flex items-center",children:[e.jsx(Se,{className:"w-7 h-7 mr-3 text-customPurple"}),"Passo 5: Equipamentos Utilizados"]}),e.jsx(E,{className:"mt-1 text-muted-foreground",children:"Selecione os equipamentos que serão usados neste trabalho para contabilizar sua depreciação."})]}),e.jsx(S,{children:o&&s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"mx-auto h-12 w-12 text-muted-foreground animate-spin mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"Carregando equipamentos..."})]}):s.length>0?e.jsx("div",{className:"space-y-2 max-h-[300px] overflow-y-auto pr-2 scrollbar-thin",children:s.map(r=>e.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-muted/50 dark:bg-muted/20 rounded-lg",children:[e.jsx(_e,{id:`eq-${r.id}`,checked:!!n[r.id],onCheckedChange:()=>c(r.id)}),e.jsxs(j,{htmlFor:`eq-${r.id}`,className:"flex-grow cursor-pointer",children:[r.nome_equipamento," (",r.marca," ",r.modelo,")"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Depreciação: ",t(r.depreciacao_mensal),"/mês"]})]},r.id))}):e.jsxs("div",{className:"text-center py-8 border-2 border-dashed border-border rounded-lg",children:[e.jsx(le,{className:"mx-auto h-12 w-12 text-muted-foreground opacity-50 mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:'Nenhum equipamento cadastrado em "Meu Setup".'}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Adicione seus equipamentos para selecioná-los aqui."})]})})]})}),ds={hidden:{scale:.95,y:10},visible:{scale:1,y:0,transition:{duration:.3,ease:"easeOut"}}},ms=({baseServiceCost:s,costPerHour:n,totalDedicatedHours:c,totalVariableCosts:o,totalSelectedEquipmentsDepreciation:t,formatCurrency:r})=>e.jsx(f.div,{variants:ds,initial:"hidden",animate:"visible",className:"sticky bottom-[80px] sm:bottom-4 z-10",children:e.jsx("div",{className:"custo-base-borda-animada",children:e.jsxs("div",{className:we("rounded-xl p-6 shadow-lg transition-all duration-300","bg-white/50 dark:bg-gray-900/50 backdrop-blur-md"),children:[e.jsxs("div",{className:"pb-4",children:[e.jsxs("h3",{className:"text-2xl font-bold text-customGreen flex items-center",children:[e.jsx(X,{className:"w-7 h-7 mr-3"}),"Custo Base do Serviço"]}),e.jsxs("p",{className:"mt-1 text-muted-foreground flex items-center",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2 text-blue-400"}),"Este é o valor mínimo para cobrir seus custos, sem lucro."]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-5xl font-extrabold text-foreground",children:r(s)}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground grid grid-cols-1 sm:grid-cols-3 gap-2",children:[e.jsxs("p",{children:["Custo/Hora: ",r(n)]}),e.jsxs("p",{children:["Horas Totais: ",c.toFixed(2),"h"]}),e.jsxs("p",{children:["Custos Variáveis: ",r(o)]}),e.jsxs("p",{className:"sm:col-span-3",children:["Depreciação Equip.: ",r(t)]})]})]})]})})}),b=s=>parseFloat(s)||0,us={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}},xs=({financialReservePercentage:s,setFinancialReservePercentage:n,profitMarginPercentage:c,setProfitMarginPercentage:o,baseServiceCost:t,financialReserveValue:r,profitMarginValue:d,finalSuggestedPrice:p,onSave:m,isSavingService:_,formatCurrency:u})=>e.jsx(f.section,{variants:us,initial:"hidden",animate:"visible",children:e.jsxs(y,{className:"precifique-card-standard",children:[e.jsxs(C,{children:[e.jsxs(P,{className:"text-2xl font-bold text-foreground flex items-center",children:[e.jsx(Xe,{className:"w-7 h-7 mr-3 text-customGreen"}),"Passo 6: Sua Estratégia de Preço"]}),e.jsx(E,{className:"mt-1 text-muted-foreground",children:"Agora, vamos transformar seu custo em um preço vencedor."})]}),e.jsxs(S,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"financialReservePercentage",className:"flex items-center text-muted-foreground",children:[e.jsx(Ee,{className:"w-4 h-4 mr-2 text-customPurple"}),"Reserva Financeira (%)"]}),e.jsx(v,{id:"financialReservePercentage",type:"number",value:s,onChange:x=>n(x.target.value),placeholder:"Ex: 10",className:"mt-1 bg-input border-border focus:border-customPurple"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Sugestão: 5% a 10%. Esta é uma gordurinha para reinvestir ou para emergências."})]}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"profitMarginPercentage",className:"flex items-center text-muted-foreground",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2 text-customGreen"}),"Margem de Lucro Desejada (%)"]}),e.jsx(v,{id:"profitMarginPercentage",type:"number",value:c,onChange:x=>o(x.target.value),placeholder:"Ex: 35",className:"mt-1 bg-input border-border focus:border-customGreen"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Sugestão: 20% a 50% ou mais. Esta é a recompensa pelo seu talento e trabalho."})]})]}),e.jsxs(y,{className:"bg-gradient-to-br from-muted/30 to-muted/10 shadow-inner precifique-card-standard",children:[e.jsx(C,{children:e.jsxs(P,{className:"text-xl font-semibold text-customGreen flex items-center",children:[e.jsx(Je,{className:"w-6 h-6 mr-2"})," Preço Final Sugerido"]})}),e.jsxs(S,{className:"text-center space-y-3",children:[e.jsx("p",{className:"text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-customPurple via-customGreen to-purple-600 animate-gradient-x",children:u(p)}),e.jsxs("div",{className:"text-sm text-muted-foreground border-t border-border pt-3 space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Custo Base Total:"})," ",e.jsx("span",{children:u(t)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Reserva (",b(s).toFixed(1),"%):"]})," ",e.jsxs("span",{className:"text-customPurple",children:["(+) ",u(r)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["Lucro (",b(c).toFixed(1),"%):"]})," ",e.jsxs("span",{className:"text-customGreen",children:["(+) ",u(d)]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-lg border-t border-border pt-2 mt-2 text-foreground",children:[e.jsx("span",{children:"Preço Final para Cliente:"})," ",e.jsx("span",{children:u(p)})]})]})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsxs(N,{onClick:m,disabled:_||t<=0,className:"btn-custom-accent-gradient shadow-lg text-lg px-8 py-6",children:[e.jsx(De,{className:"w-5 h-5 mr-2"}),_?"Salvando Pacote...":"Salvar Pacote Precificado"]})})]})]})}),ps=({isOpen:s,onClose:n,onSave:c,fixedCostData:o,isLoading:t})=>{const{toast:r}=oe(),[d,p]=l.useState({nome_custo:"",valor_mensal:""});l.useEffect(()=>{s&&p(o?{nome_custo:o.nome_custo||"",valor_mensal:o.valor_mensal!==null&&o.valor_mensal!==void 0?String(o.valor_mensal):""}:{nome_custo:"",valor_mensal:""})},[s,o]);const m=u=>{const{name:x,value:F}=u.target;p(L=>({...L,[x]:F}))},_=u=>{if(u.preventDefault(),!d.nome_custo||!d.valor_mensal){r({title:"Campos Obrigatórios",description:"Nome do Custo e Valor Mensal são obrigatórios.",variant:"destructive"});return}const x=parseFloat(d.valor_mensal);if(isNaN(x)||x<0){r({title:"Valor Inválido",description:"O valor mensal deve ser um número positivo.",variant:"destructive"});return}c({...d,valor_mensal:x})};return e.jsx(Me,{open:s,onOpenChange:n,children:e.jsxs(ke,{className:"sm:max-w-[480px] shadow-2xl border-border",children:[e.jsxs(Ae,{children:[e.jsxs(qe,{className:"text-2xl font-bold text-foreground flex items-center",children:[e.jsx(ie,{className:"w-7 h-7 mr-3 text-customPurple"}),o?"Editar Custo Fixo":"Adicionar Custo Fixo"]}),e.jsx(Te,{className:"text-muted-foreground",children:o?"Atualize os detalhes deste custo fixo.":"Informe os detalhes do novo custo fixo mensal."})]}),e.jsxs("form",{onSubmit:_,className:"grid gap-6 py-4",children:[e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"nome_custo",className:"flex items-center mb-1.5 text-muted-foreground",children:[e.jsx(Ke,{className:"w-4 h-4 mr-2 text-customPurple"})," Nome do Custo*"]}),e.jsx(v,{id:"nome_custo",name:"nome_custo",value:d.nome_custo,onChange:m,placeholder:"Ex: Plano Adobe, Aluguel",required:!0,className:"bg-input border-border focus:border-customPurple"})]}),e.jsxs("div",{children:[e.jsxs(j,{htmlFor:"valor_mensal",className:"flex items-center mb-1.5 text-muted-foreground",children:[e.jsx(X,{className:"w-4 h-4 mr-2 text-customPurple"})," Valor Mensal (R$)*"]}),e.jsx(v,{id:"valor_mensal",name:"valor_mensal",type:"number",step:"0.01",min:"0",value:d.valor_mensal,onChange:m,placeholder:"Ex: 150.00",required:!0,className:"bg-input border-border focus:border-customPurple"})]})]}),e.jsxs(Ve,{className:"pt-6 border-t border-border",children:[e.jsx(N,{variant:"outline",onClick:n,disabled:t,className:"hover:border-destructive hover:text-destructive",children:"Cancelar"}),e.jsx(N,{type:"submit",onClick:_,disabled:t,className:"btn-custom-gradient bg-customPurple hover:opacity-90",children:t?e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"mr-2 h-4 w-4 animate-spin"}),"Salvando..."]}):"Salvar Custo"})]})]})})},_s=()=>{const{toast:s}=oe(),{fixedCosts:n,addFixedCost:c,updateFixedCost:o,deleteFixedCost:t,equipments:r,addPricedService:d,addServicePackage:p,loading:m}=Re(),[_,u]=l.useState(!1),[x,F]=l.useState(null),[L,H]=l.useState(!1),[ce,J]=l.useState(!1),[z,K]=l.useState(""),[g,Z]=l.useState({meeting:"",travel:"",event:"",editing:""}),[w,R]=l.useState([{id:Y(),description:"",value:""}]),[$,ee]=l.useState({}),[D,se]=l.useState(""),[M,ae]=l.useState(""),B=l.useMemo(()=>n.reduce((i,a)=>i+(Number(a.valor_mensal)||0),0),[n]),k=l.useMemo(()=>B>0?B/160:0,[B]),de=()=>{F(null),u(!0)},me=i=>{F(i),u(!0)},ue=async i=>{H(!0);try{await t(i),s({title:"Sucesso!",description:"Custo fixo excluído."})}catch(a){s({title:"Erro ao excluir",description:a.message||"Não foi possível excluir o custo.",variant:"destructive"})}finally{H(!1)}},xe=async i=>{H(!0);const a={...i,valor_mensal:parseFloat(i.valor_mensal)||0};try{x?(await o(x.id,a),s({title:"Sucesso!",description:"Custo fixo atualizado."})):(await c(a),s({title:"Sucesso!",description:"Custo fixo adicionado."})),u(!1),F(null)}catch(T){s({title:"Erro ao salvar custo",description:T.message||"Não foi possível salvar o custo.",variant:"destructive"})}finally{H(!1)}},A=l.useMemo(()=>(parseFloat(g.meeting)||0)+(parseFloat(g.travel)||0)+(parseFloat(g.event)||0)+(parseFloat(g.editing)||0),[g]),pe=()=>{R([...w,{id:Y(),description:"",value:""}])},he=(i,a,T)=>{R(w.map(V=>V.id===i?{...V,[a]:T}:V))},ve=i=>{R(w.filter(a=>a.id!==i))},G=l.useMemo(()=>w.reduce((i,a)=>i+(parseFloat(a.value)||0),0),[w]),ge=i=>{ee(a=>({...a,[i]:!a[i]}))},I=l.useMemo(()=>r.reduce((i,a)=>$[a.id]?i+(parseFloat(a.depreciacao_mensal)||0):i,0),[r,$]),h=l.useMemo(()=>k*A+G+I,[k,A,G,I]),O=l.useMemo(()=>h*(b(D)/100),[h,D]),Q=l.useMemo(()=>h*(b(M)/100),[h,M]),U=l.useMemo(()=>h+O+Q,[h,O,Q]),je=l.useCallback(()=>{K(""),Z({meeting:"",travel:"",event:"",editing:""}),R([{id:Y(),description:"",value:""}]),ee({}),se(""),ae("")},[]),fe=async()=>{if(!z.trim()){s({title:"Nome do Serviço Obrigatório",description:"Por favor, informe o nome do pacote ou serviço (Passo 2).",variant:"destructive"}),document.getElementById("serviceName")?.focus();return}if(h<=0&&U<=0){s({title:"Cálculo Incompleto",description:"Preencha os campos de horas e custos para calcular o preço.",variant:"destructive"});return}J(!0);const i={nome_servico:z,custo_total_calculado:h,preco_final_sugerido:U,reserva_financeira_percentual:b(D),margem_lucro_percentual:b(M),detalhes_custos:{custo_por_hora:k,total_horas_dedicadas:A,detalhe_horas:{reuniao_planejamento:parseFloat(g.meeting)||0,deslocamento:parseFloat(g.travel)||0,evento_sessaofotos:parseFloat(g.event)||0,edicao_tratamento:parseFloat(g.editing)||0},custos_variaveis_lista:w.filter(a=>a.description.trim()&&parseFloat(a.value)>0),soma_custos_variaveis:G,equipamentos_selecionados_lista:r.filter(a=>$[a.id]).map(a=>({id:a.id,nome_equipamento:a.nome_equipamento,depreciacao_mensal:a.depreciacao_mensal})),soma_depreciacao_equipamentos:I}};try{const a=await d(i);if(a){const T=`Custo Base: ${q(h)}. Reserva: ${b(D)}%. Lucro: ${b(M)}%.`,V={name:a.nome_servico,price_cash_pix:a.preco_final_sugerido,price_card:a.preco_final_sugerido,description:T,items_included:[],cost:a.custo_total_calculado};await p(V),s({title:"Sucesso Completo!",description:"Pacote precificado salvo e também adicionado à sua lista de Pacotes de Serviços!",className:"bg-green-500 text-white"})}else s({title:"Sucesso Parcial",description:"Pacote precificado salvo, mas houve um problema ao adicioná-lo aos Pacotes de Serviços.",variant:"warning"});je()}catch(a){s({title:"Erro ao Salvar",description:a.message||"Não foi possível salvar o pacote precificado e/ou o pacote de serviço.",variant:"destructive"})}finally{J(!1)}},q=i=>i==null||isNaN(parseFloat(i))?"R$ 0,00":new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(parseFloat(i));return e.jsxs("div",{className:"container mx-auto p-4 md:p-6 lg:p-8 space-y-12",children:[e.jsxs("header",{className:"text-center",children:[e.jsx(X,{className:"mx-auto h-16 w-16 text-primary mb-4 animate-pulse"}),e.jsx("h1",{className:"text-5xl sm:text-6xl font-extrabold titulo-gradiente-animado mb-3",children:"Precifique seu Trabalho"}),e.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Um assistente passo a passo para calcular o preço perfeito para seus serviços, garantindo lucro e competitividade."})]}),e.jsx(ss,{fixedCosts:n,dataLoading:m,onAddNew:de,onEdit:me,onDelete:ue,totalMonthlyFixedCost:B,costPerHour:k,formatCurrency:q}),e.jsx(ps,{isOpen:_,onClose:()=>{u(!1),F(null)},onSave:xe,fixedCostData:x,isLoading:L}),e.jsx(ts,{serviceName:z,setServiceName:K}),e.jsx(os,{hours:g,setHours:Z,totalDedicatedHours:A}),e.jsx(ns,{variableCosts:w,onAdd:pe,onChange:he,onRemove:ve}),e.jsx(cs,{equipments:r,selectedEquipments:$,onSelect:ge,dataLoading:m,formatCurrency:q}),e.jsx(ms,{baseServiceCost:h,costPerHour:k,totalDedicatedHours:A,totalVariableCosts:G,totalSelectedEquipmentsDepreciation:I,formatCurrency:q}),e.jsx(xs,{financialReservePercentage:D,setFinancialReservePercentage:se,profitMarginPercentage:M,setProfitMarginPercentage:ae,baseServiceCost:h,financialReserveValue:O,profitMarginValue:Q,finalSuggestedPrice:U,onSave:fe,isSavingService:ce,formatCurrency:q})]})};export{_s as default};
