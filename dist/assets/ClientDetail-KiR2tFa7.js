import{c as ke,d as Se,j as e,aF as K,ab as J,I as d,a1 as ee,a2 as se,a3 as ae,a4 as te,a5 as k,ar as Pe,aq as Te,i as S,B as y,X as ie,aI as Ae,aT as Fe,a8 as pe,f as ne,a7 as $,r as v,Y as Ee,Z as Ie,_ as Oe,$ as Le,a0 as qe,a6 as Re,ac as De,aU as ge,ai as Me,Q as Be,T as ze,V as $e,W as de,az as Ue,ae as Ve,s as me,a as W,q as Q,u as fe,af as Y,a9 as Xe,t as He,y as Ge,O as We,D as Qe,P as Ye,H as Ze,aj as Ke,b as Je,m as es,e as ss}from"./index-B959_7_o.js";import{T as as,a as ts,b as B,c as z}from"./tabs-5JwcCaKq.js";import{P as U}from"./plus-circle-B0lITbZK.js";import{M as is}from"./map-pin-DE1Z08iO.js";import{H as ue}from"./heart-dbyQpRUf.js";import{I as rs}from"./image-CjjvHyfl.js";import{L as re}from"./link-BuAO9sRO.js";import{P as je}from"./pen-line-BJQxJtfs.js";import{A as ns,b as ls,c as os,d as cs,e as ds,f as ms,g as us,h as xs}from"./alert-dialog-CMWSZjMP.js";import{U as hs}from"./upload-cloud-BQ_2h3Tg.js";import{F as ps}from"./file-spreadsheet-BlFo8TCQ.js";import{M as gs}from"./more-vertical-_AfS99pC.js";import{C as fs}from"./calendar-days-Ch_ciOqy.js";const js=ke("ArrowRightCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),vs=()=>{const{theme:s}=Se();return e.jsx("div",{className:"flex items-center justify-center h-screen bg-background",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:s==="dark"?"https://rouvkvcngmsquebokdyg.supabase.co/storage/v1/object/public/gofiles//logotipo%20gofotografo%20claro.png":"https://rouvkvcngmsquebokdyg.supabase.co/storage/v1/object/public/gofiles//logotipo%20gofotografo%20claro.png",alt:"GO.FOTÓGRAFO Logo",className:"h-12 mb-6 animate-pulse"}),e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Carregando sua experiência..."})]})})},bs=({clientType:s,clientName:t,clientStatus:o})=>{const l=s==="Pessoa Jurídica"?K:J;return e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-customPurple to-customGreen rounded-full flex items-center justify-center text-white text-3xl mr-4",children:e.jsx(l,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t}),e.jsxs("p",{className:"text-muted-foreground",children:[s," - ",o]})]})]})},Z=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-4 mt-6 border-b border-border pb-2",children:[e.jsx(s,{className:"w-5 h-5 mr-2"}),t]}),j=({label:s,id:t,children:o,icon:l,className:p})=>e.jsxs("div",{className:`mb-4 ${p}`,children:[e.jsxs(S,{htmlFor:t,className:"text-sm font-medium text-muted-foreground flex items-center mb-1",children:[l&&e.jsx(l,{className:"w-4 h-4 mr-2 text-primary"}),s]}),o]}),_s=({formData:s,handleChange:t,handleJsonFieldChange:o,handleAdditionalPhoneChange:l,addAdditionalPhone:p,removeAdditionalPhone:f})=>s?e.jsxs(e.Fragment,{children:[e.jsx(Z,{icon:J,title:"Informações Básicas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"Nome Completo / Razão Social",id:"name",children:e.jsx(d,{id:"name",name:"name",value:s.name||"",onChange:t})}),e.jsx(j,{label:"Tipo de Cliente",id:"client_type",children:e.jsxs(ee,{name:"client_type",value:s.client_type||"Pessoa Física",onValueChange:a=>t({target:{name:"client_type",value:a}}),children:[e.jsx(se,{children:e.jsx(ae,{placeholder:"Selecione o tipo"})}),e.jsxs(te,{children:[e.jsxs(k,{value:"Pessoa Física",children:[e.jsx(J,{className:"w-4 h-4 mr-2 inline-block"}),"Pessoa Física"]}),e.jsxs(k,{value:"Pessoa Jurídica",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2 inline-block"}),"Pessoa Jurídica"]})]})]})})]}),s.client_type==="Pessoa Física"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsx(j,{label:"CPF",id:"cpf",children:e.jsx(d,{id:"cpf",name:"cpf",value:s.cpf||"",onChange:t})}),e.jsx(j,{label:"Data de Nascimento",id:"birth_date_registration",children:e.jsx(d,{type:"date",id:"birth_date_registration",name:"birth_date",value:s.birth_date||"",onChange:t})})]}),s.client_type==="Pessoa Jurídica"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsx(j,{label:"CNPJ",id:"cnpj",children:e.jsx(d,{id:"cnpj",name:"cnpj",value:s.cnpj||"",onChange:t})}),e.jsx(j,{label:"Nome do Contato Principal",id:"contact_person_name",children:e.jsx(d,{id:"contact_person_name",name:"contact_person_name",value:s.contact_person_name||"",onChange:t})}),e.jsx(j,{label:"Cargo do Contato Principal",id:"contact_person_role",children:e.jsx(d,{id:"contact_person_role",name:"contact_person_role",value:s.contact_person_role||"",onChange:t})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:e.jsx(j,{label:"Status do Cliente",id:"status",children:e.jsxs(ee,{name:"status",value:s.status||"Ativo",onValueChange:a=>t({target:{name:"status",value:a}}),children:[e.jsx(se,{children:e.jsx(ae,{placeholder:"Selecione o status"})}),e.jsxs(te,{children:[e.jsx(k,{value:"Ativo",children:"Ativo"}),e.jsx(k,{value:"Inativo",children:"Inativo"}),e.jsx(k,{value:"Lead",children:"Lead"}),e.jsx(k,{value:"Prospect",children:"Prospect"}),e.jsx(k,{value:"Bloqueado",children:"Bloqueado"})]})]})})}),e.jsx(Z,{icon:Te,title:"Informações de Contato"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"Telefone Principal",id:"phone",children:e.jsx(d,{id:"phone",name:"phone",value:s.phone||"",onChange:t})}),e.jsx(j,{label:"Email Principal",id:"email",children:e.jsx(d,{type:"email",id:"email",name:"email",value:s.email||"",onChange:t})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(S,{className:"text-sm font-medium text-muted-foreground mb-1",children:"Telefones Adicionais"}),(s.additional_phones||[]).map((a,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{value:a||"",onChange:u=>l(m,u.target.value),placeholder:"Ex: (XX) XXXXX-XXXX"}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>f(m),className:"text-destructive/70 hover:text-destructive",children:e.jsx(ie,{className:"w-4 h-4"})})]},m)),e.jsxs(y,{variant:"outline",size:"sm",onClick:p,className:"mt-2",children:[e.jsx(U,{className:"w-4 h-4 mr-2"})," Adicionar Telefone"]})]}),e.jsx(Z,{icon:is,title:"Endereço"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"CEP",id:"zip_code",children:e.jsx(d,{id:"zip_code",value:s.address?.zip_code||"",onChange:a=>o("address","zip_code",a.target.value)})}),e.jsx(j,{label:"Logradouro",id:"street",children:e.jsx(d,{id:"street",value:s.address?.street||"",onChange:a=>o("address","street",a.target.value)})}),e.jsx(j,{label:"Número",id:"number",children:e.jsx(d,{id:"number",value:s.address?.number||"",onChange:a=>o("address","number",a.target.value)})}),e.jsx(j,{label:"Complemento",id:"complement",children:e.jsx(d,{id:"complement",value:s.address?.complement||"",onChange:a=>o("address","complement",a.target.value)})}),e.jsx(j,{label:"Bairro",id:"neighborhood",children:e.jsx(d,{id:"neighborhood",value:s.address?.neighborhood||"",onChange:a=>o("address","neighborhood",a.target.value)})}),e.jsx(j,{label:"Cidade",id:"city",children:e.jsx(d,{id:"city",value:s.address?.city||"",onChange:a=>o("address","city",a.target.value)})}),e.jsx(j,{label:"Estado",id:"state",children:e.jsx(d,{id:"state",value:s.address?.state||"",onChange:a=>o("address","state",a.target.value)})}),e.jsx(j,{label:"País",id:"country",children:e.jsx(d,{id:"country",value:s.address?.country||"Brasil",onChange:a=>o("address","country",a.target.value)})})]})]}):null,xe=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-4 mt-6 border-b border-border pb-2",children:[e.jsx(s,{className:"w-5 h-5 mr-2"}),t]}),F=({label:s,id:t,children:o,icon:l,className:p})=>e.jsxs("div",{className:`mb-4 ${p}`,children:[e.jsxs(S,{htmlFor:t,className:"text-sm font-medium text-muted-foreground flex items-center mb-1",children:[l&&e.jsx(l,{className:"w-4 h-4 mr-2 text-primary"}),s]}),o]}),ys=({formData:s,handleChange:t,handleJsonFieldChange:o,handleFamilyInfoArrayChange:l,addFamilyMember:p,removeFamilyMember:f})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(F,{label:"Como conheceu seu trabalho?",id:"client_origin",icon:ue,children:e.jsx(d,{id:"client_origin",name:"client_origin",value:s.client_origin||"",onChange:t})}),e.jsxs("div",{className:"campo-formulario mb-4",children:[e.jsxs(S,{htmlFor:"birth_date_relationship_marketing",className:"text-sm font-medium text-muted-foreground flex items-center mb-1",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2 text-primary"}),"Data de Nascimento (Aniversário)"]}),e.jsx(d,{type:"date",id:"birth_date_relationship_marketing",name:"birth_date",value:s.birth_date||"",onChange:t})]})]}),e.jsx(xe,{icon:ue,title:"Informações Familiares"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(F,{label:"Nome Cônjuge/Parceiro(a)",id:"partner_name",children:e.jsx(d,{id:"partner_name",name:"family_info.partner_name",value:s.family_info?.partner_name||"",onChange:a=>o("family_info","partner_name",a.target.value)})}),e.jsx(F,{label:"Aniversário de Casamento",id:"wedding_anniversary",children:e.jsx(d,{type:"date",id:"wedding_anniversary",name:"family_info.wedding_anniversary",value:s.family_info?.wedding_anniversary||"",onChange:a=>o("family_info","wedding_anniversary",a.target.value)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(S,{className:"text-sm font-medium text-muted-foreground mb-1",children:"Filhos(as) (Nome e Data de Nascimento)"}),(s.family_info?.children_names_birthdays||[]).map((a,m)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center mb-2 p-3 border rounded-md bg-muted/20",children:[e.jsx(d,{placeholder:"Nome do Filho(a)",value:a.name||"",onChange:u=>l(m,"name",u.target.value),className:"bg-background"}),e.jsx(d,{type:"date",value:a.birth_date||"",onChange:u=>l(m,"birth_date",u.target.value),className:"bg-background"}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>f(m),className:"text-destructive/70 hover:text-destructive sm:ml-auto",children:e.jsx(Fe,{className:"w-4 h-4"})})]},m)),e.jsxs(y,{variant:"outline",size:"sm",onClick:p,className:"mt-2",children:[e.jsx(U,{className:"w-4 h-4 mr-2"})," Adicionar Filho(a)"]})]}),e.jsx(F,{label:"Preferências de Estilo",id:"style_preferences",icon:rs,children:e.jsx(pe,{id:"style_preferences",name:"style_preferences",value:s.style_preferences||"",onChange:t,rows:4})}),e.jsx(xe,{icon:re,title:"Redes Sociais"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(F,{label:"Instagram",id:"instagram",children:e.jsx(d,{id:"instagram",name:"social_media.instagram",value:s.social_media?.instagram||"",onChange:a=>o("social_media","instagram",a.target.value),placeholder:"ex: @usuario"})}),e.jsx(F,{label:"Facebook",id:"facebook",children:e.jsx(d,{id:"facebook",name:"social_media.facebook",value:s.social_media?.facebook||"",onChange:a=>o("social_media","facebook",a.target.value),placeholder:"ex: facebook.com/usuario"})}),e.jsx(F,{label:"LinkedIn",id:"linkedin",children:e.jsx(d,{id:"linkedin",name:"social_media.linkedin",value:s.social_media?.linkedin||"",onChange:a=>o("social_media","linkedin",a.target.value)})}),e.jsx(F,{label:"Outra Rede",id:"other_social",children:e.jsx(d,{id:"other_social",name:"social_media.other",value:s.social_media?.other||"",onChange:a=>o("social_media","other",a.target.value)})})]})]}),Ns=({isOpen:s,onClose:t,clientId:o,editingOrcamento:l,onSuccess:p})=>{const{toast:f}=ne(),{user:a,addOrcamento:m,updateOrcamento:u}=$(),[r,g]=v.useState({descricao_servico:"",valor:"",data_envio:new Date().toISOString().split("T")[0],status:"Enviado",link_pdf:""}),[b,T]=v.useState(!1);v.useEffect(()=>{g(l?{descricao_servico:l.descricao_servico||"",valor:l.valor||"",data_envio:l.data_envio?new Date(l.data_envio+"T00:00:00").toISOString().split("T")[0]:new Date().toISOString().split("T")[0],status:l.status||"Enviado",link_pdf:l.link_pdf||""}:{descricao_servico:"",valor:"",data_envio:new Date().toISOString().split("T")[0],status:"Enviado",link_pdf:""})},[l,s]);const N=_=>{const{name:w,value:C}=_.target;g(L=>({...L,[w]:C}))},E=(_,w)=>{g(C=>({...C,[_]:w}))},I=async _=>{if(_.preventDefault(),!a||!o){f({title:"Erro",description:"Usuário ou cliente não identificado.",variant:"destructive"});return}T(!0);const w={...r,valor:parseFloat(r.valor)||0,client_id:o,user_id:a.id};try{l?(await u(l.id,w),f({title:"Sucesso!",description:"Orçamento atualizado."})):(await m(w),f({title:"Sucesso!",description:"Orçamento adicionado."})),p()}catch(C){console.error("Erro ao salvar orçamento:",C),f({title:"Erro ao salvar",description:C.message||"Não foi possível salvar o orçamento.",variant:"destructive"})}finally{T(!1)}};return e.jsx(Ee,{open:s,onOpenChange:t,children:e.jsxs(Ie,{className:"sm:max-w-[525px] border-border shadow-xl",children:[e.jsxs(Oe,{children:[e.jsxs(Le,{className:"flex items-center text-primary",children:[l?e.jsx(je,{className:"mr-2 h-5 w-5"}):e.jsx(U,{className:"mr-2 h-5 w-5"}),l?"Editar Orçamento":"Novo Orçamento"]}),e.jsx(qe,{children:l?"Atualize os detalhes do orçamento.":"Preencha os detalhes para registrar um novo orçamento."})]}),e.jsxs("form",{onSubmit:I,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"descricao_servico",className:"text-right col-span-1",children:"Descrição"}),e.jsx(pe,{id:"descricao_servico",name:"descricao_servico",value:r.descricao_servico,onChange:N,className:"col-span-3",placeholder:"Ex: Pacote Casamento Essencial",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"valor",className:"text-right col-span-1",children:"Valor (R$)"}),e.jsx(d,{id:"valor",name:"valor",type:"number",step:"0.01",value:r.valor,onChange:N,className:"col-span-3",placeholder:"Ex: 1500.00",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"data_envio",className:"text-right col-span-1",children:"Data de Envio"}),e.jsx(d,{id:"data_envio",name:"data_envio",type:"date",value:r.data_envio,onChange:N,className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"status",className:"text-right col-span-1",children:"Status"}),e.jsxs(ee,{name:"status",value:r.status,onValueChange:_=>E("status",_),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Selecione o status"})}),e.jsxs(te,{children:[e.jsx(k,{value:"Enviado",children:"Enviado"}),e.jsx(k,{value:"Visto",children:"Visto"}),e.jsx(k,{value:"Aprovado",children:"Aprovado"}),e.jsx(k,{value:"Recusado",children:"Recusado"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"link_pdf",className:"text-right col-span-1",children:"Link PDF"}),e.jsx(d,{id:"link_pdf",name:"link_pdf",type:"url",value:r.link_pdf,onChange:N,className:"col-span-3",placeholder:"https://seu-orcamento.com/link.pdf"})]}),e.jsxs(Re,{className:"pt-4",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:t,disabled:b,children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Cancelar"]}),e.jsxs(y,{type:"submit",disabled:b,className:"btn-custom-gradient",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),b?l?"Salvando Alterações...":"Salvando Orçamento...":l?"Salvar Alterações":"Salvar Orçamento"]})]})]})]})})},he=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-4 mt-6 border-b border-border pb-2",children:[e.jsx(s,{className:"w-5 h-5 mr-2"}),t]}),ws=({formData:s})=>{const{toast:t}=ne(),{user:o,clientContracts:l,addClientContract:p,deleteClientContract:f,refreshClientContracts:a,clientOrcamentos:m,refreshClientOrcamentos:u,deleteOrcamento:r}=$(),g=v.useRef(null),[b,T]=v.useState(null),[N,E]=v.useState(!1),[I,_]=v.useState(0),[w,C]=v.useState(!1),[L,R]=v.useState(null),[D,i]=v.useState(null),[x,h]=v.useState(!1),c=s.id;v.useEffect(()=>{c&&(a&&a(c),u&&u(c))},[c,a,u]);const O=n=>{const A=n.target.files[0];A&&T(A)},ve=async()=>{if(!b||!o||!c){t({title:"Atenção",description:"Selecione um arquivo e certifique-se de que o cliente está carregado.",variant:"warning"});return}E(!0),_(0);const n=b.name,A=Ue(n.substring(0,n.lastIndexOf("."))||n),M=n.substring(n.lastIndexOf(".")),V=Ve().substring(0,8),X=`${A}_${V}${M}`,ce=`${o.id}/${c}/${X}`;try{const{error:q}=await me.storage.from("contracts").upload(ce,b,{cacheControl:"3600",upsert:!1,contentType:b.type,onUploadProgress:G=>{G.total&&_(Math.round(G.loaded/G.total*100))}});if(q)throw q;const{data:H}=me.storage.from("contracts").getPublicUrl(ce);if(!H||!H.publicUrl)throw new Error("Não foi possível obter a URL pública do arquivo.");const Ce={client_id:c,user_id:o.id,nome_arquivo:n,url_arquivo:H.publicUrl};await p(Ce),t({title:"Sucesso!",description:"Contrato anexado com sucesso.",variant:"success",icon:e.jsx(W,{className:"h-5 w-5"})}),T(null),g.current&&(g.current.value=""),a(c)}catch(q){console.error("Erro no upload ou registro do contrato:",q),t({title:"Erro ao anexar contrato",description:q.message||"Ocorreu um problema. Tente novamente.",variant:"destructive",icon:e.jsx(Q,{className:"h-5 w-5"})})}finally{E(!1),_(0)}},be=async(n,A)=>{if(!A){t({title:"Erro",description:"URL do arquivo inválida.",variant:"destructive"});return}const M=A.split("/contracts/");if(M.length<2){t({title:"Erro",description:"Formato da URL do arquivo inválido.",variant:"destructive"});return}const V=M[1];try{await f(n,V),t({title:"Sucesso",description:"Contrato excluído com sucesso.",variant:"success",icon:e.jsx(W,{className:"h-5 w-5"})}),a(c)}catch(X){t({title:"Erro ao excluir contrato",description:X.message,variant:"destructive",icon:e.jsx(Q,{className:"h-5 w-5"})})}},le=(n=null)=>{R(n),C(!0)},oe=()=>{R(null),C(!1)},_e=n=>{i(n),h(!0)},ye=async()=>{if(D)try{await r(D.id),t({title:"Sucesso",description:"Orçamento excluído com sucesso.",variant:"success",icon:e.jsx(W,{className:"h-5 w-5"})}),u(c)}catch(n){t({title:"Erro ao excluir orçamento",description:n.message,variant:"destructive",icon:e.jsx(Q,{className:"h-5 w-5"})})}h(!1),i(null)},Ne=n=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n||0),we=n=>{if(!n)return"N/A";try{return new Date(n+"T00:00:00").toLocaleDateString("pt-BR")}catch{return"Data inválida"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(he,{icon:Me,title:"Contratos Anexados"}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg border border-dashed border-primary/50",children:[e.jsx(S,{htmlFor:"contract-upload",className:"block text-sm font-medium text-muted-foreground mb-2",children:"Anexar Novo Contrato (PDF, DOCX, etc.)"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx(d,{id:"contract-upload",type:"file",ref:g,onChange:O,className:"flex-grow file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer",disabled:N}),e.jsxs(y,{onClick:ve,disabled:!b||N,className:"w-full sm:w-auto btn-custom-gradient",children:[e.jsx(hs,{className:"w-4 h-4 mr-2"}),N?`Enviando... ${I}%`:"Anexar Contrato"]})]}),N&&e.jsx("div",{className:"w-full bg-muted rounded-full h-1.5 mt-2 overflow-hidden",children:e.jsx("div",{className:"bg-primary h-1.5 rounded-full transition-all duration-300 ease-linear",style:{width:`${I}%`}})}),b&&!N&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Arquivo selecionado: ",b.name]})]}),l&&l.length>0?e.jsx("ul",{className:"space-y-3",children:l.map(n=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-card border border-border rounded-md shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("a",{href:n.url_arquivo,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-primary hover:underline truncate",title:n.nome_arquivo,children:[e.jsx(re,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.nome_arquivo||"Contrato sem nome"})]}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>be(n.id,n.url_arquivo),className:"text-destructive/70 hover:text-destructive hover:bg-destructive/10 ml-2 flex-shrink-0",title:"Excluir contrato",children:e.jsx(ie,{className:"w-4 h-4"})})]},n.id))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum contrato anexado a este cliente."}),e.jsx(he,{icon:ps,title:"Orçamentos Enviados"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs(y,{onClick:()=>le(),className:"btn-custom-gradient",children:[e.jsx(U,{className:"w-4 h-4 mr-2"})," Novo Orçamento"]})}),m&&m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Descrição"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Valor"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Data Envio"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"PDF"}),e.jsx("th",{scope:"col",className:"relative px-4 py-3",children:e.jsx("span",{className:"sr-only",children:"Ações"})})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:m.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-foreground",children:n.descricao_servico}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-foreground",children:Ne(n.valor)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-muted-foreground",children:we(n.data_envio)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                      ${n.status==="Aprovado"?"bg-green-100 text-green-800":n.status==="Recusado"?"bg-red-100 text-red-800":n.status==="Visto"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:n.status})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-muted-foreground",children:n.link_pdf?e.jsxs("a",{href:n.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:[e.jsx(re,{className:"w-4 h-4 inline-block"})," Ver PDF"]}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs(Be,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(y,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(gs,{className:"h-4 w-4"})]})}),e.jsxs($e,{align:"end",children:[e.jsxs(de,{onClick:()=>le(n),children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Editar Status"]}),e.jsxs(de,{onClick:()=>_e(n),className:"text-destructive focus:text-destructive focus:bg-destructive/10",children:[e.jsx(ie,{className:"mr-2 h-4 w-4"})," Excluir"]})]})]})})]},n.id))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum orçamento enviado para este cliente."}),w&&e.jsx(Ns,{isOpen:w,onClose:oe,clientId:c,editingOrcamento:L,onSuccess:()=>{oe(),u&&u(c)}}),e.jsx(ns,{open:x,onOpenChange:h,children:e.jsxs(ls,{children:[e.jsxs(os,{children:[e.jsx(cs,{children:"Confirmar Exclusão"}),e.jsx(ds,{children:"Tem certeza que deseja excluir este orçamento? Esta ação não poderá ser desfeita."})]}),e.jsxs(ms,{children:[e.jsx(us,{onClick:()=>i(null),children:"Cancelar"}),e.jsx(xs,{onClick:ye,className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})})]})},Cs=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-6 mt-2 border-b border-border pb-3",children:[e.jsx(s,{className:"w-6 h-6 mr-3 text-primary"}),t]}),ks=({clientId:s})=>{const{workflowCards:t,getStatusLabel:o}=$(),l=fe(),p=v.useMemo(()=>t.filter(r=>r.client_id===s&&!r.archived).sort((r,g)=>{const b=r.date?Y(r.date):new Date(0);return(g.date?Y(g.date):new Date(0))-b}),[t,s]),f=r=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r||0),a=r=>{if(!r)return"N/A";try{const g=Y(r.includes("T")?r:`${r}T00:00:00`);return Ye(g,"dd/MM/yyyy",{locale:Ze})}catch(g){return console.error("Erro ao formatar data:",r,g),"Data inválida"}},m=r=>{l(`/workflow?openCard=${r}`)},u=r=>{switch(r){case"concluido":return"bg-green-500 hover:bg-green-600";case"agendado":return"bg-blue-500 hover:bg-blue-600";case"em-andamento":return"bg-yellow-500 text-black hover:bg-yellow-600";case"proposta-enviada":return"bg-orange-300 hover:bg-purple-600";case"novo-lead":return"bg-pink-500 hover:bg-pink-600";default:return"bg-gray-500 hover:bg-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Cs,{icon:K,title:"Histórico de Serviços Prestados"}),p.length>0?e.jsx(Xe,{className:"h-[600px] pr-4 -mr-4",children:e.jsx("div",{className:"space-y-4",children:p.map(r=>e.jsx(He,{className:"overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 ease-in-out border-l-4 border-primary cursor-pointer",onClick:()=>m(r.id),children:e.jsxs(Ge,{className:"p-4 sm:p-6 space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1 sm:mb-0",children:r.title||"Serviço não especificado"}),e.jsx(We,{className:`text-xs text-white ${u(r.status)}`,children:o(r.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(fs,{className:"w-4 h-4 mr-2 text-primary"}),e.jsxs("span",{children:["Data: ",a(r.date)," ",r.time?`às ${r.time}`:""]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2 text-primary"}),e.jsxs("span",{children:["Valor: ",f(r.value)]})]})]}),r.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 pt-2",children:r.description}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",children:["Ver Detalhes no Fluxo",e.jsx(js,{className:"w-4 h-4 ml-2"})]})})]})},r.id))})}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx(K,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum serviço prestado encontrado para este cliente."})]})]})},Ss=({formData:s,handleChange:t,handleJsonFieldChange:o,handleFamilyInfoArrayChange:l,addFamilyMember:p,removeFamilyMember:f,handleAdditionalPhoneChange:a,addAdditionalPhone:m,removeAdditionalPhone:u})=>e.jsxs(as,{defaultValue:"dados-cadastrais",className:"w-full",children:[e.jsxs(ts,{className:"grid w-full grid-cols-1 sm:grid-cols-4 mb-6 bg-muted/50",children:[" ",e.jsx(B,{value:"dados-cadastrais",children:"Dados Cadastrais"}),e.jsx(B,{value:"relacionamento-marketing",children:"Relacionamento e Marketing"}),e.jsx(B,{value:"juridico-contratos",children:"Jurídico e Contratos"}),e.jsx(B,{value:"historico-servicos",children:"Histórico"})," "]}),e.jsx(z,{value:"dados-cadastrais",children:e.jsx(_s,{formData:s,handleChange:t,handleJsonFieldChange:o,handleAdditionalPhoneChange:a,addAdditionalPhone:m,removeAdditionalPhone:u})}),e.jsx(z,{value:"relacionamento-marketing",children:e.jsx(ys,{formData:s,handleChange:t,handleJsonFieldChange:o,handleFamilyInfoArrayChange:l,addFamilyMember:p,removeFamilyMember:f})}),e.jsx(z,{value:"juridico-contratos",children:e.jsx(ws,{formData:s})}),e.jsxs(z,{value:"historico-servicos",children:[" ",e.jsx(ks,{clientId:s.id})]})]}),P={name:"",email:"",phone:"",client_type:"Pessoa Física",cpf:"",cnpj:"",status:"Ativo",birth_date:"",contact_person_name:"",contact_person_role:"",address:{street:"",number:"",complement:"",neighborhood:"",city:"",state:"",zip_code:"",country:"Brasil"},additional_phones:[],client_origin:"",family_info:{partner_name:"",children_names_birthdays:[{name:"",birth_date:""}],wedding_anniversary:""},style_preferences:"",image_auth_status:"Não Solicitado",social_media:{instagram:"",facebook:"",linkedin:"",other:""}},zs=()=>{const{clientId:s}=Ke(),t=fe(),{getClientById:o,updateClient:l,loading:p,refreshClientContracts:f}=$(),{toast:a}=ne(),[m,u]=v.useState(null),[r,g]=v.useState(!0),[b,T]=v.useState(!1);Je(),v.useEffect(()=>{g(!0);const i=o(s);if(i){const x={...P,...i,birth_date:i.birth_date?i.birth_date.split("T")[0]:"",address:{...P.address,...i.address||{}},family_info:{...P.family_info,...i.family_info||{},wedding_anniversary:i.family_info?.wedding_anniversary?i.family_info.wedding_anniversary.split("T")[0]:"",children_names_birthdays:(i.family_info?.children_names_birthdays||[]).map(h=>({...h,birth_date:h.birth_date?h.birth_date.split("T")[0]:""}))},social_media:{...P.social_media,...i.social_media||{}},additional_phones:i.additional_phones||[]};u(x),f&&f(s),g(!1)}else p||(a({title:"Erro",description:"Cliente não encontrado.",variant:"destructive"}),t("/clients"),g(!1))},[s,o,p,t,a,f]);const N=i=>{const{name:x,value:h}=i.target;u(x==="client_type"?c=>({...c,client_type:h,cpf:h==="Pessoa Jurídica"?"":c.cpf,cnpj:h==="Pessoa Física"?"":c.cnpj,birth_date:h==="Pessoa Jurídica"?"":c.birth_date,contact_person_name:h==="Pessoa Física"?"":c.contact_person_name,contact_person_role:h==="Pessoa Física"?"":c.contact_person_role}):c=>({...c,[x]:h}))},E=(i,x,h)=>{u(c=>({...c,[i]:{...c[i]||(i==="address"?P.address:i==="family_info"?P.family_info:P.social_media),[x]:h}}))},I=(i,x,h)=>{u(c=>{const O=[...c.family_info?.children_names_birthdays||[]];return O[i]||(O[i]={name:"",birth_date:""}),O[i][x]=h,{...c,family_info:{...c.family_info||P.family_info,children_names_birthdays:O}}})},_=()=>{u(i=>({...i,family_info:{...i.family_info||P.family_info,children_names_birthdays:[...i.family_info?.children_names_birthdays||[],{name:"",birth_date:""}]}}))},w=i=>{u(x=>({...x,family_info:{...x.family_info||P.family_info,children_names_birthdays:(x.family_info?.children_names_birthdays||[]).filter((h,c)=>c!==i)}}))},C=(i,x)=>{u(h=>{const c=[...h.additional_phones||[]];return c[i]=x,{...h,additional_phones:c}})},L=()=>{u(i=>({...i,additional_phones:[...i.additional_phones||[],""]}))},R=i=>{u(x=>({...x,additional_phones:(x.additional_phones||[]).filter((h,c)=>c!==i)}))},D=async()=>{T(!0);try{const i={...m,birth_date:m.birth_date||null,family_info:{...m.family_info,wedding_anniversary:m.family_info?.wedding_anniversary||null,children_names_birthdays:(m.family_info?.children_names_birthdays||[]).map(x=>({...x,birth_date:x.birth_date||null})).filter(x=>x.name||x.birth_date)},additional_phones:(m.additional_phones||[]).filter(x=>x&&x.trim()!=="")};i.client_type==="Pessoa Física"?(i.cnpj=null,i.contact_person_name=null,i.contact_person_role=null):i.client_type==="Pessoa Jurídica"&&(i.cpf=null),await l(s,i),a({title:"Sucesso!",description:"Dados do cliente atualizados."})}catch(i){a({title:"Erro ao salvar",description:i.message,variant:"destructive"})}finally{T(!1)}};return r||!m?e.jsx(vs,{theme:"dark"}):e.jsxs(es.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6 max-w-5xl mx-auto pb-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{variant:"ghost",onClick:()=>t("/clients"),className:"text-primary hover:bg-primary/10",children:[e.jsx(ss,{className:"w-5 h-5 mr-2"}),"Voltar para Clientes"]}),e.jsxs(y,{onClick:D,disabled:b,className:"btn-custom-gradient text-white shadow-lg",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),b?"Salvando...":"Salvar Alterações"]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-xl border border-border",children:[e.jsx(bs,{clientType:m.client_type,clientName:m.name,clientStatus:m.status}),e.jsx(Ss,{formData:m,handleChange:N,handleJsonFieldChange:E,handleFamilyInfoArrayChange:I,addFamilyMember:_,removeFamilyMember:w,handleAdditionalPhoneChange:C,addAdditionalPhone:L,removeAdditionalPhone:R})]})]})};export{zs as default,P as initialFormData};
