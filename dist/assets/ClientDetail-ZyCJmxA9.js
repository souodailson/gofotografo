import{c as pe,d as Se,j as e,aA as Z,a7 as J,I as d,Z as ee,_ as se,$ as ae,a0 as te,a1 as k,an as Pe,am as Te,h as S,B as y,T as re,aD as Ae,aO as Ee,a4 as ge,e as ne,a3 as $,r as v,Q as Fe,V as Ie,W as Oe,X as Le,Y as Me,a2 as De,a8 as Re,aP as fe,ae as qe,K as Be,N as ze,O as $e,P as de,at as Ue,aa as Ve,s as me,a as W,p as K,u as je,ab as Q,a5 as Xe,q as He,x as Ge,D as We,J as Ke,af as Qe,b as Ye,m as Ze}from"./index-DRwGhh07.js";import{T as Je,a as es,b as B,c as z}from"./tabs-6-86FGCZ.js";import{P as U}from"./plus-circle-BoDQGLs0.js";import{M as ss}from"./map-pin-BgjgYSPM.js";import{H as ue}from"./heart-C6c15NbK.js";import{I as as}from"./image-Us0o2qdW.js";import{L as ie}from"./link-C6X5O9Jp.js";import{P as ve}from"./pen-line-BoZWGv6p.js";import{A as ts,b as rs,c as is,d as ns,e as ls,f as os,g as cs,h as ds}from"./alert-dialog-hDGwXEgF.js";import{U as ms}from"./upload-cloud-CU98l7QX.js";import{M as us}from"./more-vertical-DMnNLOHl.js";import{B as hs}from"./badge-KM9UVn0z.js";import{C as xs}from"./calendar-days-ip_tn8Yq.js";import{p as ps}from"./pt-BR-C50z7HhP.js";import{A as gs}from"./arrow-left-DLEVZzMa.js";const fs=pe("ArrowRightCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}]]),js=pe("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]),vs=()=>{const{theme:s}=Se();return e.jsx("div",{className:"flex items-center justify-center h-screen bg-background",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("img",{src:s==="dark"?"https://rouvkvcngmsquebokdyg.supabase.co/storage/v1/object/public/gofiles//logotipo%20gofotografo%20claro.png":"https://rouvkvcngmsquebokdyg.supabase.co/storage/v1/object/public/gofiles//logotipo%20gofotografo%20claro.png",alt:"GO.FOTÓGRAFO Logo",className:"h-12 mb-6 animate-pulse"}),e.jsx("div",{className:"w-12 h-12 border-4 border-primary border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-muted-foreground",children:"Carregando sua experiência..."})]})})},bs=({clientType:s,clientName:t,clientStatus:o})=>{const l=s==="Pessoa Jurídica"?Z:J;return e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-customPurple to-customGreen rounded-full flex items-center justify-center text-white text-3xl mr-4",children:e.jsx(l,{className:"w-8 h-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:t}),e.jsxs("p",{className:"text-muted-foreground",children:[s," - ",o]})]})]})},Y=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-4 mt-6 border-b border-border pb-2",children:[e.jsx(s,{className:"w-5 h-5 mr-2"}),t]}),j=({label:s,id:t,children:o,icon:l,className:p})=>e.jsxs("div",{className:`mb-4 ${p}`,children:[e.jsxs(S,{htmlFor:t,className:"text-sm font-medium text-muted-foreground flex items-center mb-1",children:[l&&e.jsx(l,{className:"w-4 h-4 mr-2 text-primary"}),s]}),o]}),_s=({formData:s,handleChange:t,handleJsonFieldChange:o,handleAdditionalPhoneChange:l,addAdditionalPhone:p,removeAdditionalPhone:f})=>s?e.jsxs(e.Fragment,{children:[e.jsx(Y,{icon:J,title:"Informações Básicas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"Nome Completo / Razão Social",id:"name",children:e.jsx(d,{id:"name",name:"name",value:s.name||"",onChange:t})}),e.jsx(j,{label:"Tipo de Cliente",id:"client_type",children:e.jsxs(ee,{name:"client_type",value:s.client_type||"Pessoa Física",onValueChange:a=>t({target:{name:"client_type",value:a}}),children:[e.jsx(se,{children:e.jsx(ae,{placeholder:"Selecione o tipo"})}),e.jsxs(te,{children:[e.jsxs(k,{value:"Pessoa Física",children:[e.jsx(J,{className:"w-4 h-4 mr-2 inline-block"}),"Pessoa Física"]}),e.jsxs(k,{value:"Pessoa Jurídica",children:[e.jsx(Pe,{className:"w-4 h-4 mr-2 inline-block"}),"Pessoa Jurídica"]})]})]})})]}),s.client_type==="Pessoa Física"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsx(j,{label:"CPF",id:"cpf",children:e.jsx(d,{id:"cpf",name:"cpf",value:s.cpf||"",onChange:t})}),e.jsx(j,{label:"Data de Nascimento",id:"birth_date_registration",children:e.jsx(d,{type:"date",id:"birth_date_registration",name:"birth_date",value:s.birth_date||"",onChange:t})})]}),s.client_type==="Pessoa Jurídica"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:[e.jsx(j,{label:"CNPJ",id:"cnpj",children:e.jsx(d,{id:"cnpj",name:"cnpj",value:s.cnpj||"",onChange:t})}),e.jsx(j,{label:"Nome do Contato Principal",id:"contact_person_name",children:e.jsx(d,{id:"contact_person_name",name:"contact_person_name",value:s.contact_person_name||"",onChange:t})}),e.jsx(j,{label:"Cargo do Contato Principal",id:"contact_person_role",children:e.jsx(d,{id:"contact_person_role",name:"contact_person_role",value:s.contact_person_role||"",onChange:t})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mt-4",children:e.jsx(j,{label:"Status do Cliente",id:"status",children:e.jsxs(ee,{name:"status",value:s.status||"Ativo",onValueChange:a=>t({target:{name:"status",value:a}}),children:[e.jsx(se,{children:e.jsx(ae,{placeholder:"Selecione o status"})}),e.jsxs(te,{children:[e.jsx(k,{value:"Ativo",children:"Ativo"}),e.jsx(k,{value:"Inativo",children:"Inativo"}),e.jsx(k,{value:"Lead",children:"Lead"}),e.jsx(k,{value:"Prospect",children:"Prospect"}),e.jsx(k,{value:"Bloqueado",children:"Bloqueado"})]})]})})}),e.jsx(Y,{icon:Te,title:"Informações de Contato"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"Telefone Principal",id:"phone",children:e.jsx(d,{id:"phone",name:"phone",value:s.phone||"",onChange:t})}),e.jsx(j,{label:"Email Principal",id:"email",children:e.jsx(d,{type:"email",id:"email",name:"email",value:s.email||"",onChange:t})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(S,{className:"text-sm font-medium text-muted-foreground mb-1",children:"Telefones Adicionais"}),(s.additional_phones||[]).map((a,m)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(d,{value:a||"",onChange:u=>l(m,u.target.value),placeholder:"Ex: (XX) XXXXX-XXXX"}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>f(m),className:"text-destructive/70 hover:text-destructive",children:e.jsx(re,{className:"w-4 h-4"})})]},m)),e.jsxs(y,{variant:"outline",size:"sm",onClick:p,className:"mt-2",children:[e.jsx(U,{className:"w-4 h-4 mr-2"})," Adicionar Telefone"]})]}),e.jsx(Y,{icon:ss,title:"Endereço"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"CEP",id:"zip_code",children:e.jsx(d,{id:"zip_code",value:s.address?.zip_code||"",onChange:a=>o("address","zip_code",a.target.value)})}),e.jsx(j,{label:"Logradouro",id:"street",children:e.jsx(d,{id:"street",value:s.address?.street||"",onChange:a=>o("address","street",a.target.value)})}),e.jsx(j,{label:"Número",id:"number",children:e.jsx(d,{id:"number",value:s.address?.number||"",onChange:a=>o("address","number",a.target.value)})}),e.jsx(j,{label:"Complemento",id:"complement",children:e.jsx(d,{id:"complement",value:s.address?.complement||"",onChange:a=>o("address","complement",a.target.value)})}),e.jsx(j,{label:"Bairro",id:"neighborhood",children:e.jsx(d,{id:"neighborhood",value:s.address?.neighborhood||"",onChange:a=>o("address","neighborhood",a.target.value)})}),e.jsx(j,{label:"Cidade",id:"city",children:e.jsx(d,{id:"city",value:s.address?.city||"",onChange:a=>o("address","city",a.target.value)})}),e.jsx(j,{label:"Estado",id:"state",children:e.jsx(d,{id:"state",value:s.address?.state||"",onChange:a=>o("address","state",a.target.value)})}),e.jsx(j,{label:"País",id:"country",children:e.jsx(d,{id:"country",value:s.address?.country||"Brasil",onChange:a=>o("address","country",a.target.value)})})]})]}):null,he=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-4 mt-6 border-b border-border pb-2",children:[e.jsx(s,{className:"w-5 h-5 mr-2"}),t]}),E=({label:s,id:t,children:o,icon:l,className:p})=>e.jsxs("div",{className:`mb-4 ${p}`,children:[e.jsxs(S,{htmlFor:t,className:"text-sm font-medium text-muted-foreground flex items-center mb-1",children:[l&&e.jsx(l,{className:"w-4 h-4 mr-2 text-primary"}),s]}),o]}),ys=({formData:s,handleChange:t,handleJsonFieldChange:o,handleFamilyInfoArrayChange:l,addFamilyMember:p,removeFamilyMember:f})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(E,{label:"Como conheceu seu trabalho?",id:"client_origin",icon:ue,children:e.jsx(d,{id:"client_origin",name:"client_origin",value:s.client_origin||"",onChange:t})}),e.jsxs("div",{className:"campo-formulario mb-4",children:[e.jsxs(S,{htmlFor:"birth_date_relationship_marketing",className:"text-sm font-medium text-muted-foreground flex items-center mb-1",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2 text-primary"}),"Data de Nascimento (Aniversário)"]}),e.jsx(d,{type:"date",id:"birth_date_relationship_marketing",name:"birth_date",value:s.birth_date||"",onChange:t})]})]}),e.jsx(he,{icon:ue,title:"Informações Familiares"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(E,{label:"Nome Cônjuge/Parceiro(a)",id:"partner_name",children:e.jsx(d,{id:"partner_name",name:"family_info.partner_name",value:s.family_info?.partner_name||"",onChange:a=>o("family_info","partner_name",a.target.value)})}),e.jsx(E,{label:"Aniversário de Casamento",id:"wedding_anniversary",children:e.jsx(d,{type:"date",id:"wedding_anniversary",name:"family_info.wedding_anniversary",value:s.family_info?.wedding_anniversary||"",onChange:a=>o("family_info","wedding_anniversary",a.target.value)})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(S,{className:"text-sm font-medium text-muted-foreground mb-1",children:"Filhos(as) (Nome e Data de Nascimento)"}),(s.family_info?.children_names_birthdays||[]).map((a,m)=>e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 items-center mb-2 p-3 border rounded-md bg-muted/20",children:[e.jsx(d,{placeholder:"Nome do Filho(a)",value:a.name||"",onChange:u=>l(m,"name",u.target.value),className:"bg-background"}),e.jsx(d,{type:"date",value:a.birth_date||"",onChange:u=>l(m,"birth_date",u.target.value),className:"bg-background"}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>f(m),className:"text-destructive/70 hover:text-destructive sm:ml-auto",children:e.jsx(Ee,{className:"w-4 h-4"})})]},m)),e.jsxs(y,{variant:"outline",size:"sm",onClick:p,className:"mt-2",children:[e.jsx(U,{className:"w-4 h-4 mr-2"})," Adicionar Filho(a)"]})]}),e.jsx(E,{label:"Preferências de Estilo",id:"style_preferences",icon:as,children:e.jsx(ge,{id:"style_preferences",name:"style_preferences",value:s.style_preferences||"",onChange:t,rows:4})}),e.jsx(he,{icon:ie,title:"Redes Sociais"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(E,{label:"Instagram",id:"instagram",children:e.jsx(d,{id:"instagram",name:"social_media.instagram",value:s.social_media?.instagram||"",onChange:a=>o("social_media","instagram",a.target.value),placeholder:"ex: @usuario"})}),e.jsx(E,{label:"Facebook",id:"facebook",children:e.jsx(d,{id:"facebook",name:"social_media.facebook",value:s.social_media?.facebook||"",onChange:a=>o("social_media","facebook",a.target.value),placeholder:"ex: facebook.com/usuario"})}),e.jsx(E,{label:"LinkedIn",id:"linkedin",children:e.jsx(d,{id:"linkedin",name:"social_media.linkedin",value:s.social_media?.linkedin||"",onChange:a=>o("social_media","linkedin",a.target.value)})}),e.jsx(E,{label:"Outra Rede",id:"other_social",children:e.jsx(d,{id:"other_social",name:"social_media.other",value:s.social_media?.other||"",onChange:a=>o("social_media","other",a.target.value)})})]})]}),Ns=({isOpen:s,onClose:t,clientId:o,editingOrcamento:l,onSuccess:p})=>{const{toast:f}=ne(),{user:a,addOrcamento:m,updateOrcamento:u}=$(),[i,g]=v.useState({descricao_servico:"",valor:"",data_envio:new Date().toISOString().split("T")[0],status:"Enviado",link_pdf:""}),[b,T]=v.useState(!1);v.useEffect(()=>{g(l?{descricao_servico:l.descricao_servico||"",valor:l.valor||"",data_envio:l.data_envio?new Date(l.data_envio+"T00:00:00").toISOString().split("T")[0]:new Date().toISOString().split("T")[0],status:l.status||"Enviado",link_pdf:l.link_pdf||""}:{descricao_servico:"",valor:"",data_envio:new Date().toISOString().split("T")[0],status:"Enviado",link_pdf:""})},[l,s]);const N=_=>{const{name:w,value:C}=_.target;g(L=>({...L,[w]:C}))},F=(_,w)=>{g(C=>({...C,[_]:w}))},I=async _=>{if(_.preventDefault(),!a||!o){f({title:"Erro",description:"Usuário ou cliente não identificado.",variant:"destructive"});return}T(!0);const w={...i,valor:parseFloat(i.valor)||0,client_id:o,user_id:a.id};try{l?(await u(l.id,w),f({title:"Sucesso!",description:"Orçamento atualizado."})):(await m(w),f({title:"Sucesso!",description:"Orçamento adicionado."})),p()}catch(C){console.error("Erro ao salvar orçamento:",C),f({title:"Erro ao salvar",description:C.message||"Não foi possível salvar o orçamento.",variant:"destructive"})}finally{T(!1)}};return e.jsx(Fe,{open:s,onOpenChange:t,children:e.jsxs(Ie,{className:"sm:max-w-[525px] border-border shadow-xl",children:[e.jsxs(Oe,{children:[e.jsxs(Le,{className:"flex items-center text-primary",children:[l?e.jsx(ve,{className:"mr-2 h-5 w-5"}):e.jsx(U,{className:"mr-2 h-5 w-5"}),l?"Editar Orçamento":"Novo Orçamento"]}),e.jsx(Me,{children:l?"Atualize os detalhes do orçamento.":"Preencha os detalhes para registrar um novo orçamento."})]}),e.jsxs("form",{onSubmit:I,className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"descricao_servico",className:"text-right col-span-1",children:"Descrição"}),e.jsx(ge,{id:"descricao_servico",name:"descricao_servico",value:i.descricao_servico,onChange:N,className:"col-span-3",placeholder:"Ex: Pacote Casamento Essencial",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"valor",className:"text-right col-span-1",children:"Valor (R$)"}),e.jsx(d,{id:"valor",name:"valor",type:"number",step:"0.01",value:i.valor,onChange:N,className:"col-span-3",placeholder:"Ex: 1500.00",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"data_envio",className:"text-right col-span-1",children:"Data de Envio"}),e.jsx(d,{id:"data_envio",name:"data_envio",type:"date",value:i.data_envio,onChange:N,className:"col-span-3",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"status",className:"text-right col-span-1",children:"Status"}),e.jsxs(ee,{name:"status",value:i.status,onValueChange:_=>F("status",_),children:[e.jsx(se,{className:"col-span-3",children:e.jsx(ae,{placeholder:"Selecione o status"})}),e.jsxs(te,{children:[e.jsx(k,{value:"Enviado",children:"Enviado"}),e.jsx(k,{value:"Visto",children:"Visto"}),e.jsx(k,{value:"Aprovado",children:"Aprovado"}),e.jsx(k,{value:"Recusado",children:"Recusado"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(S,{htmlFor:"link_pdf",className:"text-right col-span-1",children:"Link PDF"}),e.jsx(d,{id:"link_pdf",name:"link_pdf",type:"url",value:i.link_pdf,onChange:N,className:"col-span-3",placeholder:"https://seu-orcamento.com/link.pdf"})]}),e.jsxs(De,{className:"pt-4",children:[e.jsxs(y,{type:"button",variant:"outline",onClick:t,disabled:b,children:[e.jsx(Re,{className:"mr-2 h-4 w-4"}),"Cancelar"]}),e.jsxs(y,{type:"submit",disabled:b,className:"btn-custom-gradient",children:[e.jsx(fe,{className:"mr-2 h-4 w-4"}),b?l?"Salvando Alterações...":"Salvando Orçamento...":l?"Salvar Alterações":"Salvar Orçamento"]})]})]})]})})},xe=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-4 mt-6 border-b border-border pb-2",children:[e.jsx(s,{className:"w-5 h-5 mr-2"}),t]}),ws=({formData:s})=>{const{toast:t}=ne(),{user:o,clientContracts:l,addClientContract:p,deleteClientContract:f,refreshClientContracts:a,clientOrcamentos:m,refreshClientOrcamentos:u,deleteOrcamento:i}=$(),g=v.useRef(null),[b,T]=v.useState(null),[N,F]=v.useState(!1),[I,_]=v.useState(0),[w,C]=v.useState(!1),[L,D]=v.useState(null),[R,r]=v.useState(null),[h,x]=v.useState(!1),c=s.id;v.useEffect(()=>{c&&(a&&a(c),u&&u(c))},[c,a,u]);const O=n=>{const A=n.target.files[0];A&&T(A)},be=async()=>{if(!b||!o||!c){t({title:"Atenção",description:"Selecione um arquivo e certifique-se de que o cliente está carregado.",variant:"warning"});return}F(!0),_(0);const n=b.name,A=Ue(n.substring(0,n.lastIndexOf("."))||n),q=n.substring(n.lastIndexOf(".")),V=Ve().substring(0,8),X=`${A}_${V}${q}`,ce=`${o.id}/${c}/${X}`;try{const{error:M}=await me.storage.from("contracts").upload(ce,b,{cacheControl:"3600",upsert:!1,contentType:b.type,onUploadProgress:G=>{G.total&&_(Math.round(G.loaded/G.total*100))}});if(M)throw M;const{data:H}=me.storage.from("contracts").getPublicUrl(ce);if(!H||!H.publicUrl)throw new Error("Não foi possível obter a URL pública do arquivo.");const ke={client_id:c,user_id:o.id,nome_arquivo:n,url_arquivo:H.publicUrl};await p(ke),t({title:"Sucesso!",description:"Contrato anexado com sucesso.",variant:"success",icon:e.jsx(W,{className:"h-5 w-5"})}),T(null),g.current&&(g.current.value=""),a(c)}catch(M){console.error("Erro no upload ou registro do contrato:",M),t({title:"Erro ao anexar contrato",description:M.message||"Ocorreu um problema. Tente novamente.",variant:"destructive",icon:e.jsx(K,{className:"h-5 w-5"})})}finally{F(!1),_(0)}},_e=async(n,A)=>{if(!A){t({title:"Erro",description:"URL do arquivo inválida.",variant:"destructive"});return}const q=A.split("/contracts/");if(q.length<2){t({title:"Erro",description:"Formato da URL do arquivo inválido.",variant:"destructive"});return}const V=q[1];try{await f(n,V),t({title:"Sucesso",description:"Contrato excluído com sucesso.",variant:"success",icon:e.jsx(W,{className:"h-5 w-5"})}),a(c)}catch(X){t({title:"Erro ao excluir contrato",description:X.message,variant:"destructive",icon:e.jsx(K,{className:"h-5 w-5"})})}},le=(n=null)=>{D(n),C(!0)},oe=()=>{D(null),C(!1)},ye=n=>{r(n),x(!0)},Ne=async()=>{if(R)try{await i(R.id),t({title:"Sucesso",description:"Orçamento excluído com sucesso.",variant:"success",icon:e.jsx(W,{className:"h-5 w-5"})}),u(c)}catch(n){t({title:"Erro ao excluir orçamento",description:n.message,variant:"destructive",icon:e.jsx(K,{className:"h-5 w-5"})})}x(!1),r(null)},we=n=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n||0),Ce=n=>{if(!n)return"N/A";try{return new Date(n+"T00:00:00").toLocaleDateString("pt-BR")}catch{return"Data inválida"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(xe,{icon:qe,title:"Contratos Anexados"}),e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg border border-dashed border-primary/50",children:[e.jsx(S,{htmlFor:"contract-upload",className:"block text-sm font-medium text-muted-foreground mb-2",children:"Anexar Novo Contrato (PDF, DOCX, etc.)"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3",children:[e.jsx(d,{id:"contract-upload",type:"file",ref:g,onChange:O,className:"flex-grow file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer",disabled:N}),e.jsxs(y,{onClick:be,disabled:!b||N,className:"w-full sm:w-auto btn-custom-gradient",children:[e.jsx(ms,{className:"w-4 h-4 mr-2"}),N?`Enviando... ${I}%`:"Anexar Contrato"]})]}),N&&e.jsx("div",{className:"w-full bg-muted rounded-full h-1.5 mt-2 overflow-hidden",children:e.jsx("div",{className:"bg-primary h-1.5 rounded-full transition-all duration-300 ease-linear",style:{width:`${I}%`}})}),b&&!N&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Arquivo selecionado: ",b.name]})]}),l&&l.length>0?e.jsx("ul",{className:"space-y-3",children:l.map(n=>e.jsxs("li",{className:"flex items-center justify-between p-3 bg-card border border-border rounded-md shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("a",{href:n.url_arquivo,target:"_blank",rel:"noopener noreferrer",className:"flex items-center text-primary hover:underline truncate",title:n.nome_arquivo,children:[e.jsx(ie,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:n.nome_arquivo||"Contrato sem nome"})]}),e.jsx(y,{variant:"ghost",size:"icon",onClick:()=>_e(n.id,n.url_arquivo),className:"text-destructive/70 hover:text-destructive hover:bg-destructive/10 ml-2 flex-shrink-0",title:"Excluir contrato",children:e.jsx(re,{className:"w-4 h-4"})})]},n.id))}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum contrato anexado a este cliente."}),e.jsx(xe,{icon:js,title:"Orçamentos Enviados"}),e.jsx("div",{className:"flex justify-end mb-4",children:e.jsxs(y,{onClick:()=>le(),className:"btn-custom-gradient",children:[e.jsx(U,{className:"w-4 h-4 mr-2"})," Novo Orçamento"]})}),m&&m.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-border",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Descrição"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Valor"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Data Envio"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-muted-foreground uppercase tracking-wider",children:"PDF"}),e.jsx("th",{scope:"col",className:"relative px-4 py-3",children:e.jsx("span",{className:"sr-only",children:"Ações"})})]})}),e.jsx("tbody",{className:"bg-card divide-y divide-border",children:m.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-foreground",children:n.descricao_servico}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-foreground",children:we(n.valor)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-muted-foreground",children:Ce(n.data_envio)}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                      ${n.status==="Aprovado"?"bg-green-100 text-green-800":n.status==="Recusado"?"bg-red-100 text-red-800":n.status==="Visto"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:n.status})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-muted-foreground",children:n.link_pdf?e.jsxs("a",{href:n.link_pdf,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:[e.jsx(ie,{className:"w-4 h-4 inline-block"})," Ver PDF"]}):"-"}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs(Be,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(y,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu"}),e.jsx(us,{className:"h-4 w-4"})]})}),e.jsxs($e,{align:"end",children:[e.jsxs(de,{onClick:()=>le(n),children:[e.jsx(ve,{className:"mr-2 h-4 w-4"})," Editar Status"]}),e.jsxs(de,{onClick:()=>ye(n),className:"text-destructive focus:text-destructive focus:bg-destructive/10",children:[e.jsx(re,{className:"mr-2 h-4 w-4"})," Excluir"]})]})]})})]},n.id))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum orçamento enviado para este cliente."}),w&&e.jsx(Ns,{isOpen:w,onClose:oe,clientId:c,editingOrcamento:L,onSuccess:()=>{oe(),u&&u(c)}}),e.jsx(ts,{open:h,onOpenChange:x,children:e.jsxs(rs,{children:[e.jsxs(is,{children:[e.jsx(ns,{children:"Confirmar Exclusão"}),e.jsx(ls,{children:"Tem certeza que deseja excluir este orçamento? Esta ação não poderá ser desfeita."})]}),e.jsxs(os,{children:[e.jsx(cs,{onClick:()=>r(null),children:"Cancelar"}),e.jsx(ds,{onClick:Ne,className:"bg-destructive hover:bg-destructive/90",children:"Excluir"})]})]})})]})},Cs=({icon:s,title:t})=>e.jsxs("div",{className:"flex items-center text-lg font-semibold text-primary mb-6 mt-2 border-b border-border pb-3",children:[e.jsx(s,{className:"w-6 h-6 mr-3 text-primary"}),t]}),ks=({clientId:s})=>{const{workflowCards:t,getStatusLabel:o}=$(),l=je(),p=v.useMemo(()=>t.filter(i=>i.client_id===s&&!i.archived).sort((i,g)=>{const b=i.date?Q(i.date):new Date(0);return(g.date?Q(g.date):new Date(0))-b}),[t,s]),f=i=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(i||0),a=i=>{if(!i)return"N/A";try{const g=Q(i.includes("T")?i:`${i}T00:00:00`);return Ke(g,"dd/MM/yyyy",{locale:ps})}catch(g){return console.error("Erro ao formatar data:",i,g),"Data inválida"}},m=i=>{l(`/workflow?openCard=${i}`)},u=i=>{switch(i){case"concluido":return"bg-green-500 hover:bg-green-600";case"agendado":return"bg-blue-500 hover:bg-blue-600";case"em-andamento":return"bg-yellow-500 text-black hover:bg-yellow-600";case"proposta-enviada":return"bg-orange-300 hover:bg-purple-600";case"novo-lead":return"bg-pink-500 hover:bg-pink-600";default:return"bg-gray-500 hover:bg-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Cs,{icon:Z,title:"Histórico de Serviços Prestados"}),p.length>0?e.jsx(Xe,{className:"h-[600px] pr-4 -mr-4",children:e.jsx("div",{className:"space-y-4",children:p.map(i=>e.jsx(He,{className:"overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 ease-in-out border-l-4 border-primary cursor-pointer",onClick:()=>m(i.id),children:e.jsxs(Ge,{className:"p-4 sm:p-6 space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1 sm:mb-0",children:i.title||"Serviço não especificado"}),e.jsx(hs,{className:`text-xs text-white ${u(i.status)}`,children:o(i.status)})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-2 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(xs,{className:"w-4 h-4 mr-2 text-primary"}),e.jsxs("span",{children:["Data: ",a(i.date)," ",i.time?`às ${i.time}`:""]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(We,{className:"w-4 h-4 mr-2 text-primary"}),e.jsxs("span",{children:["Valor: ",f(i.value)]})]})]}),i.description&&e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2 pt-2",children:i.description}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsxs(y,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary/80",children:["Ver Detalhes no Fluxo",e.jsx(fs,{className:"w-4 h-4 ml-2"})]})})]})},i.id))})}):e.jsxs("div",{className:"text-center py-10",children:[e.jsx(Z,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Nenhum serviço prestado encontrado para este cliente."})]})]})},Ss=({formData:s,handleChange:t,handleJsonFieldChange:o,handleFamilyInfoArrayChange:l,addFamilyMember:p,removeFamilyMember:f,handleAdditionalPhoneChange:a,addAdditionalPhone:m,removeAdditionalPhone:u})=>e.jsxs(Je,{defaultValue:"dados-cadastrais",className:"w-full",children:[e.jsxs(es,{className:"grid w-full grid-cols-1 sm:grid-cols-4 mb-6 bg-muted/50",children:[" ",e.jsx(B,{value:"dados-cadastrais",children:"Dados Cadastrais"}),e.jsx(B,{value:"relacionamento-marketing",children:"Relacionamento e Marketing"}),e.jsx(B,{value:"juridico-contratos",children:"Jurídico e Contratos"}),e.jsx(B,{value:"historico-servicos",children:"Histórico"})," "]}),e.jsx(z,{value:"dados-cadastrais",children:e.jsx(_s,{formData:s,handleChange:t,handleJsonFieldChange:o,handleAdditionalPhoneChange:a,addAdditionalPhone:m,removeAdditionalPhone:u})}),e.jsx(z,{value:"relacionamento-marketing",children:e.jsx(ys,{formData:s,handleChange:t,handleJsonFieldChange:o,handleFamilyInfoArrayChange:l,addFamilyMember:p,removeFamilyMember:f})}),e.jsx(z,{value:"juridico-contratos",children:e.jsx(ws,{formData:s})}),e.jsxs(z,{value:"historico-servicos",children:[" ",e.jsx(ks,{clientId:s.id})]})]}),P={name:"",email:"",phone:"",client_type:"Pessoa Física",cpf:"",cnpj:"",status:"Ativo",birth_date:"",contact_person_name:"",contact_person_role:"",address:{street:"",number:"",complement:"",neighborhood:"",city:"",state:"",zip_code:"",country:"Brasil"},additional_phones:[],client_origin:"",family_info:{partner_name:"",children_names_birthdays:[{name:"",birth_date:""}],wedding_anniversary:""},style_preferences:"",image_auth_status:"Não Solicitado",social_media:{instagram:"",facebook:"",linkedin:"",other:""}},Us=()=>{const{clientId:s}=Qe(),t=je(),{getClientById:o,updateClient:l,loading:p,refreshClientContracts:f}=$(),{toast:a}=ne(),[m,u]=v.useState(null),[i,g]=v.useState(!0),[b,T]=v.useState(!1);Ye(),v.useEffect(()=>{g(!0);const r=o(s);if(r){const h={...P,...r,birth_date:r.birth_date?r.birth_date.split("T")[0]:"",address:{...P.address,...r.address||{}},family_info:{...P.family_info,...r.family_info||{},wedding_anniversary:r.family_info?.wedding_anniversary?r.family_info.wedding_anniversary.split("T")[0]:"",children_names_birthdays:(r.family_info?.children_names_birthdays||[]).map(x=>({...x,birth_date:x.birth_date?x.birth_date.split("T")[0]:""}))},social_media:{...P.social_media,...r.social_media||{}},additional_phones:r.additional_phones||[]};u(h),f&&f(s),g(!1)}else p||(a({title:"Erro",description:"Cliente não encontrado.",variant:"destructive"}),t("/clients"),g(!1))},[s,o,p,t,a,f]);const N=r=>{const{name:h,value:x}=r.target;u(h==="client_type"?c=>({...c,client_type:x,cpf:x==="Pessoa Jurídica"?"":c.cpf,cnpj:x==="Pessoa Física"?"":c.cnpj,birth_date:x==="Pessoa Jurídica"?"":c.birth_date,contact_person_name:x==="Pessoa Física"?"":c.contact_person_name,contact_person_role:x==="Pessoa Física"?"":c.contact_person_role}):c=>({...c,[h]:x}))},F=(r,h,x)=>{u(c=>({...c,[r]:{...c[r]||(r==="address"?P.address:r==="family_info"?P.family_info:P.social_media),[h]:x}}))},I=(r,h,x)=>{u(c=>{const O=[...c.family_info?.children_names_birthdays||[]];return O[r]||(O[r]={name:"",birth_date:""}),O[r][h]=x,{...c,family_info:{...c.family_info||P.family_info,children_names_birthdays:O}}})},_=()=>{u(r=>({...r,family_info:{...r.family_info||P.family_info,children_names_birthdays:[...r.family_info?.children_names_birthdays||[],{name:"",birth_date:""}]}}))},w=r=>{u(h=>({...h,family_info:{...h.family_info||P.family_info,children_names_birthdays:(h.family_info?.children_names_birthdays||[]).filter((x,c)=>c!==r)}}))},C=(r,h)=>{u(x=>{const c=[...x.additional_phones||[]];return c[r]=h,{...x,additional_phones:c}})},L=()=>{u(r=>({...r,additional_phones:[...r.additional_phones||[],""]}))},D=r=>{u(h=>({...h,additional_phones:(h.additional_phones||[]).filter((x,c)=>c!==r)}))},R=async()=>{T(!0);try{const r={...m,birth_date:m.birth_date||null,family_info:{...m.family_info,wedding_anniversary:m.family_info?.wedding_anniversary||null,children_names_birthdays:(m.family_info?.children_names_birthdays||[]).map(h=>({...h,birth_date:h.birth_date||null})).filter(h=>h.name||h.birth_date)},additional_phones:(m.additional_phones||[]).filter(h=>h&&h.trim()!=="")};r.client_type==="Pessoa Física"?(r.cnpj=null,r.contact_person_name=null,r.contact_person_role=null):r.client_type==="Pessoa Jurídica"&&(r.cpf=null),await l(s,r),a({title:"Sucesso!",description:"Dados do cliente atualizados."})}catch(r){a({title:"Erro ao salvar",description:r.message,variant:"destructive"})}finally{T(!1)}};return i||!m?e.jsx(vs,{theme:"dark"}):e.jsxs(Ze.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6 max-w-5xl mx-auto pb-10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{variant:"ghost",onClick:()=>t("/clients"),className:"text-primary hover:bg-primary/10",children:[e.jsx(gs,{className:"w-5 h-5 mr-2"}),"Voltar para Clientes"]}),e.jsxs(y,{onClick:R,disabled:b,className:"btn-custom-gradient text-white shadow-lg",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),b?"Salvando...":"Salvar Alterações"]})]}),e.jsxs("div",{className:"bg-card rounded-xl p-6 shadow-xl border border-border",children:[e.jsx(bs,{clientType:m.client_type,clientName:m.name,clientStatus:m.status}),e.jsx(Ss,{formData:m,handleChange:N,handleJsonFieldChange:F,handleFamilyInfoArrayChange:I,addFamilyMember:_,removeFamilyMember:w,handleAdditionalPhoneChange:C,addAdditionalPhone:L,removeAdditionalPhone:D})]})]})};export{Us as default,P as initialFormData};
